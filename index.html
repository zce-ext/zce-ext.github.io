<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5">
<meta name="author" content="Version 0.50.1">
<title>RISC-V Zce code-size reduction extension proposal v0.50.1</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>RISC-V Zce code-size reduction extension proposal v0.50.1</h1>
<div class="details">
<span id="author" class="author">Version 0.50.1</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_spec_update_history">1. Spec update history</a></li>
<li><a href="#_github_issues_may_not_be_a_complete_list">2. Github issues (may not be a complete list)</a></li>
<li><a href="#__code_zce_code_configurations">3. <code>Zce</code> configurations</a></li>
<li><a href="#_c_extension_subsets">4. C-extension subsets</a></li>
<li><a href="#_allocation_of_new_16_bit_encodings">5. Allocation of new 16-bit encodings</a>
<ul class="sectlevel2">
<li><a href="#_16_bit_encoding_code_points">5.1. 16-bit encoding code-points</a></li>
</ul>
</li>
<li><a href="#__code_zcee_code_definition">6. <code>Zcee</code> definition</a>
<ul class="sectlevel2">
<li><a href="#_c_sext_b_c_sext_h_c_zext_b_c_zext_h_c_zext_w_c_mul">6.1. C.SEXT.B, C.SEXT.H, C.ZEXT.B, C.ZEXT.H, C.ZEXT.W, C.MUL</a></li>
<li><a href="#_c_sext_w">6.2. C.SEXT.W</a></li>
</ul>
</li>
<li><a href="#__code_zcea_code_definition">7. <code>Zcea</code> definition</a>
<ul class="sectlevel2">
<li><a href="#c_not_c_neg">7.1. C.NOT, C.NEG</a></li>
<li><a href="#_c_mva01s07">7.2. C.MVA01S07</a></li>
<li><a href="#_muli">7.3. MULI</a></li>
<li><a href="#cmpimmbr">7.4. BEQI, BNEI</a></li>
<li><a href="#_table_jump">7.5. Table Jump</a>
<ul class="sectlevel3">
<li><a href="#tablejump16">7.5.1. C.TBLJ, C.TBLJAL, C.TBLJALM</a></li>
</ul>
</li>
<li><a href="#pushpoppopret_heading">7.6. PUSH and POP</a>
<ul class="sectlevel3">
<li><a href="#pushpop32">7.6.1. PUSH, POP, POPRET, PUSH.E, POP.E, POPRET.E</a></li>
<li><a href="#pushpop16">7.6.2. C.PUSH, C.POP, C.POPRET, C.PUSH.E, C.POP.E, C.POPRET.E</a></li>
</ul>
</li>
<li><a href="#_b_extension_recommended_subsets_for_code_size_reduction">7.7. B-extension recommended subsets for code-size reduction</a></li>
</ul>
</li>
<li><a href="#__code_zceb_code_definition">8. <code>Zceb</code> definition</a>
<ul class="sectlevel2">
<li><a href="#_decrement_and_branch">8.1. Decrement and branch</a>
<ul class="sectlevel3">
<li><a href="#decbr16">8.1.1. C.DECBNEZ</a></li>
<li><a href="#_decbnez_limited_value">8.1.2. DECBNEZ (limited value?)</a></li>
</ul>
</li>
<li><a href="#_lwgp_swgp_ldgp_sdgp">8.2. LWGP, SWGP, LDGP, SDGP</a></li>
<li><a href="#_c_lbu_c_lhu_c_lb_c_lh_c_sb_c_sh">8.3. C.LBU, C.LHU, C.LB, C.LH, C.SB, C.SH</a></li>
</ul>
</li>
<li><a href="#tablejump">9. Table Jump</a>
<ul class="sectlevel2">
<li><a href="#_rationale">9.1. Rationale</a></li>
<li><a href="#_encoding">9.2. Encoding</a></li>
<li><a href="#configuringthejumptable">9.3. Recommended algorithm for allocating entries in the jump table</a></li>
<li><a href="#_csrs">9.4. CSRs</a></li>
<li><a href="#_jump_table_mode">9.5. Jump table mode</a>
<ul class="sectlevel3">
<li><a href="#_pseudo_code_for_jump_table_mode">9.5.1. Pseudo-code for jump table mode</a></li>
<li><a href="#_exceptions_for_jump_table_mode">9.5.2. Exceptions for jump table mode</a></li>
<li><a href="#_single_stepping">9.5.3. Single stepping</a></li>
<li><a href="#_context_switching_for_jump_table_mode">9.5.4. Context Switching for jump table mode</a></li>
<li><a href="#_caching_for_jump_table_mode">9.5.5. Caching for jump table mode</a></li>
</ul>
</li>
<li><a href="#vector-table-mode">9.6. Future Mode: Vector table mode (not for RVM22/RVA22)</a>
<ul class="sectlevel3">
<li><a href="#_pseudo_code_for_vector_table_mode">9.6.1. Pseudo-code for vector table mode</a></li>
<li><a href="#_vector_table_code">9.6.2. vector table code</a></li>
<li><a href="#_vector_mode_security_future_ideas">9.6.3. Vector Mode Security (future ideas)</a></li>
</ul>
</li>
<li><a href="#emulation-mode">9.7. Future Mode: Emulation Mode (not for RVM22/RVA22)</a>
<ul class="sectlevel3">
<li><a href="#_pseudo_code_for_emulation_mode">9.7.1. Pseudo-code for emulation mode</a></li>
</ul>
</li>
<li><a href="#_diagram_for_all_table_jump_modes">9.8. Diagram for all table jump modes</a></li>
</ul>
</li>
<li><a href="#pushpoppopret">10. PUSH and POP</a>
<ul class="sectlevel2">
<li><a href="#_a_brief_example_from_zephyr">10.1. A brief example from Zephyr</a></li>
<li><a href="#uabiandeabisupport">10.2. UABI and EABI support</a></li>
<li><a href="#_assembler_syntax">10.3. Assembler Syntax</a>
<ul class="sectlevel3">
<li><a href="#pushpop32bitsyntax">10.3.1. 32-bit encoding assembler syntax</a></li>
<li><a href="#_16_bit_encoding_assembler_syntax">10.3.2. 16-bit encoding assembler syntax</a></li>
</ul>
</li>
<li><a href="#_determining_xlen_to_decode_and_execute_the_instructions">10.4. Determining XLEN to decode and execute the instructions</a></li>
<li><a href="#_pseudo_code">10.5. Pseudo-code</a>
<ul class="sectlevel3">
<li><a href="#_push_push_e_c_push_c_push_e_pseudo_code">10.5.1. PUSH/PUSH.E/C.PUSH/C.PUSH.E Pseudo-code</a></li>
<li><a href="#_pop_pop_e_popret_popret_e_c_pop_c_pop_e_c_popret_c_popret_e_pseudo_code">10.5.2. POP/POP.E/POPRET/POPRET.E/C.POP/C.POP.E/C.POPRET/C.POPRET.E Pseudo-code</a></li>
</ul>
</li>
<li><a href="#pushpoppopret32bitencodings">10.6. 32-bit Encodings</a>
<ul class="sectlevel3">
<li><a href="#_illegal_instructions">10.6.1. Illegal instructions</a></li>
</ul>
</li>
<li><a href="#pushpoppopret16bitIencodings">10.7. 16-bit Encodings</a>
<ul class="sectlevel3">
<li><a href="#spimm">10.7.1. <code>spimm</code> encoding field</a></li>
<li><a href="#total-stack-rv32">10.7.2. Total stack adjustment ranges for RV32</a></li>
<li><a href="#total-stack-rv64">10.7.3. Total stack adjustment ranges for RV64</a></li>
</ul>
</li>
<li><a href="#fault-handling">10.8. Fault handling</a></li>
<li><a href="#software-view">10.9. Software view of execution</a>
<ul class="sectlevel3">
<li><a href="#_software_view_of_code_push_code_sequence">10.9.1. Software view of <code>PUSH</code> sequence</a></li>
<li><a href="#_software_view_of_code_pop_popret_code_sequence">10.9.2. Software view of <code>POP/POPRET</code> sequence</a></li>
<li><a href="#non-idem-mem">10.9.3. Non-idempotent memory</a></li>
<li><a href="#_error_detection">10.9.4. Error detection</a></li>
<li><a href="#_non_idempotent_support">10.9.5. Non-idempotent support</a></li>
</ul>
</li>
<li><a href="#_toolchain_implementation">10.10. Toolchain implementation</a>
<ul class="sectlevel3">
<li><a href="#_compiling_for_size_or_performance">10.10.1. Compiling for size or performance</a></li>
</ul>
</li>
<li><a href="#_assembly_examples">10.11. Assembly examples</a>
<ul class="sectlevel3">
<li><a href="#push-example-1">10.11.1. C.PUSH RV32 UABI (16-byte aligned stack)</a></li>
<li><a href="#_c_push_rv32i_uabi_16_byte_aligned_stack">10.11.2. C.PUSH RV32I UABI (16-byte aligned stack)</a></li>
<li><a href="#_c_pop_rv32i_uabi_16_byte_aligned_stack">10.11.3. C.POP RV32I UABI (16-byte aligned stack)</a></li>
<li><a href="#popret-example-1">10.11.4. C.POPRET RV32I UABI (16-byte aligned stack)</a></li>
<li><a href="#_pop_rv32i_uabi_16_byte_aligned_stack">10.11.5. POP RV32I UABI (16-byte aligned stack)</a></li>
</ul>
</li>
<li><a href="#ldstm">10.12. Appendix: Usage as load/store-multiple</a></li>
<li><a href="#benchmarkingpushpop">10.13. Appendix: Benchmarking PUSH/POP against -msave-restore</a>
<ul class="sectlevel3">
<li><a href="#_benchmarking_configuration_1">10.13.1. Benchmarking configuration 1</a></li>
<li><a href="#_benchmarking_configuration_2">10.13.2. Benchmarking configuration 2</a></li>
<li><a href="#_performance_analysis">10.13.3. Performance analysis</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_compiler_switches">11. Compiler switches</a></li>
<li><a href="#_verification_notes">12. Verification notes</a>
<ul class="sectlevel2">
<li><a href="#_existing_functionality">12.1. Existing functionality</a></li>
<li><a href="#_simple_extensions_to_existing_functionality">12.2. Simple extensions to existing functionality</a></li>
<li><a href="#_new_branch_functionality">12.3. New branch functionality</a></li>
<li><a href="#_sequenced_functionality">12.4. Sequenced functionality</a>
<ul class="sectlevel3">
<li><a href="#_cover_all_possible_sets_of_operands">12.4.1. Cover all possible sets of operands</a></li>
<li><a href="#_test_the_functionality">12.4.2. Test the functionality</a></li>
<li><a href="#_table_jump_jump_table_mode_only">12.4.3. Table jump, jump table mode only</a></li>
<li><a href="#_table_jump_and_overlays">12.4.4. Table jump and overlays</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_rejected_and_postponed_instructions">13. Rejected and postponed instructions</a>
<ul class="sectlevel2">
<li><a href="#_not_benchmarked_push_fdq_pop_fdq_popret_fdq">13.1. Not benchmarked: PUSH.[FDQ], POP.[FDQ], POPRET.[FDQ]</a>
<ul class="sectlevel3">
<li><a href="#_assembler_syntax_2">13.1.1. Assembler Syntax</a>
<ul class="sectlevel4">
<li><a href="#_rationale_why_include_the_fdq_suffix">Rationale: why include the .[fdq] suffix</a></li>
</ul>
</li>
<li><a href="#_pseudo_code_2">13.1.2. Pseudo-code</a>
<ul class="sectlevel4">
<li><a href="#_push_fdq_pseudo_code">PUSH.[FDQ] Pseudo-code</a></li>
<li><a href="#_pop_fdq_popret_fdq_pseudo_code">POP.[FDQ]/POPRET/[FDQ] Pseudo-code</a></li>
</ul>
</li>
<li><a href="#pushfdqpoppopret32bitencodings">13.1.3. 32-bit Encodings</a>
<ul class="sectlevel4">
<li><a href="#_illegal_instructions_2">Illegal instructions</a></li>
<li><a href="#_rational_code_rlist_13_frlist_0_code_saving_all_saved_registers">Rational: <code>rlist=13, frlist=0</code> saving all saved registers</a></li>
</ul>
</li>
<li><a href="#_encoding_fields">13.1.4. Encoding Fields</a>
<ul class="sectlevel4">
<li><a href="#__code_mv_ret_val_ra_frlist_rlist_code_for_the_32_bit_encodings"><code>mv, ret_val, ra, frlist, rlist</code> for the 32-bit encodings</a></li>
</ul>
</li>
<li><a href="#_assembly_examples_2">13.1.5. Assembly examples</a>
<ul class="sectlevel4">
<li><a href="#_push_f_rv32i_fdq_uabi_16_byte_aligned_stack">PUSH.F RV32I[FDQ] UABI (16-byte aligned stack)</a></li>
<li><a href="#_push_d_rv64i_dq_uabi_16_byte_aligned_stack">PUSH.D RV64I[DQ] UABI (16-byte aligned stack)</a></li>
<li><a href="#_push_d_rv64i_dq_uabi_16_byte_aligned_stack_2">PUSH.D RV64I[DQ] UABI (16-byte aligned stack)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_benchmarking_results_too_low">13.2. Benchmarking results too low</a>
<ul class="sectlevel3">
<li><a href="#_tbljal_32_bit_encoding">13.2.1. TBLJAL (32-bit encoding)</a></li>
<li><a href="#_lwtp_swtp_ldtp_sdtp">13.2.2. LWTP, SWTP, LDTP, SDTP</a></li>
<li><a href="#_muliadd_addiadd_muliw_muliaddw_addiaddw">13.2.3. MULIADD, ADDIADD, MULIW, MULIADDW, ADDIADDW</a></li>
<li><a href="#_bgeui_bltui">13.2.4. BGEUI, BLTUI</a></li>
<li><a href="#_c_lbusp_c_lhusp_c_sbsp_c_shsp">13.2.5. C.LBUSP, C.LHUSP, C.SBSP, C.SHSP</a></li>
<li><a href="#_c_lsbnot_c_lsbset">13.2.6. C.LSBNOT / C.LSBSET</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_future_ideas">14. Future ideas</a>
<ul class="sectlevel2">
<li><a href="#_multiple_move_instructions">14.1. Multiple move instructions</a>
<ul class="sectlevel3">
<li><a href="#_c_mvp">14.1.1. C.MVP</a></li>
<li><a href="#_c_mva23s07">14.1.2. C.MVA23S07</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This document describes the <code>Zce</code> extension to reduce code-size.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  This document is currently in a <strong>stable</strong> state but will certainly change before ratification, as some custom encodings are in use.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_spec_update_history">1. Spec update history</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">change</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.50.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fix typo - all instructions are available in RV32 (some tables said otherwise)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.50</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">release version.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fix <a href="https://github.com/riscv/riscv-code-size-reduction/issues/103" class="bare">https://github.com/riscv/riscv-code-size-reduction/issues/103</a> (BEQI/BNEI format)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.41.12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Simplify table jump CSRs (<a href="https://github.com/riscv/riscv-code-size-reduction/issues/84">github issue</a>) and enhance the table jump pesudo-code to include debug triggers/haltreq/step</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.41.11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Change memory order for PUSH/POP (<a href="https://github.com/riscv/riscv-code-size-reduction/issues/99">github issue</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.41.10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Change definition of C.TBLJ* exceptions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.41.9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Update Zcee definition to include C.MUL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.41.8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fix table jump pseudo-code to show that two memory exceptions are possible during execution</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.41.7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fix c.push assembler syntax so &lt;areg_list&gt; must always be included, even if null</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.41.6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">simplify c.mva01s07 assembler syntax, and fix encoding in table 16 (it was inconsistent)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fix ZCE-type format for 32-bit PUSH/POP (no actual spec change)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.41.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">remove # from c.tblj* assembly syntax, as it&#8217;s a comment character</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.41.4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">correct table 30 so that the C.LB/C.LH encodings are in the 001____10 group (the spec was inconsistent)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.41.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">remove requirement that writing to xTBLJALVEC flushes the jump table cache - just use FENCE.I or other standard mechanism</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">change pseudo-code for POP so that the return value can be interrupted / repeated</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">beq/bne assembly example should have been beqi/bnei</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.41.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bug fix: PUSH/PUSH.E were missing the <code>areg</code> field which controls wether the PUSH moves a[i] into s[i]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.41.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bug fix: move PUSH/POP/POPRET to custom-1 as they were overlapping (so will have to change again in the future)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.41</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bug fix: change MULI encoding, as it overlapped with SLLI (it&#8217;s now in custom-0, so will have to change again in the future)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bug fix: C.TBLJ and C.TBLJALM were reserved in the encoding table and example usage</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">add compiler switches for the prototype compiler</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.40</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Stable version for toolchain/simulator prototyping</strong></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_github_issues_may_not_be_a_complete_list">2. Github issues (may not be a complete list)</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/riscv/riscv-code-size-reduction/issues/106">MULI has a temporary encoding</a></p>
</li>
<li>
<p><a href="https://github.com/riscv/riscv-code-size-reduction/issues/105">TBLJALVEC needs address to be allocated</a></p>
</li>
<li>
<p><a href="https://github.com/riscv/riscv-code-size-reduction/issues/104">EABI spec is not frozen - so it&#8217;s not clear which formats of PUSH.E/POP.E/POPRET.E etc that are needed</a></p>
</li>
<li>
<p><a href="https://github.com/riscv/riscv-code-size-reduction/issues/102">May need an EABI version of C.MVA01S07</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__code_zce_code_configurations">3. <code>Zce</code> configurations</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="https://github.com/riscv/riscv-code-size-reduction/blob/master/ISA%20proposals/Huawei/Zce_subsets%20simplified6.png" alt="Zce subsets">
</div>
</div>
<div class="paragraph">
<p><code>Zce</code> is split into two main subsets</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Zcea</code> which is compatible with all existing standard extensions designed for small embedded cores</p>
<div class="ulist">
<ul>
<li>
<p><code>Zcee</code> is a simpler subset of <code>Zcea</code> for high performance cores, it can be implemented without the rest of <code>Zcea</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>Zceb</code> reuses encoding from the <code>D</code>-extension, and so is incompatible with <code>D</code></p>
<div class="ulist">
<ul>
<li>
<p><code>Zceb</code> is fully compatible with <code>Zdinx</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  To get 32-bit versions of the instructions from <code>Zcee</code> the <code>B</code>-extension subsets <code>Zba</code> and <code>Zbb</code> should be implemented. This is recommended but not required by this specification.
</td>
</tr>
</table>
</div>
<table id="zcea" class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Zcea extension</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Instruction</th>
<th class="tableblock halign-left valign-top">RV32</th>
<th class="tableblock halign-left valign-top">RV64</th>
<th class="tableblock halign-left valign-top">RV128</th>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="6"><p class="tableblock">Zcee subset</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SEXT.B</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea/Zcee</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SEXT.H</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea/Zcee</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SEXT.W</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea/Zcee</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pseudo-instruction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ZEXT.B</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea/Zcee</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ZEXT.H</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea/Zcee</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ZEXT.W</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea/Zcee</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="6"><p class="tableblock">Require M or Zmmul to be inferred</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MUL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea/Zcee</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">requires M or Zmmul</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">requires M or Zmmul</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="6"><p class="tableblock">other 16-bit encodings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MVA01S07</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.NOT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.NEG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.TBLJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.TBLJAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.TBLJALM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH.E</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP.E</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET.E</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="6"><p class="tableblock">other 32-bit encodings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH.E</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP.E</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET.E</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BEQI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BNEI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<table id="zceb" class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. Zceb extension, incompatible with D, compatible with Zdinx</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Instruction</th>
<th class="tableblock halign-left valign-top">RV32</th>
<th class="tableblock halign-left valign-top">RV64</th>
<th class="tableblock halign-left valign-top">RV128</th>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="6"><p class="tableblock">16-bit encodings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.DECBNEZ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zceb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incompatible with D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LBU</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zceb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incompatible with D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LHU</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zceb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incompatible with D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zceb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incompatible with D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zceb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incompatible with D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zceb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incompatible with D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zceb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incompatible with D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="6"><p class="tableblock">32-bit encodings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LWGP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zceb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incompatible with D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWGP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zceb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incompatible with D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDGP</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zceb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incompatible with D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SDGP</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zceb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incompatible with D</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>Zcea/Zceb</code> are compatible with both the <code>I</code> and <code>E</code> extensions.</p>
</div>
<div class="paragraph">
<p>All systems which implement <code>Zcea/Zceb</code> must also implement the <code>C</code> extension.</p>
</div>
<div class="paragraph">
<p>If <code>M</code> or <code>Zmmul</code> is specified then <code>Zcea/Zcee</code> also include the <code>C.MUL, MULI</code> instructions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_c_extension_subsets">4. C-extension subsets</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The C-extension already reuses encodings between different architectures. <code>Zce</code> extends this concept further. <a href="#zce_quad0">C-extension quadrant 0</a>, <a href="#zce_quad1">C-extension quadrant 1</a> and <a href="#zce_quad2">C-extension quadrant 2</a> show how each encoding is allocated for different architectures or for different combinations of extensions.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>C.FSD</code>, <code>C.SQ</code>, and <code>{C.LBU, C.SB}</code> share opcodes, so for different configurations the encodings represent:</p>
<div class="ulist">
<ul>
<li>
<p><code>C.FSD</code> for <code>RV32CD/RV64CD</code></p>
</li>
<li>
<p><code>C.SQ</code>  for <code>RV128C</code></p>
</li>
<li>
<p><code>{C.LBU, C.SB}</code> for <code>RV32C_Zceb, RV64C_Zceb, RV32C_Zceb_Zdinx, RV64C_Zceb_Zdinx</code></p>
</li>
<li>
<p>illegal encoding for <code>RV32C, RV64C</code>, as neither <code>D</code> nor <code>Zce</code> was specified</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The shared encoding column in the tables assigns an arbitrary number to show which encodings are grouped together (I can&#8217;t find a better way of highlighting groups of cells in the table in adoc format). <code>Zce</code> instructions are in <strong>bold</strong>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  The names <code>Zci, Zcf, Zcd, Zcq, Zc32, Zc64, Zc128</code> are not official subset names, I have used them to help explain how the 16-bit encoding space is divided up and reused.
</td>
</tr>
</table>
</div>
<table id="zce_quad0" class="tableblock frame-all grid-all spread">
<caption class="title">Table 3. C-extension quadrant 0</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Enc[15:13]</th>
<th class="tableblock halign-left valign-top">Instruction</th>
<th class="tableblock halign-left valign-top">shared encoding group</th>
<th class="tableblock halign-left valign-top">Ext Subset</th>
<th class="tableblock halign-left valign-top">RV32</th>
<th class="tableblock halign-left valign-top">RV64</th>
<th class="tableblock halign-left valign-top">RV128</th>
<th class="tableblock halign-left valign-top">Extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ADDI4SPN</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.FLD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LQ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcq</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.LBU</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zceb</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zceb</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.LHU</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zceb</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zceb</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LW</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.FLW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+F</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc64/Zc128</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.POP</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.POPRET</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.PUSH</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.POP.E</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.POPRET.E</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.PUSH.E</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.TBLJ</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.TBLJAL</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.TBLJALM</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.SEXT.B</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea/Zcee</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea/Zcee</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.SEXT.H</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea/Zcee</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea/Zcee</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.ZEXT.B</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea/Zcee</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea/Zcee</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.ZEXT.H</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea/Zcee</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea/Zcee</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.NOT</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.NEG</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.FSD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SQ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcq</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.SB</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zceb</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zceb</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.SH</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zceb</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zceb</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">110</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SW</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.FSW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+F</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc64/Zc128</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
</tbody>
</table>
<table id="zce_quad1" class="tableblock frame-all grid-all spread">
<caption class="title">Table 4. C-extension quadrant 1</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Enc[15:13]</th>
<th class="tableblock halign-left valign-top">Instruction</th>
<th class="tableblock halign-left valign-top">shared encoding group</th>
<th class="tableblock halign-left valign-top">Ext Subset</th>
<th class="tableblock halign-left valign-top">RV32</th>
<th class="tableblock halign-left valign-top">RV64</th>
<th class="tableblock halign-left valign-top">RV128</th>
<th class="tableblock halign-left valign-top">Extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.NOP</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ADDI</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.JAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ADDIW (rd=0:RSV)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc64/Zc128</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LI (rd=0:HINT)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ADDI16SP (nzimm=0:RSV)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LUI (nzimm=0: RSV; rd=0:HINT)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SRLI (RV32:NSE, nzuimm[5]=1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc32/Zc64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SRLI64 (RV32:HINT)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc128</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SRAI (RV32:NSE, nzuimm[5]=1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc32/Zc64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SRAI64 (RV32/64:HINT)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc128</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ANDI</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SUB</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.XOR</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.OR</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.AND</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SUBW (RV32:RSV)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc64/Zc128</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ADDW (RV32:RSV)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc64/Zc128</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MUL</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea/Zcee</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">M+C+<strong>Zcea/Zcee</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MVA01S07</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.J</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">110</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.BEQZ</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.BNEZ</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
</tbody>
</table>
<table id="zce_quad2" class="tableblock frame-all grid-all spread">
<caption class="title">Table 5. C-extension quadrant 2</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Enc[15:13]</th>
<th class="tableblock halign-left valign-top">Instruction</th>
<th class="tableblock halign-left valign-top">shared encoding group</th>
<th class="tableblock halign-left valign-top">Ext Subset</th>
<th class="tableblock halign-left valign-top">RV32</th>
<th class="tableblock halign-left valign-top">RV64</th>
<th class="tableblock halign-left valign-top">RV128</th>
<th class="tableblock halign-left valign-top">Extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SLLI (rd=0:HINT; RV32 &amp;&amp; nzuimm[5]=1:NSE)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc32/Zc64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SLLI64 (RV32/64 or rd=0:HINT)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc128</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.FLDSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LQSP (rd=0:RSV)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc128</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.LB</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zceb</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.LH</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zceb</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LWSP (rd=0:RSV)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.FLWSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+F</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LDSP (rd=0:HINT)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc64/Zc128</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.JR     (rd=0:RSV)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MV   (rd=0:HINT)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.EBREAK</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.JALR</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ADD (rd=0:HINT)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.FSDSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SQSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc128</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.DECBNEZ</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zceb</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zceb</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">110</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SWSP</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.FSWSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+F</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SDSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc128</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_allocation_of_new_16_bit_encodings">5. Allocation of new 16-bit encodings</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section gives a short-hand lookup of exactly where the new encodings are allocated to make it easier to review the encoding space. The first column is the group number from <a href="#zce_quad0">C-extension quadrant 0</a>, <a href="#zce_quad1">C-extension quadrant 1</a> and <a href="#zce_quad2">C-extension quadrant 2</a>.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Group</th>
<th class="tableblock halign-left valign-top">[15:13]</th>
<th class="tableblock halign-left valign-top">[12:10]</th>
<th class="tableblock halign-left valign-top">[1:0]</th>
<th class="tableblock halign-left valign-top">Instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SEXT.B, C.SEXT.H, C.ZEXT.B, C.ZEXT.H, C.ZEXT.W, C.NOT, C.NEG</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.TBLJ, C.TBLJAL, C.TBLJALM</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP, C.POPRET, C.PUSH, C.POP.E, C.POPRET.E, C.PUSH.E</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LBU</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1xx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LHU</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1xx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SH</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MUL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MVA01S07</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1xx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LH</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.DECBNEZ</p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="_16_bit_encoding_code_points">5.1. 16-bit encoding code-points</h3>
<div class="paragraph">
<p>All previously reserved 16-bit encodings are in the tables below, showing how many are allocated to <code>Zce</code>.</p>
</div>
<table id="spare16encodings" class="tableblock frame-all grid-all spread">
<caption class="title">Table 6. spare 16-bit encodings for RV32/RV64</caption>
<colgroup>
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6676%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15:13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1:0</th>
<th class="tableblock halign-left valign-top">code points</th>
<th class="tableblock halign-left valign-top">sub-extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">xxxx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">56/256</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zcea</code> (40 <code>Zcee</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">xxxx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0/256</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">xxxx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">120/256</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zcea</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">xxxx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">256/256</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zcea</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">1xx</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">xxxx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0/1024</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="5"><p class="tableblock">xxxxx</p></td>
<td class="tableblock halign-left valign-top" colspan="5"><p class="tableblock">11111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0/32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">111</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64/128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zcea</code> (56 <code>Zcee</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="6"><p class="tableblock">000000</p></td>
<td class="tableblock halign-left valign-top" colspan="5"><p class="tableblock">non-zero</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0/31</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 7. spare 16-bit encodings for RV32 only (mainly out of range shifts)</caption>
<colgroup>
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6676%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15:13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1:0</th>
<th class="tableblock halign-left valign-top">code points</th>
<th class="tableblock halign-left valign-top">sub-extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top" colspan="9"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0/512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">111</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0/128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" colspan="5"><p class="tableblock">non-zero</p></td>
<td class="tableblock halign-left valign-top" colspan="5"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0/992</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 8. spare 16-bit encodings for RV64 only (ADDIW with zero destination)</caption>
<colgroup>
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6676%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15:13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1:0</th>
<th class="tableblock halign-left valign-top">code points</th>
<th class="tableblock halign-left valign-top">sub-extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top" colspan="5"><p class="tableblock">00000</p></td>
<td class="tableblock halign-left valign-top" colspan="5"><p class="tableblock">xxxxx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0/64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 9. spare 16-bit encodings reused from the D-extension</caption>
<colgroup>
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6676%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15:13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1:0</th>
<th class="tableblock halign-left valign-top">code points</th>
<th class="tableblock halign-left valign-top">sub-extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top" colspan="11"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2048/2048</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zceb</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top" colspan="11"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2048/2048</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zceb</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top" colspan="11"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2048/2048</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zceb</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top" colspan="11"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2047/2048</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zceb</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In total in the existing RVC (16-bit) encoding space:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>RV32C has 3871 code points available, 496 are used (12.8%)</p>
</li>
<li>
<p>RV64C has 2303 code points available, 496 are used (21.5%)</p>
</li>
<li>
<p>RV32CD (i.e. the C.FSD,C.FLD, C.FSDSP, C.FLDSP encodings) has 8192 code points available, 8191 are used (99.9%)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>Zcee</code> subset uses 106 code points (2.7% RV32C, 4.6% RV64C).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__code_zcee_code_definition">6. <code>Zcee</code> definition</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_c_sext_b_c_sext_h_c_zext_b_c_zext_h_c_zext_w_c_mul">6.1. C.SEXT.B, C.SEXT.H, C.ZEXT.B, C.ZEXT.H, C.ZEXT.W, C.MUL</h3>
<div class="paragraph">
<p>These instructions have no conflicts with other extensions, they use previously reserved encodings.</p>
</div>
<div class="paragraph">
<p>These instructions are 16-bit versions of existing 32-bit instructions, from either <code>I/E</code> or the <code>Zba/Zbb</code>-extension.</p>
</div>
<div class="paragraph">
<p><code>C.NOT/C.NEG</code> are <em>not</em> part of <code>Zcee</code> but are included in <a href="#monadic-16encodings">monadic simple instructions 16-bit encodings</a> to show the entire allocation of this encoding group. They are specified in <a href="#c_not_c_neg">C.NOT, C.NEG</a>.</p>
</div>
<table id="monadic-16encodings" class="tableblock frame-all grid-all spread">
<caption class="title">Table 10. monadic simple instructions 16-bit encodings</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15:13</th>
<th class="tableblock halign-left valign-top">12:10</th>
<th class="tableblock halign-left valign-top">9:7</th>
<th class="tableblock halign-left valign-top">6:5</th>
<th class="tableblock halign-left valign-top">4:2</th>
<th class="tableblock halign-left valign-top">1:0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="7"><p class="tableblock">monadic with single source/dest, room for 3 more encodings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ZEXT.B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SEXT.B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ZEXT.H</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SEXT.H</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ZEXT.W</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">110</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.NEG (see Zcea)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.NOT (see Zcea)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
</tbody>
</table>
<table id="dyadic-16encodings" class="tableblock frame-all grid-all spread">
<caption class="title">Table 11. dyadic simple instructions 16-bit encodings</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15:13</th>
<th class="tableblock halign-left valign-top">12:10</th>
<th class="tableblock halign-left valign-top">9:7</th>
<th class="tableblock halign-left valign-top">6:5</th>
<th class="tableblock halign-left valign-top">4:2</th>
<th class="tableblock halign-left valign-top">1:0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rs2'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MUL</p></td>
</tr>
</tbody>
</table>
<table id="monsemantics_zcee" class="tableblock frame-all grid-all spread">
<caption class="title">Table 12. simple instruction semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ZEXT.B</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = zero_ext(rd'[ 7:0])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ZEXT.H</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = zero_ext(rd'[15:0])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SEXT.B</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = sign_ext(rd'[ 7:0])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SEXT.H</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = sign_ext(rd'[15:0])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MUL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = rd' * rs2'</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">RV64/RV128 only</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ZEXT.W</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = zero_ext(rd'[31:0])</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  The expansion of <code>c.neg</code> puts <code>rd</code> onto <code>rs2</code>, unlike the other expansions which put <code>rd</code> onto <code>rs1</code>, and so requires additional muxing during the expansion
</td>
</tr>
</table>
</div>
<table id="mon-32bit-zcee" class="tableblock frame-all grid-all spread">
<caption class="title">Table 13. simple instruction 32-bit equivalent instructions/pseudo-instructions</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">example assembler syntax</th>
<th class="tableblock halign-left valign-top">requirements for 16-bit encoding</th>
<th class="tableblock halign-left valign-top">32-bit extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ZEXT.B</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zext.b rd, rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all regs x8-x15, rd=rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I or E</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ZEXT.H</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zext.h rd, rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all regs x8-x15, rd=rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbb</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SEXT.B</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sext.b rd, rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all regs x8-x15, rd=rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbb</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SEXT.H</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sext.h rd, rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all regs x8-x15, rd=rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbb</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MUL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mul    rd, rs1, rs2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all regs x8-x15, rd=rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I or E</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">RV64/RV128 only</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ZEXT.W</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zext.w rd, rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all regs x8-x15, rd=rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zba</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  Other assembler syntaxes are possible such as including the c. prefix and only including one operand to cover rs1 and rd
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  Implementing <code>Zba</code> and <code>Zbb</code> to get the 32-bit encodings from <a href="#mon-32bit-zcee">simple instruction 32-bit equivalent instructions/pseudo-instructions</a> is not required by this specification.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Assembly Examples</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">zext.b a5, a5;  # a5 = zero_ext(a5[7:0])
zext.h a5, a5;  # a5 = zero_ext(a5[15:0])
sext.b a5, a5;  # a5 = sign_ext(a5[7:0])
sext.h a5, a5;  # a5 = sign_ext(a5[15:0])

mul a5, a5, a6; # a5 = a5 * a6

//RV64/RV128 only

zext.w a5, a5;  # a5 = zero_ext(a5[31:0])
sext.w a5, a5;  # a5 = sign_ext(a5[31:0])</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_c_sext_w">6.2. C.SEXT.W</h3>
<div class="paragraph">
<p><code>C.SEXT.W</code> is added as a pseudo-instruction for <code>C.ADDIW rd, 0</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__code_zcea_code_definition">7. <code>Zcea</code> definition</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>Zcea</code> includes all of the <code>Zcee</code> instructions above.</p>
</div>
<div class="sect2">
<h3 id="c_not_c_neg">7.1. C.NOT, C.NEG</h3>
<div class="paragraph">
<p>These instructions have no conflicts with other extensions, they use previously reserved encodings.</p>
</div>
<div class="paragraph">
<p>These instructions are 16-bit versions of existing 32-bit instructions, from the <code>I/E</code>-extension.</p>
</div>
<table id="monadic-16encodings_not_neg" class="tableblock frame-all grid-all spread">
<caption class="title">Table 14. monadic simple instructions 16-bit encodings</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15:13</th>
<th class="tableblock halign-left valign-top">12:10</th>
<th class="tableblock halign-left valign-top">9:7</th>
<th class="tableblock halign-left valign-top">6:5</th>
<th class="tableblock halign-left valign-top">4:2</th>
<th class="tableblock halign-left valign-top">1:0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">110</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.NEG</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.NOT</p></td>
</tr>
</tbody>
</table>
<table id="monsemantics_not_neg" class="tableblock frame-all grid-all spread">
<caption class="title">Table 15. simple instruction semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.NEG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = -rd' / rd' = 0 - rd'</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.NOT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = ~rd' / rd' = rd' XOR -1</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  The expansion of <code>c.neg</code> puts <code>rd</code> onto <code>rs2</code>, unlike the other expansions which put <code>rd</code> onto <code>rs1</code>, and so requires additional muxing during the expansion
</td>
</tr>
</table>
</div>
<table id="mon-32bit_not_neg" class="tableblock frame-all grid-all spread">
<caption class="title">Table 16. simple instruction 32-bit equivalent instructions/pseudo-instructions</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">example assembler syntax</th>
<th class="tableblock halign-left valign-top">requirements for 16-bit encoding</th>
<th class="tableblock halign-left valign-top">32-bit extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.NEG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neg    rd, rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all regs x8-x15, rd=rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I or E</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.NOT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not    rd, rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all regs x8-x15, rd=rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I or E</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  Other assembler syntaxes are possible such as including the c. prefix and only including one operand to cover rs1 and rd
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Assembly Examples</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">not a5, a5      # a5 = ~a5 bitwise inversion
neg a5, a5      # a5 = -a5 two's complement inversion</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_c_mva01s07">7.2. C.MVA01S07</h3>
<div class="paragraph">
<p>Register moves are the most common in GCC output in both the benchmark suite and the Debian distro. This instruction combines very common pairs of moves into a single 16-bit encoding:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>move from two <code>s[0-7]</code> registers into <code>a0</code> and <code>a1</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Similar to <code>PUSH/POP</code> this instruction uses ABI names for the registers. The mapping from <code>s</code> to <code>x</code> number is simple. For <code>RV32_Zdinx</code> a paired register write port is required already. For other configurations the microarchitecture can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>split the instructions into an uninterruptable sequence of two <code>mv</code> instructions to avoid the second write port</p>
</li>
<li>
<p>add a paired write port for <code>a0</code> and <code>a1</code> only. Because the instruction only writes these two registers, only one paired write port is needed. This is much cheaper than allowing paired writes to the whole register file.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">#RV64 debian/libm-2 example
    ab08:       86a2                    mv      a3,s0
    ab0a:       8652                    mv      a2,s4
    ab0c:       85de                    mv      a1,s7 # c.mva01s07 s1, s7
    ab0e:       8526                    mv      a0,s1 #
    ab10:       0f73e0ef                jal     ra,49406 &lt;__exp2f_finite@@GLIBC_2.27+0x1e58&gt;
    ab14:       55010993                addi    s3,sp,1360
    ab18:       86a2                    mv      a3,s0
    ab1a:       864e                    mv      a2,s3
    ab1c:       85de                    mv      a1,s7 # c.mva01s07 s1, s7
    ab1e:       8526                    mv      a0,s1 #
    ab20:       1bb3e0ef                jal     ra,494da &lt;__exp2f_finite@@GLIBC_2.27+0x1f2c&gt;
    ab24:       8622                    mv      a2,s0
    ab26:       85da                    mv      a1,s6 # c.mva01s07 s4, s6
    ab28:       8552                    mv      a0,s4 #
    ab2a:       49a3e0ef                jal     ra,48fc4 &lt;__exp2f_finite@@GLIBC_2.27+0x1a16&gt;
    ab2e:       8622                    mv      a2,s0
    ab30:       85d6                    mv      a1,s5 # c.mva01s07 s3, s5
    ab32:       854e                    mv      a0,s3 #
    ab34:       4903e0ef                jal     ra,48fc4 &lt;__exp2f_finite@@GLIBC_2.27+0x1a16&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  Combining a2 and a3 into a double move isn&#8217;t beneficial enough in general to include in the ISA
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  We may need an EABI version of this instruction. TBD.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  There is no 32-bit instruction, because a 32-bit form would add no value.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Mapping from the <code>s</code> register number to the <code>x</code> register index is simple for the UABI:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">//000 (s0) -&gt; 01000 (x8)
//001 (s1) -&gt; 01001 (x9)
//010 (s2) -&gt; 10010 (x18)
//011 (s3) -&gt; 10011 (x19)
// ...         ...
//111 (s7) -&gt; 10111 (x23)

//verilog syntax for concatenation of bits
xreg[4:0] = {sreg[2:1]&gt;0,sreg[2:1]==0,sreg[2:0]};</code></pre>
</div>
</div>
<div class="paragraph">
<p>The EABI mapping may not be so simple, TBD.</p>
</div>
<table id="mva-16encodings" class="tableblock frame-all grid-all spread">
<caption class="title">Table 17. <code>C.MVA01S07</code> 16-bit encodings</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15:13</th>
<th class="tableblock halign-left valign-top">12:10</th>
<th class="tableblock halign-left valign-top">9:7</th>
<th class="tableblock halign-left valign-top">6:5</th>
<th class="tableblock halign-left valign-top">4:2</th>
<th class="tableblock halign-left valign-top">1:0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sreg1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sreg2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MVA01S07</p></td>
</tr>
</tbody>
</table>
<table id="mva_semantics" class="tableblock frame-all grid-all spread">
<caption class="title">Table 18. <code>C.MVA01S07</code> semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MVA01S07</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mv a0, s[sreg1];  mv a1, s[sreg2]</p></td>
</tr>
</tbody>
</table>
<table id="mva_syntax" class="tableblock frame-all grid-all spread">
<caption class="title">Table 19. <code>C.MVA01S07</code> assembler syntax</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">example assembler syntax</th>
<th class="tableblock halign-left valign-top">requirements for 16-bit encoding</th>
<th class="tableblock halign-left valign-top">32-bit extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MVA01S07</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">c.mva01s07 sreg1, sreg2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Assembly examples.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode"># c.mva01s07: sreg1 = 0; sreg2 = 0;
c.mva01s07 s0, s0; # mv a0, s0; mv a1, s0</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_muli">7.3. MULI</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  This encoding is in <code>custom-0</code>, a real encoding must be found possibly with a shorter immediate
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 20. <code>MULI</code> 32-bit encoding</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">31:20</th>
<th class="tableblock halign-left valign-top">19:15</th>
<th class="tableblock halign-left valign-top">14:12</th>
<th class="tableblock halign-left valign-top">11:7</th>
<th class="tableblock halign-left valign-top">6 : 0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[11:0]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0001011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULI</p></td>
</tr>
</tbody>
</table>
<table id="muli_syntax" class="tableblock frame-all grid-all spread">
<caption class="title">Table 21. <code>MULI</code> assembler syntax</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">assembler syntax</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mul rd, rs1, imm</p></td>
</tr>
</tbody>
</table>
<table id="muli_semantics" class="tableblock frame-all grid-all spread">
<caption class="title">Table 22. <code>MULI</code> semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = rs1' * sign_ext(imm)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Assembly Examples</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">muli     a0, a1, 2     # a0 = a1 * 2</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cmpimmbr">7.4. BEQI, BNEI</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  These encodings match the format for BEQ as much as possible
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  The encoding is not valid if <code>nzuimm=0</code> as <code>BEQ/BNE rs1, zero, offset</code> can be used instead.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The encodings allow a comparison of a register and an immediate value. <code>BEQI</code> in particular is very useful for <em>switch</em> statements.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 23. proposed 32-bit encodings for <code>BEQI/BNEI</code></caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">31:25</th>
<th class="tableblock halign-left valign-top">24:20</th>
<th class="tableblock halign-left valign-top">19:15</th>
<th class="tableblock halign-left valign-top">14:12</th>
<th class="tableblock halign-left valign-top">11:7</th>
<th class="tableblock halign-left valign-top">6 : 0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">offset[12,10:5]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rs2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">nzuimm[4:0]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">offset[4:1,11]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1100011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BEQI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">offset[12,10:5]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rs2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">nzuimm[4:0]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">offset[4:1,11]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1100011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BNEI</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 24. Compare immediate branch semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BEQI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if (rs2==zero_ext(nzuimm)) target_pc=PC+offset; else target_pc=PC+4;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BNEI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if (rs2!=zero_ext(nzuimm)) target_pc=PC+offset; else target_pc=PC+4;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Assembly Examples</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">beqi  a5, 1,offset # if(a5==zero_ext(1)) branch_to(PC+offset)
bnei  a5, 2,offset # if(a5!=zero_ext(2)) branch_to(PC+offset)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_table_jump">7.5. Table Jump</h3>
<div class="paragraph">
<p>The specification is in <a href="#tablejump">Table Jump</a>.</p>
</div>
<div class="sect3">
<h4 id="tablejump16">7.5.1. C.TBLJ, C.TBLJAL, C.TBLJALM</h4>
<div class="paragraph">
<p>The encodings are in <a href="#tbljal16bitencoding">C.TBLJAL 16-bit encoding</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pushpoppopret_heading">7.6. PUSH and POP</h3>
<div class="paragraph">
<p>See <a href="#pushpoppopret">PUSH and POP</a> for the specification.</p>
</div>
<div class="sect3">
<h4 id="pushpop32">7.6.1. PUSH, POP, POPRET, PUSH.E, POP.E, POPRET.E</h4>
<div class="paragraph">
<p>See <a href="#pushpoppopret32bitencodings">32-bit Encodings</a> for the encodings.</p>
</div>
</div>
<div class="sect3">
<h4 id="pushpop16">7.6.2. C.PUSH, C.POP, C.POPRET, C.PUSH.E, C.POP.E, C.POPRET.E</h4>
<div class="paragraph">
<p>See <a href="#proposed-16bit-encodingsI-1">PUSH/POP/POPRET 16-bit encodings</a> for the encodings.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_b_extension_recommended_subsets_for_code_size_reduction">7.7. B-extension recommended subsets for code-size reduction</h3>
<div class="paragraph">
<p>The 32-bit encodings for <code>C.SEXT.<strong></code> and <code>C.ZEXT.</strong></code> from <code>Zcee</code> (see <a href="#mon-32bit_not_neg">simple instruction 32-bit equivalent instructions/pseudo-instructions</a>) are in <code>Zba</code> and <code>Zbb</code>.</p>
</div>
<div class="paragraph">
<p>It is recommended to implement both <code>Zba</code> and <code>Zbb</code> for code-size reduction, but not required by <code>Zce</code>. They contain useful instructions for example:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>Zba</code> includes <code>sh[123]add</code> which are used for address calculations.</p>
</li>
<li>
<p><code>Zbb</code> includes rotate (<code>rori, ror, rol</code>), byte reverse (<code>rev8</code>) and count-leading-zeroes (<code>clz</code>).</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__code_zceb_code_definition">8. <code>Zceb</code> definition</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>Zceb</code> and the <code>D</code>-extension use the same encodings, therefore the two cannot co-exist and would be an illegal RISC-V configuration.</p>
</div>
<div class="paragraph">
<p><code>Zceb</code> is compatible with <code>Zdinx</code>.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 25. proposed 32-bit formats</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1112%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">31:29</th>
<th class="tableblock halign-left valign-top">28:25</th>
<th class="tableblock halign-left valign-top">24:20</th>
<th class="tableblock halign-left valign-top">19:18</th>
<th class="tableblock halign-left valign-top">17:15</th>
<th class="tableblock halign-left valign-top">14:12</th>
<th class="tableblock halign-left valign-top">11:7</th>
<th class="tableblock halign-left valign-top">6 : 0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="9"><p class="tableblock">These formats are designed for maximum overlap immediate with I-type and S-type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">funct3a</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">imm[8:2,10:9]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">imm[15:11]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">funct3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opcode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LW16-type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">funct3a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[8:5]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rs2</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">imm[15:11]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">funct3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[4:2, 10:9]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opcode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW16-type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">funct3a</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">imm[8:3,16,10:9]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">imm[15:11]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">funct3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opcode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LD16-type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">funct3a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[8:5]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rs2</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">imm[15:11]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">funct3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[4:3,16,10:9]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opcode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SD16-type</p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="_decrement_and_branch">8.1. Decrement and branch</h3>
<div class="sect3">
<h4 id="decbr16">8.1.1. C.DECBNEZ</h4>
<div class="paragraph">
<p>This instruction conflicts with the <code>D</code>-extension. If <code>D</code> is implemented, this instruction will not be available. It is compatible with <code>ZDinx</code>.</p>
</div>
<div class="paragraph">
<p>This instruction is a combined decrement and branch, used for inferring loops with an optionally scaled loop counter.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  The 16 and 32-bit forms of this instruction need a new relocation type in the toolchain.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  The 32-bit encoding has a signed offset. The 16-bit encoding has an unsigned offset, but it can only represent a backwards jump.
  Therefore to be legal syntax for the 16-bit encoding the offset is specified as a negative number but encoded as a positive offset.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  The encoding is reserved if the offset is zero.
</td>
</tr>
</table>
</div>
<table id="proposed-16bit-encodings-dec_br" class="tableblock frame-all grid-all spread">
<caption class="title">Table 26. proposed 16-bit encodings for dec-and-branch</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15:13</th>
<th class="tableblock halign-left valign-top">12:10</th>
<th class="tableblock halign-left valign-top">9:7</th>
<th class="tableblock halign-left valign-top">6:4</th>
<th class="tableblock halign-left valign-top">3:2</th>
<th class="tableblock halign-left valign-top">1:0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">nzuimm[6:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">nzuimm[3:1]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">scale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.DECBNEZ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">scale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
</tbody>
</table>
<table id="deccmpbrsemantics" class="tableblock frame-all grid-all spread">
<caption class="title">Table 27. decrement, compare and branch semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.DECBNEZ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = rd' - (1&lt;&lt;scale); bnez rd', -zero_ext(nzuimm);</p></td>
</tr>
</tbody>
</table>
<table id="v1" class="tableblock frame-all grid-all spread 0-32bit">
<caption class="title">Table 28. 32-bit equivalent instructions for decrement, compare and branch semantics</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">example assembler syntax</th>
<th class="tableblock halign-left valign-top">requirements for 16-bit encoding</th>
<th class="tableblock halign-left valign-top">32-bit extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.DECBNEZ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">decbnez rd, scale, -nzuimm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd is x8-x15, scale is [1248], nzuimm is in range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zceb</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  Other assembler syntaxes are possible such as including the c. prefix
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Assembly Example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">decbnez s2, 1, -4 ;# s2-=1;if(s2!=0) branch_to(PC-4) encoded as scale=0, nzuimm=4</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_decbnez_limited_value">8.1.2. DECBNEZ (limited value?)</h4>
<div class="paragraph">
<p>This instruction conflicts with the <code>D</code>-extension. If <code>D</code> is implemented, this instruction will not be available. It is compatible with <code>ZDinx</code>.</p>
</div>
<div class="paragraph">
<p>The 16-bit encoding and specification is in <a href="#decbr16">C.DECBNEZ</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  This instruction appears to have limited value, and so it may well be removed.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  The 16 and 32-bit forms of this instruction need a new relocation type in the toolchain.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 29. proposed 32-bit encoding <code>DECBNEZ</code></caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1112%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">31:29</th>
<th class="tableblock halign-left valign-top">28:25</th>
<th class="tableblock halign-left valign-top">24:20</th>
<th class="tableblock halign-left valign-top">19:18</th>
<th class="tableblock halign-left valign-top">17:15</th>
<th class="tableblock halign-left valign-top">14:12</th>
<th class="tableblock halign-left valign-top">11:7</th>
<th class="tableblock halign-left valign-top">6 : 0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">imm[8:2,10:9]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">scale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[1,12:11]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0000111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DECBNEZ</p></td>
</tr>
</tbody>
</table>
<table id="DECBNEZsemantics32" class="tableblock frame-all grid-all spread">
<caption class="title">Table 30. decrement, compare and branch 32-bit semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DECBNEZ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd = rd - (1&lt;&lt;scale); bnez rd, sign_ext(imm);</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Assembly Example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">decbnez s2, 1, offset ;# s2-=1;if(s2!=0) branch_to(PC+offset)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_lwgp_swgp_ldgp_sdgp">8.2. LWGP, SWGP, LDGP, SDGP</h3>
<div class="paragraph">
<p>These instructions conflict with the <code>D</code>-extension. If <code>D</code> is implemented, these instruction will not be available. They are compatible with <code>Zdinx</code>.</p>
</div>
<div class="paragraph">
<p>These instructions reuse the encodings for <code>FLD/FSD</code>.</p>
</div>
<div class="paragraph">
<p><code>LWGP,SWGP</code> give a larger offset range than the standard <code>LW, SW</code> instructions by making the base register explicitly <code>gp</code>, allowing a 16-bit/64KB range of word aligned offsets, instead of a 12-bit/4KB range of byte aligned offsets.</p>
</div>
<div class="paragraph">
<p><code>LDGP,SDGP</code> require double word alignment, and so have an increased range of 17-bit/128KB offsets relative to <code>gp</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
   Restrictions in the GCC toolchain mean that the full range of <code>gp</code> cannot be used for the standard <code>LW/SW</code> instructions, in case linker relaxation means that the <code>gp</code> relative addresses moves out of range. This will still be the case with <code>LWGP, SWGP</code> but the range is so much larger that the impact will be minimal. <a href="https://github.com/riscv/riscv-gnu-toolchain/issues/497">See this github issue</a>. This issue means that with the current RISC-V ISA the full 4KB range cannot be accessed using <code>gp</code> using GCC so the benefit is lower than might be expected.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 31. proposed 32-bit encodings for <code>LWGP/SWGP/LWTP/SWTP</code> and <code>LDGP/SDGP/LDTP/SDTP</code></caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">31:29</th>
<th class="tableblock halign-left valign-top">28:25</th>
<th class="tableblock halign-left valign-top">24:20</th>
<th class="tableblock halign-left valign-top">19:15</th>
<th class="tableblock halign-left valign-top">14:12</th>
<th class="tableblock halign-left valign-top">11:7</th>
<th class="tableblock halign-left valign-top">6 : 0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">imm[8:2,10:9]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[15:11]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0000111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LWGP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[8:5]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rs2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[15:11]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[4:2, 10:9]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0100111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWGP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">RV64/RV128 only</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">imm[8:3,16,10:9]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[15:11]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0000111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDGP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[8:5]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rs2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[15:11]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[4:3,16,10:9]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0100111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SDGP</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  In <a href="#lwgp_semantics">Load/store word/double GP relative semantics</a> DataMemory is a data memory array of elements with XLEN width.
</td>
</tr>
</table>
</div>
<table id="lwgp_semantics" class="tableblock frame-all grid-all spread">
<caption class="title">Table 32. Load/store word/double GP relative semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LWGP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd=sign_ext(DataMemory[gp+sign_ext(imm)][31:0]);</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWGP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DataMemory[gp+sign_ext(imm)][31:0])=rs2[31:0];</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">RV64/RV128 only</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDGP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd=sign_ext(DataMemory[gp+sign_ext(imm)][63:0]);</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SDGP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DataMemory[gp+sign_ext(imm)][63:0])=rs2[63:0];</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Assembly Examples</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">lw s0, 20(gp)
sw s0, 20(gp)

//RV64/RV128 only
ld s0, 20(gp)
sd s0, 20(gp)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_c_lbu_c_lhu_c_lb_c_lh_c_sb_c_sh">8.3. C.LBU, C.LHU, C.LB, C.LH, C.SB, C.SH</h3>
<div class="paragraph">
<p>These instructions conflict with the <code>D</code>-extension. If <code>D</code> is implemented, these instruction will not be available. They are compatible with <code>Zdinx</code>.</p>
</div>
<table id="ldstbh" class="tableblock frame-all grid-all spread">
<caption class="title">Table 33. proposed 16-bit encodings for load/store byte/half</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15:13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11:10</th>
<th class="tableblock halign-left valign-top">9:7</th>
<th class="tableblock halign-left valign-top">6:5</th>
<th class="tableblock halign-left valign-top">4:2</th>
<th class="tableblock halign-left valign-top">1:0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uimm[0,3]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rs1'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uimm[2:1]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LBU</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uimm[4:3]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rs1'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uimm[2:1]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LHU</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uimm[0,3]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rs1'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uimm[2:1]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uimm[4:3]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rs1'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uimm[2:1]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LH</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uimm[0,3]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rs1'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uimm[2:1]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rs2'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uimm[4:3]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rs1'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uimm[2:1]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rs2'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SH</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  Because of the short offsets available in the 16-bit encodings, if programmers place byte/short values near the base of their structures then it&#8217;s more likely that they will be accessible with a 16-bit encoding and therefore save code-size.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  In <a href="#ldstbhsemantics">Load/store byte/half semantics</a> DataMemory is a data memory array of elements with XLEN width
</td>
</tr>
</table>
</div>
<table id="ldstbhsemantics" class="tableblock frame-all grid-all spread">
<caption class="title">Table 34. Load/store byte/half semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LBU</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = zero_ext(DataMemory[rs1'+zero_ext(uimm)][ 7:0])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LHU</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = zero_ext(DataMemory[rs1'+zero_ext(uimm)][15:0])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = sign_ext(DataMemory[rs1'+zero_ext(uimm)][ 7:0])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = sign_ext(DataMemory[rs1'+zero_ext(uimm)][15:0])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = DataMemory[rs1'+zero_ext(uimm)][ 7:0] = rs2'[ 7:0]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = DataMemory[rs1'+zero_ext(uimm)][15:0] = rs2'[15:0]</p></td>
</tr>
</tbody>
</table>
<table id="ldstbh-32bit" class="tableblock frame-all grid-all spread">
<caption class="title">Table 35. Load/store byte-half 32-bit equivalent instructions with a direct equivalent</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">example assembler syntax</th>
<th class="tableblock halign-left valign-top">requirements for 16-bit encoding</th>
<th class="tableblock halign-left valign-top">32-bit extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LBU</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lbu    rd, imm(rs1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all regs x8-x15, imm in range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-extension</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LHU</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lhu    rd, imm(rs1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all regs x8-x15, imm in range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-extension</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lb     rd, imm(rs1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all regs x8-x15, imm in range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-extension</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lh     rd, imm(rs1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all regs x8-x15, imm in range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-extension</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sb     rd, imm(rs1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all regs x8-x15, imm in range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-extension</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sh     rd, imm(rs1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all regs x8-x15, imm in range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-extension</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  Other assembler syntaxes are possible such as including the c. prefix
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Assembly Examples</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">lbu a5,10(a4)   # a5 = zero_ext(DataMemory(a4+10)[ 7:0])
lhu a5,20(a4)   # a5 = zero_ext(DataMemory(a4+20)[15:0])
lb  a5,10(a4)   # a5 = sign_ext(DataMemory(a4+10)[ 7:0])
lh  a5,20(a4)   # a5 = sign_ext(DataMemory(a4+20)[15:0])
sb  a5,10(a4)   # DataMemory(a4+10)[ 7:0] = a5[ 7:0]
sh  a5,20(a4)   # DataMemory(a4+20)[15:0] = a5[15:0]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tablejump">9. Table Jump</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Table jumps are used to reduce the code size of <code>JAL</code> / <code>AUIPC+JALR</code> / <code>JR</code> / <code>AUIPC+JR</code> instructions.</p>
</div>
<div class="sect2">
<h3 id="_rationale">9.1. Rationale</h3>
<div class="paragraph">
<p>Function calls and jumps to fixed labels typically take 32-bit or 64-bit instruction sequences.
Here&#8217;s an example from the Huawei IoT code, GCC output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">00e084be &lt;vsprintf&gt;:
  #64-bit AUIPC/JALR sequence
  e084be:	001f8317            auipc t1,0x1f8
  e084c2:	18a302e7            jalr  t0,394(t1) # 1000648 &lt;__riscv_save_0&gt;

  e084c6:	86b2                mv    a3,a2
  e084c8:	862e                mv    a2,a1
  e084ca:	800005b7            lui	  a1,0x80000
  e084ce:	fff5c593            not	  a1,a1

  #32-bit JAL
  e084d2:	f61ff0ef            jal	  ra,e08432 &lt;vsnprintf&gt; # vsnprintf

  #64-bit AUIPC/JALR sequence
  e084d6:	001f8317            auipc	t1,0x1f8
  e084da:	19630067            jr	  406(t1) # 100066c &lt;__riscv_restore_0&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>using <code>C.TBLJ*</code> we can reduce this as follows (accepting gaps in the PCs as code has been deleted)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">00e084be &lt;vsprintf&gt;:
  e084be:	&lt;16-bit&gt;            tbljalm x ;#&lt;mapped to __riscv_save_0&gt;, saving 6-bytes

  e084c6:	86b2                mv     a3,a2
  e084c8:	862e                mv     a2,a1
  e084ca:	800005b7            lui	   a1,0x80000
  e084ce:	fff5c593            not	   a1,a1

  e084d2:	&lt;16-bit&gt;            tbljal y ;#&lt;mapped to vsnprintf&gt;, saving 2-bytes (8-byte refs to this fn also exist)

  e084da:	&lt;16-bit&gt;            tblj   z ;#&lt;mapped to __riscv_restore_0&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The principle is to have a single lookup table of <code>TBLJALENTRIES</code> addresses for <code>C.TBLJ*</code>, which is built by the linker. The linker then substitutes the code as shown in the example above where the 32-byte function is reduced to 18-bytes giving ~ 56% saving. Clearly the lookup table takes some space, but this is a minimal overhead for repeated functions such as the save/restore routines.</p>
</div>
<div class="paragraph">
<p><code>TBLJALENTRIES</code> is set by the maximum size of the table, which is 256 as the encoding has an 8-bit index.</p>
</div>
<div class="paragraph">
<p>Table jump allows the linker to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>replace 32-bit <code>J</code> calls with <code>C.TBLJ</code></p>
</li>
<li>
<p>replace 32-bit <code>JAL ra</code> calls with <code>C.TBLJAL</code></p>
</li>
<li>
<p>replace 32-bit <code>JAL t0</code> calls with <code>C.TBLJALM</code> (<code>M</code> for Millicode)</p>
</li>
<li>
<p>replace 64-bit <code>AUIPC/JR</code> calls to fixed locations with <code>C.TBLJ</code></p>
</li>
<li>
<p>replace 64-bit <code>AUIPC/JALR ra</code> calls to fixed locations with <code>C.TBLJAL</code></p>
</li>
<li>
<p>replace 64-bit <code>AUIPC/JALR t0</code> calls to fixed locations with <code>C.TBLJALM</code></p>
<div class="ulist">
<ul>
<li>
<p>The <code>AUIPC+JR/JALR</code> sequence is used because the offset from the PC is out of the 1MB range.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_encoding">9.2. Encoding</h3>
<div class="paragraph">
<p>These instructions use a previously reserved encoding.</p>
</div>
<table id="tbljal16bitencoding" class="tableblock frame-all grid-all spread">
<caption class="title">Table 36. C.TBLJAL 16-bit encoding</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15:13</th>
<th class="tableblock halign-left valign-top">12:10</th>
<th class="tableblock halign-left valign-top">9:2</th>
<th class="tableblock halign-left valign-top">1:0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">index8&lt;8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.TBLJALM</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">index8&gt;=8 &amp;&amp; index8&lt;64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.TBLJ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">index8&gt;=64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.TBLJAL</p></td>
</tr>
</tbody>
</table>
<table id="tbljal16bitassemblersyntax" class="tableblock frame-all grid-all spread">
<caption class="title">Table 37. C.TBLJAL assembler syntax</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">example assembler syntax</th>
<th class="tableblock halign-left valign-top">requirements for 16-bit encoding</th>
<th class="tableblock halign-left valign-top">32-bit extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.TBLJALM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tbljalm n</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n is in the range 0 to 7   (index8=n)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.TBLJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tblj    n</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n is in the range 0 to 55  (index8=n+8)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.TBLJAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tbljal  n</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n is in the range 0 to 191 (index8=n+64)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  Other assembler syntaxes are possible such as including the c. prefix
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Therefore there is a single jump table in memory. The table entry number is from the <code>index8</code> field in the encoding, which controls the link register.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>C.TBLJALM</code>: entries 0-7,    link to <code>t0</code></p>
</li>
<li>
<p><code>C.TBLJ</code>   : entries 8-63,   link to <code>zero</code></p>
</li>
<li>
<p><code>C.TBLJAL</code> : entries 64-255, link to <code>ra</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that the LSB of every jump table entry is <em>ignored</em> which matches standard <code>JALR</code> behaviour.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuringthejumptable">9.3. Recommended algorithm for allocating entries in the jump table</h3>
<div class="paragraph">
<p>Calls to each function are categorised as shown in <a href="#tbljalsavings">C.TBLJAL/TBJAL code size saving per function</a>.</p>
</div>
<table id="tbljalsavings" class="tableblock frame-all grid-all spread">
<caption class="title">Table 38. C.TBLJAL/TBJAL code size saving per function</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">original sequence</th>
<th class="tableblock halign-left valign-top"><code>C.TBLJ*</code> saving</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>J</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A*2-(XLEN/8) bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AUIPC+JR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">B*6-(XLEN/8) bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JAL ra</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C*2-(XLEN/8) bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AUIPC+JALR ra</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">D*6-(XLEN/8) bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JAL t0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E*2-(XLEN/8) bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AUIPC+JALR t0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F*6-(XLEN/8) bytes</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  <code>C.JAL</code> is not included as there&#8217;s no code-size saving for RV32 and it&#8217;s not available for RV64
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Each function is called by using one of the three link registers. The total saving per function is calculated by counting the number of calls and adding up the total saving from each replacement of the existing sequence with <code>C.TBLJ*</code>, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">saving_per_function_c_tblj    = A * 2 + B * 6 - 2*(XLEN-8)
saving_per_function_c_tbljal  = C * 2 + D * 6 - 2*(XLEN-8)
saving_per_function_c_tbljalm = E * 2 + F * 6 - 2*(XLEN-8)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The functions are sorted so that the one with the highest saving is in table entry 0, the second highest in entry 1 etc. for that encoding.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  This algorithm assumes that each function is only called with one link register. If the same funciton is called with more than one link register, then it must have two entries in the table.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This allows the core to cache the most frequent targets by caching the lowest numbered entries of each section of the jump table. Only caching a few entries will greatly improve the performance.</p>
</div>
</div>
<div class="sect2">
<h3 id="_csrs">9.4. CSRs</h3>
<div class="paragraph">
<p>The CSR is required to control the jump table, and it forms part of the current context. The jump table and <code>TBLJALVEC</code> must be configured before the first <code>C.TBLJ*</code> instruction is executed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  The address is for a custom CSR, a correct CSR address need to be specified.
</td>
</tr>
</table>
</div>
<table id="TBLJALVEC-table" class="tableblock frame-all grid-all spread">
<caption class="title">Table 39. <code>TBLJALVEC</code> definition</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">XLEN-1:6</th>
<th class="tableblock halign-left valign-top">5:0</th>
<th class="tableblock halign-left valign-top">CSR</th>
<th class="tableblock halign-left valign-top">Permissions</th>
<th class="tableblock halign-left valign-top">Status</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x800</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">base[XLEN-1:6]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TBLJALVEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>TBLJALVEC.base</code> is a virtual address, whenever virtual memory is enabled.</p>
</div>
<div class="paragraph">
<p>Using <code>TBLJALVEC.base</code> in the pseudo code below implicitly assumes that <code>TBLJALVEC.base[5:0]=0</code>. This is consistent with the description of <code>xTVEC</code> in the Unprivileged ISA manual.</p>
</div>
<div class="paragraph">
<p><code>TBLJALVEC.base</code> is naturally aligned for all legal values of <code>XLEN</code>.</p>
</div>
<div class="paragraph">
<p>The memory pointed to by <code>TBLJALVEC.base</code> only requires eXecute permission. Read/Write access is not required once the jump table/vector table has been configured.</p>
</div>
<table id="TBLJALVEC-config-table" class="tableblock frame-all grid-all spread">
<caption class="title">Table 40. <code>TBLJALVEC.config</code> definition</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">TBLJALVEC.config</th>
<th class="tableblock halign-left valign-top">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">000000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jump table mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">others</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved for future standard use</strong></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>TBLJALVEC.config</code> is a WARL field, so can only be programmed to modes which are implemented. Therefore the discovery mechanism is to attempt to program different modes and read back the values to see which are available. Jump table mode <em>must</em> be implemented.</p>
</div>
</div>
<div class="sect2">
<h3 id="_jump_table_mode">9.5. Jump table mode</h3>
<div class="paragraph">
<p>In jump table mode the behaviour is to load the target address from <code>TBLJALVEC.base</code> with an offset which is <code>XLEN/8</code> times the parameter passed to the instruction.</p>
</div>
<div class="paragraph">
<p>The actual functions are not moved in memory, the jump table lookup is only to give a reference to them using a 16-bit encoding.</p>
</div>
<div class="paragraph">
<p>Jump table mode is implemented in the linker and doesn&#8217;t affect the compiler, as it is only a link time optimisation.</p>
</div>
<div class="sect3">
<h4 id="_pseudo_code_for_jump_table_mode">9.5.1. Pseudo-code for jump table mode</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  InstMemory below is an instruction memory array of elements with XLEN width.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode"># target_address is temporary internal state, it doesn't represent a real register
# Mem is byte indexed
# index8 is the field from the encoding, not the index passed to the C.TBLJ* in the assembler

switch(XLEN) {
  32:  table_address[XLEN-1:0] = TBLJALVEC.base + index8&lt;&lt;2;
  64:  table_address[XLEN-1:0] = TBLJALVEC.base + index8&lt;&lt;3;
  128: table_address[XLEN-1:0] = TBLJALVEC.base + index8&lt;&lt;4;
}

//check for debug mode entry, trigger with timing=0 and action=1, haltreq or step
if ((debug_trigger(table_address) &amp;&amp; MCONTROL.timing==0 &amp;&amp; MCONTROL.action==1) ||
    external_debug_haltreq() || DCSR.step==1) {
  DPC        = current_PC;
  DCSR.cause = DCSR.step==1 ? 4 : external_debug_haltreq() ? 3 : 2;
  enter_debug_mode();
//check for breakpoint trigger which takes an exception with timing=0
} else if ((debug_trigger(table_address) &amp;&amp; MCONTROL.timing==0) ||
            !can_access_instruction_memory(table_address)) {
  MEPC   = current_PC;
  MTVAL  = table_address;
  MCAUSE = debug_trigger(table_address) ? BREAKPOINT : INSTRUCTION_ACCESS_FAULT;
  take_exception();
} else {
  //access the jump table
  switch(XLEN) {
    32:  LW target_address, InstMemory[table_address][XLEN-1:0];
    64:  LD target_address, InstMemory[table_address][XLEN-1:0];
    128: LQ target_address, InstMemory[table_address][XLEN-1:0];
  }

  //don't use haltreq or step here, only check the addresses
  //check for table_address after reading if timing=1
  if (debug_trigger(table_address) &amp;&amp; MCONTROL.timing==1 &amp;&amp; MCONTROL.action==1) {
    DPC        = current_PC;
    DCSR.cause = 2;
    enter_debug_mode();
  } else if (debug_trigger(table_address) &amp;&amp; MCONTROL.timing==1) {
    MEPC       = current_PC;
    MTVAL      = table_address;
    MCAUSE     = BREAKPOINT;
    take_exception();
  } else if ((debug_trigger(target_address) &amp;&amp; MCONTROL.timing==0 &amp;&amp; MCONTROL.action==1) {
    DPC        = target_address;
    DCSR.cause = 2;
    enter_debug_mode();
  } else if (((debug_trigger(target_address) &amp;&amp; MCONTROL.timing==0) ||
               !can_access_instruction_memory(target_address)) {
    MEPC       = target_address;
    MTVAL      = target_address;
    MCAUSE     = debug_trigger(target_address) ? BREAKPOINT : INSTRUCTION_ACCESS_FAULT;
    take_exception();
  } else {
    //jump to the target address
    switch(opcode) {
      C.TBLJALM: JALR t0,   target_address[XLEN-1:0]&amp;~0x1;
      C.TBLJ:    JALR zero, target_address[XLEN-1:0]&amp;~0x1;
      C.TBLJAL:  JALR ra,   target_address[XLEN-1:0]&amp;~0x1;
    }
  }
}

//check the target_address afterwards if timing=1
if (((debug_trigger(target_address) &amp;&amp; MCONTROL.timing==1 &amp;&amp; MCONTROL.action==1)) {
  DPC        = target_address;
  DCSR.cause = 2;
  enter_debug_mode();
} else if ((debug_trigger(target_address) &amp;&amp; MCONTROL.timing==1) {
  MEPC       = target_address;
  MTVAL      = target_address;
  MCAUSE     = BREAKPOINT;
  take_exception();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the <code>vsprintf</code> example above, the jump table contains the following for <code>RV32</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">TBLJALVEC.base+ 32(index  0) = # 100064a &lt;__riscv_save_0&gt;    # called with C.TBLJALM #0 (index8=0  in the encoding)
TBLJALVEC.base+  0(index  8) = # 100066c &lt;__riscv_restore_0&gt; # called with C.TBLJ    #0 (index8=8  in the encoding)
TBLJALVEC.base+256(index 64) = #  e08433 &lt;vsnprintf&gt;         # called with C.TBLJAL  #0 (index8=64 in the encoding)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_exceptions_for_jump_table_mode">9.5.2. Exceptions for jump table mode</h4>
<div class="paragraph">
<p>Two instruction memory accesses are required.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The first memory access is to the jump table.</p>
</li>
<li>
<p>The second memory access is from dereferencing the jump table entry and fetching the address of the destination function.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A fault from accessing the destination function address can only be taken if the read from the jump table completed successfully.</p>
</div>
<div class="paragraph">
<p>The address of the table jump entry is considered to be an instruction address, and so is checked against all possible sources of address faults such as page faults and instruction address breakpoints. When a fault occurs on the jump table address, the saved PC is the PC of the <code>C.TBLJ*</code> instruction, which is stored in <code>MEPC</code> or <code>DPC</code> as required.</p>
</div>
<div class="paragraph">
<p><em>Example 1: the jump table entry itself caused a fault</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>MEPC</code>  = the PC of the <code>C.TBLJ*</code> instruction</p>
</li>
<li>
<p><code>MTVAL</code> = the address of the jump table entry</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Example 2: the destination function caused a fault</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>MEPC</code>  = the PC of the destination function</p>
</li>
<li>
<p><code>MTVAL</code> = the PC of the destination function</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_single_stepping">9.5.3. Single stepping</h4>
<div class="paragraph">
<p>When single stepping across a <code>C.TBLJ*</code> instruction, execution stops before the <code>C.TBLJ*</code>, and then stops before the first instruction of the destination function. The fetch from the jump table only becomes visible if it causes a fault, as shown above.</p>
</div>
</div>
<div class="sect3">
<h4 id="_context_switching_for_jump_table_mode">9.5.4. Context Switching for jump table mode</h4>
<div class="paragraph">
<p>The <code>TBLJALVEC</code> CSR forms part of the current context, and so will need to be saved and restored.</p>
</div>
</div>
<div class="sect3">
<h4 id="_caching_for_jump_table_mode">9.5.5. Caching for jump table mode</h4>
<div class="paragraph">
<p>For improved performance, the implementation may cache the contents of the jump table. To maintain coherency between stores to the jump table and the instruction fetch, then a <code>FENCE.I</code> is required, or other standard coherency mechanism as defined by RISC-V. More generally, any jump table cache should be flushed whenever the instruction cache is flushed.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="vector-table-mode">9.6. Future Mode: Vector table mode (not for RVM22/RVA22)</h3>
<div class="paragraph">
<p>Vector table mode is very similar to vectored interrupt handling. The target address is a scaled offset from the base vector. Therefore in vector table mode, execution passes directly to the scaled offset from the base register, not via a jump table.</p>
</div>
<div class="paragraph">
<p>Vector table mode is similar to the mechanism for the interrupt handler vector. The jump is direct to the destination. However the compiler would have to be aware as it will have to try to fit functions into the table, as each entry is a fixed size so it&#8217;s not so obviously implementable in the toolchain. We may find other reasons for having this mode. TBD.</p>
</div>
<div class="paragraph">
<p><code>TBLJALVEC.scale</code> controls the scale. It is a read/write field instead of WARL.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 40%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>TBLJALVEC.scale</code></th>
<th class="tableblock halign-left valign-top"><code>tablescale</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16-bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32-bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">&#8230;&#8203;..</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4096-bytes to match minimum TLB page size</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note that <code>tablescale = 1&lt;&lt;(TBLJALVEC.scale+3)</code></p>
</div>
<div class="sect3">
<h4 id="_pseudo_code_for_vector_table_mode">9.6.1. Pseudo-code for vector table mode</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  InstMemory below is an instruction memory array of elements with XLEN width.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode"># Mem is byte indexed
# n is the immediate operand passed to c.tblj*
switch(opcode) {
  C.TBLJ:    JALR zero, InstMemory[TBLJALVEC.base + n*tablescale][XLEN-1:0]&amp;~0x1;
  C.TBLJAL:  JALR ra,   InstMemory[TBLJALVEC.base + n*tablescale][XLEN-1:0]&amp;~0x1;
  C.TBLJALM: JALR t0,   InstMemory[TBLJALVEC.base + n*tablescale][XLEN-1:0]&amp;~0x1;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_vector_table_code">9.6.2. vector table code</h4>
<div class="paragraph">
<p>Because this method doesn&#8217;t have the jump table - the code is actually placed in the table. If the code is too large to fit then it will have to call a routine outside the table, or use more than one entry which invalidates one or more table entries.
This avoids an additional redirection to get to the actual code, assuming the whole body of the code actually fits in the table.</p>
</div>
<div class="paragraph">
<p>Setting <code>TBLJALVEC.scale</code> to specific values does not set a requirement on the alignment of <code>TBLJALVEC.base</code>. For example if <code>tablescale=4096</code>, <code>TBLJALVEC.base</code> does <em>not</em> need to be 4096-byte aligned.</p>
</div>
<div class="paragraph">
<p>If <code>tablescale</code> is set to 4096 then this allows each entry in the table to be owned by different privilege domain, which can manange its own code. <code>TBLJALVEC</code> must be changed by machine mode only so as the table refers to the system as a whole.</p>
</div>
<div class="paragraph">
<p>In a way this approach is similar to a <strong>flash patch</strong> mechanism, where the code can be patched by replacing an instruction with a <code>C.TBLJALM</code> instruction to call an alternative routine to fix a bug, or add functionality. Although this requires write permission on the code area so cannot work on a boot ROM for example, but it can form the basis of such a mechanism.</p>
</div>
<div class="paragraph">
<p>For the <code>vsprintf</code> example above <code>riscv_save_0</code> / <code>riscv_restore_0</code> each take 12 bytes, and <code>TBLJALVEC.scale=1</code> (16 bytes per entry) so the actual code is placed in the table. <code>vsprintf</code> is 136 bytes, but will shrink to 128-bytes or smaller by use of <code>c.tbljal</code> so I have allocated 4 entries to it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode"># index 0 (JAL t0 called by C.TBLJALM #0 (index8=0 in the encoding))
TBLJALVEC.base+32  &lt;__riscv_save_0&gt;:
 	1141                	addi	sp,sp,-16
 	c04a                	sw	s2,0(sp)
 	c226                	sw	s1,4(sp)
 	c422                	sw	s0,8(sp)
 	c606                	sw	ra,12(sp)
 	8282                	jr	t0

#index 8 (JAL zero called by C.TBLJ #0 (index8=8 in the encoding))
TBLJALVEC.base+0 &lt;__riscv_restore_0&gt;:
 	4902                	lw	s2,0(sp)
 	4492                	lw	s1,4(sp)
 	4422                	lw	s0,8(sp)
 	40b2                	lw	ra,12(sp)
 	0141                	addi	sp,sp,16
 	8082                	ret

# index 64-67 (JAL ra called by C.TBLJAL #0 (index8=64 in the encoding))
TBLJALVEC.base+48: &lt;vsnprintf&gt;
  	xxxx                	tbljalm #0 ;# call to &lt;__riscv_save_0&gt;
  ...  up to 128-byte function body ...
  	xxxx                	tblj #0 ;# call to &lt;__riscv_restore_0&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  This mode may waste memory as the target functions are very unlikely to all be multiples of <code>tablescale</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_vector_mode_security_future_ideas">9.6.3. Vector Mode Security (future ideas)</h4>
<div class="paragraph">
<p>The vector mode mechanism could be reused for security in the future. It is possible to define that the memory allocated to to the table can only have entry points on the specific vectors, and also only from <code>C.TBLJ*</code> instructions. In this way sensitive code can be placed in the table which cannot be reused for ROP/JOP gadgets, because the code cannot be targetted by <code>JALR</code> instructions.</p>
</div>
<div class="paragraph">
<p>These ideas will not be pursued as part of the code size work.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="emulation-mode">9.7. Future Mode: Emulation Mode (not for RVM22/RVA22)</h3>
<div class="paragraph">
<p>Emulation mode is the simplest. It doesn&#8217;t have a jump table or vector table, so allow a minimal hardware implementation.
It relies on the values in temporary registers not being maintained across function calls.</p>
</div>
<div class="paragraph">
<p><em>There are concerns about overwriting the temporary registers so this may be rejected</em></p>
</div>
<div class="sect3">
<h4 id="_pseudo_code_for_emulation_mode">9.7.1. Pseudo-code for emulation mode</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">t4 = TBLJALVEC.base;
t5 = n;       #table index
JALR t4, t4;  # t4 gets PC+2 for c.tbljal, PC+4 for tbljal</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_diagram_for_all_table_jump_modes">9.8. Diagram for all table jump modes</h3>
<div class="imageblock">
<div class="content">
<img src="https://github.com/riscv/riscv-code-size-reduction/blob/master/ISA%20proposals/Huawei/tbljump4.PNG" alt="all three modes">
</div>
<div class="title">Figure 1. all three modes</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pushpoppopret">10. PUSH and POP</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>PUSH, POP, POPRET</code> and <code>PUSH.E, POP.E, POPRET.E</code> along with the 16-bit forms are used to reduce the size of function prologues and epilogues.</p>
</div>
<div class="sect2">
<h3 id="_a_brief_example_from_zephyr">10.1. A brief example from Zephyr</h3>
<div class="paragraph">
<p>This example gives a nice illustration of what <code>PUSH, POP, POPRET</code> are trying to achieve.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">from subsys/bluetooth/controller/crypto/crypto.c
int bt_rand(void *buf, size_t len)
{
        return lll_csrand_get(buf, len);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>compiles with GCC10 to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">20405458 &lt;bt_rand&gt;:
20405458:	1141                	addi	sp,sp,-16	;#PUSH(1)
2040545a:	c04a                	sw	s2,0(sp)	;#PUSH(2)
2040545c:	70000937          	lui	s2,0x70000
20405460:	62090613          	addi	a2,s2,1568 # 70000620 &lt;prng&gt;
20405464:	c422                	sw	s0,8(sp)	;#PUSH(3)
20405466:	c226                	sw	s1,4(sp)	;#PUSH(4)
20405468:	c606                	sw	ra,12(sp)	;#PUSH(5)
2040546a:	842a                	mv	s0,a0		;#PUSH(6)
2040546c:	84ae                	mv	s1,a1		;#PUSH(7)
&lt;function body&gt;
20405494:	4501                	li	a0,0		;#POPRET(1)
20405496:	40b2                	lw	ra,12(sp)	;#POPRET(2)
20405498:	4422                	lw	s0,8(sp)	;#POPRET(3)
2040549a:	4492                	lw	s1,4(sp)	;#POPRET(4)
2040549c:	4902                	lw	s2,0(sp)	;#POPRET(5)
2040549e:	0141                	addi	sp,sp,16	;#POPRET(6)
204054a0:	8082                	ret			;#POPRET(7)</code></pre>
</div>
</div>
<div class="paragraph">
<p>with the GCC option <code>-msave-restore</code> the output is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">204089ac &lt;bt_rand&gt;:
204089ac:       f97f72ef                jal     t0,20400942 &lt;__riscv_save_0&gt;	;#PUSH(1)
204089b0:       70001937                lui     s2,0x70001
204089b4:       ac090613                addi    a2,s2,-1344 # 70000ac0 &lt;prng&gt;
204089b8:       842a                    mv      s0,a0	;#PUSH(2)
204089ba:       84ae                    mv      s1,a1	;#PUSH(3)
&lt;function_body&gt;
204089e2:       4501                    li      a0,0	;#POPRET(1)
204089e4:       f83f706f                j       20400966 &lt;__riscv_restore_0&gt;	;#POPRET(2)</code></pre>
</div>
</div>
<div class="paragraph">
<p>with <code>PUSH/POPRET</code> this reduces to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">20405458 &lt;bt_rand&gt;:
20405458:	&lt;16-bit&gt;                push	 {ra,s0-s2},{a0-a2},-16
2040545c:	70000937          	lui	s2,0x70000
20405460:	62090613          	addi	a2,s2,1568 # 70000620 &lt;prng&gt;
&lt;function body&gt;
20405496:	&lt;16-bit&gt;                popret	 {ra,s0-s2},{0}, 16</code></pre>
</div>
</div>
<div class="paragraph">
<p>The prologue / epilogue reduce from 28-bytes in the original code, to 14-bytes with <code>-msave-restore</code>, and to to 8-bytes with <code>PUSH, POP, POPRET</code>, which will also improve the performance.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  The calls to <code>&lt;riscv_save_0&gt;/&lt;riscv_restore_0&gt;</code> become 64-bit when the target functions are out of the 1MB range, increasing the prologue/epilogue size to 22-bytes.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  The <code>C.PUSH</code> has an additional register move included <code>mv s2, a2</code> which wasn&#8217;t in the original prologue. This is included to simplify the encoding and definition of <code>C.PUSH/PUSH</code> and will cost some performance.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="uabiandeabisupport">10.2. UABI and EABI support</h3>
<div class="paragraph">
<p>The UABI is available on all RVI cores. The EABI is optional on RV32I and required on RV32E.</p>
</div>
<div class="paragraph">
<p>The UABI supports saved registers <code>s0-s11</code>, the EABI supports saved registers <code>s0-s4</code> only but <code>s2-s4</code> are mapped to <em>different</em> <code>X</code> registers.</p>
</div>
<div class="paragraph">
<p>Therefore encodings which support register lists which include up to <code>s1</code> can be used for both ABIs. As soon as the list includes <code>s2</code> then a different encoding is required.</p>
</div>
<div class="paragraph">
<p>This specification for the EABI is taken from <a href="https://github.com/riscv/riscv-eabi-spec/blob/master/EABI.adoc">this document</a>.</p>
</div>
<div class="paragraph">
<p>The <code>PUSH/POP/POPRET/C.PUSH/C.POP/C.POPRET</code> instructions support the UABI. The <code>PUSH.E/POP.E/POPRET.E/C.PUSH.E/C.POP.E/C.POPRET.E</code> instructions support the EABI.</p>
</div>
<div class="paragraph">
<p>Where the <code>X</code> register list is the same for both ABIs the EABI version is a pseudo-instruction, where the <code>X</code> register list is different it has a different encoding, for example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>c.pop.e {ra, s0}, {}, 32</code> is a pseudo-instruction for <code>c.pop {ra, s0}, {}, 32</code></p>
</li>
<li>
<p><code>c.pop.e {ra, s0-s2}, {}, 32</code> has a different encoding to <code>c.pop {ra, s0-s2}, {}, 32</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is recommended that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>when compiling/disassembling for the UABI, the pseudo-instructions with the <code>.E</code> suffix <em>should not</em> be used.</p>
</li>
<li>
<p>when compiling/disassembling for the EABI, the pseudo-instructions with the <code>.E</code> suffix <em>should</em> be used.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>.E</code> forms are not available on RV64I or RV128I. Any encodings with a <code>.E</code> suffix are reserved on those base architectures.</p>
</div>
<table id="ABI-on-base-arch" class="tableblock frame-all grid-all spread">
<caption class="title">Table 41. ABIs on different base architectures</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Base architecture</th>
<th class="tableblock halign-left valign-top">UABI</th>
<th class="tableblock halign-left valign-top">EABI</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RV32I</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Full support of both ABIs required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RV32E</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binary can execute on RV32I</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RV64I/RV128I</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No EABI support on RV64I/RV128I</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Code compiled for RV32I may be compiled for the UABI or EABI. Code compiled for RV32E may be executed on an RV32I core.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  An RV32I core running the EABI has many saved registers. The <code>PUSH/POP</code> encodings only support up to <code>s4</code>. There are no encodings which support saving higher numbered <code>s</code> registers in this case, and so the optimal solution would be for a reduced version of <code>-msave-restore</code> which is used for longer register lists. A future version of <code>Zce</code> may include new cases in the 32-bit encodings to save the higher <code>s</code> registers. At the timing of writing the EABI specification is not frozen and there is no toolchain publicly available so the distribution of higher numbered saved registers for RV32I EABI cannot be assessed.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_assembler_syntax">10.3. Assembler Syntax</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <code>PUSH</code> instruction</p>
<div class="ulist">
<ul>
<li>
<p>pushes(stores)  the registers specified in <code>reg_list</code> to the stack</p>
</li>
<li>
<p>if <code>areg_list</code> is included, moves the registers in the <code>areg_list</code> into <code>s</code> registers</p>
<div class="ulist">
<ul>
<li>
<p><code>areg_list</code> is determined automatically from <code>rlist</code>, it cannot be arbitrarily specified. The definition is in <a href="#pushpop32bitsyntax">32-bit encoding assembler syntax</a>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>adjusts the stack pointer by the <code>stack_adjustment</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>The <code>POP</code> instruction</p>
<div class="ulist">
<ul>
<li>
<p>pops(loads) the registers in <code>reg_list</code> from the stack</p>
</li>
<li>
<p>if <code>ret_val</code> is included, moves the specified constant value into <code>a0</code> as the return value</p>
</li>
<li>
<p>adjusts the stack pointer by the <code>stack_adjustment</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>POPRET</code> has the same behaviour as <code>POP</code>, followed by <code>RET</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>32-bit and 16-bit forms of all instructions are available, the assembler should choose the 16-bit form if the parameters permit.</p>
</div>
<div class="paragraph">
<p>The registers in <code>reg_list</code> and <code>areg_list</code> are comma separated lists and must not be empty.</p>
</div>
<div class="paragraph">
<p>The assembler/disassembler can choose whether to include the <code>c.</code> prefix for 16-bit encodings. The recommendation is to exclude it.</p>
</div>
<div class="sect3">
<h4 id="pushpop32bitsyntax">10.3.1. 32-bit encoding assembler syntax</h4>
<div class="paragraph">
<p>There are different definitions for the register lists in use (<code>reg_list_32u/reg_list_16u/reg_list_e</code>). In all cases the requirements of <code>areg_list</code> are the same - and so it is only specified only once with respect to <code>reg_list_*</code> to avoid replication.</p>
</div>
<div class="paragraph">
<p>The stack adjustment range varies between encodings. The syntax <code>stack_adjustment_0_N</code> is used. The stack adjustment value must be the total memory required for the registers in <code>reg_list_*</code> rounded up to a multiple of 16-bytes, plus an additional 0 to <code>N</code> * 16-bytes. Also see <a href="#spimm"><code>spimm</code> encoding field</a>.</p>
</div>
<div class="paragraph">
<p>This syntax is for the 32-bit encodings, for the UABI</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">&lt;ret_val_32&gt;     ::= "" | 0 | 1 | -1
&lt;sreg_list_32u&gt;  ::=      &lt;s0&gt;  | &lt;s0-sN&gt;   (where N is in the range [1, 11])
&lt;areg_list&gt;      ::= "" | &lt;a0&gt;  | &lt;a0-aP&gt;   (where P is in the range [1, 3])
&lt;reg_list_32u&gt;   ::= &lt;ra&gt; ["," &lt;sreg_list_32u&gt;]

//L is the length of the encoding - 16 or 32 - so &lt;reg_list_Lu&gt; can represent &lt;reg_list_16u&gt; or &lt;reg_list_32u&gt;
//Only certain combinations of &lt;reg_list_Lu&gt; and &lt;areg_list&gt; are allowed.

if (&lt;reg_list_Lu&gt;=="ra")         &lt;areg_list&gt;=""
if (&lt;reg_list_Lu&gt;=="ra, s0")     &lt;areg_list&gt;="a0"
if (&lt;reg_list_Lu&gt;=="ra, s0-sN")  &lt;areg_list&gt;="a0-aP" (where if (N&lt;4) P=N; else P=3;)

//&lt;reg_list_Lu&gt; can also be expressed using X registers using the standard UABI mapping

if (&lt;reg_list_Lu&gt;=="ra")         &lt;xreg_list_Lu&gt;="x1"
if (&lt;reg_list_Lu&gt;=="ra, s0")     &lt;xreg_list_Lu&gt;="x1, x8"
if (&lt;reg_list_Lu&gt;=="ra, s0-s1")  &lt;xreg_list_Lu&gt;="x1, x8-x9"
if (&lt;reg_list_Lu&gt;=="ra, s0-s2")  &lt;xreg_list_Lu&gt;="x1, x8-x9, x18"
if (&lt;reg_list_Lu&gt;=="ra, s0-sN")  &lt;xreg_list_Lu&gt;="x1, x8-x9, x18-xM" (where M=N+16 and N is in the range [3, 11])

//&lt;areg_list&gt; can also be expressed using X registers using the standard UABI mapping

if (&lt;reg_list_Lu&gt;=="ra")         &lt;xareg_list&gt;=""
if (&lt;reg_list_Lu&gt;=="ra, s0")     &lt;xareg_list&gt;="x10"
if (&lt;reg_list_Lu&gt;=="ra, s0-sN")  &lt;xareg_list&gt;="x10-xP" (where if (N&lt;4) P=N+10; else P=13;)

//legal syntax for 32-bit encodings.
//Note that &lt;areg_list&gt;/&lt;xareg_list&gt; is optional for push,
//and that both register lists must use either ABI names or `x` numbers.

push         {&lt;reg_list_32u&gt;},  {"" | &lt;areg_list&gt;},  -stack_adjustment_0_31
push         {&lt;xreg_list_32u&gt;}, {"" | &lt;xareg_list&gt;}, -stack_adjustment_0_31

popret       {&lt;reg_list_32u&gt; | &lt;xreg_list_32u&gt;},  {ret_val_32}, stack_adjustment_0_31

pop          {&lt;reg_list_32u&gt; | &lt;xreg_list_32u&gt;},  {ret_val_32}, stack_adjustment_0_31</code></pre>
</div>
</div>
<div class="paragraph">
<p>This syntax is for the 32-bit encodings, for the EABI, which has a shorter range of <code>s</code> registers. Note that if the highest register in <code>sreg_list_e</code> is <code>s2</code> or lower, then this instruction is a <em>pseudo-instruction</em> for the non <code>.e</code> version. If <code>sreg_list_e</code> includes <code>s3</code> or <code>s4</code> then it is a separate encoding. Unlike the UABI encodings above, the <code>s</code> registers are not always listed sequentially as the <code>x</code> register order is the important one - the <code>x</code> register list is sequential.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">&lt;sreg_list_e&gt;  ::= &lt;s0&gt;  | &lt;s0-s1&gt; | &lt;s0-s2&gt; | &lt;s3,s0-s2&gt; | &lt;s3-s4,s0-s2&gt;
&lt;reg_list_e&gt;   ::= &lt;ra&gt; ["," &lt;sreg_list_e&gt;]
if (&lt;reg_list_e&gt;=="ra")               &lt;xreg_list_e&gt;="x1"
if (&lt;reg_list_e&gt;=="ra, s0")           &lt;xreg_list_e&gt;="x1, x8"
if (&lt;reg_list_e&gt;=="ra, s0-s1")        &lt;xreg_list_e&gt;="x1, x8-x9"
if (&lt;reg_list_e&gt;=="ra, s0-s2")        &lt;xreg_list_e&gt;="x1, x8-x9, x14"
if (&lt;reg_list_e&gt;=="ra, s3, s0-s2")    &lt;xreg_list_e&gt;="x1, x6, x8-x9, x14"
if (&lt;reg_list_e&gt;=="ra, s3-s4, s0-s2") &lt;xreg_list_e&gt;="x1, x6-x9, x14"

push.e         {&lt;reg_list_e&gt; | &lt;xreg_list_e&gt;}, {"" | &lt;areg_list&gt;}, -stack_adjustment_0_31
popret.e       {&lt;reg_list_e&gt; | &lt;xreg_list_e&gt;}, {ret_val_32},        stack_adjustment_0_31
pop.e          {&lt;reg_list_e&gt; | &lt;xreg_list_e&gt;}, {ret_val_32},        stack_adjustment_0_31</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  An earlier version of the specification allowed <code>ra</code> to be excluded from the register list. This caused a lot of complexity in the specifications above and we found very few cases in the benchmark suite where it would have been beneficial. If <code>ra</code> is not required then <code>PUSH/C.PUSH</code> can still be used, which will waste <code>XLEN</code> bits of stack memory but <code>POP/POPRET</code> etc. <em>cannot</em> as they would overwrite <code>ra</code>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_16_bit_encoding_assembler_syntax">10.3.2. 16-bit encoding assembler syntax</h4>
<div class="paragraph">
<p>This syntax is for the 16-bit encodings, for the UABI. The rules stated above for the 32-bit encodings also apply.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">&lt;sreg_list_16u&gt;  ::= &lt;s0&gt;  | &lt;s0-sN&gt;   (where N is 1,2,3,5,7,11)
&lt;reg_list_16u&gt;   ::= &lt;ra&gt; ["," &lt;sreg_list_16u&gt;]

c.push       {&lt;reg_list_16u&gt;},  {&lt;areg_list&gt;},  -stack_adjustment_0_5
c.push       {&lt;xreg_list_16u&gt;}, {&lt;xareg_list&gt;}, -stack_adjustment_0_5

c.popret     {&lt;reg_list_16u&gt; | &lt;xreg_list_16u&gt;}, {"" | 0}, stack_adjustment_0_5
c.pop        {&lt;reg_list_16u&gt; | &lt;xreg_list_16u&gt;}, {},       stack_adjustment_0_1</code></pre>
</div>
</div>
<div class="paragraph">
<p>This syntax is for the 16-bit encodings, for the EABI. All variables have been previously defined.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  <code>areg_list</code> is required for <code>c.push</code>. If no register moves are required then the 32-bit encoding <code>push</code> is required instead.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">c.push.e     {&lt;reg_list_e&gt;},  {&lt;areg_list&gt;},  -stack_adjustment_0_5
c.push.e     {&lt;xreg_list_e&gt;}, {&lt;xareg_list&gt;}, -stack_adjustment_0_5

c.popret.e   {&lt;reg_list_e&gt; | &lt;xreg_list_e&gt;}, {"" | 0},       stack_adjustment_0_5
c.pop.e      {&lt;reg_list_e&gt; | &lt;xreg_list_e&gt;}, {},             stack_adjustment_0_1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Examples of valid 16-bit encodings for RV32I or RV64I using the UABI:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">c.push   {ra},                {},         -16; //store ra;                                                decrement sp by 16
c.push   {ra,s0},             {a0},       -32; //store ra,s0;     mv s0,a0;                               decrement sp by 32
c.push   {ra,s0-s1},          {a0-a1},    -96; //store ra,s0-s1;  mv s0,a0; mv s1,a1;                     decrement sp by 96
c.push   {x1, x8-x9, x18-x13},{x10-x13}, -128; //store ra,s0-s11; mv s0,a0; mv s1,a1; mv s2,a2; mv s3,a3; decrement sp by 128

c.pop    {ra}, {},    16;  //load  ra;        increment sp by 16
c.popret {x1}, {},    16;  //load  ra;        increment sp by 16; jump to ra

c.pop    {ra,s0},    {},  32;  //load  ra,s0;     increment sp by 32
c.popret {x1, x8},   {0}, 32;  //load  ra,s0;     increment sp by 32; li a0, 0; jump to ra
c.popret {ra,s0-s3}, {},  96;  //load  ra,s0-s3;  increment sp by 96;           jump to ra
c.popret {ra,s0-s11},{}, 128;  //load  ra,s0-s11; increment sp by 128;          jump to ra</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>c.push   {ra,s0-s2}, {a0-a2},  -64</code> can use a 16-bit encoding</p>
</li>
<li>
<p><code>push     {ra,s0-s2}, {},       -64</code> must use a 32-bit encoding as <code>&lt;areg_list&gt;</code> is null</p>
</li>
<li>
<p><code>push     {ra,s0-s2}, {a0-a2}, -256</code> can use a 32-bit encoding as the <code>stack_adjustment</code> is out of range for <code>c.push</code></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>a <code>c.addi16sp; c.push</code> sequence achieves the same code-size</p>
</li>
</ol>
</div>
</li>
<li>
<p><code>c.popret {ra,s0-s2}, {0},       32</code> can use a 16-bit encoding</p>
</li>
<li>
<p><code>popret   {ra,s0-s2}, {1},       32</code> must use a 32-bit encoding as <code>c.popret</code> only supports <code>0</code> as the <code>ret_val</code> value</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_determining_xlen_to_decode_and_execute_the_instructions">10.4. Determining XLEN to decode and execute the instructions</h3>
<div class="paragraph">
<p>The execution of the instructions depends upon <code>XLEN</code>, as the width of the loads and stores change. From the ELF file header, the dissembler can determine <code>XLEN</code> by the following flags:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ELFCLASS64 for RV64</p>
</li>
<li>
<p>ELFCLASS32 for RV32</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  I don&#8217;t think there&#8217;s an ELFCLASS128 for RV128
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If using a debugger then <code>misa.MXL</code> can be read, if XLEN is not known for the core.</p>
</div>
<div class="paragraph">
<p>Follow this link for details of the <a href="https://github.com/riscv/riscv-elf-psabi-doc/blob/master/riscv-elf.md#file-header">ELF file header</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_pseudo_code">10.5. Pseudo-code</h3>
<div class="paragraph">
<p>The pseudo-code below show the required architectural state updates.</p>
</div>
<div class="paragraph">
<p>Note that every architectural state update in the pseudo-code can be executed as a standard RISC-V 32-bit encoding, so that it is possible execute the instructions as sequences of standard instructions.</p>
</div>
<div class="paragraph">
<p>Because the pseudo-code includes load or store operations, they may take any fault caused by executing loads or stores. See <a href="#fault-handling">Fault handling</a> for more details.</p>
</div>
<div class="sect3">
<h4 id="_push_push_e_c_push_c_push_e_pseudo_code">10.5.1. PUSH/PUSH.E/C.PUSH/C.PUSH.E Pseudo-code</h4>
<div class="paragraph">
<p>The <code>PUSH/PUSH.E/C.PUSH/C.PUSH.E</code> instructions store the set of registers from <code>xreg_list</code> to consecutive memory locations, and decrement the stack pointer.
The pseudo-code uses assembly inserts so that it can use <code>sw/sd</code> etc. The registers are always accessed in <code>x</code> register order.</p>
</div>
<div class="paragraph">
<p>The pseudo-code shows the memory and architectural state updates of the whole instruction which has completed without faults, debug halts or interrupts. See <a href="#fault-handling">Fault handling</a> and <a href="#software-view">Software view of execution</a> for more information.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  <code>stack_adjustment</code> is negative.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">//RV64/RV128 must have a 16-byte aligned sp
if (misa.MXL&gt;=2 &amp;&amp; sp[3:0]) {take_illegal_instruction_exception();}
//RV32I might be using the EABI (8-byte alignment) or UABI (16-byte alignment, so in hardware we can only check for 8)
if (misa.MXL==1 &amp;&amp; sp[2:0]) {take_illegal_instruction_exception();}

if (misa.MXL==1) {bytes=4;}
if (misa.MXL==2) {bytes=8;}
else             {bytes=16;}
addr=sp-bytes;
switch(bytes) {
  4:  asm("sw ra, 0(addr)");
  8:  asm("sd ra, 0(addr)");
  16: asm("sq ra, 0(addr)");
}
for(i=31;i&gt;=0;i--)  {
  //if register i is in xreg_list
  if (xreg_list[i]) {
    addr-=bytes;
    switch(bytes) {
      4:  asm("sw s[i], 0(addr)");
      8:  asm("sd s[i], 0(addr)");
      16: asm("sq s[i], 0(addr)");
    }
  }
}
//The sequence must be uninterruptible from this point

if (xareg_list[10]) { //if x10/a0 is in [x]areg_list
   asm("mv x8, x10");
  }
if (xareg_list[11]) { //if x11/a1 is in [x]areg_list
   asm("mv x9, x11");
  }
//if x12 is in xreg_list
if (xareg_list[12]) { //if x12/a2 is in [x]areg_list
   if (opcode == "PUSH.E" or opcode == "C.PUSH.E") {
     asm("mv x14, x12");
  } else {
     asm("mv x18, x12");
  }
//if x13 is in xreg_list
if (xareg_list[13]) { //if x13/a3 is in [x]areg_list
   if (opcode == "PUSH.E" or opcode == "C.PUSH.E") {
     asm("mv x6, x13");
  } else {
     asm("mv x19, x13");
  }
}
sp+=stack_adjustment; //decrement</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_pop_pop_e_popret_popret_e_c_pop_c_pop_e_c_popret_c_popret_e_pseudo_code">10.5.2. POP/POP.E/POPRET/POPRET.E/C.POP/C.POP.E/C.POPRET/C.POPRET.E Pseudo-code</h4>
<div class="paragraph">
<p>A <code>POP/POP.E/POPRET/POPRET.E/C.POP/C.POP.E/C.POPRET/C.POPRET.E</code> instruction loads the set of registers from <code>reg_list</code> from consecutive memory locations, and then increments the stack pointer.
The pseudo-code uses assembly inserts so that it can use <code>lw/ld/ret</code> etc.</p>
</div>
<div class="paragraph">
<p>The pseudo-code shows the architectural state updates of the whole instruction which has completed without faults, debug halts or interrupts. See <a href="#fault-handling">Fault handling</a> and <a href="#software-view">Software view of execution</a> for more information.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  <code>stack_adjustment</code> is positive.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">//RV64/RV128 must have a 16-byte aligned sp
if (misa.MXL&gt;=2 &amp;&amp; sp[3:0]) {take_illegal_instruction_exception();}
//RV32I might be using the EABI (8-byte alignment) or UABI (16-byte alignment, so in hardware we can only check for 8)
if (misa.MXL==1 &amp;&amp; sp[2:0]) {take_illegal_instruction_exception();}

if (misa.MXL==1) {bytes=4;}
if (misa.MXL==2) {bytes=8;}
else             {bytes=16;}
addr=sp+stack_adjustment-bytes;
switch(bytes) {
  4:  asm("lw ra, 0(addr)");
  8:  asm("ld ra, 0(addr)");
  16: asm("lq ra, 0(addr)");
}
for(i=31;i&gt;=0;i--)  {
  //if register i is in xreg_list
  if (xreg_list[i]) {
    addr-=bytes;
    switch(bytes) {
      4:  asm("lw s[i], 0(addr)");
      8:  asm("ld s[i], 0(addr)");
      16: asm("lq s[i], 0(addr)");
    }
  }
}
if (ret_val) {
   switch(ret_val) {
      "0":  asm("li a0, 0");
      "1":  asm("li a0, 1");
      "-1": asm("li a0, -1");
   }
}
//The sequence must be uninterruptible from this point
sp+=stack_adjustment; //increment
if (opcode == "POPRET"   or
    opcode == "POPRET.E" or
    opcode == "C.POPRET" or
    opcode == "C.POPRET.E") {
   asm("ret");
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pushpoppopret32bitencodings">10.6. 32-bit Encodings</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  These encodings are in <em>custom-1</em>, correct encodings need to be allocated.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 42. push/pop/popret 32-bit format PPP-type</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">31:22</th>
<th class="tableblock halign-left valign-top">21:20</th>
<th class="tableblock halign-left valign-top">19:16</th>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14:12</th>
<th class="tableblock halign-left valign-top">11: 7</th>
<th class="tableblock halign-left valign-top">6 : 0</th>
<th class="tableblock halign-left valign-top">type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">funct10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">field4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">field3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">field2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">funct3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">field1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opcode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZCE-type</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 43. push/pop/popret 32-bit encodings</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1112%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">31:22</th>
<th class="tableblock halign-left valign-top">21</th>
<th class="tableblock halign-left valign-top">20</th>
<th class="tableblock halign-left valign-top">19:16</th>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14:12</th>
<th class="tableblock halign-left valign-top">11: 7</th>
<th class="tableblock halign-left valign-top">6 : 0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0000000000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">areg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rlist (0-12)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0101011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0000000000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">areg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rlist (13-15)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0101011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH.E</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0000000000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">ret_val</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rlist (0-12)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0101011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0000000000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">ret_val</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rlist (13-15)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0101011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP.E</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0000000000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">ret_val</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rlist (0-12)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">110</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0101011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0000000000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">ret_val</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rlist (13-15)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">110</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0101011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET.E</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  <code>rlist&gt;12</code> gives register lists which only map to the EABI because the <code>X</code> register mapping is different for <code>s2-s4</code>, hence the <code>.E</code> suffix
</td>
</tr>
</table>
</div>
<table id="32-bit-areg" class="tableblock frame-all grid-all spread">
<caption class="title">Table 44. <code>areg</code> values for the 32-bit encoding of <code>PUSH, PUSH.E</code></caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>areg</code></th>
<th class="tableblock halign-left valign-top">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>areg_list</code> is empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>areg_list</code> is determined from <code>rlist</code> (see <a href="#32-bit-areg-list"><code>areg_list</code> values for the 32-bit encoding of <code>PUSH, PUSH.E</code></a>)</p></td>
</tr>
</tbody>
</table>
<table id="32bit-ret_val" class="tableblock frame-all grid-all spread">
<caption class="title">Table 45. <code>ret_val</code> values for the 32-bit encodings for <code>POP, POPRET, POP.E, POPRET.E</code></caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">return value</th>
<th class="tableblock halign-left valign-top">ABI names</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none (don&#8217;t set a0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a0=0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a0=1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a0=-1</p></td>
</tr>
</tbody>
</table>
<table id="32bit-rlist" class="tableblock frame-all grid-all spread">
<caption class="title">Table 46. <code>rlist</code> field values for the 32-bit encodings</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">rlist</th>
<th class="tableblock halign-left valign-top">reg_list_32u/reg_list_e</th>
<th class="tableblock halign-left valign-top">ABI</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>s0-s1</code> are the same for the UABI or EABI so the encoding is the same</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">both</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra, s0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">both</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra, s0-s1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">both</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">These values are for <code>reg_list_32u</code> for the UABI only</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra, s0-s2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UABI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra, s0-s3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UABI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra, s0-s4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UABI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra, s0-s5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UABI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra, s0-s6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UABI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra, s0-s7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UABI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra, s0-s8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UABI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra, s0-s9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UABI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra, s0-s10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UABI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra, s0-s11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UABI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">These values are for <code>reg_list_e</code> for the EABI only</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra, s0-s2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EABI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra, s3, s0-s2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EABI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra, s3-s4, s0-s2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EABI</p></td>
</tr>
</tbody>
</table>
<table id="32-bit-areg-list" class="tableblock frame-all grid-all spread">
<caption class="title">Table 47. <code>areg_list</code> values for the 32-bit encoding of <code>PUSH, PUSH.E</code></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">areg</th>
<th class="tableblock halign-left valign-top">rlist</th>
<th class="tableblock halign-left valign-top">areg_list</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a0-a1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a0-a2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4-12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a0-a3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a0-a2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">14-15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a0-a3</p></td>
</tr>
</tbody>
</table>
<table id="proposed-32bit-encodingsI-2" class="tableblock frame-all grid-all spread">
<caption class="title">Table 48. PUSH/POP/POPRET 32-bit encoding validity on RV32I/RV32E/RV64I/RV128I</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">RV32I</th>
<th class="tableblock halign-left valign-top">RV32E</th>
<th class="tableblock halign-left valign-top">RV64I/RV128I</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP          {ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP          {[ra,] s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP          {[ra,] s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP          {[ra,] s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP.E        {[ra,] s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET       {ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET       {[ra,] s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET       {[ra,] s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET       {[ra,] s0- <em>sN</em>}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET.E     {[ra,] s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET.E     {[ra,] s3, s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET.E     {[ra,] s3-s4, s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH         {ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH         {[ra,] s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH         {[ra,] s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH         {[ra,] s0- <em>sN</em>}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH.E       {[ra,] s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH.E       {[ra,] s3, s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH.E       {[ra,] s3-s4, s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  <em>sN</em> = (s2,s3,..,s11)
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  If there is no y in a cell then the encoding is <strong>reserved</strong> on that architecture
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All the <code>.E</code> instructions and pseudo-instructions are valid for <code>RV32I/RV32E</code>, none are valid for <code>RV64I/RV128I</code></p>
</div>
<div class="sect3">
<h4 id="_illegal_instructions">10.6.1. Illegal instructions</h4>
<div class="paragraph">
<p>The following cases cause illegal instruction exceptions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If <code>sp</code> is not 8-byte aligned and <code>XLEN=32</code></p>
</li>
<li>
<p>If <code>sp</code> is not 16-byte aligned and <code>XLEN&gt;32</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  RV32I may use either the UABI or EABI, so we can only check the EABI minimum alignment.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  The alignment check is for future compatibility with <code>PUSH.F,PUSH.D, PUSH.Q</code> where <code>XLEN!=FLEN</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pushpoppopret16bitIencodings">10.7. 16-bit Encodings</h3>
<div class="paragraph">
<p>These instructions have no conflicts with other extensions, they use previously reserved encodings.</p>
</div>
<table id="proposed-16bit-encodingsI-1" class="tableblock frame-all grid-all spread">
<caption class="title">Table 49. PUSH/POP/POPRET 16-bit encodings</caption>
<colgroup>
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8832%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">spimm0_5[6:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ret0</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rlist3</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spimm[4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rlist3</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spimm[4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rlist2</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP.E (RV32 only)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">spimm0_5[6:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rlist3</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">spimm0_5[6:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ret0</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rlist2</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET.E (RV32 only)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spimm0_5[4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">spimm0_5[6:5]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rlist2</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH.E (RV32 only)</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p><code>spimm0_5[6:4]</code> has legal values of 0 to 5, which maps to stack adjustments of 0 to 80 as bits [6:4] are specified.</p>
</li>
</ul>
</div>
<table id="rlist3-table" class="tableblock frame-all grid-all spread">
<caption class="title">Table 50. <code>rlist3</code> values for the 16-bit encodings</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">rlist3</th>
<th class="tableblock halign-left valign-top">reg_list_16u</th>
<th class="tableblock halign-left valign-top">areg_list (C.PUSH only)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra, s0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra, s0-s1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a0-a1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra, s0-s2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a0-a2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra, s0-s3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a0-a3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra, s0-s5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a0-a3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra, s0-s7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a0-a3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra, s0-s11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a0-a3</p></td>
</tr>
</tbody>
</table>
<table id="rlist2-table" class="tableblock frame-all grid-all spread">
<caption class="title">Table 51. <code>rlist2</code> values for the 16-bit encodings</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">rlist2</th>
<th class="tableblock halign-left valign-top">reg_list_e</th>
<th class="tableblock halign-left valign-top">areg_list (C.PUSH.E only)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra, s0-s2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a0-a2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra, s3, s0-s2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a0-a3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra, s3-s4, s0-s2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a0-a3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
</tbody>
</table>
<table id="ret0-table" class="tableblock frame-all grid-all spread">
<caption class="title">Table 52. <code>ret0</code> values for the 16-bit encodings</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">return value</th>
<th class="tableblock halign-left valign-top">ABI names</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none (don&#8217;t set a0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a0=0</p></td>
</tr>
</tbody>
</table>
<table id="proposed-16bit-encodingsI-2" class="tableblock frame-all grid-all spread">
<caption class="title">Table 53. PUSH/POP/POPRET 16-bit encoding validity on RV32I/RV32E/RV64I/RV128I</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">RV32I</th>
<th class="tableblock halign-left valign-top">RV32E</th>
<th class="tableblock halign-left valign-top">RV64I/RV128I</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP        {ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP        {ra, s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP        {ra, s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP        {ra, s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP.E      {ra, s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET     {ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET     {ra, s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET     {ra, s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET     {ra, s0- <em>sN</em>}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET.E   {ra, s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET.E   {ra, s3, s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET.E   {ra, s3-s4, s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH       {ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH       {ra, s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH       {ra, s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH       {ra, s0- <em>sN</em>}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH.E     {ra, s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH.E     {ra, s3, s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH.E     {ra, s3-s4, s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  <em>sN</em> = (s2,s3,s5,s7,s11)
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  If there is no y in a cell then the encoding is <strong>reserved</strong> on that architecture
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All the <code>.E</code> instructions and pseudo-instructions are valid for <code>RV32I/RV32E</code>, none are valid for <code>RV64I/RV128I</code></p>
</div>
<div class="sect3">
<h4 id="spimm">10.7.1. <code>spimm</code> encoding field</h4>
<div class="paragraph">
<p>The <code>stack_adjustment</code> field in the assembler syntax comprises of two components:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the memory required for the registers in the list, rounded up to 16-bytes (using the <code>Align16</code> function below)</p>
</li>
<li>
<p>additional stack space allocated for local variables, encoded in the <code>spimm</code> field</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">function Align16(i): return (i+15)&amp;~0xf; // make it 16-byte aligned
total_register_bytes = number_of_registers_in_reg_list * XLEN/8;
stack_adjustment = Align16(total_register_bytes) + spimm;</code></pre>
</div>
</div>
<div class="paragraph">
<p>the allowable range of <code>spimm</code> varies for different encodings.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  <code>spimm</code> always represents 16-byte blocks even on RV32E where the stack is 8-byte aligned. This is for simplicity.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  <code>spimm</code> is an <em>unsigned</em> immediate, it is subtracted for all <code>PUSH</code> instructions and added for all <code>POP/POPRET</code> instructions.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  if <code>spimm</code> is out of range for the compiler, <code>PUSH/POP/POPRET</code> can still be inferred, and the compiler can infer an additional stack adjustment instruction
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In many cases the 16-bit encoding is sufficient. The 32-bit encoding offers a larger <code>spimm</code> range, but this can also be achieved with a separate <code>c.addi sp, sp, #offset</code> instruction giving the same overall code-size.</p>
</div>
<div class="paragraph">
<p>Additional benefits of the 32-bit encoding are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>more accurate register lists improving performance and memory usage (so that superfluous <code>s</code> registers aren&#8217;t saved/restored)</p>
</li>
<li>
<p>better control over the return value (<code>POP/POPRET</code>) improving code-size.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="total-stack-rv32">10.7.2. Total stack adjustment ranges for RV32</h4>
<div class="paragraph">
<p>These tables are provided as a handy reference, they are all calculated from the formulae in this specification. They should be in an appendix.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  Cells which say <code>see PUSH/POP/POPRET</code> etc. are because the <code>.E</code> instruction is a pseudo-instruction. See <a href="#uabiandeabisupport">UABI and EABI support</a>.
</td>
</tr>
</table>
</div>
<table id="spimmrange_16" class="tableblock frame-all grid-all spread">
<caption class="title">Table 54. C.PUSH/C.POP/C.POPRET valid values of stack adjustment for RV32</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">rlist</th>
<th class="tableblock halign-left valign-top">C.PUSH</th>
<th class="tableblock halign-left valign-top">C.PUSH.E</th>
<th class="tableblock halign-left valign-top">C.POPRET</th>
<th class="tableblock halign-left valign-top">C.POPRET.E</th>
<th class="tableblock halign-left valign-top">C.POP</th>
<th class="tableblock halign-left valign-top">C.POP.E</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">see C.PUSH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">see C.POPRET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">see C.POP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">see C.PUSH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">see C.POPRET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">see C.POP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">see C.PUSH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">see C.POPRET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">see C.POP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s3}*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -112</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -112</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 112</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 112</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 48</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s4}*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -112</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 112</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s5}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -112</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 112</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 48</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 48</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s7}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-48 to -128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48 to 128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48 to 64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48 to 64</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s11}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-64 to -144</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64 to 144</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64 to 80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64 to 80</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>*the register list order varies for .E versions</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  The ranges in <a href="#spimmrange_16">C.PUSH/C.POP/C.POPRET valid values of stack adjustment for RV32</a> and <a href="#spimmrange_32_ra">PUSH/POP/POPRET valid values of total stack adjustment for RV32</a> show the total stack adjustment range, starting from <code>spimm=0</code> up to the maximum value of <code>spimm</code> for each encoding.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="paragraph">
<p><code>c.push {ra,s0-s2}</code> requires 16-bytes to cover the registers, and the range shown is <code>-16 to -96</code>. The range of <code>spimm0_5[6:4]=0 to 5</code> which maps to the values <code>0 to 80</code>.
The stack adjustment is negative for <code>c.push</code> so the total possible stack adjustment is <code>-(16+(0*16) to -(16+(5*16)) = -16 to -80</code>.</p>
</div>
<table id="spimmrange_32_ra" class="tableblock frame-all grid-all spread">
<caption class="title">Table 55. PUSH/POP/POPRET valid values of total stack adjustment for RV32</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">rlist</th>
<th class="tableblock halign-left valign-top">PUSH</th>
<th class="tableblock halign-left valign-top">PUSH.E</th>
<th class="tableblock halign-left valign-top">POP/POPRET</th>
<th class="tableblock halign-left valign-top">POP.E/POPRET.E</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">see PUSH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">see POP/POPRET</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">see PUSH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">see POP/POPRET</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">see PUSH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">see POP/POPRET</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 512</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s3}*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 528</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s4}*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 528</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s5}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s6}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s7}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-48 to -544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48 to 544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s8}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-48 to -544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48 to 544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s9}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-48 to -544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48 to 544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s10}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-48 to -544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48 to 544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s11}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-64 to -560</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64 to 560</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>*the register list order varies for .E versions</p>
</div>
</div>
<div class="sect3">
<h4 id="total-stack-rv64">10.7.3. Total stack adjustment ranges for RV64</h4>
<div class="paragraph">
<p>These tables are provided as a handy reference, they are all calculated from the formulae in this specification.</p>
</div>
<table id="spimmrange_16_rv64" class="tableblock frame-all grid-all spread">
<caption class="title">Table 56. C.PUSH/C.POP/C.POPRET valid values of stack adjustment for RV64</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">rlist</th>
<th class="tableblock halign-left valign-top">C.PUSH</th>
<th class="tableblock halign-left valign-top">C.POPRET</th>
<th class="tableblock halign-left valign-top">C.POP</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -112</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 112</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 48</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -112</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 112</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 48</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s3}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-48 to -128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48 to 128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48 to 64</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s4}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s5}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-64 to -144</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64 to 144</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64 to 80</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s7}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-80 to -160</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80 to 160</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80 to 96</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s11}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-112 to -192</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">112 to 192</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">112 to 128</p></td>
</tr>
</tbody>
</table>
<table id="spimmrange_32_ra_rv64" class="tableblock frame-all grid-all spread">
<caption class="title">Table 57. PUSH/POP/POPRET valid values of total stack adjustment for RV64</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">rlist</th>
<th class="tableblock halign-left valign-top">PUSH</th>
<th class="tableblock halign-left valign-top">POP/POPRET</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 512</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 512</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 528</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 528</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s3}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-48 to -544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48 to 544</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s4}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-48 to -544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48 to 544</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s5}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-64 to -560</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64 to 560</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s6}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-64 to -560</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64 to 560</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s7}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-80 to -576</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80 to 576</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s8}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-80 to -576</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80 to 576</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s9}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-96 to -592</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">96 to 592</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s10}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-96 to -592</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">96 to 592</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s11}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-112 to -608</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">112 to 608</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="fault-handling">10.8. Fault handling</h3>
<div class="paragraph">
<p>The sequence required to execute the instruction may be interrupted, or may not be able to start execution for several reasons.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>virtual memory page fault or PMP fault</p>
<div class="ulist">
<ul>
<li>
<p>these can be detected before execution, or during execution if the memory addresses cross a page/PMP boundary</p>
</li>
<li>
<p><code>MTVAL</code> is set to any address which causes the fault</p>
</li>
</ul>
</div>
</li>
<li>
<p>watchpoint trigger</p>
<div class="ulist">
<ul>
<li>
<p>these can be detected before execution, or during execution depending on the trigger type (load data triggers require the sequence to have started executing, for example)</p>
</li>
<li>
<p><code>MTVAL</code> is set to any address which causes the fault</p>
</li>
</ul>
</div>
</li>
<li>
<p>external debug halt</p>
<div class="ulist">
<ul>
<li>
<p>the halt can treat the whole sequence atomically, or interrupt mid sequence (implementation defined)</p>
</li>
</ul>
</div>
</li>
<li>
<p>debug halt caused by a trigger</p>
<div class="ulist">
<ul>
<li>
<p>same comment as watchpoint trigger above</p>
</li>
</ul>
</div>
</li>
<li>
<p>load access fault</p>
<div class="ulist">
<ul>
<li>
<p>these are detected while the sequence is executing</p>
</li>
<li>
<p><code>MTVAL</code> is set to the fault address.</p>
</li>
</ul>
</div>
</li>
<li>
<p>store access fault (precise or imprecise)</p>
<div class="ulist">
<ul>
<li>
<p>these may be detected while the sequence is executing, or afterwards if imprecise</p>
</li>
<li>
<p><code>MTVAL</code> is set to the fault address.</p>
</li>
</ul>
</div>
</li>
<li>
<p>interrupts</p>
<div class="ulist">
<ul>
<li>
<p>these may arrive at any time. An implementation can choose whether to interrupt the sequence or not.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>In all case <code>MEPC</code> contain the <code>PC</code> of the <code>PUSH/POP</code> instruction, and <code>MCAUSE</code> is set as expected for the type of fault.</p>
</div>
<div class="paragraph">
<p>For debug halts <code>DPC</code> is set to the <code>PC</code> of the <code>PUSH/POP</code> instruction.</p>
</div>
<div class="paragraph">
<p>Because some faults can only be detected during the sequence the core implementation is able to recover from the fault and re-execute the sequence. This may involve executing some or all of the loads and stores from the sequence multiple times before the sequence completes (as multiple faults or multiple interrupts are possible).</p>
</div>
<div class="paragraph">
<p>Therefore correct execution requires that <code>sp</code> refers to idempotent memory (see <a href="#non-idem-mem">Non-idempotent memory</a> for non-idempotent handling)</p>
</div>
</div>
<div class="sect2">
<h3 id="software-view">10.9. Software view of execution</h3>
<div class="sect3">
<h4 id="_software_view_of_code_push_code_sequence">10.9.1. Software view of <code>PUSH</code> sequence</h4>
<div class="paragraph">
<p>From a software perspective the <code>PUSH</code> sequence appears as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A sequence of stores writing a contiguous block of memory. Any of the bytes may be written multiple times.</p>
</li>
<li>
<p>A stack pointer adjustment</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Because the memory is idempotent and the stores are non-overlapping, they may be reordered, grouped into larger accesses, split into smaller access or any combination of these.</p>
</div>
<div class="paragraph">
<p>If an implementation allows interrupts during the sequence, and the interrupt handler uses <code>sp</code> to allocate stack memory, then any stores which were executed before the interrupt maybe be overwritten by the handler. This is safe because the memory is idempotent and the stores will be re-executed once the handler completes.</p>
</div>
<div class="paragraph">
<p>The stack pointer adjustment must only be committed once it is certain that all of the stores will complete within triggerring any precise faults (stores may return imprecise bus errors which are received after the instruction has completed execution).</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">c.push  {ra, s0-s5},{a0-a3}, -64</code></pre>
</div>
</div>
<div class="paragraph">
<p>Appears to software as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode"># any bytes from SP-1 to SP-28 may be written multiple times before the instruction completes
sw  s5, -4(sp);
sw  s4, -8(sp);
sw  s3,-12(sp);
sw  s2,-16(sp);
sw  s1,-20(sp);
sw  s0,-24(sp);
sw  ra,-28(sp);

# these must only execute once, and will only execute after all stores complete sucessfully
mv s0, a0;
mv s1, a1;
mv s2, a2;
mv s3, a3;
addi sp, sp, -64;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_software_view_of_code_pop_popret_code_sequence">10.9.2. Software view of <code>POP/POPRET</code> sequence</h4>
<div class="paragraph">
<p>From a software perspective the <code>POP/POPRET</code> sequence appears as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A sequence of loads, any of which may be executed multiple times</p>
</li>
<li>
<p>A stack pointer adjustment</p>
</li>
<li>
<p>An optional <code>RET</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If an implementation allows interrupts during the sequence, then any loads which were executed before the interrupt may update architectural state. The loads will be re-executed once the handler completes, so the values will be overwritten. Therefore it is permitted for an implementation to update some of the destination registers before taking the interrupt or other fault.</p>
</div>
<div class="paragraph">
<p>The register moves and stack pointer adjustment must only be committed once it is certain that all of the loads will complete successfully.</p>
</div>
<div class="paragraph">
<p>For <code>POPRET</code> once the stack pointer adjustment has been committed the <code>RET</code> must execute.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">popret   {ra, s0-s3}, {1}, 32 ;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Appears to software as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode"># any or all of these load instructions may execute multiple times
lw   s3, 28(sp);
lw   s2, 24(sp);
lw   s1, 20(sp);
lw   s0, 16(sp);
lw   ra, 12(sp);

# must only execute once, will only execute after all loads complete successfully
# all instructions must execute atomically
li a0, 1
addi sp, sp, 32;
ret;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="non-idem-mem">10.9.3. Non-idempotent memory</h4>
<div class="paragraph">
<p>An implementation may have a requirement to issue <code>PUSH/POP/POPRET</code> to non-idempotent memory.</p>
</div>
</div>
<div class="sect3">
<h4 id="_error_detection">10.9.4. Error detection</h4>
<div class="paragraph">
<p>If the core implementation does not have a requirement to support <code>PUSH/POP/POPRET</code> to non-idempotent memories, and the core can use a PMA to detect that the memory is non-idempotent, then take a load(<code>POP/POPRET</code>) or store (<code>PUSH</code>) access fault exception.</p>
</div>
</div>
<div class="sect3">
<h4 id="_non_idempotent_support">10.9.5. Non-idempotent support</h4>
<div class="paragraph">
<p>It is possible to support non-idempotent memory. One reason is to re-use <code>PUSH/POP</code> as a restricted form of a load/store multiple instruction to a peripheral (see <a href="#ldstm">Appendix: Usage as load/store-multiple</a>), as there is no generic load/store multiple instruction currently in the RISC-V ISA. If load/store multiple is supported in the future then it should support non-idempotent memory.</p>
</div>
<div class="paragraph">
<p>If accessing non-idempotent memory then it is <em>recommended</em> to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Not allow interrupts during execution</p>
</li>
<li>
<p>Not allow external debug halt during execution</p>
</li>
<li>
<p>Detect any virtual memory page faults or PMP faults for the whole instruction before starting execution (instead of during the sequence)</p>
</li>
<li>
<p>Not split / merge / reorder the generated memory accesses</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>It is possible that one of the following will still occur during execution:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Watchpoint trigger</p>
</li>
<li>
<p>Load/store access fault</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In these cases the core will jump to the debug or exception handler. If execution is required to continue afterwards (so the event is not fatal to the code execution), then the handler is required to do so in software.</p>
</div>
<div class="paragraph">
<p>By following these rules memory accesses will only ever be issued once, and in the order listed in the pseudo-code.</p>
</div>
<div class="paragraph">
<p>It is possible for implementations to follow these restricted rules and to safely access both types of memory. It is also possible for an implementation to use PMAs to detect the memory type and apply different rules, such as only allowing interrupts if accessing cacheable memory, for example.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_toolchain_implementation">10.10. Toolchain implementation</h3>
<div class="paragraph">
<p><code>PUSH/POP/POPRET</code> can be generated by the compiler, but can also be added as an optimisation in the linker. If they are inferred at link time then they can also be used to optimise precompiled library code. This means that the libraries can be shipped without these instructions, but platforms which implement them can still benefit from the code-size saving.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  The linker may have to reallocate registers as the register moves included in <code>PUSH/C.PUSH</code> target specific <code>s</code> registers which may not agree with the compiler output, example.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_compiling_for_size_or_performance">10.10.1. Compiling for size or performance</h4>
<div class="paragraph">
<p>There are cases where it is not clear whether to use the 16-bit or 32-bit encoding.</p>
</div>
<div class="paragraph">
<p>If compiling with -Os/-Oz the compiler should generate the smallest possible code output, which may include performance reduction due to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>too many <code>s</code> registers in the register list</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>for example <code>push {ra, s0-s6}</code> is required but not available in the 16-bit encoding so <code>c.push {ra,s0-s7}</code> must be used instead for the smallest code-size</p>
</li>
</ol>
</div>
</li>
<li>
<p>too many included register moves (for <code>C.PUSH</code> only)</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>for example <code>push {ra,s0-s1}, {a0}</code> is required, but the 16-bit encoding will include an extra register move <code>c.push {ra,s0-s1}, {a0-a1}</code></p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Another consideration is whether the total stack adjustment can be encoded by the 16-bit version, the 32-bit encoding gives a larger range but still will not cover all cases.</p>
</div>
<div class="paragraph">
<p>The default choice is always to use the 16-bit encoding. The rules below are for when to choose the 32-bit encoding instead.</p>
</div>
<div class="paragraph">
<p>For <code>C.PUSH/PUSH</code>, use <code>PUSH</code> if:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The total stack adjustment (see &lt;&lt;#total-stack-rv32&gt;&gt;, <a href="#total-stack-rv64">Total stack adjustment ranges for RV64</a>) is out of range for <code>C.PUSH</code>, but in range for <code>PUSH</code>.</p>
</li>
<li>
<p><code>C.PUSH</code> includes too many <code>s</code> registers and not compiling with -Os/-Oz.</p>
</li>
<li>
<p><code>C.PUSH</code> includes too many register moves and not compiling with -Os/-Oz.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For <code>C.POPRET/POPRET</code>, use <code>POPRET</code> if:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The total stack adjustment (see &lt;&lt;#total-stack-rv32&gt;&gt;, <a href="#total-stack-rv64">Total stack adjustment ranges for RV64</a>) is out of range for <code>C.POPRET</code>, but in range for <code>POPRET</code>.</p>
</li>
<li>
<p><code>C.POPRET</code> includes too many <code>s</code> registers and not compiling with -Os/-Oz.</p>
</li>
<li>
<p>The return value is <code>1</code> or <code>-1</code>, (<code>C.POPRET</code> only allows the option of returning <code>0</code>).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For <code>C.POP/POP</code>, use <code>POP</code> if</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The total stack adjustment (see &lt;&lt;#total-stack-rv32&gt;&gt;, <a href="#total-stack-rv64">Total stack adjustment ranges for RV64</a>) is out of range for <code>C.POP</code>, but in range for <code>POP</code>.</p>
</li>
<li>
<p>The return value is <code>0, 1</code> or <code>-1</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><em>Example 1</em> The 16-bit encoding includes too many register moves.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">#From debian / re compiled with GCC (RV64), reordered to put the registers in order
    53be:       7135                    addi    sp,sp,-160
    53c6:       ed06                    sd      ra,152(sp)
    53c8:       e922                    sd      s0,144(sp)
...s1-s10...
    53d8:       fc6e                    sd      s11,56(sp)
    53da:       84aa                    mv      s1,a0
    53e0:       892e                    mv      s2,a1
#-Os/-Oz: compile to C.PUSH, but includes redundant register moves of a2, a3
#note that the moves are "mv s0, a0; mv a1, s1; mv a2, s2; mv a3, s3"  so the s registers need to be reallocated
    53be:       &lt;16-bit&gt;                c.push  {ra,s0-s11}, {a0-a3}, -160
#-O1/-O2/-O3: compile to PUSH to avoid the redundant register moves of a2, a3 even though the code is larger
    53be:       &lt;32-bit&gt;                push    {ra,s0-s11}, -160
    53da:       84aa                    mv      s1,a0
    53e0:       892e                    mv      s2,a1</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Example 2</em> The stack adjustment is out of range for the 32-bit encoding, and the register list matches the 16-bit encoding.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">#From Huawei IoT code compiled with GCC (RV32)
  e0c744:       2bc12083                lw      ra,700(sp)
  e0c748:       2b812403                lw      s0,696(sp)
...s1-s7...
  e0c768:       29812c03                lw      s7,668(sp)
  e0c76c:       2c010113                addi    sp,sp,704 #out of range, limit is 544 for 32-bit encoding
  e0c770:       8082                    ret
#-Os/-Oz/-O1/-O2/-O3: always compile to 2 16-bit encodings, the 32-bit encoding doesn't improve performance
  e0c744:       &lt;16-bit&gt;                c.addi16sp sp,sp,640
  e0c748:       &lt;16-bit&gt;                c.popret   {ra,s0-s7}, 64</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Example 3</em> The register list doesn&#8217;t match the 16-bit encoding, and the 32-bit encoding allows inclusion of the return value.</p>
</div>
<div class="paragraph">
<p>In this case the 16-bit encoding is inferior in the epilogue - because it includes <code>s7</code> and cannot include the <code>mv, a0, s0</code>. Therefore the 32-bit encoding uses the correct register list and has the same code size.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">#From Huawei IoT code compiled with GCC (RV32), reordered to put the registers in order
#prologue
  e0073e:       7179                    addi    sp,sp,-48
  e0074c:       d606                    sw      ra,44(sp)
  e00740:       d422                    sw      s0,40(sp)
...s1-s6...
  e0074a:       c65e                    sw      s6,16(sp)
  e00752:       892a                    mv      s2,a0
...a1-a3...
  e0075a:       8a3a                    mv      s4,a4
....
#epilogue
  e0079a:       8522                    mv      a0,s0
  e0079c:       5422                    lw      s0,40(sp)
...s1-s6...
  e007aa:       4bb2                    lw      s6,16(sp)
  e007ac:       6145                    addi    sp,sp,48
  e007ae:       8082                    ret

#optimised prologue
#-Os/-Oz: the smallest is with the 16-bit encoding which also stores s7 (so wastes performance)
  e0073e:       &lt;16-bit&gt;                push {ra,s0-s7}, {a0-a2}
  e0075a:       8a3a                    mv      s4,a4

#-O1/-O2/-O3: the 32-bit encoding is larger but doesn't store s7 (so doesn't waste performance)
  e0073e:       &lt;32-bit&gt;                push {ra,s0-s6}, {a0-a2}
  e0075a:       8a3a                    mv      s4,a4

#optimised epilogue
#-Os/-Oz the smallest is with the 16-bit encoding which also stores s7 (so wastes performance)
  e0079c:       &lt;16-bit&gt;                popret {ra,s0-s7}, 48

#-O1/-O2/-O3: the 32-bit encoding is larger but doesn't store s7 (so doesn't waste performance)
  e0079c:       &lt;32-bit&gt;                popret {ra,s0-s6}, 48</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_assembly_examples">10.11. Assembly examples</h3>
<div class="sect3">
<h4 id="push-example-1">10.11.1. C.PUSH RV32 UABI (16-byte aligned stack)</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">c.push  {ra, s0-s5}, {a0-a3}, -64</code></pre>
</div>
</div>
<div class="paragraph">
<p>Encoding: rlist=5, spimm=32</p>
</div>
<div class="paragraph">
<p>Equivalent sequence:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">sw  s5, -4(sp);
sw  s4, -8(sp);
sw  s3, -12(sp);
sw  s2, -16(sp);
sw  s1, -20(sp);
sw  s0, -24(sp);
sw  ra, -28(sp);
mv  s0, a0;
mv  s1, a1;
mv  s2, a2;
mv  s3, a3;
addi sp, sp, -64;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_c_push_rv32i_uabi_16_byte_aligned_stack">10.11.2. C.PUSH RV32I UABI (16-byte aligned stack)</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">c.push {ra, s0-s1}, {a0-a1}, -32</code></pre>
</div>
</div>
<div class="paragraph">
<p>Encoding: rlist=2, spimm=16</p>
</div>
<div class="paragraph">
<p>Equivalent sequence:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">sw  s1, -4(sp);
sw  s0, -8(sp);
sw  ra, -12(sp);
mv s0, a0;
mv s1, a1;
addi sp, sp, -32;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_c_pop_rv32i_uabi_16_byte_aligned_stack">10.11.3. C.POP RV32I UABI (16-byte aligned stack)</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">c.pop   {ra, s0-s7}, {}, 160</code></pre>
</div>
</div>
<div class="paragraph">
<p>Encoding: rlist=6, spimm=112</p>
</div>
<div class="paragraph">
<p>Equivalent sequence:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">lw   s7, 156(sp);
lw   s6, 152(sp);
lw   s5, 148(sp);
lw   s4, 144(sp);
lw   s3, 140(sp);
lw   s2, 136(sp);
lw   s1, 132(sp);
lw   s0, 128(sp);
lw   ra, 124(sp);
addi sp, sp, 160</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="popret-example-1">10.11.4. C.POPRET RV32I UABI (16-byte aligned stack)</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">c.popret   {ra, s0-s7}, {0}, 160</code></pre>
</div>
</div>
<div class="paragraph">
<p>Encoding: rlist=6, spimm=112</p>
</div>
<div class="paragraph">
<p>Equivalent sequence:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">lw   s7, 156(sp);
lw   s6, 152(sp);
lw   s5, 148(sp);
lw   s4, 144(sp);
lw   s3, 140(sp);
lw   s2, 136(sp);
lw   s1, 132(sp);
lw   s0, 128(sp);
lw   ra, 124(sp);
li   a0, 0;
addi sp, sp, 160;
ret</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_pop_rv32i_uabi_16_byte_aligned_stack">10.11.5. POP RV32I UABI (16-byte aligned stack)</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">pop   {ra, s0-s9}, {1}, 256</code></pre>
</div>
</div>
<div class="paragraph">
<p>Encoding: ra=1, rlist=10, frlist=0, spimm=128 (16-byte aligned)</p>
</div>
<div class="paragraph">
<p>Micro operation sequence:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">lw   s9, 252(sp);
lw   s8, 248(sp);
lw   s7, 244(sp);
lw   s6, 240(sp)
lw   s5, 236(sp);
lw   s4, 232(sp);
lw   s3, 228(sp);
lw   s2, 224(sp)
lw   s1, 220(sp);
lw   s0, 216(sp);
lw   ra, 212(sp);
li   a0, 1
addi sp, sp, 256</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ldstm">10.12. Appendix: Usage as load/store-multiple</h3>
<div class="paragraph">
<p><code>PUSH/POP</code> encodings can be reused as generic load/store multiple instructions. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">lui t0, 0xffff
sw  s5, 0x4c(t0)
sw  s4, 0x50(t0)
sw  s3, 0x54(t0)
sw  s2, 0x58(t0)
sw  s1, 0x5c(t0)
sw  s0, 0x60(t0)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Can be replaced by</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">lui t0, 0xffff
addi sp, t0, 64
push {s0-s5}, -64</code></pre>
</div>
</div>
<div class="paragraph">
<p>This requires that <code>sp</code> is saved before and restored after the sequence.  It may also require that interrupts are disbled if the interrupt handler allocates space using <code>sp</code>, as the <code>sp</code> will not point to the stack during the sequence.</p>
</div>
<div class="paragraph">
<p>Also <code>POP</code> can be used to replace the equivalent series of loads.</p>
</div>
<div class="paragraph">
<p>Even though there is not much code-size saving once the <code>sp</code> save/restore code has been included, and the restricted memory layout targetted by the instructions, there may be a performance benefit to doing this for small embedded cores. A load/store-multiple sequence may be issued to the peripheral bus as a single burst instead of multiple single accesses which individually require arbitration. In some cases this can save one or more cycles per access as the arbiter remains locked to the core until the sequence has completed.</p>
</div>
<div class="paragraph">
<p>If the target memory is non-idempotent then see <a href="#non-idem-mem">Non-idempotent memory</a> for additional constraints.</p>
</div>
</div>
<div class="sect2">
<h3 id="benchmarkingpushpop">10.13. Appendix: Benchmarking PUSH/POP against -msave-restore</h3>
<div class="paragraph">
<p><code>PUSH/POP</code> are benchmarked relative to <code>-msave-restore</code>, which is available in GCC and more recently also available in LLVM 13. To give more realistic benchmarking results, the save routines have embedded moves added (see below), and are otherwise unchanged from GCC10.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">&lt;__riscv_save_12&gt;:
  addi	sp,sp,-64
  li	t1,0
  sw	s11,12(sp)
  j &lt;__riscv_save_10_j&gt;

&lt;__riscv_save_10&gt;:
  addi	sp,sp,-64
  li	t1,-16
&lt;__riscv_save_10_j&gt;:
  sw	s10,16(sp)
  sw	s9,20(sp)
  sw	s8,24(sp)
  sw	s7,28(sp)
  j &lt;__riscv_save_4_j&gt;

&lt;__riscv_save_4&gt;:
  addi	sp,sp,-64
  li	t1,-32
&lt;__riscv_save_4_j&gt;:
  sw	s6,32(sp)
  sw	s5,36(sp)
  sw	s4,40(sp)
  sw	s3,44(sp)
  sw	s2,48(sp)
  sw	s1,52(sp)
  sw	s0,56(sp)
  sw	ra,60(sp)
  mv  s3, a3           ;# embedded move
  mv  s2, a2           ;# embedded move
  mv  s1, a1           ;# embedded move
  mv  s0, a0           ;# embedded move
  sub	sp,sp,t1
  jr	t0

&lt;__riscv_save_0&gt;:
  addi	sp,sp,-16
  sw	s2,0(sp)
  sw	s1,4(sp)
  sw	s0,8(sp)
  sw	ra,12(sp)
  mv  s2, a2           ;# embedded move
  mv  s1, a1           ;# embedded move
  mv  s0, a0           ;# embedded move
  jr	t0</code></pre>
</div>
</div>
<div class="paragraph">
<p>The restore routines are unchanged, and always include <code>ret</code> at the end. This means that tail call optimisation is disabled when using <code>msave-restore</code>, which can have a large performance impact (which is solved by using <code>C.POP</code>). Realistically, a second set of routines without <code>RET</code> are needed to allow tail call optimisation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">&lt;__riscv_restore_12&gt;:
  lw	s11,12(sp)
  addi	sp,sp,16

&lt;__riscv_restore_10&gt;:
  lw	s10,0(sp)
  lw	s9,4(sp)
  lw	s8,8(sp)
  lw	s7,12(sp)
  addi	sp,sp,16

&lt;__riscv_restore_4&gt;:
  lw	s6,0(sp)
  lw	s5,4(sp)
  lw	s4,8(sp)
  lw	s3,12(sp)
  addi	sp,sp,16

&lt;__riscv_restore_0&gt;:
  lw	s2,0(sp)
  lw	s1,4(sp)
  lw	s0,8(sp)
  lw	ra,12(sp)
  addi	sp,sp,16
  ret</code></pre>
</div>
</div>
<div class="paragraph">
<p>The cost of each call to the save/restore routines varies. If <code>C.TBLJALM/C.TBLJ</code> are used then it is <em>always</em> 16-bits. If not, then the call to save will be 32 or 64-bit (<code>C.JAL</code> can&#8217;t link to <code>t0</code>). The call to the restore routine can be 16-bit (<code>C.J</code>), 32-bit (<code>J</code>) or 64-bit (<code>AUIPC; JR</code>).</p>
</div>
<div class="paragraph">
<p>Clearly the code-size will be considerably smaller if all calls use <code>C.TBLJALM/CLTBLJ</code>.</p>
</div>
<div class="sect3">
<h4 id="_benchmarking_configuration_1">10.13.1. Benchmarking configuration 1</h4>
<div class="paragraph">
<p>Configuration 1 uses the save/restore code above, and does not use <code>C.TBLJALM/C.TBLJ</code>.
It will <strong>not</strong> call a save/restore routine if only <code>ra</code> is saved/restored.</p>
</div>
</div>
<div class="sect3">
<h4 id="_benchmarking_configuration_2">10.13.2. Benchmarking configuration 2</h4>
<div class="paragraph">
<p>Configuration 2 uses the save/restore code above, and uses <code>C.TBLJALM/C.TBLJ</code>, so every call is 16-bits.
It will <strong>not</strong> call a save/restore routine if only <code>ra</code> is saved/restored.</p>
</div>
</div>
<div class="sect3">
<h4 id="_performance_analysis">10.13.3. Performance analysis</h4>
<div class="paragraph">
<p>Performance is expected to be significantly higher using PUSH/POP than the software routines. Unnecessary jumps are eliminated, and redundant loads/stores are minimised. Additionally <code>C.POP</code> allows tail call optimisation to be enabled.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  We should do some performance analysis to show the benefit vs <code>-msave-restore</code>. Details TBD.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compiler_switches">11. Compiler switches</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If <code>Zcea/Zceb/Zcee</code> are specified, then the compiler will include all the instructions from the relevant subsets.
It is also useful to be able to select instructions in a more fine-grained way to help with benchmarking and analysis work, especially when analysing the results of the prototype compiler.
Therefore the compiler switches in <a href="#compilerswitches">Compiler switches for Zce</a> are available, each one is used to enable a specific list of instructions.</p>
</div>
<table id="compilerswitches" class="tableblock frame-all grid-all spread">
<caption class="title">Table 58. Compiler switches for Zce</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Switch</th>
<th class="tableblock halign-left valign-top">Enabled instructions</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-mzce-cpush-cpop</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH, C.POP, C.POPRET</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-mzce-push-pop</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH.E, POP.E, POPRET.E</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-mzce-cpushe-cpope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH.E, C.POP.E, C.POPRET.E</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-mzce-pushe-pope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH.E, POP.E, POPRET.E</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-mzce-tbljal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.TBLJ, C.TBLJAL, C.TBLJALM</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-mzce-clbhu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LBU, C.LHU</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-mzce-clbh</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LB, C.LH</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-mzce-csbh</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SB, C.SH</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-mzce-lsgp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LWGP, SWGP, LDGP (RV64), SDGP (RV64)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-mzce-muli</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-mzce-cmul</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MUL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-mzce-sext</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SEXT.B, C.SEXT.H, (C.SEXT.W RV64 pseudo-instruction)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-mzce-zext</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ZEXT.B, C.ZEXT.H, C.ZEXT.W (RV64)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-mzce-beqi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BEQI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-mzce-bnei</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BNEI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-mzce-cnot</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.NOT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-mzce-cneg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.NEG</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-mzce-cmva01s07</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MVA01S07</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-mzce-cdecbnez</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.DECBNEZ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-mzce-decbnez</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DECBNEZ</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_verification_notes">12. Verification notes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_existing_functionality">12.1. Existing functionality</h3>
<div class="paragraph">
<p>Many of the instructions are 16-bit encodings of existing 32-bit instructions, therefore the verification should be a simple extension to existing tests and coverage. Additionally, the instructions are all very simple.
. C.SEXT.B, C.SEXT.H, (C.SEXT.W is a pseudo-instruction)
. C.ZEXT.B, C.ZEXT.H, C.ZEXT.W
. C.MUL, C.NOT, C.NEG
. C.LBU, C.LHU, C.LB, C.LH, C.SB, C.SH</p>
</div>
</div>
<div class="sect2">
<h3 id="_simple_extensions_to_existing_functionality">12.2. Simple extensions to existing functionality</h3>
<div class="paragraph">
<p>These instructions are extremely similar to existing instructions, so the verification tests and coverage should be a simple extension from existing tests and coverage:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>BEQI, BNEI</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>these are immediate forms of BEQ and BNE, they compare a register value against an immediate instead of two register values</p>
</li>
</ol>
</div>
</li>
<li>
<p>LWGP</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>this have the same functionality as LW, but the base register is explicitly GP and the immediate offset range is larger</p>
</li>
</ol>
</div>
</li>
<li>
<p>SWGP</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>this have the same functionality as SW, but the base register is explicitly GP and the immediate offset range is larger</p>
</li>
</ol>
</div>
</li>
<li>
<p>MULI</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>same as MUL with a signed immediate operand</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_new_branch_functionality">12.3. New branch functionality</h3>
<div class="paragraph">
<p><code>DECBNEZ</code> and <code>C.DECBNEZ</code> are also fused versions of two instructions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">decbnez  s2, 1, -48</code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">addi s2, s2, -1
bnez s2, -48</code></pre>
</div>
</div>
<div class="paragraph">
<p>Therefore the coverage is the same as for <code>ADDI/BGEZ</code> combined, noting the limited range of subtraction values (1,2,4,8) and the range of the branch offset (especially for <code>C.DECBNEZ</code>).</p>
</div>
</div>
<div class="sect2">
<h3 id="_sequenced_functionality">12.4. Sequenced functionality</h3>
<div class="paragraph">
<p><code>PUSH/POP/POPRET</code> execute a sequence of micro-ops to execute the whole instruction. As a result they are considerably more complex to verify than the other instructions.</p>
</div>
<div class="sect3">
<h4 id="_cover_all_possible_sets_of_operands">12.4.1. Cover all possible sets of operands</h4>
<div class="paragraph">
<p><code>mv, rlist, ra, spimm</code> are all fields in the encoding.</p>
</div>
<table id="32pushpopsourcecoverage" class="tableblock frame-all grid-all spread">
<caption class="title">Table 59. Coverage for PUSH/POP/POPRET source operands</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Instruction</th>
<th class="tableblock halign-left valign-top">Variables</th>
<th class="tableblock halign-left valign-top">Coverage bins</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH (<code>mv</code>=0)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rlist</code>(0 to 12) x <code>ra</code> (0 to 1) x <code>spimm</code> (0 to 15)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">416</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH (<code>mv</code>=1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rlist</code>(1 to 12) x <code>ra</code> (0 to 1) x <code>spimm</code> (0 to 15)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">384</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH (<code>mv</code>=2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rlist</code>(2 to 12) x <code>ra</code> (0 to 1) x <code>spimm</code> (0 to 15)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">352</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH (<code>mv</code>=3)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rlist</code>(3 to 12) x <code>ra</code> (0 to 1) x <code>spimm</code> (0 to 15)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">288</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rlist</code>(0 to 12) x <code>ret_val</code> (0 to 3) x <code>ra</code> (0 to 1) x <code>spimm</code> (0 to 15)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1664</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rlist</code>(0 to 12) x <code>ret_val</code> (0 to 3) x <code>spimm</code> (0 to 15)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">834</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The 16-bit encodings have ffar ewer coverage bins:</p>
</div>
<table id="16pushpopsourcecoverage" class="tableblock frame-all grid-all spread">
<caption class="title">Table 60. Coverage for C.PUSH/C.POP/C.POPRET source operands</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Instruction</th>
<th class="tableblock halign-left valign-top">Variables</th>
<th class="tableblock halign-left valign-top">Coverage bins</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rlist</code>(0 to 7) x <code>spimm</code> (0 to 7)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rlist</code>(0 to 3) x <code>spimm</code> (0 to 1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rlist</code>(0 to 7) x <code>ret_val</code> (0 to 1) x <code>spimm</code> (0 to 7)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">128</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_test_the_functionality">12.4.2. Test the functionality</h4>
<div class="paragraph">
<p>Execution of every PUSH/POP/POPRET instruction must result in the same architectural state updates as executing the sequence that it expands into. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">popret   {ra, s0-s3}, {1}, 32;</code></pre>
</div>
</div>
<div class="paragraph">
<p>causes identical architectural state updates to the expanded sequence:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">lw   ra, 28(sp);
lw   s0, 24(sp);
lw   s1, 20(sp);
lw   s2, 16(sp);
lw   s3, 12(sp);
li   a0, 1
addi sp, sp, 32;
ret</code></pre>
</div>
</div>
<div class="paragraph">
<p>Therefore a suggestion is to generate pairs of tests, one with the expanded sequences and one with <code>PUSH/POP/POPRET</code>. Each test must give identical results, including having the same contents in the memory.</p>
</div>
<div class="paragraph">
<p>It is also possible to introduce</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>interrupts</p>
</li>
<li>
<p>debug triggers on the loads/stores in the sequence</p>
</li>
<li>
<p>external debug halts</p>
</li>
<li>
<p>load/store access faults due to bus errors or PMP faults</p>
</li>
<li>
<p>load/store page faults</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>on the loads and stores in the sequence. <code>mepc</code> will be different between the two tests but <code>mcause</code> and <code>mtval</code> must match. Note that interrupts and external debug halts are asynchronous events, so to make the results from the two tests match then the handler must not (for example) count the number of interrupts taken.</p>
</div>
<div class="paragraph">
<p>Implementations may choose for the sequences to be uninterruptible, or to be interruptible and to restart after the <code>mret</code>. The overall result is the same - the sequence will eventually complete and correctly update the architectural state, providing any debug triggers are disabled in the handler before resuming execution (so they don&#8217;t trigger again)</p>
</div>
</div>
<div class="sect3">
<h4 id="_table_jump_jump_table_mode_only">12.4.3. Table jump, jump table mode only</h4>
<div class="paragraph">
<p>Table jump is quite simple architecturally.</p>
</div>
<div class="paragraph">
<p><code>c.tblj* n;</code> references memory address <code>m = InstMemory[TBLJALVEC + n * XLEN/8]</code></p>
</div>
<div class="paragraph">
<p>The core jumps to address <code>m</code>, and links to the relevant link register.</p>
</div>
<div class="paragraph">
<p>For verification we must show that the different link registers work and that the core jumps to the correct location each time.</p>
</div>
</div>
<div class="sect3">
<h4 id="_table_jump_and_overlays">12.4.4. Table jump and overlays</h4>
<div class="paragraph">
<p>The overlap task group has a proposal which can fit nicely with a table jump implementation. <a href="https://github.com/riscv/riscv-overlay/blob/master/docs/overlay-hld.adoc">Click here for the proposal</a>.
They use <code>t6</code> as the semi-fixed address for the overlap table engine. This could be replaced by a <code>c.tbljal</code> to the overlay engine.
If the address of the engine needs to be changed then it can be changed in the jump table, so allowing table jump to call the engine removes teh need to allocate <code>t6</code>.</p>
</div>
<div class="paragraph">
<p>A future version of this spec may not allocate CSRs (as CSRs are a finite resource), and use a temporary register for the jump table base address. If this is the case then using <code>t6</code> would fit nicely with overlap proposal,
but the concern is that precompiled libraries which use <code>t6</code> will no longer work, and additionally the EABI only has two temporary registers so allocating one of them for the jump table base is unlikely to be acceptable.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rejected_and_postponed_instructions">13. Rejected and postponed instructions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_not_benchmarked_push_fdq_pop_fdq_popret_fdq">13.1. Not benchmarked: PUSH.[FDQ], POP.[FDQ], POPRET.[FDQ]</h3>
<div class="paragraph">
<p>Please read <a href="#pushpoppopret">PUSH and POP</a> before reading this section.</p>
</div>
<div class="paragraph">
<p>These instructions are variants of <code>PUSH/POP/POPRET</code> which also allow <code>F</code> registers to be saved/restored.</p>
</div>
<div class="sect3">
<h4 id="_assembler_syntax_2">13.1.1. Assembler Syntax</h4>
<div class="paragraph">
<p>These instructions require a register list including <code>fs</code> registers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">&lt;fsreg_list&gt; ::= &lt;ra&gt; "," &lt;sreg_range&gt; ", " &lt;freg_range&gt; | &lt;ra&gt; "," &lt;freg_range&gt; | &lt;sreg_range&gt; "," &lt;freg_range&gt; | &lt;freg_range&gt;
&lt;rfsreg_list&gt; ::= &lt;ra&gt; "," &lt;sreg_range&gt; ", " &lt;freg_range&gt; | &lt;ra&gt; "," &lt;freg_range&gt;
&lt;freg_range&gt; ::= &lt;fs0&gt; | &lt;fs0-fsM&gt; (valid values of M are 1,2,3,5,8,11)

//legal syntax

push.[fdq]   {&lt;fsreg_list&gt;},     -stack_adjustment
pop.[fdq]    {&lt;fsreg_list&gt;},      stack_adjustment
popret.[fdq] {&lt;rfsreg_list&gt;},     stack_adjustment //popret must include ra</code></pre>
</div>
</div>
<div class="paragraph">
<p>To be a legal encoding:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The total stack adjustment must be negative for <code>PUSH.[FDQ]</code> and positive for <code>POP.[FDQ]/POPRET.[FDQ]</code></p>
</li>
<li>
<p>The total stack adjustment must be in range (see <a href="#spimm"><code>spimm</code> encoding field</a>) and must be a multiple of 16</p>
</li>
<li>
<p>The register lists must be valid (see above)</p>
</li>
<li>
<p>For <code>POPRET.[FDQ]</code>, <code>rfsreg_list</code> must include <code>ra</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Additionally:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If <code>sp</code> is not 16-byte aligned then take a load (<code>PUSH.[FDQ]</code>) or store (<code>POP.[FDQ]/POPRET.[FDQ]</code>) address misaligned exception, and do not issue any loads or stores.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  When moving from loading or storing <code>x</code> registers to <code>f</code> registers there may be a gap as the registers may be different widths, and all registers must be aligned in memory
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_rationale_why_include_the_fdq_suffix">Rationale: why include the .[fdq] suffix</h5>
<div class="paragraph">
<p>It is required to hard-code the length of the <code>f</code> registers in the opcode, and not just save/restore the whole register. We must allow code compiled for the F-extension
to run on a  core which supports D and possibly Q. We must also allow code compiled for the D-extension to run on a core which supports Q.</p>
</div>
<div class="paragraph">
<p>If we don&#8217;t explicitly state the <code>f</code> register width and always store the whole register, then the registers will be stored at different addresses to the ones expected
by the compiler.</p>
</div>
<div class="paragraph">
<p>An alternative would be to use <code>misa.[FDQ]</code>
to directly control the behaviour and so set <code>misa.[DQ]=0</code> when running F code. Nothing else in the architecture requires this, so it seems unreasonable to
add this requirement here. This approach also wouldn&#8217;t work for <code>Z[FDQ]inx</code> cores as <code>misa.[FDQ]</code> are all hardwired to zero.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_pseudo_code_2">13.1.2. Pseudo-code</h4>
<div class="paragraph">
<p>The pseudo-code below show the required architectural state updates.</p>
</div>
<div class="paragraph">
<p>Note that every architectural state update in the pseudo-code can be executed as a standard RISC-V 32-bit encoding, so that it is possible execute the instructions as sequences of standard instructions.</p>
</div>
<div class="paragraph">
<p>Because the pseudo-code includes load or store operations, they may take any fault caused by executing loads or stores. See <a href="#fault-handling">Fault handling</a> for more details.</p>
</div>
<div class="sect4">
<h5 id="_push_fdq_pseudo_code">PUSH.[FDQ] Pseudo-code</h5>
<div class="paragraph">
<p>The <code>PUSH.FDQ</code> instruction stores the set of registers from <code>fsreg_list</code> to consecutive memory locations, and decrements the stack pointer.
The pseudo-code uses assembly inserts so that it can use <code>fsw/fsd</code> etc.</p>
</div>
<div class="paragraph">
<p>The pseudo-code shows the memory and architectural state updates of the whole instruction which has completed without faults, debug halts or interrupts. See <a href="#fault-handling">Fault handling</a> and <a href="#software-view">Software view of execution</a> for more information.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  <code>stack_adjustment</code> is negative.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">//sp must be correctly aligned
if (sp[3:0])           {take_illegal_instruction_exception();}
if (rlist&gt;12)          {take_illegal_instruction_exception();}
if (rlist&gt;2 &amp;&amp; misa.E) {take_illegal_instruction_exception();}
if (misa.MXL==1) {bytes=4;}
if (misa.MXL==2) {bytes=8;}
else             {bytes=16;}
addr=sp;
if (ra) {
  addr-=bytes;
  switch(bytes) {
    4:  asm("sw ra, 0(addr)");
    8:  asm("sd ra, 0(addr)");
    16: asm("sq ra, 0(addr)");
  }
}
for(i in sreg_list)  {
  addr-=bytes;
  switch(bytes) {
    4:  asm("sw s[i], 0(addr)");
    8:  asm("sd s[i], 0(addr)");
    16: asm("sq s[i], 0(addr)");
  }
}
switch (opcode) {
  //if FLEN &gt; XLEN, then get the address back into alignment before saving the F registers
  "PUSH.D": while(addr% 8) {addr-=bytes;}
  "PUSH.Q": while(addr%16) {addr-=bytes;}
}
for(i in freg_list)  {
  switch (opcode) {
    "PUSH.F": {addr-= 4;asm("fsw fs[i], 0(addr)");}
    "PUSH.D": {addr-= 8;asm("fsd fs[i], 0(addr)");}
    "PUSH.Q": {addr-=16;asm("fsq fs[i], 0(addr)");}
  }
}
sp+=stack_adjustment; //decrement</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_pop_fdq_popret_fdq_pseudo_code">POP.[FDQ]/POPRET/[FDQ] Pseudo-code</h5>
<div class="paragraph">
<p>A <code>POP/POPRET</code> instruction loads the set of registers from <code>fsreg_list</code> from consecutive memory locations, and then increments the stack pointer.
The pseudo-code uses assembly inserts so that it can use <code>flw/fld/ret</code>.</p>
</div>
<div class="paragraph">
<p>The pseudo-code shows the architectural state updates of the whole instruction which has completed without faults, debug halts or interrupts. See <a href="#fault-handling">Fault handling</a> and <a href="#software-view">Software view of execution</a> for more information.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  <code>stack_adjustment</code> is positive.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">//sp must be correctly aligned
if (sp[3:0])           {take_illegal_instruction_exception();}
if (rlist&gt;12)          {take_illegal_instruction_exception();}
if (rlist&gt;2 &amp;&amp; misa.E) {take_illegal_instruction_exception();}
if (misa.MXL==1) {bytes=4;}
if (misa.MXL==2) {bytes=8;}
else             {bytes=16;}
addr=sp+stack_adjustment;
if (ra) {
  addr-=bytes;
  switch(bytes) {
    4:  asm("lw ra, 0(addr)");
    8:  asm("ld ra, 0(addr)");
    16: asm("lq ra, 0(addr)");

  }
}
for(i in sreg_list)  {
  addr-=bytes;
  switch(bytes) {
    4:  asm("lw s[i], 0(addr)");
    8:  asm("ld s[i], 0(addr)");
    16: asm("lq s[i], 0(addr)");
  }
}
switch (opcode) {
  //if FLEN &gt; XLEN, then get the address back into alignment before saving the F registers
  "POP.D", "POPRET.D": while(addr% 8) {addr-=bytes;}
  "POP.Q", "POPRET.Q": while(addr%16) {addr-=bytes;}
}
for(i in freg_list)  {
  switch (opcode) {
    "POP.F", "POPRET.F": {addr-= 4;asm("flw fs[i], 0(addr)");}
    "POP.D", "POPRET.D": {addr-= 8;asm("fld fs[i], 0(addr)");}
    "POP.Q", "POPRET.Q": {addr-=16;asm("flq fs[i], 0(addr)");}
  }
}
sp+=stack_adjustment; //increment
if (opcode == "POPRET") {
   asm("ret");
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="pushfdqpoppopret32bitencodings">13.1.3. 32-bit Encodings</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  These encodings are provisional.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 61. push/pop 32-bit encodings</caption>
<colgroup>
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6676%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">31:27</th>
<th class="tableblock halign-left valign-top">26</th>
<th class="tableblock halign-left valign-top">25</th>
<th class="tableblock halign-left valign-top">24</th>
<th class="tableblock halign-left valign-top">23</th>
<th class="tableblock halign-left valign-top">22</th>
<th class="tableblock halign-left valign-top">21:20</th>
<th class="tableblock halign-left valign-top">19:18</th>
<th class="tableblock halign-left valign-top">17:16</th>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14:12</th>
<th class="tableblock halign-left valign-top">11:10</th>
<th class="tableblock halign-left valign-top">9: 7</th>
<th class="tableblock halign-left valign-top">6 : 0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="15"><p class="tableblock"><code>PUSH.[FDQ]</code> encodings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">0000000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">frlist</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rlist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH.F</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">0000000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">frlist</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rlist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH.D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">0000000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">frlist</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rlist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH.Q</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="15"><p class="tableblock"><code>POP.[FDQ]</code> encodings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">0000000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">frlist</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rlist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP.F</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">0000000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">frlist</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rlist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP.D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">0000000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">frlist</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rlist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP.Q</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="15"><p class="tableblock"><code>POPRET.[FDQ]</code> encodings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">0000000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">frlist</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rlist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET.F</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">0000000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">frlist</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rlist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET.D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">0000000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">frlist</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rlist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET.Q</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  bits [23:22] are the <code>fdq</code> field
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  <code>ra=1</code> for all <code>popret</code> encodings, it is not specified in the encoding
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_illegal_instructions_2">Illegal instructions</h5>
<div class="paragraph">
<p>The encoding takes the same behaviour as any floating point instruction if executed when disabled:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if <code>frlist&gt;0</code> and <code>misa.F==0</code></p>
</li>
<li>
<p>if <code>frlist&gt;0</code> and <code>fdq==1</code> and <code>misa.D==0</code></p>
</li>
<li>
<p>if <code>frlist&gt;0</code> and <code>fdq==2</code> and <code>misa.Q==0</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following cases do not decode as <code>PUSH*/POP*/POPRET*</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>No registers are specified (<code>rlist, frlist</code> are both zero)</p>
</li>
<li>
<p><code>rlist&gt;14</code></p>
</li>
<li>
<p><code>fdq=3</code></p>
</li>
<li>
<p><code>rlist==13</code> and <code>frlist&gt;0</code> and the opcode doesn&#8217;t have an <code>[fdq]</code> suffix</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_rational_code_rlist_13_frlist_0_code_saving_all_saved_registers">Rational: <code>rlist=13, frlist=0</code> saving all saved registers</h5>
<div class="paragraph">
<p>The debian distro does save all <code>s</code> and <code>fs</code> registers on a few occasions, so there is a special encoding for this case. I saw no justification for saving all <code>fs</code> registers <strong>without</strong> saving all <code>s</code> registers. It seems useful to have a form which saves all saved registers.</p>
</div>
<div class="paragraph">
<p>The programmable range for <code>frlist</code> doesn&#8217;t save many <code>fs</code> registers as <code>FPMark</code> only saves one or two and Debian rarely saves more than that.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_encoding_fields">13.1.4. Encoding Fields</h4>
<div class="paragraph">
<p>See <a href="#spimm"><code>spimm</code> encoding field</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">//the padding calculation requires SP to be 16-byte aligned before executing the instruction
if (FLEN&gt;XLEN &amp;&amp;
    number_of_registers_in_freg_list&gt;0 &amp;&amp;
    number_of_registers_in_reg_list % (FLEN/XLEN)&gt;0) {
  //need padding to ensure FLEN registers are aligned
  padding = (FLEN/XLEN - number_of_registers_in_reg_list % (FLEN/XLEN)) * XLEN/8;
} else {
  padding = 0
}
total_register_bytes = number_of_registers_in_reg_list * XLEN/8 + padding + number_of_registers_in_freg_list * FLEN/8;
stack_adjustment = Align16(total_register_bytes) + spimm;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The bytes required for padding is simple - if FLEN==XLEN it&#8217;s always zero. If FLEN=2*XLEN it is 0 or 4. RV32Q is more complex (see below) but this is an unlikely configuration.
<code>n</code> is an integer in the tables so <code>2n</code> is always even, <code>2n+1</code> is always odd.</p>
</div>
<table id="padding-examples-RV32D" class="tableblock frame-all grid-all spread">
<caption class="title">Table 62. RV32D padding examples, XLEN=32, FLEN=64</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">#Xreg</th>
<th class="tableblock halign-left valign-top">Padding required if accessing Fregs</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2n</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2n+1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4-bytes</p></td>
</tr>
</tbody>
</table>
<table id="padding-examples-RV64Q" class="tableblock frame-all grid-all spread">
<caption class="title">Table 63. RV64Q padding examples, XLEN=64, FLEN=128</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">#Xreg</th>
<th class="tableblock halign-left valign-top">Padding required if accessing Fregs</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2n</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2n+1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4-bytes</p></td>
</tr>
</tbody>
</table>
<table id="padding-examples-RV32Q" class="tableblock frame-all grid-all spread">
<caption class="title">Table 64. RV32Q padding examples, XLEN=32, FLEN=128</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">#Xreg</th>
<th class="tableblock halign-left valign-top">Padding required if accessing Fregs</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4n</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4n+1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4-bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4n+2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4n+3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12-bytes</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="__code_mv_ret_val_ra_frlist_rlist_code_for_the_32_bit_encodings"><code>mv, ret_val, ra, frlist, rlist</code> for the 32-bit encodings</h5>
<div class="paragraph">
<p>The registers in the <code>reg_list</code> are controlled by these fields</p>
</div>
<div class="paragraph">
<p>Note that <code>frlist</code>, <code>mv</code> and <code>ret_val</code> are in the same location in the encoding.</p>
</div>
<table id="32bit-frlistfdq" class="tableblock frame-all grid-all spread">
<caption class="title">Table 65. <code>frlist</code> values for the 32-bit encodings for <code>PUSH.[FDQ], POP.[FDQ], POPRET.[FDQ]</code></caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">frlist</th>
<th class="tableblock halign-left valign-top">ABI names</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none or <code>fs0-fs11</code> (see <code>rlist=13</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fs0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fs0-fs1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fs0-fs5</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>See <a href="#32bit-mv">[32bit-mv]</a> for <code>mv</code>.</p>
</div>
<div class="paragraph">
<p>See <a href="#32bit-ra">[32bit-ra]</a> for <code>ra</code>.</p>
</div>
<table id="32bit-rlistfdq" class="tableblock frame-all grid-all spread">
<caption class="title">Table 66. <code>rlist</code> field values for PUSH.[FDQ]/POP.[FDQ]/POPRET.[FDQ]</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">rlist</th>
<th class="tableblock halign-left valign-top">ABI names</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s9</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s10</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s11</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><code>rlist=13</code> is valid if <code>frlist=0</code> for <code>[.fdq]</code> opcodes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s11,fs0-fs11</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">these values could be used for interrupt save/restore</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">14-15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_assembly_examples_2">13.1.5. Assembly examples</h4>
<div class="sect4">
<h5 id="_push_f_rv32i_fdq_uabi_16_byte_aligned_stack">PUSH.F RV32I[FDQ] UABI (16-byte aligned stack)</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">push.f  {ra, s0-s4, fs0}, -64</code></pre>
</div>
</div>
<div class="paragraph">
<p>Encoding: ra=1, rlist=5, frlist=1, fdq=0, spimm=16 (16-byte aligned)</p>
</div>
<div class="paragraph">
<p>Micro operation sequence:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">sw  ra,   -4(sp);
sw  s0,   -8(sp);
sw  s1,  -12(sp);
sw  s2,  -16(sp);
sw  s3,  -20(sp);
sw  s4,  -24(sp);
fsw fs0, -28(sp)
addi sp, sp, -64;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_push_d_rv64i_dq_uabi_16_byte_aligned_stack">PUSH.D RV64I[DQ] UABI (16-byte aligned stack)</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">push.d  {ra, s0-s4, fs0}, -64</code></pre>
</div>
</div>
<div class="paragraph">
<p>Encoding: ra=1, rlist=5, frlist=1, fdq=1, spimm=0 (16-byte aligned)</p>
</div>
<div class="paragraph">
<p>Micro operation sequence:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">sd  ra,  -8(sp);
sd  s0,  -16(sp);
sd  s1,  -24(sp);
sd  s2,  -32(sp);
sd  s3,  -40(sp);
sd  s4,  -48(sp);
fsd fs0, -56(sp)
addi sp, sp, -64;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_push_d_rv64i_dq_uabi_16_byte_aligned_stack_2">PUSH.D RV64I[DQ] UABI (16-byte aligned stack)</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">push.d  {fs0-fs7}, -128</code></pre>
</div>
</div>
<div class="paragraph">
<p>Encoding: rlist=0, frlist=12, fdq=2, spimm=32 (16-byte aligned)</p>
</div>
<div class="paragraph">
<p>Micro operation sequence:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">fsd  fs0,  -8(sp);
fsd  fs1, -16(sp);
fsd  fs2, -24(sp);
fsd  fs3, -32(sp);
fsd  fs5, -40(sp);
fsd  fs4, -48(sp);
fsd  fs6, -56(sp);
fsd  fs7, -64(sp);
fsd  fs8, -72(sp);
fsd  fs9, -80(sp);
fsd  fs10,-88(sp);
fsd  fs11,-96(sp);
addi sp, sp, -128;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_benchmarking_results_too_low">13.2. Benchmarking results too low</h3>
<div class="sect3">
<h4 id="_tbljal_32_bit_encoding">13.2.1. TBLJAL (32-bit encoding)</h4>
<div class="paragraph">
<p><code>TBLJAL</code> offers minimal additional benefit over <code>C.TBLJAL</code></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  The 32-bit encoding is in <em>custom-0</em>, correct encodings need to be allocated.
</td>
</tr>
</table>
</div>
<table id="tbljal32bitencoding" class="tableblock frame-all grid-all spread">
<caption class="title">Table 67. TBLJAL 32-bit encoding, ZCE-type encoding</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">31:23</th>
<th class="tableblock halign-left valign-top">22:15</th>
<th class="tableblock halign-left valign-top">14:12</th>
<th class="tableblock halign-left valign-top">11:7</th>
<th class="tableblock halign-left valign-top">6 : 0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">00000000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">index13[12:5]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">index13[4:0]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0101011</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_lwtp_swtp_ldtp_sdtp">13.2.2. LWTP, SWTP, LDTP, SDTP</h4>
<div class="paragraph">
<p>TP relative load/store (similar to LWGP etc.) adding TP as a second global pointer.</p>
</div>
<div class="paragraph">
<p>The benefit from LWGP etc. so far is very low so there is no justification to add an extended range to TP.</p>
</div>
</div>
<div class="sect3">
<h4 id="_muliadd_addiadd_muliw_muliaddw_addiaddw">13.2.3. MULIADD, ADDIADD, MULIW, MULIADDW, ADDIADDW</h4>
<div class="paragraph">
<p>These instructions have low benefit. <code>MULIADD</code> and <code>ADDIADD</code> are unpopular due to requiring 3 operands. <code>MULI</code> is useful (and is included in the proposal) and takes much of the benefit of <code>MULIADD</code></p>
</div>
<div class="paragraph">
<p>See <a href="https://github.com/clairexen/riscv-fanfic/blob/master/riscv-cfmt/riscv-cfmt.md">Clare&#8217;s proposal from the B-extension</a>.
Also see <a href="https://github.com/riscv/riscv-code-size-reduction/blob/master/existing_extensions/Huawei%20Custom%20Extension/riscv_muladd_extension.rst">this document</a>, which is implemented on silicon.</p>
</div>
<table id="arithmetic_semantics" class="tableblock frame-all grid-all spread">
<caption class="title">Table 68. Arithmetic semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULIADD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = rs1' + rs2' * sign_ext(imm)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADDIADD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = rs1' + rs2' + sign_ext(imm)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">RV64/RV128 only</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULIW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = sign_extrs1'[31:0] * sign_ext(imm[31:0])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULIADDW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = sign_extrs1'[31:0] + rs2'[31:0] * sign_ext(imm[31:0])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADDIADDW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = sign_extrs1'[31:0] + rs2'[31:0] + sign_ext(imm[31:0])
)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Assembly Examples</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">muliadd  a0, a1, a2, 2 # a0 = a1 + a2 * 2
addiadd  a0, a1, a2, 2 # a0 = a1 + a2 + 2
muliw    a0, a1, 2     # a0 = sign_ext(a1 * 2)
muliaddw a0, a1, 2     # a0 = sign_ext(a1 + a2 * 2)
addiaddw a0, a1, 2     # a0 = sign_ext(a1 + a2 + 2)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_bgeui_bltui">13.2.4. BGEUI, BLTUI</h4>
<div class="paragraph">
<p>These allocate reserved encodings, and are similar to <a href="#cmpimmbr">BEQI, BNEI</a> but have lower value. It&#8217;s possible that future use of these instructions will be found in later versions of <code>Zce</code>.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 69. Rejected 32-bit encodings</caption>
<colgroup>
<col style="width: 7.6923%;">
<col style="width: 7.6923%;">
<col style="width: 7.6923%;">
<col style="width: 7.6923%;">
<col style="width: 7.6923%;">
<col style="width: 7.6923%;">
<col style="width: 7.6923%;">
<col style="width: 7.6923%;">
<col style="width: 7.6923%;">
<col style="width: 7.6923%;">
<col style="width: 7.6923%;">
<col style="width: 7.6923%;">
<col style="width: 7.6924%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">31:27</th>
<th class="tableblock halign-left valign-top">26:25</th>
<th class="tableblock halign-left valign-top">24</th>
<th class="tableblock halign-left valign-top">23</th>
<th class="tableblock halign-left valign-top">22:20</th>
<th class="tableblock halign-left valign-top">19:18</th>
<th class="tableblock halign-left valign-top">17:16</th>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14:12</th>
<th class="tableblock halign-left valign-top">11:10</th>
<th class="tableblock halign-left valign-top">9:7</th>
<th class="tableblock halign-left valign-top">6 : 0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">zcmpimm[5:1]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zcmpimm[0]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">offset[9:6]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">offset[5:1]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BGEUI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">zcmpimm[5:1]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zcmpimm[0]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">offset[9:6]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">offset[5:1]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BLTUI</p></td>
</tr>
</tbody>
</table>
<table id="rejected-cmpimmbr-branch_semantics" class="tableblock frame-all grid-all spread">
<caption class="title">Table 70. Rejected compare immediate branch semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BGEUI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if (rs1&gt;=<sub>u</sub> zero_ext(zcmpimm)) target_pc=PC+offset; else target_pc=PC+4;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BLTUI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if (rs1&lt;<sub>u</sub>  zero_ext(zcmpimm)) target_pc=PC+offset; else target_pc=PC+4;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Assembly Examples</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">bgeu a5, 1,offset # if(a5&gt;= 1) branch_to(PC+offset) # unsigned comparison
bltu a5, 1,offset # if(a5&lt;  1) branch_to(PC+offset) # unsigned comparison</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_c_lbusp_c_lhusp_c_sbsp_c_shsp">13.2.5. C.LBUSP, C.LHUSP, C.SBSP, C.SHSP</h4>
<div class="paragraph">
<p>These encodings require too much space for the benefit.</p>
</div>
<table id="ldstbhsprel-16encodings" class="tableblock frame-all grid-all spread">
<caption class="title">Table 71. Rejected load/store half/byte SP relative 16-bit encodings</caption>
<colgroup>
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8832%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="17"><p class="tableblock">source/dest with one other source operand, stack pointer relative</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uimm[3]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">uimm[2:0]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LBUSP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uimm[3]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">uimm[2:14]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LHUSP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uimm[3]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs2'</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">uimm[2:0]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SBSP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uimm[3]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs2'</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">uimm[2:14]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SHSP</p></td>
</tr>
</tbody>
</table>
<table id="ldstbhsprel-semantics" class="tableblock frame-all grid-all spread">
<caption class="title">Table 72. Rejected load/store byte/half SP relative semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LBUSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = zero_ext(DataMemory[sp + zero_ext(uimm)][ 7:0])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LHUSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = zero_ext(DataMemory[sp + zero_ext(uimm)][15:0])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SBSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DataMemory[sp + zero_ext(uimm)][ 7:0] = rs2'[ 7:0]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SHSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DataMemory[sp + zero_ext(uimm)][15:0] = rs2'[15:0]</p></td>
</tr>
</tbody>
</table>
<table id="ldstbh_sprel_32bit" class="tableblock frame-all grid-all spread">
<caption class="title">Table 73. load/store byte/half SP relative assembler syntax and 32-bit equivalent instructions</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">assembler syntax</th>
<th class="tableblock halign-left valign-top">requirements for 16-bit encoding</th>
<th class="tableblock halign-left valign-top">32-bit extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LBUSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lbu    rd, imm(sp)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd is x8-x15, imm is in range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-extension</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LHUSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lhu    rd, imm(sp)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd is x8-x15, imm is in range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-extension</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SBSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sb     rd, imm(sp)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd is x8-x15, imm is in range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-extension</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SHSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sh     rd, imm(sp)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd is x8-x15, imm is in range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-extension</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Assembly Examples</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">lbu a5,20(sp)   # a5 = zero_ext(Memory(sp+20)[ 7:0])
lhu a5,20(sp)   # a5 = zero_ext(Memory(sp+20)[15:0])
sb  a5,20(sp)   # Memory(sp+20)[ 7:0] = a5[ 7:0]
sh  a5,20(sp)   # Memory(sp+20)[15:0] = a5[15:0]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_c_lsbnot_c_lsbset">13.2.6. C.LSBNOT / C.LSBSET</h4>
<div class="paragraph">
<p>The encodings are cheap, but the benefit is low.</p>
</div>
<table id="dyadic-16encodings-lsbnot-lsbset" class="tableblock frame-all grid-all spread">
<caption class="title">Table 74. simple instructions 16-bit encodings</caption>
<colgroup>
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8832%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs1'/rd'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">110</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LSBNOT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs1'/rd'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">111</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LSBSET</p></td>
</tr>
</tbody>
</table>
<table id="monsemantics_lsbnot_lsbset" class="tableblock frame-all grid-all spread">
<caption class="title">Table 75. simple instruction semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LSBNOT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = rd' XOR 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LSBSET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = rd' OR 1</p></td>
</tr>
</tbody>
</table>
<table id="mon-32bit" class="tableblock frame-all grid-all spread">
<caption class="title">Table 76. simple instruction 32-bit equivalent instructions/pseudo-instructions</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">assembler syntax</th>
<th class="tableblock halign-left valign-top">requirements for 16-bit encoding</th>
<th class="tableblock halign-left valign-top">32-bit extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LSBNOT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lsbnot rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all registers x8-x15, rd==rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-extension</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LSBKEEP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lsbset rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all registers x8-x15, rd==rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-extension</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Assembly Examples</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">lsbnot a5;      # a5 = a5 XOR 1</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_future_ideas">14. Future ideas</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_multiple_move_instructions">14.1. Multiple move instructions</h3>
<div class="paragraph">
<p>These instructions have some problems:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>They either two register file write ports, or to be issued in a sequence.</p>
</li>
<li>
<p>C.MVA* use ABI names when specifying source registers, which is efficient but non-standard</p>
</li>
<li>
<p>There is no 32-bit encoding which makes sense, because each does the work of 2 x 16-bit encodings</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Therefore ratification is delayed, and some more thought is needed.</p>
</div>
<div class="sect3">
<h4 id="_c_mvp">14.1.1. C.MVP</h4>
<div class="paragraph">
<p>The generic move uses standard x register numbers, and so it more standard than <code>C.MVA*S07</code>, however it takes a lot more encoding space. Both register pairs must be even/odd pairs (<code>rdp[0]=0, rsp[0]=0</code>) to reduce the encoding space requirement.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  Currently there are no 32-bit equivalent instructions, is it enough to expand to <strong>two</strong> 32-bit instructions?
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  These are optional (<code>Zces</code>) as they require 2 register file write ports, or are sequenced.
</td>
</tr>
</table>
</div>
<table id="mvp-encoding" class="tableblock frame-all grid-all spread">
<caption class="title">Table 77. generic double move 16-bit encoding</caption>
<colgroup>
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8832%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">rdp[4:1]</p></td>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">rsp[4:1]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MVP</p></td>
</tr>
</tbody>
</table>
<table id="mvp-semantics" class="tableblock frame-all grid-all spread">
<caption class="title">Table 78. generic double move semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MVP rdp, rsp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mv rdp, rsp;  mv rdp+1, rsp+1</p></td>
</tr>
</tbody>
</table>
<table id="mvp-syntax" class="tableblock frame-all grid-all spread">
<caption class="title">Table 79. <code>C.MVP</code> assembler syntax</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">assembler syntax</th>
<th class="tableblock halign-left valign-top">requirements for 16-bit encoding</th>
<th class="tableblock halign-left valign-top">32-bit extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MVP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mv(rdp,rsp),(rdp+1,rsp+1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  Currently there are no 32-bit equivalent instructions, is it enough to expand to <strong>two</strong> 32-bit instructions?
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Assembly examples.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode"># c.mvp: sreg1 = 0; sreg2 = 0;
mv (x2, x3), (x18, x19) ; # mv x2, x2; mv x18, x19</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_c_mva23s07">14.1.2. C.MVA23S07</h4>
<div class="paragraph">
<p>Similar to C.MVA01S07 but the benefit is much lower.</p>
</div>
<table id="proposed-16bit-encodings-4" class="tableblock frame-all grid-all spread">
<caption class="title">Table 80. <code>C.MVA23S07</code> 16-bit encoding</caption>
<colgroup>
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8832%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">sreg1</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">sreg2</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MVA23S07</p></td>
</tr>
</tbody>
</table>
<table id="mvs07_semantics" class="tableblock frame-all grid-all spread">
<caption class="title">Table 81. <code>C.MVA23S07</code> semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MVA23S07 sreg1, sreg2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mv a2, s[sreg1];  mv a3, s[sreg2]</p></td>
</tr>
</tbody>
</table>
<table id="mvs07_syntax" class="tableblock frame-all grid-all spread">
<caption class="title">Table 82. <code>C.MVA23S07</code> assembler syntax</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">assembler syntax</th>
<th class="tableblock halign-left valign-top">requirements for 16-bit encoding</th>
<th class="tableblock halign-left valign-top">32-bit extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MVAS23S07</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mv(a2,a3),(sreg1,sreg2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Assembly examples.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode"># c.mva23s: sreg1 = 1; sreg2 = 3;
mv (a2, a3), (s1, s3) ; # mv a2, s1; mv a3, s3</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-09-21 11:46:31 BST
</div>
</div>
</body>
</html>