<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="Version 0.29.2">
<title>RISC-V Zce code-size reduction extension proposal v0.29.2</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article toc2 toc-left data-line-1">
<div id="header">
<h1>RISC-V Zce code-size reduction extension proposal v0.29.2</h1>
<div class="details">
<span id="author" class="author">Version 0.29.2</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_spec_update_history">1. Spec update history</a></li>
<li><a href="#_issues">2. Issues</a></li>
<li><a href="#_zce_configurations">3. <code>Zce</code> configurations</a></li>
<li><a href="#_c_extension_subsets">4. C-extension subsets</a></li>
<li><a href="#_allocation_of_new_16_bit_encodings">5. Allocation of new 16-bit encodings</a>
<ul class="sectlevel2">
<li><a href="#_16_bit_encoding_code_points">5.1. 16-bit encoding code-points</a></li>
</ul>
</li>
<li><a href="#_zcea_definition">6. <code>Zcea</code> definition</a>
<ul class="sectlevel2">
<li><a href="#_c_sext_b_c_sext_h_c_zext_b_c_zext_h_c_zext_w_c_mul_c_not_c_neg">6.1. C.SEXT.B, C.SEXT.H, C.ZEXT.B, C.ZEXT.H, C.ZEXT.W, C.MUL, C.NOT, C.NEG</a></li>
<li><a href="#_c_sext_w">6.2. C.SEXT.W</a></li>
<li><a href="#_muli_muliadd_addiadd_muliw_muliaddw_addiaddw">6.3. MULI, MULIADD, ADDIADD, MULIW, MULIADDW, ADDIADDW</a></li>
<li><a href="#cmpimmbr">6.4. BEQI, BNEI</a></li>
<li><a href="#_table_jump">6.5. Table Jump</a>
<ul class="sectlevel3">
<li><a href="#tablejump16">6.5.1. C.TBLJAL</a></li>
<li><a href="#tablejump32">6.5.2. TBLJAL</a></li>
</ul>
</li>
<li><a href="#pushpoppopret_heading">6.6. PUSH and POP</a>
<ul class="sectlevel3">
<li><a href="#pushpop32">6.6.1. PUSH, POP, POPRET, PUSH.E, POP.E, POPRET.E</a></li>
<li><a href="#pushpop16">6.6.2. C.PUSH, C.POP, C.POPRET, C.PUSH.E, C.POP.E, C.POPRET.E</a></li>
</ul>
</li>
<li><a href="#_b_extension_reuse">6.7. B-extension reuse</a>
<ul class="sectlevel3">
<li><a href="#_zba_zbb_required">6.7.1. Zba, Zbb required</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_zceb_definition">7. <code>Zceb</code> definition</a>
<ul class="sectlevel2">
<li><a href="#_decrement_and_branch">7.1. Decrement and branch</a>
<ul class="sectlevel3">
<li><a href="#decbr16">7.1.1. C.DECBGEZ</a></li>
<li><a href="#_decbgez">7.1.2. DECBGEZ</a></li>
</ul>
</li>
<li><a href="#_lwgp_swgp_lwtp_swtp">7.2. LWGP, SWGP, LWTP, SWTP</a></li>
<li><a href="#_c_lbu_c_lhu_c_sb_c_sh">7.3. C.LBU, C.LHU, C.SB, C.SH</a></li>
</ul>
</li>
<li><a href="#tablejump">8. Table Jump</a>
<ul class="sectlevel2">
<li><a href="#_rationale">8.1. Rationale</a></li>
<li><a href="#_encoding">8.2. Encoding</a></li>
<li><a href="#_csrs">8.3. CSRs</a></li>
<li><a href="#_jump_table_mode">8.4. Jump table mode</a>
<ul class="sectlevel3">
<li><a href="#_pseudo_code_for_jump_table_mode">8.4.1. Pseudo-code for jump table mode</a></li>
<li><a href="#_exceptions_for_jump_table_mode">8.4.2. Exceptions for jump table mode</a></li>
<li><a href="#_context_switching_for_jump_table_mode">8.4.3. Context Switching for jump table mode</a></li>
<li><a href="#_caching_for_jump_table_mode">8.4.4. Caching for jump table mode</a></li>
<li><a href="#_powerperformance_of_jump_table_mode">8.4.5. Power/performance of jump table mode</a></li>
</ul>
</li>
<li><a href="#vector-table-mode">8.5. Future Mode: Vector table mode (not for RVM22/RVA22)</a>
<ul class="sectlevel3">
<li><a href="#_watermarks">8.5.1. Watermarks</a></li>
<li><a href="#_exceptions_for_vector_table_mode">8.5.2. Exceptions for vector table mode</a></li>
<li><a href="#_pseudo_code_for_vector_table_mode">8.5.3. Pseudo-code for vector table mode</a></li>
<li><a href="#_vector_table_code">8.5.4. vector table code</a></li>
<li><a href="#_vector_mode_security_future_ideas">8.5.5. Vector Mode Security (future ideas)</a></li>
</ul>
</li>
<li><a href="#emulation-mode">8.6. Future Mode: Emulation Mode (not for RVM22/RVA22)</a>
<ul class="sectlevel3">
<li><a href="#_pseudo_code_for_emulation_mode">8.6.1. Pseudo-code for emulation mode</a></li>
</ul>
</li>
<li><a href="#_diagram_for_all_table_jump_modes">8.7. Diagram for all table jump modes</a></li>
</ul>
</li>
<li><a href="#pushpoppopret">9. PUSH and POP</a>
<ul class="sectlevel2">
<li><a href="#_a_brief_example_from_zephyr">9.1. A brief example from Zephyr</a></li>
<li><a href="#_uabi_and_eabi_support">9.2. UABI and EABI support</a></li>
<li><a href="#_assembler_syntax">9.3. Assembler Syntax</a></li>
<li><a href="#_determining_xlen_to_decode_and_execute_the_instructions">9.4. Determining XLEN to decode and execute the instructions</a></li>
<li><a href="#_pseudo_code">9.5. Pseudo-code</a>
<ul class="sectlevel3">
<li><a href="#_pushpush_e_pseudo_code">9.5.1. PUSH/PUSH.E Pseudo-code</a></li>
<li><a href="#_poppop_epopretpopret_e_pseudo_code">9.5.2. POP/POP.E/POPRET/POPRET.E Pseudo-code</a></li>
</ul>
</li>
<li><a href="#pushpoppopret32bitencodings">9.6. 32-bit Encodings</a>
<ul class="sectlevel3">
<li><a href="#_illegal_instructions">9.6.1. Illegal instructions</a></li>
</ul>
</li>
<li><a href="#pushpoppopret16bitIencodings">9.7. 16-bit Encodings</a>
<ul class="sectlevel3">
<li><a href="#spimm">9.7.1. <code>spimm</code> encoding field</a></li>
<li><a href="#_mv_ret_val_ra_rlist_for_the_32_bit_encodings">9.7.2. mv, ret_val, ra, rlist for the 32-bit encodings</a></li>
<li><a href="#_rlist_ret_val_for_the_16_bit_encodings">9.7.3. <code>rlist</code>, <code>ret_val</code> for the 16-bit encodings</a></li>
</ul>
</li>
<li><a href="#fault-handling">9.8. Fault handling</a></li>
<li><a href="#software-view">9.9. Software view of execution</a>
<ul class="sectlevel3">
<li><a href="#_software_view_of_push_sequence">9.9.1. Software view of <code>PUSH</code> sequence</a></li>
<li><a href="#_software_view_of_poppopret_sequence">9.9.2. Software view of <code>POP/POPRET</code> sequence</a></li>
<li><a href="#non-idem-mem">9.9.3. Non-idempotent memory</a></li>
<li><a href="#_error_detection">9.9.4. Error detection</a></li>
<li><a href="#_non_idempotent_support">9.9.5. Non-idempotent support</a></li>
</ul>
</li>
<li><a href="#_toolchain_implementation">9.10. Toolchain implementation</a></li>
<li><a href="#_assembly_examples">9.11. Assembly examples</a>
<ul class="sectlevel3">
<li><a href="#push-example-1">9.11.1. C.PUSH RV32 UABI (16-byte aligned stack)</a></li>
<li><a href="#_c_push_rv32i_uabi_16_byte_aligned_stack">9.11.2. C.PUSH RV32I UABI (16-byte aligned stack)</a></li>
<li><a href="#_c_pop_rv32i_uabi_16_byte_aligned_stack">9.11.3. C.POP RV32I UABI (16-byte aligned stack)</a></li>
<li><a href="#popret-example-1">9.11.4. C.POPRET RV32I UABI (16-byte aligned stack)</a></li>
<li><a href="#_pop_rv32i_uabi_16_byte_aligned_stack">9.11.5. POP RV32I UABI (16-byte aligned stack)</a></li>
</ul>
</li>
<li><a href="#ldstm">9.12. Appendix: Usage as load/store-multiple</a></li>
</ul>
</li>
<li><a href="#_verification_notes">Verification notes</a>
<ul class="sectlevel1">
<li><a href="#_existing_functionality">1. Existing functionality</a></li>
<li><a href="#_simple_extensions_to_existing_functionality">2. Simple extensions to existing functionality</a></li>
<li><a href="#_new_arithmetic_functionality">3. New arithmetic functionality</a></li>
<li><a href="#_new_branch_functionality">4. New branch functionality</a></li>
<li><a href="#_sequenced_functionality">5. Sequenced functionality</a>
<ul class="sectlevel2">
<li><a href="#_cover_all_possible_sets_of_operands">5.1. Cover all possible sets of operands</a></li>
<li><a href="#_test_the_functionality">5.2. Test the functionality</a></li>
</ul>
</li>
<li><a href="#_table_jump_jump_table_mode_only">6. Table jump, jump table mode only</a></li>
</ul>
</li>
<li><a href="#_rejected_and_postponed_instructions">Rejected and postponed instructions</a>
<ul class="sectlevel1">
<li><a href="#_not_benchmarked_push_fdq_pop_fdq_popret_fdq">1. Not benchmarked: PUSH.[FDQ], POP.[FDQ], POPRET.[FDQ]</a>
<ul class="sectlevel2">
<li><a href="#_assembler_syntax_2">1.1. Assembler Syntax</a>
<ul class="sectlevel3">
<li><a href="#_rationale_why_include_the_fdq_suffix">1.1.1. Rationale: why include the .[fdq] suffix</a></li>
</ul>
</li>
<li><a href="#_pseudo_code_2">1.2. Pseudo-code</a>
<ul class="sectlevel3">
<li><a href="#_push_fdq_pseudo_code">1.2.1. PUSH.[FDQ] Pseudo-code</a></li>
<li><a href="#_pop_fdqpopretfdq_pseudo_code">1.2.2. POP.[FDQ]/POPRET/[FDQ] Pseudo-code</a></li>
</ul>
</li>
<li><a href="#pushpoppopret32bitencodings">1.3. 32-bit Encodings</a>
<ul class="sectlevel3">
<li><a href="#_illegal_instructions_2">1.3.1. Illegal instructions</a></li>
<li><a href="#_rational_rlist13_frlist0_saving_all_saved_registers">1.3.2. Rational: <code>rlist=13, frlist=0</code> saving all saved registers</a></li>
</ul>
</li>
<li><a href="#_encoding_fields">1.4. Encoding Fields</a>
<ul class="sectlevel3">
<li><a href="#_mv_ret_val_ra_frlist_rlist_for_the_32_bit_encodings">1.4.1. <code>mv, ret_val, ra, frlist, rlist</code> for the 32-bit encodings</a></li>
</ul>
</li>
<li><a href="#_assembly_examples_2">1.5. Assembly examples</a>
<ul class="sectlevel3">
<li><a href="#_push_f_rv32ifdq_uabi_16_byte_aligned_stack">1.5.1. PUSH.F RV32I[FDQ] UABI (16-byte aligned stack)</a></li>
<li><a href="#_push_d_rv64idq_uabi_16_byte_aligned_stack">1.5.2. PUSH.D RV64I[DQ] UABI (16-byte aligned stack)</a></li>
<li><a href="#_push_d_rv64idq_uabi_16_byte_aligned_stack_2">1.5.3. PUSH.D RV64I[DQ] UABI (16-byte aligned stack)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_benchmarking_results_too_low">2. Benchmarking results too low</a>
<ul class="sectlevel2">
<li><a href="#_bgeui_bltui">2.1. BGEUI, BLTUI</a></li>
<li><a href="#_c_lbusp_c_lhusp_c_sbsp_c_shsp">2.2. C.LBUSP, C.LHUSP, C.SBSP, C.SHSP</a></li>
<li><a href="#_c_lsbnot_c_lsbset">2.3. C.LSBNOT / C.LSBSET</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_future_ideas">Future ideas</a>
<ul class="sectlevel1">
<li><a href="#_multiple_move_instructions">1. Multiple move instructions</a>
<ul class="sectlevel2">
<li><a href="#_c_mvp">1.1. C.MVP</a></li>
<li><a href="#_c_mva01s07_c_mva23s07">1.2. C.MVA01S07, C.MVA23S07</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph data-line-13">
<p>This document describes the <code>Zce</code> extension to reduce code-size.</p>
</div>
</div>
</div>
<div class="sect1 data-line-15">
<h2 id="_spec_update_history">1. Spec update history</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch data-line-17">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">change</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.29.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">change SPIMM definiton so the encoding sets bits [8:4] not [4:0] to make it obvious it&#8217;s a multiple of 16</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fixed C.PUSH/C.POP etc. encodings as they overlapped</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.29.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add ZCE-type format for push/pop/popret and tbljal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.29</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add EABI versions of 32-bit encodings of PUSH/POP/POPRET, and move encodings of PUSH/POP/POPRET/BEQI/BNEI to custom-0 as I chose bad encodings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.28</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">change alignment check of all non FP forms of PUSH/POP/POPRET to 8-byte not 16-byte to allow EABI compatibility. SPIMM still allocates blocks of 16-bytes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.27</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">add tentative versions of C.PUSH.E/C.POP.E/C.POPRET.E, need to review them</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.26</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">simplify and rename subsets. Re-encode LWGP/SWGP etc. Add LDWP/SDGP etc. Re-encode DECBGEZ. Re-encode C.SEXT.B, C.SEXT.H, C.NOT, C.NEG following Greg Favor&#8217;s recommendation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add Zcee for inclusion in RVA22</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">add illegal combinations of mv and rcount into PUSH spec</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">added verification notes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.23</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">add C.ZEXT.W and Zba for the 32-bit version</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">group encodings closer together to hopefully allocate 16-bit encoding space to Zce. Put code points numbers into the tables</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.21</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">remove SEXT.W as it&#8217;s an existing pseudo-instruction, and also remove ZEXT.W as it requires Zbp (which is otherwise is <strong>not</strong> required).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove C.LSBKEEP as it&#8217;s the same as C.ANDI, rs, 1. Postpone C.LSBSET.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tidy up encodings of C.[SX]EXT.[BH] so we don&#8217;t leave gaps</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add code-point information</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Put MULI[W]/MULIADD[W] into Zcecm</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POSTPONE PUSH.[FDQ]/POP.[FDQ]/POPRET.[FDQ].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replace C.LSBNOT with C.LSBSET and also add C.LSBKEEP.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove BGEUI, BLTUI, C.LSBNOT, C.LBUSP, C.LHUSP, C.SBSP, C.SHSP as benchmarking results are low</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Put C.MVP/C.MVA*S07 into a "future work" category as they need more thought</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reduced C.TBLJAL immediate to 8-bits, the 9th bit didn&#8217;t pay for itself</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Note EABI compatibility in PUSH/POP/POPRET</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Update C.NOT/C.NEG assembly syntax</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.18</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Separate C.MUL into Zcecm to avoid the dependancy on M, so Zcec has one subset (but is still the same ratification group)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add Zbb and possibly Zba (open issue)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add Zces[fdq] subsets</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">add B-ext pseudo-ops and pack/packw into Zcec for 32-bit forms of new instructions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BNEI/BEQI/MULI/MULIADD/ADDIADD moved from Zced to Zcec. Found encodings for B*I and DECBGEZ to allow Zced+ZDinx. Reduced cmpimm range for BNEI/BEQI to fit the encoding. Allocated provisional encodings for all 32-bit instructions. Fixed width of frcount, mv in PUSH/POP encodings.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">split LWGP/SWGP into LWGP/SWGP and LWTP/SWTP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reduce ret_val to 2-bits for POP/POPRET</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add C.SEXT.W, C.ZEXT.W, MULI, MULIADDW, ADDIADDW, and change the C.[SZ]EXT.* encodings. Rename flen PUSH/POP encoding field to fdq to avoid confusion with FLEN.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1 data-line-53">
<h2 id="_issues">2. Issues</h2>
<div class="sectionbody">
<div class="ulist data-line-55">
<ul>
<li class="data-line-55">
<p>need 32-bit instruction formats for Zcea (I&#8217;ve only done Zceb)</p>
</li>
<li class="data-line-56">
<p>should the fault handling in <code>push/pop/popret</code> be profile defined, or is platform defined ok?</p>
</li>
<li class="data-line-57">
<p>is a hypervisor version of <code>xTBLJALVEC</code> required for <code>tbljal</code>?</p>
</li>
<li class="data-line-58">
<p><code>xTBLJALVEC</code> need addresses to be allocated</p>
</li>
<li class="data-line-59">
<p>EABI spec is not frozen - so it&#8217;s not clear which formats of PUSH.E etc that I need</p>
<div class="ulist data-line-60">
<ul>
<li class="data-line-60">
<p>currently s4 is the maximum EABI saved register, which doesn&#8217;t match a 16-bit format register list (which end at s3, s5, s8, s11) I&#8217;d prefer it if the register lists match for the UABI and EABI for a simpler spec.</p>
</li>
</ul>
</div>
</li>
<li class="data-line-61">
<p>for <code>C.PUSH</code> confirm that the auto-included register moves are optimal (give the right balance between saving code-size and not wasting performance)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1 data-line-63">
<h2 id="_zce_configurations">3. <code>Zce</code> configurations</h2>
<div class="sectionbody">
<div class="imageblock data-line-65">
<div class="content">
<img src="https://github.com/riscv/riscv-code-size-reduction/blob/master/ISA%20proposals/Huawei/Zce_subsets%20simplified3.png" alt="Zce subsets">
</div>
</div>
<div class="paragraph data-line-67">
<p><code>Zce</code> is split into two main subsets</p>
</div>
<div class="ulist data-line-69">
<ul>
<li class="data-line-69">
<p><code>Zcea</code> is required in RVM22, is compatible with all existing standard extensions</p>
<div class="ulist data-line-70">
<ul>
<li class="data-line-70">
<p><code>Zcee</code> is a subset of <code>Zcea</code> which required in RVA22</p>
</li>
<li class="data-line-71">
<p><code>Zcea/Zcee</code> imply <code>Zba/Zba</code> to get the 32-bit versions of the sign/zero-extension encodings</p>
</li>
</ul>
</div>
</li>
<li class="data-line-72">
<p><code>Zceb</code> is optional for in RVM22 <em>because it conflicts with the D-extension</em></p>
<div class="ulist data-line-73">
<ul>
<li class="data-line-73">
<p><code>Zceb</code> is fully compatible with <code>ZDinx</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<table id="zcea" class="tableblock frame-all grid-all stretch data-line-78">
<caption class="title">Table 1. Zcea extension</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Instruction</th>
<th class="tableblock halign-left valign-top">RV32</th>
<th class="tableblock halign-left valign-top">RV64</th>
<th class="tableblock halign-left valign-top">RV128</th>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="6"><p class="tableblock">Zcee subset</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SEXT.B</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea/Zcee</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SEXT.H</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea/Zcee</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SEXT.W</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea/Zcee</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pseudo-instruction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ZEXT.B</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea/Zcee</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ZEXT.H</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea/Zcee</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ZEXT.W</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea/Zcee</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="6"><p class="tableblock">Require M or Zmmul to be inferred</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MUL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">requires M or Zmmul</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">requires M or Zmmul</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULIADD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">requires M or Zmmul</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULIW</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">requires M or Zmmul</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULIADDW</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">requires M or Zmmul</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="6"><p class="tableblock">other 16-bit encodings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.NOT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.NEG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.TBLJAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH.E</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP.E</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET.E</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="6"><p class="tableblock">other 32-bit encodings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADDIADD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADDIADDW</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TBLJAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH.E</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP.E</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET.E</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<table id="zceb" class="tableblock frame-all grid-all stretch data-line-118">
<caption class="title">Table 2. Zceb extension, incompatible with D, compatible with ZDinx</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Instruction</th>
<th class="tableblock halign-left valign-top">RV32</th>
<th class="tableblock halign-left valign-top">RV64</th>
<th class="tableblock halign-left valign-top">RV128</th>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="6"><p class="tableblock">16-bit encodings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.DECBGEZ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zceb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incompatible with D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LBU</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zceb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incompatible with D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LHU</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zceb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incompatible with D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zceb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incompatible with D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zceb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incompatible with D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="6"><p class="tableblock">32-bit encodings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DECBGEZ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zceb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incompatible with D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LWGP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zceb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incompatible with D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LWTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zceb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incompatible with D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWGP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zceb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incompatible with D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zceb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incompatible with D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDGP</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zceb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incompatible with D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDTP</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zceb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incompatible with D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SDGP</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zceb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incompatible with D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SDTP</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zceb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incompatible with D</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-138">
<p><code>Zcea/Zceb</code> are compatible with both the <code>I</code> and <code>E</code> extensions.</p>
</div>
<div class="paragraph data-line-140">
<p>All systems which implement <code>Zcea/Zceb</code> must also implement the <code>C</code> extension.</p>
</div>
<div class="paragraph data-line-142">
<p>If <code>M</code> or <code>Zmmul</code> is specified then <code>Zcea</code> also includes the <code>C.MUL, MULI, MULIADD</code> instructions, and <code>MULIW, MULIADDW</code> for RV64/RV128.</p>
</div>
<div class="paragraph data-line-144">
<p><code>Zcea</code> implies the <code>B</code>-extension subsets <code>Zba</code> and <code>Zbb</code>. Therefore <code>RV32IC_Zcea</code> is equivalent to <code>RV32IC_Zcea_Zba_Zbb</code>.</p>
</div>
</div>
</div>
<div class="sect1 data-line-146">
<h2 id="_c_extension_subsets">4. C-extension subsets</h2>
<div class="sectionbody">
<div class="paragraph data-line-148">
<p>The C-extension already reuses encodings between different architectures. <code>Zce</code> extends this concept further. <a href="#zce_quad0">Table 3</a>, <a href="#zce_quad1">Table 4</a> and <a href="#zce_quad2">Table 5</a> show how each encoding is allocated for different architectures or for different combinations of extensions.</p>
</div>
<div class="paragraph data-line-150">
<p>For example:</p>
</div>
<div class="ulist data-line-152">
<ul>
<li class="data-line-152">
<p><code>C.FSD</code>, <code>C.SQ</code>, and <code>{C.LBU, C.SB}</code> share opcodes, so for different configurations the encodings represent:</p>
<div class="ulist data-line-153">
<ul>
<li class="data-line-153">
<p><code>C.FSD</code> for <code>RV32CD/RV64CD</code></p>
</li>
<li class="data-line-154">
<p><code>C.SQ</code>  for <code>RV128C</code></p>
</li>
<li class="data-line-155">
<p><code>{C.LBU, C.SB}</code> for <code>RV32C_Zce, RV64C_Zce， RV32C_Zce_ZDinx, RV64C_Zce_ZDinx</code></p>
</li>
<li class="data-line-156">
<p>illegal encoding for <code>RV32C, RV64C</code>, as neither <code>D</code> nor <code>Zce</code> was specified</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph data-line-158">
<p>The shared encoding column in the tables assigns an arbitrary number to show which encodings are grouped together (I can&#8217;t find a better way of highlighting groups of cells in the table in adoc format). <code>Zce</code> instructions are in <strong>bold</strong>.</p>
</div>
<table id="zce_quad0" class="tableblock frame-all grid-all stretch data-line-163">
<caption class="title">Table 3. C-extension quadrant 0</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Enc[15:13]</th>
<th class="tableblock halign-left valign-top">Instruction</th>
<th class="tableblock halign-left valign-top">shared encoding group</th>
<th class="tableblock halign-left valign-top">Ext Subset</th>
<th class="tableblock halign-left valign-top">RV32</th>
<th class="tableblock halign-left valign-top">RV64</th>
<th class="tableblock halign-left valign-top">RV128</th>
<th class="tableblock halign-left valign-top">Extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ADDI4SPN</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.FLD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LQ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcq</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.DECBGEZ</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zceb</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zceb</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LW</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.FLW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+F</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc64/Zc128</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.POP</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.POPRET</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.PUSH</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.POP.E</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.POPRET.E</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.PUSH.E</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.TBLJAL</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.SEXT.B</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.SEXT.H</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.ZEXT.B</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.ZEXT.H</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.NOT</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.NEG</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.MUL</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">M+C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.FSD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SQ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcq</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.SB</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zceb</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zceb</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.LBU</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zceb</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zceb</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">110</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SW</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.FSW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+F</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc64/Zc128</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
</tbody>
</table>
<table id="zce_quad1" class="tableblock frame-all grid-all stretch data-line-207">
<caption class="title">Table 4. C-extension quadrant 1</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Enc[15:13]</th>
<th class="tableblock halign-left valign-top">Instruction</th>
<th class="tableblock halign-left valign-top">shared encoding group</th>
<th class="tableblock halign-left valign-top">Ext Subset</th>
<th class="tableblock halign-left valign-top">RV32</th>
<th class="tableblock halign-left valign-top">RV64</th>
<th class="tableblock halign-left valign-top">RV128</th>
<th class="tableblock halign-left valign-top">Extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.NOP</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ADDI</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.JAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ADDIW (rd=0:RSV)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc64/Zc128</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LI (rd=0:HINT)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ADDI16SP (nzimm=0:RSV)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LUI (nzimm=0: RSV; rd=0:HINT)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SRLI (RV32:NSE, nzuimm[5]=1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc32/Zc64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SRLI64 (RV32:HINT)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc128</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SRAI (RV32:NSE, nzuimm[5]=1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc32/Zc64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SRAI64 (RV32/64:HINT)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc128</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ANDI</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SUB</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.XOR</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.OR</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.AND</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SUBW (RV32:RSV)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc64/Zc128</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ADDW (RV32:RSV)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc64/Zc128</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.J</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">110</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.BEQZ</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.BNEZ</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
</tbody>
</table>
<table id="zce_quad2" class="tableblock frame-all grid-all stretch data-line-248">
<caption class="title">Table 5. C-extension quadrant 2</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Enc[15:13]</th>
<th class="tableblock halign-left valign-top">Instruction</th>
<th class="tableblock halign-left valign-top">shared encoding group</th>
<th class="tableblock halign-left valign-top">Ext Subset</th>
<th class="tableblock halign-left valign-top">RV32</th>
<th class="tableblock halign-left valign-top">RV64</th>
<th class="tableblock halign-left valign-top">RV128</th>
<th class="tableblock halign-left valign-top">Extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SLLI (rd=0:HINT; RV32 &amp;&amp; nzuimm[5]=1:NSE)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc32/Zc64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SLLI64 (RV32/64 or rd=0:HINT)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc128</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.FLDSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LQSP (rd=0:RSV)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc128</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>unallocated</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>??</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LWSP (rd=0:RSV)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.FLWSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+F</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LDSP (rd=0:HINT)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc64/Zc128</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.JR     (rd=0:RSV)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MV   (rd=0:HINT)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.EBREAK</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.JALR</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ADD (rd=0:HINT)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.FSDSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SQSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc128</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.SH</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zceb</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zceb</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.LHU</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zceb</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zceb</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">110</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SWSP</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.FSWSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+F</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SDSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc128</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1 data-line-273">
<h2 id="_allocation_of_new_16_bit_encodings">5. Allocation of new 16-bit encodings</h2>
<div class="sectionbody">
<div class="paragraph data-line-275">
<p>This section gives a short-hand lookup of exactly where the new encodings are allocated to make it easier to review the encoding space. The first column is the group number from <a href="#zce_quad0">Table 3</a>, <a href="#zce_quad1">Table 4</a> and <a href="#zce_quad2">Table 5</a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch data-line-277">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Group</th>
<th class="tableblock halign-left valign-top">[15:13]</th>
<th class="tableblock halign-left valign-top">[12:10]</th>
<th class="tableblock halign-left valign-top">[1:0]</th>
<th class="tableblock halign-left valign-top">Instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP, C.POPRET, C.PUSH, C.POP.E, C.POPRET.E, C.PUSH.E</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SEXT.B, C.SEXT.H, C.ZEXT.B, C.ZEXT.H, C.ZEXT.W, C.NOT, C.NEG, C.MUL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">110</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.TBLJAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.DECBGEZ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1xx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LBU</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SH</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1xx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LHU</p></td>
</tr>
</tbody>
</table>
<div class="sect2 data-line-294">
<h3 id="_16_bit_encoding_code_points">5.1. 16-bit encoding code-points</h3>
<div class="paragraph data-line-296">
<p>All previously reserved 16-bit encodings are in the tables below, showing how many are allocated to <code>Zce</code>.</p>
</div>
<table id="spare16encodings" class="tableblock frame-all grid-all stretch data-line-301">
<caption class="title">Table 6. spare 16-bit encodings for RV32/RV64</caption>
<colgroup>
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5565%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
<th class="tableblock halign-left valign-top">code points</th>
<th class="tableblock halign-left valign-top">sub-extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">xxxx</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">226/256</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zcea</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">xxxx</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">120/256</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zcea</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">xxxx</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">256/256</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zcea</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">xxxx</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0/256</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">1xx</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">xxxx</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0/1024</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="5"><p class="tableblock">xxxxx</p></td>
<td class="tableblock halign-left valign-top" colspan="5"><p class="tableblock">11111</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0/32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">111</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0/128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="6"><p class="tableblock">000000</p></td>
<td class="tableblock halign-left valign-top" colspan="5"><p class="tableblock">non-zero</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0/31</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch data-line-316">
<caption class="title">Table 7. spare 16-bit encodings for RV32 only (mainly out of range shifts)</caption>
<colgroup>
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5565%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
<th class="tableblock halign-left valign-top">code points</th>
<th class="tableblock halign-left valign-top">sub-extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top" colspan="9"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0/512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">111</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0/128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" colspan="5"><p class="tableblock">non-zero</p></td>
<td class="tableblock halign-left valign-top" colspan="5"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0/992</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch data-line-326">
<caption class="title">Table 8. spare 16-bit encodings for RV64 only (ADDIW with zero destination)</caption>
<colgroup>
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5565%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
<th class="tableblock halign-left valign-top">code points</th>
<th class="tableblock halign-left valign-top">sub-extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top" colspan="5"><p class="tableblock">00000</p></td>
<td class="tableblock halign-left valign-top" colspan="5"><p class="tableblock">xxxxx</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0/64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch data-line-334">
<caption class="title">Table 9. spare 16-bit encodings reused from the D-extension</caption>
<colgroup>
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5565%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
<th class="tableblock halign-left valign-top">code points</th>
<th class="tableblock halign-left valign-top">sub-extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top" colspan="11"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2047/2048</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zceb</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top" colspan="11"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2048/2048</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zceb</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top" colspan="11"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0/2048</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top" colspan="11"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2048/2048</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zceb</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-342">
<p>In total in the existing RVC (16-bit) encoding space:</p>
</div>
<div class="olist arabic data-line-344">
<ol class="arabic">
<li class="data-line-344">
<p>RV32C has 3871 code points available, 576 are used (14.9%)</p>
</li>
<li class="data-line-345">
<p>RV64C has 2303 code points available, 576 are used (25.0%)</p>
</li>
<li class="data-line-346">
<p>RV32CD (i.e. the C.FSD,C.FLD, C.FSDSP, C.FLDSP encodings) has 8192 code points available, 6143 are used (75.0%)</p>
</li>
<li class="data-line-348">
<p>if the partially allocated encoding groups from <a href="#spare16encodings">Table 6</a> are fully allocated to Zce the figures become</p>
<div class="olist loweralpha data-line-349">
<ol class="loweralpha" type="a">
<li class="data-line-349">
<p>RV32C has 3871 code points available, 768 are used (19.8%)</p>
</li>
<li class="data-line-350">
<p>RV64C has 2303 code points available, 768 are used (33.3%)</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-352">
<h2 id="_zcea_definition">6. <code>Zcea</code> definition</h2>
<div class="sectionbody">
<div class="sect2 data-line-354">
<h3 id="_c_sext_b_c_sext_h_c_zext_b_c_zext_h_c_zext_w_c_mul_c_not_c_neg">6.1. C.SEXT.B, C.SEXT.H, C.ZEXT.B, C.ZEXT.H, C.ZEXT.W, C.MUL, C.NOT, C.NEG</h3>
<div class="paragraph data-line-356">
<p>These instructions have no conflicts with other extensions, they use previously reserved encodings.</p>
</div>
<div class="paragraph data-line-358">
<p>These instructions are 16-bit versions of existing 32-bit instructions, from either <code>I/E</code> or the <code>Zba/Zbb</code>-extension.</p>
</div>
<table id="dyadic-16encodings" class="tableblock frame-all grid-all stretch data-line-363">
<caption class="title">Table 10. simple instructions 16-bit encodings</caption>
<colgroup>
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8832%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="17"><p class="tableblock">monadic with single source/dest, room for 1 more encoding</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs1'/rd'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ZEXT.B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs1'/rd'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ZEXT.H</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs1'/rd'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ZEXT.W</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs1'/rd'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs1'/rd'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SEXT.B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs1'/rd'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SEXT.H</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs1'/rd'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">110</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.NOT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs1'/rd'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">111</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.NEG</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="17"><p class="tableblock">Dyadic with room for 2 more encodings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs1'/rd'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs2'</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MUL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
</tbody>
</table>
<table id="monsemantics" class="tableblock frame-all grid-all stretch data-line-382">
<caption class="title">Table 11. simple instruction semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ZEXT.B</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = zero_ext(rd'[ 7:0])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ZEXT.H</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = zero_ext(rd'[15:0])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SEXT.B</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = sign_ext(rd'[ 7:0])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SEXT.H</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = sign_ext(rd'[15:0])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.NOT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = ~rd' / rd' = rd' XOR -1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.NEG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = -rd' / rd' = 0 - rd'</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MUL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = rd' * rs2'</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">RV64/RV128 only</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ZEXT.W</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = zero_ext(rd'[31:0])</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note data-line-397">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  The expansion of <code>c.neg</code> puts <code>rd</code> onto <code>rs2</code>, unlike the other expansions which put <code>rd</code> onto <code>rs1</code>, and so requires additional muxing during the expansion
</td>
</tr>
</table>
</div>
<table id="mon-32bit" class="tableblock frame-all grid-all stretch data-line-402">
<caption class="title">Table 12. simple instruction 32-bit equivalent instructions/pseudo-instructions</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">assembly syntax</th>
<th class="tableblock halign-left valign-top">requirements for 16-bit encoding</th>
<th class="tableblock halign-left valign-top">32-bit extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ZEXT.B</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zext.b rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd x8-x15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I or E</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ZEXT.H</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zext.h rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd x8-x15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbb</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SEXT.B</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sext.b rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd x8-x15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbb</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SEXT.H</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sext.h rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd x8-x15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbb</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.NOT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not    rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd x8-x15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I or E</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.NEG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neg    rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd x8-x15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I or E</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MUL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mul    rd, rs1, rs2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd x8-x15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I or E</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">RV64/RV128 only</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ZEXT.W</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zext.h rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd x8-x15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zba</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-416">
<p>Assembly Examples</p>
</div>
<div class="listingblock data-line-419">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">zext.b a5;  # a5 = zero_ext(a5[7:0])
zext.h a5;  # a5 = zero_ext(a5[15:0])
sext.b a5;  # a5 = sign_ext(a5[7:0])
sext.h a5;  # a5 = sign_ext(a5[15:0])

not a5          # a5 = ~a5 bitwise inversion
neg a5          # a5 = -a5 two's complement inversion

mul a5, a5, a6; # a5 = a5 * a6</code></pre>
</div>
</div>
</div>
<div class="sect2 data-line-432">
<h3 id="_c_sext_w">6.2. C.SEXT.W</h3>
<div class="paragraph data-line-434">
<p><code>C.SEXT.W</code> is added as a pseudo-instruction for <code>C.ADDIW rd, rd, 0</code></p>
</div>
</div>
<div class="sect2 data-line-436">
<h3 id="_muli_muliadd_addiadd_muliw_muliaddw_addiaddw">6.3. MULI, MULIADD, ADDIADD, MULIW, MULIADDW, ADDIADDW</h3>
<div class="paragraph data-line-438">
<p>These instructions have no conflicts with other extensions, they use previously reserved encodings.</p>
</div>
<div class="paragraph data-line-440">
<p>See <a href="https://github.com/clairexen/riscv-fanfic/blob/master/riscv-cfmt/riscv-cfmt.md">Clare&#8217;s proposal from the B-extension</a>.
Also see <a href="https://github.com/riscv/riscv-code-size-reduction/blob/master/existing_extensions/Huawei%20Custom%20Extension/riscv_muladd_extension.rst">this document</a>, which is implemented on silicon.</p>
</div>
<table class="tableblock frame-all grid-all stretch data-line-446">
<caption class="title">Table 13. arithmetic instructions 32-bit encodings</caption>
<colgroup>
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6676%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">31:27</th>
<th class="tableblock halign-left valign-top">26</th>
<th class="tableblock halign-left valign-top">25</th>
<th class="tableblock halign-left valign-top">24</th>
<th class="tableblock halign-left valign-top">23</th>
<th class="tableblock halign-left valign-top">22</th>
<th class="tableblock halign-left valign-top">21:20</th>
<th class="tableblock halign-left valign-top">19:18</th>
<th class="tableblock halign-left valign-top">17:16</th>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14:12</th>
<th class="tableblock halign-left valign-top">11:10</th>
<th class="tableblock halign-left valign-top">9:7</th>
<th class="tableblock halign-left valign-top">6 : 0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="15"><p class="tableblock">C2-type from Claire&#8217;s proposal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="7"><p class="tableblock">imm[11:0]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rs1'</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">11100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0011011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="7"><p class="tableblock">imm[11:0]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rs1'</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">11100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0011011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULIW</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="15"><p class="tableblock">C3-type from Claire&#8217;s proposal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="5"><p class="tableblock">imm[8:0]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rs2'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rs1'</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">11100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0011111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULIADD</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="5"><p class="tableblock">imm[8:0]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rs2'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rs1'</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">11100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0011111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULIADDW</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="5"><p class="tableblock">imm[8:0]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rs2'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rs1'</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">11101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0011111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADDIADD</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="5"><p class="tableblock">imm[8:0]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rs2'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rs1'</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">11101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0011111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADDIADDW</p></td>
</tr>
</tbody>
</table>
<table id="arithmetic_semantics" class="tableblock frame-all grid-all stretch data-line-461">
<caption class="title">Table 14. Arithmetic semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = rs1' * sign_ext(imm)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULIADD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = rs1' + rs2' * sign_ext(imm)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADDIADD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = rs1' + rs2' + sign_ext(imm)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">RV64/RV128 only</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULIW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = sign_ext(rs1'[31:0] * sign_ext(imm))</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULIADDW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = sign_ext(rs1'[31:0] + rs2' * sign_ext(imm))</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADDIADDW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = sign_ext(rs1'[31:0] + rs2' + sign_ext(imm))</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-472">
<p>Assembly Examples</p>
</div>
<div class="listingblock data-line-475">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">muli     a0, a1, 2     # a0 = a1 * 2
muliadd  a0, a1, a2, 2 # a0 = a1 + a2 * 2
addiadd  a0, a1, a2, 2 # a0 = a1 + a2 + 2
muliw    a0, a1, 2     # a0 = sign_ext(a1 * 2)
muliaddw a0, a1, 2     # a0 = sign_ext(a1 + a2 * 2)
addiaddw a0, a1, 2     # a0 = sign_ext(a1 + a2 + 2)</code></pre>
</div>
</div>
</div>
<div class="sect2 data-line-486">
<h3 id="cmpimmbr">6.4. BEQI, BNEI</h3>
<div class="admonitionblock note data-line-490">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  These encodings are in custom-0 space pending allocation
</td>
</tr>
</table>
</div>
<div class="admonitionblock note data-line-494">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  These encodings could go in the <code>BRANCH</code> major opcode, with <code>funct3=01x</code>, if not otherwise allocated?
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-496">
<p>The encodings allow a comparison of a register and an immediate value. <code>BEQI</code> in particular is very useful for <em>switch</em> statements.</p>
</div>
<table class="tableblock frame-all grid-all stretch data-line-501">
<caption class="title">Table 15. proposed 32-bit encodings for <code>BEQI/BNEI</code></caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">31:30</th>
<th class="tableblock halign-left valign-top">29:24</th>
<th class="tableblock halign-left valign-top">23:20</th>
<th class="tableblock halign-left valign-top">19:15</th>
<th class="tableblock halign-left valign-top">14:12</th>
<th class="tableblock halign-left valign-top">11:7</th>
<th class="tableblock halign-left valign-top">6 : 0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">scmpimm[5:0]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">offset[9:6]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">offset[5:1]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0001011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BEQI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">scmpimm[5:0]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">offset[9:6]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">offset[5:1]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0001011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BNEI</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch data-line-510">
<caption class="title">Table 16. Compare immediate branch semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BEQI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if (rs1==sign_ext(scmpimm)) target_pc=PC+offset; else target_pc=PC+4;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BNEI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if (rs1!=sign_ext(scmpimm)) target_pc=PC+offset; else target_pc=PC+4;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-516">
<p>Assembly Examples</p>
</div>
<div class="listingblock data-line-519">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">beq  a5, 1,offset # if(a5== 1) branch_to(PC+offset) # signed comparison
bne  a5,-1,offset # if(a5!=-1) branch_to(PC+offset) # signed comparison</code></pre>
</div>
</div>
</div>
<div class="sect2 data-line-524">
<h3 id="_table_jump">6.5. Table Jump</h3>
<div class="paragraph data-line-526">
<p>The specification is in <a href="#tablejump">Section 8</a>.</p>
</div>
<div class="sect3 data-line-529">
<h4 id="tablejump16">6.5.1. C.TBLJAL</h4>
<div class="paragraph data-line-531">
<p>The 16-bit encoding is in <a href="#tbljal16bitencoding">Table 28</a>.</p>
</div>
</div>
<div class="sect3 data-line-534">
<h4 id="tablejump32">6.5.2. TBLJAL</h4>
<div class="paragraph data-line-536">
<p>The 32-bit encoding is in <a href="#tbljal32bitencoding">Table 29</a>.</p>
</div>
</div>
</div>
<div class="sect2 data-line-539">
<h3 id="pushpoppopret_heading">6.6. PUSH and POP</h3>
<div class="paragraph data-line-541">
<p>See <a href="#pushpoppopret">Section 9</a> for the specification.</p>
</div>
<div class="sect3 data-line-544">
<h4 id="pushpop32">6.6.1. PUSH, POP, POPRET, PUSH.E, POP.E, POPRET.E</h4>
<div class="paragraph data-line-546">
<p>See <a href="#pushpoppopret32bitencodings">Section 9.6</a> for the encodings.</p>
</div>
</div>
<div class="sect3 data-line-549">
<h4 id="pushpop16">6.6.2. C.PUSH, C.POP, C.POPRET, C.PUSH.E, C.POP.E, C.POPRET.E</h4>
<div class="paragraph data-line-551">
<p>See <a href="#proposed-16bit-encodingsI-1">Table 41</a> for the encodings.</p>
</div>
</div>
</div>
<div class="sect2 data-line-554">
<h3 id="_b_extension_reuse">6.7. B-extension reuse</h3>
<div class="paragraph data-line-556">
<p>Some instructions will be reused from the B-extension and are implied by <code>Zce</code>.</p>
</div>
<div class="sect3 data-line-558">
<h4 id="_zba_zbb_required">6.7.1. Zba, Zbb required</h4>
<div class="paragraph data-line-560">
<p><code>Zba</code> is require for the 32-bit encoding for <code>c.zext.w</code>. The <code>sh[123]add</code> instructions are also useful for code-size reduction, as they are used for address calculations.</p>
</div>
<div class="paragraph data-line-562">
<p><code>Zbb</code> is required for 32-bit encodings for <code>c.sext.b, c.sext.h, c.zext.b, c.zext.h</code>. It is simpler to take the whole <code>Zbb</code> subset as it also contains useful instructions like rotate (<code>rori, ror, rol</code>), byte reverse (<code>rev8</code>) and count-leading-zeroes (<code>clz</code>).</p>
</div>
<div class="admonitionblock note data-line-566">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  <code>Zbp</code> is <strong>not</strong> implied by <code>Zce</code> as instructions like <code>grev[i]</code> and <code>shfl[i]</code> seem too heavyweight for small embedded cores.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-569">
<h2 id="_zceb_definition">7. <code>Zceb</code> definition</h2>
<div class="sectionbody">
<div class="paragraph data-line-571">
<p>The D-extension takes priority over these encodings.</p>
</div>
<table class="tableblock frame-all grid-all stretch data-line-576">
<caption class="title">Table 17. proposed 32-bit formats</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1112%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">31:29</th>
<th class="tableblock halign-left valign-top">28:25</th>
<th class="tableblock halign-left valign-top">24:20</th>
<th class="tableblock halign-left valign-top">19:18</th>
<th class="tableblock halign-left valign-top">17:15</th>
<th class="tableblock halign-left valign-top">14:12</th>
<th class="tableblock halign-left valign-top">11:7</th>
<th class="tableblock halign-left valign-top">6 : 0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="9"><p class="tableblock">These formats are designed for maximum overlap immediate with I-type and S-type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">funct3a</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">imm[8:2,10:9]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">imm[15:11]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">funct3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opcode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LW16-type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">funct3a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[8:5]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rs2</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">imm[15:11]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">funct3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[4:2, 10:9]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opcode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW16-type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">funct3a</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">imm[8:3,16,10:9]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">imm[15:11]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">funct3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opcode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LD16-type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">funct3a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[8:5]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rs2</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">imm[15:11]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">funct3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[4:3,16,10:9]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opcode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SD16-type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="9"><p class="tableblock">This format is only for DECBGEZ, designed for maximum immediate overlap with B-type and LW16-type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">funct3a</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">imm[8:2,10:9]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">scale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[1,12:11]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">funct3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opcode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DECB-type</p></td>
</tr>
</tbody>
</table>
<div class="sect2 data-line-587">
<h3 id="_decrement_and_branch">7.1. Decrement and branch</h3>
<div class="sect3 data-line-590">
<h4 id="decbr16">7.1.1. C.DECBGEZ</h4>
<div class="paragraph data-line-592">
<p>This instruction conflicts with the <code>D</code>-extension. If <code>D</code> is implemented, this instruction will not be available. It is compatible with <code>ZDinx</code>.</p>
</div>
<div class="paragraph data-line-594">
<p>This instruction is a combined decrement and branch, used for inferring loops with an optionally scaled loop counter.</p>
</div>
<div class="admonitionblock note data-line-598">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  The 16 and 32-bit forms of this instruction need a new relocation type in the toolchain.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note data-line-602">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  The 32-bit encoding has a signed offset. The 16-bit encoding has an unsigned offset, but it can only represent a backwards jump.
  Therefore to be legal syntax for the 16-bit encoding the offset is specified as a negative number but encoded as a positive offset.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note data-line-607">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  The encoding is reserved if the offset is zero.
</td>
</tr>
</table>
</div>
<table id="proposed-16bit-encodings-dec_br" class="tableblock frame-all grid-all stretch data-line-612">
<caption class="title">Table 18. proposed 16-bit encodings for dec-and-branch</caption>
<colgroup>
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8832%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">nzimm[6:4]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">nzimm[3:1]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">scale</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.DECBGEZ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">scale</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
</tbody>
</table>
<table id="deccmpbrsemantics" class="tableblock frame-all grid-all stretch data-line-621">
<caption class="title">Table 19. decrement, compare and branch semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.DECBGEZ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = rd' - (1&lt;&lt;scale); bge rd', zero, -zero_ext(nzimm);</p></td>
</tr>
</tbody>
</table>
<table id="v1" class="tableblock frame-all grid-all stretch 0-32bit data-line-629">
<caption class="title">Table 20. 32-bit equivalent instructions for decrement, compare and branch semantics</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">assembly syntax</th>
<th class="tableblock halign-left valign-top">requirements for 16-bit encoding</th>
<th class="tableblock halign-left valign-top">32-bit extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.DECBGEZ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">decbgez, rd, imm, -offset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd is x8-x15, imm is [1248], offset is in range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcec</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-634">
<p>Assembly Example</p>
</div>
<div class="listingblock data-line-636">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">decbgez s2, 1, -4 ;# s2-=1;if(s2&gt;=0) branch_to(PC-4) encoded as scale=0, uimm=4 (not uimm=-4)</code></pre>
</div>
</div>
</div>
<div class="sect3 data-line-640">
<h4 id="_decbgez">7.1.2. DECBGEZ</h4>
<div class="paragraph data-line-642">
<p>This instruction conflicts with the <code>D</code>-extension. If <code>D</code> is implemented, this instruction will not be available. It is compatible with <code>ZDinx</code>. It uses a DECB-type encoding.</p>
</div>
<div class="paragraph data-line-644">
<p>The 16-bit encoding and specification is in <a href="#decbr16">Section 7.1.1</a>.</p>
</div>
<div class="admonitionblock note data-line-648">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  The 16 and 32-bit forms of this instruction need a new relocation type in the toolchain.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch data-line-653">
<caption class="title">Table 21. proposed 32-bit encoding <code>DECBGEZ</code></caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1112%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">31:29</th>
<th class="tableblock halign-left valign-top">28:25</th>
<th class="tableblock halign-left valign-top">24:20</th>
<th class="tableblock halign-left valign-top">19:18</th>
<th class="tableblock halign-left valign-top">17:15</th>
<th class="tableblock halign-left valign-top">14:12</th>
<th class="tableblock halign-left valign-top">11:7</th>
<th class="tableblock halign-left valign-top">6 : 0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">imm[8:2,10:9]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">scale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[1,12:11]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0000111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DECBGEZ</p></td>
</tr>
</tbody>
</table>
<table id="decbgezsemantics32" class="tableblock frame-all grid-all stretch data-line-661">
<caption class="title">Table 22. decrement, compare and branch 32-bit semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DECBGEZ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd = rd - (1&lt;&lt;scale); bge rd, zero, sign_ext(imm);</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-666">
<p>Assembly Example</p>
</div>
<div class="listingblock data-line-668">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">decbgez s2, 1, offset ;# s2-=1;if(s2&gt;=0) branch_to(PC+offset)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-673">
<h3 id="_lwgp_swgp_lwtp_swtp">7.2. LWGP, SWGP, LWTP, SWTP</h3>
<div class="paragraph data-line-675">
<p>These instructions conflict with the <code>D</code>-extension. If <code>D</code> is implemented, these instruction will not be available. They are compatible with <code>ZDinx</code>.</p>
</div>
<div class="paragraph data-line-677">
<p>These instructions reuse the encodings for <code>FLD/FSD</code>.</p>
</div>
<div class="paragraph data-line-679">
<p><code>LWGP,SWGP</code> give a larger offset range than the standard <code>LW, SW</code> instructions by making the base register explicitly <code>gp</code>, allowing a 16-bit/64KB range of word aligned offsets, instead of a 12-bit/4KB range of byte aligned offsets.</p>
</div>
<div class="paragraph data-line-681">
<p><code>LDGP,SDGP</code> require double word alignment, and so have an increased range of 17-bit/128KB offsets relative to <code>gp</code>.</p>
</div>
<div class="admonitionblock note data-line-685">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
   Restrictions in the GCC toolchain mean that the full range of <code>gp</code> cannot be used for the standard <code>LW/SW</code> instructions, in case linker relaxation means that the <code>gp</code> relative addresses moves out of range. This will still be the case with <code>LWGP, SWGP</code> but the range is so much larger that the impact will be minimal. <a href="https://github.com/riscv/riscv-gnu-toolchain/issues/497">See this github issue</a>. This issue means that with the current RISC-V ISA the full 4KB range cannot be accessed using <code>gp</code> using GCC so the benefit is lower than might be expected.
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-687">
<p><code>LWTP,SWTP</code> give an 16-bit/128KB offset range, which is larger than the standard <code>LW, SW</code> instructions by making the base register explicitly <code>tp</code>. <code>LDTP,SDTP</code> have a 17-bit/128KB range relative to <code>tp</code>.</p>
</div>
<div class="admonitionblock note data-line-692">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  The intention is to allow the toolchain to use <code>tp</code> as a second global pointer, for systems which do not need thread local storage, giving two 256KB address spaces within reach of a single 32-bit load/store word instruction. Any ABI or toolchain implications from allowing this are not covered by this document. <code>LWTP, SWTP</code> can also be used to allow a larger range of thread local storage to be accessed with a 32-bit instruction.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch data-line-697">
<caption class="title">Table 23. proposed 32-bit encodings for <code>LWGP/SWGP/LWTP/SWTP</code> and <code>LDGP/SDGP/LDTP/SDTP</code></caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">31:29</th>
<th class="tableblock halign-left valign-top">28:25</th>
<th class="tableblock halign-left valign-top">24:20</th>
<th class="tableblock halign-left valign-top">19:15</th>
<th class="tableblock halign-left valign-top">14:12</th>
<th class="tableblock halign-left valign-top">11:7</th>
<th class="tableblock halign-left valign-top">6 : 0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">imm[8:2,10:9]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[15:11]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0000111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LWGP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">imm[8:2,10:9]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[15:11]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0000111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LWTP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[8:5]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rs2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[15:11]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[4:2, 10:9]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0100111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWGP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[8:5]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rs2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[15:11]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[4:2, 10:9]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0100111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWTP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">RV64/RV128 only</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">imm[8:3,16,10:9]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[15:11]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0000111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDGP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">imm[8:3,16,10:9]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[15:11]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0000111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDTP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[8:5]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rs2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[15:11]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[4:3,16,10:9]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0100111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SDGP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[8:5]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rs2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[15:11]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[4:3,16,10:9]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0100111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SDTP</p></td>
</tr>
</tbody>
</table>
<table id="lwgp_semantics" class="tableblock frame-all grid-all stretch data-line-713">
<caption class="title">Table 24. Load/store word/double GP/TP relative semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LWGP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd=sign_ext(Memory[gp+sign_ext(imm)][31:0]);</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWGP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Memory[gp+sign_ext(imm)][31:0])=rs2[31:0];</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LWTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd=sign_ext(Memory[tp+sign_ext(imm)][31:0]);</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Memory[tp+sign_ext(imm)][31:0])=rs2[31:0];</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">RV64/RV128 only</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDGP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd=sign_ext(Memory[gp+sign_ext(imm)][63:0]);</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SDGP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Memory[gp+sign_ext(imm)][63:0])=rs2[63:0];</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd=sign_ext(Memory[tp+sign_ext(imm)][63:0]);</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SDTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Memory[tp+sign_ext(imm)][63:0])=rs2[63:0];</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-726">
<p>Assembly Examples</p>
</div>
<div class="listingblock data-line-728">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">lw s0, 20(gp)
sw s0, 20(gp)
lw s0, 20(tp)
sw s0, 20(tp)

//RV64/RV128 only
ld s0, 20(gp)
sd s0, 20(gp)
ld s0, 20(tp)
sd s0, 20(tp)</code></pre>
</div>
</div>
</div>
<div class="sect2 data-line-741">
<h3 id="_c_lbu_c_lhu_c_sb_c_sh">7.3. C.LBU, C.LHU, C.SB, C.SH</h3>
<div class="paragraph data-line-743">
<p>These instructions conflict with the <code>D</code>-extension. If <code>D</code> is implemented, these instruction will not be available. They are compatible with <code>ZDinx</code>.</p>
</div>
<div class="paragraph data-line-745">
<p>These instructions reuse the encodings for <code>FLD/FSD</code>.</p>
</div>
<table id="ldstbh" class="tableblock frame-all grid-all stretch data-line-750">
<caption class="title">Table 25. proposed 16-bit encodings for load/store byte/half</caption>
<colgroup>
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8832%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">uimm[0,3]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs1'</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">uimm[2:1]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs2'</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">uimm[0,3]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs1'</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">uimm[2:1]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs2'</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LBU</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">uimm[4:3]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs1'</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">uimm[2:1]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs2'</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SH</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">uimm[4:3]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs1'</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">uimm[2:1]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs2'</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LHU</p></td>
</tr>
</tbody>
</table>
<table id="ldstbhsemantics" class="tableblock frame-all grid-all stretch data-line-761">
<caption class="title">Table 26. Load/store byte/half semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LBU</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = zero_ext(Memory[rs1'+zero_ext(uimm)][ 7:0])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LHU</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = zero_ext(Memory[rs1'+zero_ext(uimm)][15:0])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = Memory[rs1'+zero_ext(uimm)][ 7:0] = rs2'[ 7:0]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = Memory[rs1'+zero_ext(uimm)][15:0] = rs2'[15:0]</p></td>
</tr>
</tbody>
</table>
<table id="ldstbh-32bit" class="tableblock frame-all grid-all stretch data-line-772">
<caption class="title">Table 27. Load/store byte-half 32-bit equivalent instructions with a direct equivalent</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">assembly syntax</th>
<th class="tableblock halign-left valign-top">requirements for 16-bit encoding</th>
<th class="tableblock halign-left valign-top">32-bit extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LBU</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lbu    rd, imm(rs1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all regs x8-x15, imm in range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-extension</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LHU</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lhu    rd, imm(rs1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all regs x8-x15, imm in range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-extension</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sb     rd, imm(rs1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all regs x8-x15, imm in range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-extension</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sh     rd, imm(rs1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all regs x8-x15, imm in range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-extension</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-780">
<p>Assembly Examples</p>
</div>
<div class="listingblock data-line-782">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">lbu a5,20(a4)   # a5 = zero_ext(Memory(a4+20)[ 7:0])
lhu a5,20(a4)   # a5 = zero_ext(Memory(a4+20)[15:0])
sb  a5,20(a4)   # Memory(a4+20)[ 7:0] = a5[ 7:0]
sh  a5,20(a4)   # Memory(a4+20)[15:0] = a5[15:0]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-790">
<h2 id="tablejump">8. Table Jump</h2>
<div class="sectionbody">
<div class="paragraph data-line-792">
<p>Table jumps are used to reduce the code size of <code>JAL</code> / <code>JALR</code> instructions.</p>
</div>
<div class="sect2 data-line-794">
<h3 id="_rationale">8.1. Rationale</h3>
<div class="paragraph data-line-796">
<p>Function calls and jumps to fixed labels typically take 32-bit or 64-bit instruction sequences.
Here&#8217;s an example from the Huawei IoT code, GCC output:</p>
</div>
<div class="listingblock data-line-800">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">00e084be &lt;vsprintf&gt;:
  #64-bit AUIPC/JALR sequence
  e084be:	001f8317            auipc t1,0x1f8
  e084c2:	18a302e7            jalr  t0,394(t1) # 1000648 &lt;__riscv_save_0&gt;

  e084c6:	86b2                mv    a3,a2
  e084c8:	862e                mv    a2,a1
  e084ca:	800005b7            lui	  a1,0x80000
  e084ce:	fff5c593            not	  a1,a1

  #32-bit JAL
  e084d2:	f61ff0ef            jal	  ra,e08432 &lt;vsnprintf&gt; # vsnprintf

  #64-bit AUIPC/JALR sequence
  e084d6:	001f8317            auipc	t1,0x1f8
  e084da:	19630067            jr	  406(t1) # 100066c &lt;__riscv_restore_0&gt;</code></pre>
</div>
</div>
<div class="paragraph data-line-819">
<p>using <code>C.TBLJAL</code> we can reduce this as follows (accepting gaps in the PCs as code has been deleted)</p>
</div>
<div class="listingblock data-line-822">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">00e084be &lt;vsprintf&gt;:
  e084be:	xxxx                tbljal #x ;#&lt;mapped to __riscv_save_0&gt;, saving 6-bytes

  e084c6:	86b2                mv     a3,a2
  e084c8:	862e                mv     a2,a1
  e084ca:	800005b7            lui	   a1,0x80000
  e084ce:	fff5c593            not	   a1,a1

  e084d2:	xxxx                tbljal #y ;#&lt;mapped to vsnprintf&gt;, saving 2-bytes (8-byte refs to this fn also exist)

  e084da:	xxxx                tbljal #z ;#&lt;mapped to __riscv_restore_0&gt;</code></pre>
</div>
</div>
<div class="paragraph data-line-836">
<p>The principle is to have a single lookup table of <code>TBLJALENTRIES</code> addresses for <code>[C.]TBLJAL</code>, which is built by the linker. The linker then substitutes the code as shown in the example above where the 32-byte function is reduced to 18-bytes giving ~ 56% saving. Clearly the lookup table takes some space, but this is a minimal overhead for repeated functions such as the save/restore routines.</p>
</div>
<div class="paragraph data-line-838">
<p><code>TBLJALENTRIES</code> is set by the maximum size of the table, which is currently 8192 as the 32-bit encoding has an 13-bit index.</p>
</div>
<div class="paragraph data-line-840">
<p>Table jump allows the linker to:</p>
</div>
<div class="ulist data-line-842">
<ul>
<li class="data-line-842">
<p>replace 32-bit <code>JAL</code> calls with 16-bit <code>C.TBLJAL</code></p>
</li>
<li class="data-line-843">
<p>replace 64-bit <code>AUIPC/JALR</code> calls to fixed locations with either a 16-bit <code>C.TBLJAL</code> or a 32-bit <code>TBLJAL</code></p>
<div class="ulist data-line-844">
<ul>
<li class="data-line-844">
<p><code>[C.]TBLJAL</code> can be used replace <code>JALR</code> if it jumps to a fixed target, which is typically inferred as an <code>AUIPC/JALR</code> sequence because the offset from the PC is out of the ±1MB range.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note data-line-848">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
   RV64 does not have <code>C.JAL</code> so <code>C.TBLJAL</code> is even more valuable
</td>
</tr>
</table>
</div>
<div class="admonitionblock note data-line-852">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  The 32-bit encoding allows more functions to be called, but saves less code size, so the most common functions should be callable by the 16-bit encoding
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-854">
<p>The 32-bit instruction encoding will ensure that 64-bit sequences <code>AUIPC/JALR</code> are unlikely to ever be needed to call functions, unless the jump table is full.</p>
</div>
</div>
<div class="sect2 data-line-856">
<h3 id="_encoding">8.2. Encoding</h3>
<div class="paragraph data-line-858">
<p>These instructions have no conflicts with other extensions, they use previously reserved encodings.</p>
</div>
<table id="tbljal16bitencoding" class="tableblock frame-all grid-all stretch data-line-863">
<caption class="title">Table 28. C.TBLJAL 16-bit encoding</caption>
<colgroup>
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8832%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">index8</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.TBLJAL</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note data-line-870">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  This encoding is in <em>custom-01</em>, correct encodings need to be allocated.
</td>
</tr>
</table>
</div>
<table id="tbljal32bitencoding" class="tableblock frame-all grid-all stretch data-line-875">
<caption class="title">Table 29. TBLJAL 32-bit encoding, ZCE-type encoding</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">31:23</th>
<th class="tableblock halign-left valign-top">22:15</th>
<th class="tableblock halign-left valign-top">14:12</th>
<th class="tableblock halign-left valign-top">11:7</th>
<th class="tableblock halign-left valign-top">6 : 0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">00000000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">index13[12:5]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">index13[4:0]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0101011</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2 data-line-880">
<h3 id="_csrs">8.3. CSRs</h3>
<div class="paragraph data-line-882">
<p>The following set of CSRs is required to control the jump table.</p>
</div>
<div class="admonitionblock note data-line-886">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  The addresses are for custom CSRs, correct CSR addresses need to be specified.
</td>
</tr>
</table>
</div>
<table id="xTBLJALVEC-table" class="tableblock frame-all grid-all stretch data-line-891">
<caption class="title">Table 30. <code>xTBLJALVEC</code> definition</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">XLEN-1:6</th>
<th class="tableblock halign-left valign-top">5:2</th>
<th class="tableblock halign-left valign-top">1: 0</th>
<th class="tableblock halign-left valign-top">CSR</th>
<th class="tableblock halign-left valign-top">Permissions</th>
<th class="tableblock halign-left valign-top">Status</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7c0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">base[XLEN-1:6]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">scale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MTBLJALVEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required if jump table mode is implemented</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xbc0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">base[XLEN-1:6]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">scale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STBLJALVEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required if S-mode is implemented</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x800</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">base[XLEN-1:6]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">scale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UTBLJALVEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
<div class="ulist data-line-898">
<ul>
<li class="data-line-898">
<p>M-mode always uses <code>MTBLJALVEC.base</code></p>
</li>
<li class="data-line-899">
<p>S-mode always uses <code>STBLJALVEC.base</code></p>
</li>
<li class="data-line-900">
<p>U-mode uses <code>UTBLJALVEC.base</code> if implemented, otherwise <code>STBLJALVEC.base</code> if implemented, otherwise <code>MTBLJALVEC.base</code></p>
</li>
</ul>
</div>
<div class="paragraph data-line-902">
<p><code>xTBLJALVEC.base</code> is a virtual address, whenever virtual memory is enabled (i.e. S and U-modes only if implemented and enabled).</p>
</div>
<div class="paragraph data-line-904">
<p>Using <code>xTBLJALVEC.base</code> in the pseudo code below implicitly assumes that <code>xTBLJALVEC.base[5:0]=0</code>. This is consistent with the description of <code>xTVEC</code> in the Unprivileged ISA manual.</p>
</div>
<div class="paragraph data-line-906">
<p><code>xTBLJALVEC.base</code> is naturally aligned for all legal values of <code>XLEN</code>.</p>
</div>
<div class="paragraph data-line-908">
<p>The memory pointed to by <code>xTBLJALVEC.base</code> only requires eXecute permission. Read/Write access is not required once the jump table/vector table has been configured.</p>
</div>
<table id="xTBLJALVEC-mode-table" class="tableblock frame-all grid-all stretch data-line-913">
<caption class="title">Table 31. <code>xTBLJALVEC.mode</code> definition</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Mode</th>
<th class="tableblock halign-left valign-top">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jump table mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved for <a href="#vector-table-mode">Section 8.5</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved for <a href="#emulation-mode">Section 8.6</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-921">
<p><code>xTBLJALVEC.mode</code> is a WARL field, so can only be programmed to modes which are implemented. Therefore the discovery mechanism is to attempt to program different modes and read back the values to see which are available. Jump table mode <em>must</em> be implemented.</p>
</div>
<div class="paragraph data-line-923">
<p><code>xTBLJALVEC.scale</code> is also WARL, and reads as zero. It is reserved for Vector Table Mode, see <a href="#vector-table-mode">Section 8.5</a>.</p>
</div>
</div>
<div class="sect2 data-line-925">
<h3 id="_jump_table_mode">8.4. Jump table mode</h3>
<div class="paragraph data-line-927">
<p>In jump table mode the behaviour is to load the target address from <code>xTBLJALVEC.base</code> with an offset which is <code>XLEN/8</code> times the parameter passed to the instruction. Bits [1:0] of the data at the target address represent which link register is in use, and whether the entry is legal. Therefore the target functions must be word aligned in memory.</p>
</div>
<div class="paragraph data-line-929">
<p>The actual functions are not moved in memory, the jump table lookup is only to give a reference to them using a 16-bit encoding whenever possible.</p>
</div>
<div class="paragraph data-line-931">
<p>Jump table mode is easy to implement in the linker and doesn&#8217;t affect the compiler at all as it is only a link time optimisation. It may complicate instruction fetch due to the indirection, and so may cost performance. The instruction fetch unit can choose to cache the table.</p>
</div>
<table id="entry-lsbs" class="tableblock frame-all grid-all stretch data-line-936">
<caption class="title">Table 32. bits [1:0] of each jump table entry</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Link Register</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">link to x0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">link to x1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">link to x5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved / table entry is illegal</strong></p></td>
</tr>
</tbody>
</table>
<div class="sect3 data-line-944">
<h4 id="_pseudo_code_for_jump_table_mode">8.4.1. Pseudo-code for jump table mode</h4>
<div class="listingblock data-line-947">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode"># tmp is temporary internal state, it doesn't represent a real register
# Mem is byte indexed
# n is the immediate operand passed to [c.]tbljal
switch(XLEN) {
  32:  LW tmp, Mem[xTBLJALVEC.base + n&lt;&lt;2][XLEN-1:0];
  64:  LD tmp, Mem[xTBLJALVEC.base + n&lt;&lt;3][XLEN-1:0];
  128: LQ tmp, Mem[xTBLJALVEC.base + n&lt;&lt;4][XLEN-1:0];
}
switch(tmp[1:0]) {
  0: JALR x0, tmp[XLEN-1:2]&lt;&lt;2;
  1: JALR x1, tmp[XLEN-1:2]&lt;&lt;2;
  2: JALR x5, tmp[XLEN-1:2]&lt;&lt;2;
  #MEPC is the PC of the [c.]tbljal, not tmp
  3: take_illegal_instruction_exception();
}</code></pre>
</div>
</div>
<div class="paragraph data-line-965">
<p>For the <code>vsprintf</code> example above, the jump table contains the following:</p>
</div>
<div class="listingblock data-line-968">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">xTBLJALVEC.base+ 0(index 0) = # 100066c &lt;__riscv_restore_0&gt; # requires JAL x0 so [1:0]=00
xTBLJALVEC.base+ 8(index 1) = # 100064a &lt;__riscv_save_0&gt;    # requires JAL x5 so [1:0]=10
xTBLJALVEC.base+12(index 2) = #  e08433 &lt;vsnprintf&gt;         # requires JAL x1 so [1:0]=01</code></pre>
</div>
</div>
</div>
<div class="sect3 data-line-974">
<h4 id="_exceptions_for_jump_table_mode">8.4.2. Exceptions for jump table mode</h4>
<div class="paragraph data-line-976">
<p>The only illegal instruction exception is if the jump table LSBs are set to <code>11</code>. If this happens <code>MEPC</code> is set to the PC of the <code>[c.]tbljal</code> instruction.</p>
</div>
</div>
<div class="sect3 data-line-978">
<h4 id="_context_switching_for_jump_table_mode">8.4.3. Context Switching for jump table mode</h4>
<div class="paragraph data-line-980">
<p>The <code>xTBLJALVEC</code> CSRs form part of the current context, and so will need to be saved and restored. It is also possible for the jump table to have a single configuration for all contexts, but in general <code>xTBLJALVEC</code> is considered part of the context.</p>
</div>
</div>
<div class="sect3 data-line-982">
<h4 id="_caching_for_jump_table_mode">8.4.4. Caching for jump table mode</h4>
<div class="paragraph data-line-984">
<p>For improved performance, the implementation may cache the contents of the jump table. To assist this and avoid unnecessary memory fetches, we state that the table contents may be cached without consistency checks against memory outside the hart if <code>xTBLJALVEC</code> has not been written to.</p>
</div>
<div class="paragraph data-line-986">
<p>Any write to <code>xTBLJALVEC</code>, even if the actual value is not updated, will indicate that any table caching must be flushed and refetched.</p>
</div>
<div class="paragraph data-line-988">
<p>Therefore if there are any updates to generated code in the table in vector mode, a write to <code>xTBLJALVEC</code> is required to ensure that any cached contents are not stale. This is not expected to be the common case, because in the absence of dynamically linked libraries, the jump table is static for a given executable. Therefore the recommendation is that it is set with eXecute only privileges, the same as the rest of the code. This is better for security to prevent code in the jump table being scanned for gadgets.</p>
</div>
</div>
<div class="sect3 data-line-990">
<h4 id="_powerperformance_of_jump_table_mode">8.4.5. Power/performance of jump table mode</h4>
<div class="paragraph data-line-992">
<p>The instruction fetch unit could cache the most frequently accessed table jump targets to improve performance. The management of this caching will cost some power (although the ~ 10% code size saving should save power overall by reducing the number of instruction fetches).</p>
</div>
<div class="paragraph data-line-994">
<p>An alternative approach is to for the instruction fetch to cache a certain range of table jump indices, e.g. 0-31. The linker could be configured to place the most frequently used table jump indices into this range so that static caching can be used. For this to be successful the linker would need information about the dynamic call frequency of each function call.</p>
</div>
</div>
</div>
<div class="sect2 data-line-997">
<h3 id="vector-table-mode">8.5. Future Mode: Vector table mode (not for RVM22/RVA22)</h3>
<div class="paragraph data-line-999">
<p>Vector table mode is very similar to vectored interrupt handling. The target address is a scaled offset from the base vector. Therefore in vector table mode, execution passes directly to the scaled offset from the base register, not via a jump table.</p>
</div>
<div class="paragraph data-line-1001">
<p>Vector table mode is simplest for the hardware, as it&#8217;s just the same mechanism as for the interrupt handler vector. The jump is direct to the destination. However the compiler would have to be aware as it will have to try to fit functions into the table, as each entry is a fixed size so it&#8217;s not so obviously implementable in the toolchain. We may find other reasons for having this mode. TBD.</p>
</div>
<div class="paragraph data-line-1003">
<p><code>xTBLJALVEC.scale</code> controls the scale. It is a read/write field instead of WARL.</p>
</div>
<table class="tableblock frame-all grid-all data-line-1006" style="width: 40%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>xTBLJALVEC.scale</code></th>
<th class="tableblock halign-left valign-top"><code>tablescale</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16-bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32-bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">&#8230;&#8203;..</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4096-bytes to match minimum TLB page size</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-1016">
<p>Note that <code>tablescale = 1&lt;&lt;(xTBLJALVEC.scale+3)</code></p>
</div>
<div class="paragraph data-line-1018">
<p><code>MTBLJALCFG</code> controls the valid entries in the table and the <em>watermarks</em> which are used to control which link register is in use for each table entry.</p>
</div>
<table id="MTBLJALCFG-table" class="tableblock frame-all grid-all stretch data-line-1023">
<caption class="title">Table 33. <code>MTBLJALCFG</code> definition</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">XLEN-1:30</th>
<th class="tableblock halign-left valign-top">29:20</th>
<th class="tableblock halign-left valign-top">19:10</th>
<th class="tableblock halign-left valign-top">9: 0</th>
<th class="tableblock halign-left valign-top">CSR</th>
<th class="tableblock halign-left valign-top">Permissions</th>
<th class="tableblock halign-left valign-top">Status</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ROZ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxentry</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wxm5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wmx0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MTBLJALCFG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required if vector mode is implemented</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ROZ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxentry</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wxm5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wmx0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STBLJALCFG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required if S-mode is implemented</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ROZ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxentry</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wxm5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wmx0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UTBLJALCFG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
<div class="ulist data-line-1030">
<ul>
<li class="data-line-1030">
<p>M-mode always uses <code>MTBLJALCFG</code></p>
</li>
<li class="data-line-1031">
<p>S-mode always uses <code>STBLJALCFG</code></p>
</li>
<li class="data-line-1032">
<p>U-mode uses <code>UTBLJALCFG</code> if implemented, otherwise <code>STBLJALCFG</code> if implemented, otherwise <code>MTBLJALCFG</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note data-line-1036">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  The range of <code>MTBLJALCFG.maxentry</code> is from 0 to <code>TBLJALENTRIES-1</code>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note data-line-1039">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  All 3 fields are <em>unsigned</em> integers
</td>
</tr>
</table>
</div>
<div class="sect3 data-line-1041">
<h4 id="_watermarks">8.5.1. Watermarks</h4>
<div class="paragraph data-line-1043">
<p>The two watermark fields are used to control which tables entries link to</p>
</div>
<div class="ulist data-line-1045">
<ul>
<li class="data-line-1045">
<p><code>x0</code> (i.e. <code>J</code> not <code>JAL</code>)</p>
</li>
<li class="data-line-1046">
<p><code>x1</code> (<code>ra</code>, standard link register)</p>
</li>
<li class="data-line-1047">
<p><code>x5</code> (alternate link register for millicode routines)</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1049">
<p>Depending upon the programming, table entries can all be allocated to 1, 2 or all 3 link registers.</p>
</div>
<div class="paragraph data-line-1051">
<p>In the table MAX is <code>TBLJALENTRIES-1</code>.</p>
</div>
<table id="MTBLJALCFG-table-watermark-end-conditions" class="tableblock frame-all grid-all stretch data-line-1056">
<caption class="title">Table 34. <code>MTBLJALCFG</code> watermarks</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>MTBLJALCFG.wmx0</code></th>
<th class="tableblock halign-left valign-top"><code>MTBLJALCFG.wmx5</code></th>
<th class="tableblock halign-left valign-top"><code>JAL x0</code> range</th>
<th class="tableblock halign-left valign-top"><code>JAL x5</code> range</th>
<th class="tableblock halign-left valign-top"><code>JAL x1</code> range</th>
<th class="tableblock halign-left valign-top">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="6"><p class="tableblock">Normal programming model, use all 3 link registers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">X, X&gt;0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y, Y&gt;X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0 to X-1</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>X to Y-1</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Y to MAX</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use all 3 link registers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="6"><p class="tableblock">Restricted programming model, exclude 1 or 2 link registers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0 to MAX</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only link to x0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0 to MAX</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only link to x5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0 to MAX</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only link to x1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y, Y&gt;0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0 to Y-1</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Y to MAX</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only link to x0, x1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">X, X&gt;0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0 to X-1</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>X to MAX</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only link to x1, x5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="6"><p class="tableblock">reserved for future use</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Z</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;Z</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">illegal instruction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-1070">
<p>Some of the modes may not be so useful, so we can consider restricting them, for example</p>
</div>
<div class="ulist data-line-1072">
<ul>
<li class="data-line-1072">
<p>only link to x5 (only millicode routines)</p>
</li>
<li class="data-line-1073">
<p>only link to x1, x5 (no J equivalent)</p>
</li>
<li class="data-line-1074">
<p><em>this needs review, but in general I&#8217;d like the specification to be flexible</em></p>
</li>
</ul>
</div>
<div class="paragraph data-line-1076">
<p>With the proposed encodings</p>
</div>
<div class="ulist data-line-1078">
<ul>
<li class="data-line-1078">
<p>the 16-bit encoding can access entry 0 to min(127, <code>MTBLJALCFG.maxentry</code>)</p>
</li>
<li class="data-line-1079">
<p>the 32-bit encoding can access entry 0 to min(255, <code>MTBLJALCFG.maxentry</code>)</p>
</li>
</ul>
</div>
<table id="MTBLJALCFG-table-watermark-examples" class="tableblock frame-all grid-all stretch data-line-1084">
<caption class="title">Table 35. <code>MTBLJALCFG</code> watermark examples</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>MTBLJALCFG.wmx0</code></th>
<th class="tableblock halign-left valign-top"><code>MTBLJALCFG.wmx5</code></th>
<th class="tableblock halign-left valign-top"><code>JAL x0</code> range</th>
<th class="tableblock halign-left valign-top"><code>JAL x5</code> range</th>
<th class="tableblock halign-left valign-top"><code>JAL x1</code> range</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">40</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0 to 19</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>20 to 39</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>40 to 255</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">40</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0 to 39</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>40 to 255</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">40</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">40</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0 to 39</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>40 to 255</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">40</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">39</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">255</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0 to 255</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">255</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">255</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0 to 255</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0 to 255</strong></p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-1095">
<p><code>JAL x1</code> is always highest in the range (if enabled), so that the 32-bit encoding typically adds more cases using <code>x1</code> to convert <code>AUIPC/JALR x1</code> sequences to <code>TBLJAL</code> to save code size.</p>
</div>
<div class="imageblock data-line-1098">
<div class="content">
<img src="https://github.com/riscv/riscv-code-size-reduction/blob/master/ISA%20proposals/Huawei/tbljump2.PNG" alt="watermark example">
</div>
<div class="title">Figure 1. watermark example</div>
</div>
</div>
<div class="sect3 data-line-1100">
<h4 id="_exceptions_for_vector_table_mode">8.5.2. Exceptions for vector table mode</h4>
<div class="paragraph data-line-1102">
<p>Take an illegal instruction exception if <code>[C.]TBLJAL #n</code> is executed and one of more of these conditions are true:</p>
</div>
<div class="ulist data-line-1104">
<ul>
<li class="data-line-1104">
<p><code>n &gt; MTBLJALWM.maxentry</code></p>
</li>
<li class="data-line-1105">
<p><code>MTBLJALWM.wmx5 &lt; MTBLJALWM.wxm0</code></p>
</li>
<li class="data-line-1106">
<p><code>MTBLJALWM.wmx0 &gt; MTBLJALWM.maxentry</code></p>
</li>
<li class="data-line-1107">
<p><code>MTBLJALWM.wmx5 &gt; MTBLJALWM.maxentry</code></p>
</li>
</ul>
</div>
<div class="paragraph data-line-1109">
<p>All comparisons are <em>unsigned</em>.</p>
</div>
</div>
<div class="sect3 data-line-1111">
<h4 id="_pseudo_code_for_vector_table_mode">8.5.3. Pseudo-code for vector table mode</h4>
<div class="listingblock data-line-1114">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode"># Mem is byte indexed
# LINK is x0, x1, x5 depending on the index number and the watermarks
if (n &gt; MTBLJALCFG.maxentry OR MTBLJALWM.wmx5 &lt; MTBLJALWM.wxm0) {
  take_illegal_instruction_exception();
  }
JALR LINK, Mem[xTBLJALVEC.base + n*tablescale][XLEN-1:0];</code></pre>
</div>
</div>
</div>
<div class="sect3 data-line-1123">
<h4 id="_vector_table_code">8.5.4. vector table code</h4>
<div class="paragraph data-line-1125">
<p>Because this method doesn&#8217;t have the jump table - the code is actually placed in the table. If the code is too large to fit then it will have to call a routine outside the table, or use more than one entry which invalidates one or more table entries.
This avoids an additional redirection to get to the actual code, assuming the whole body of the code actually fits in the table.</p>
</div>
<div class="paragraph data-line-1128">
<p>Setting <code>xTBLJALVEC.scale</code> to specific values does not set a requirement on the alignment of <code>xTBLJALVEC.base</code>. For example if <code>tablescale=4096</code>, <code>xTBLJALVEC.base</code> does <em>not</em> need to be 4096-byte aligned.</p>
</div>
<div class="paragraph data-line-1130">
<p>If <code>tablescale</code> is set to 4096 then this allows each entry in the table to be owned by different privilege domain, which can manange its own code. <code>xTBLJALVEC</code> must be changed by machine mode only so as the table refers to the system as a whole.</p>
</div>
<div class="paragraph data-line-1132">
<p>In a way this approach is similar to a <strong>flash patch</strong> mechanism, where the code can be patched by replacing an instruction with a 32-bit or 16-bit encoding of <code>TBLJ[AL]</code> to call an alternative routine to fix a bug, or add functionality. Although this requires write permission on the code area so cannot work on a boot ROM for example, but it can form the basis of such a mechanism.</p>
</div>
<div class="paragraph data-line-1134">
<p>For the <code>vsprintf</code> example above <code>riscv_save_0</code> / <code>riscv_restore_0</code> each take 12 bytes, and <code>xTBLJALVEC.scale=1</code> (16 bytes per entry) so the actual code is placed in the table. <code>vsprintf</code> is 136 bytes, but will shrink to 128-bytes or smaller by use of <code>c.tbljal</code> so I have allocated 4 entries to it.</p>
</div>
<div class="listingblock data-line-1137">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">MTBJALVECWM.wmx0 = 0 # c.tbljal #0 maps to JAL x0
MTBJALVECWM.wmx5 = 1 # c.tbljal #1+ map to JAL x1

#index 0 (JAL x0)
xTBLJALVEC.base+0 &lt;__riscv_restore_0&gt;:
 	4902                	lw	s2,0(sp)
 	4492                	lw	s1,4(sp)
 	4422                	lw	s0,8(sp)
 	40b2                	lw	ra,12(sp)
 	0141                	addi	sp,sp,16
 	8082                	ret

# index 2 (JAL x1)
xTBLJALVEC.base+32  &lt;__riscv_save_0&gt;:
 	1141                	addi	sp,sp,-16
 	c04a                	sw	s2,0(sp)
 	c226                	sw	s1,4(sp)
 	c422                	sw	s0,8(sp)
 	c606                	sw	ra,12(sp)
 	8282                	jr	t0

# index 3-6 (JAL x1)
xTBLJALVEC.base+48: &lt;vsnprintf&gt;
  	xxxx                	tbljal #5 ;# call to &lt;__riscv_save_0&gt;
  ...  up to 128-byte function body ...
  	xxxx                	tbljal #4 ;# call to &lt;__riscv_restore_0&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note data-line-1169">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  This mode may waste memory as the target functions are very unlikely to all be multiples of <code>tablescale</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-1171">
<h4 id="_vector_mode_security_future_ideas">8.5.5. Vector Mode Security (future ideas)</h4>
<div class="paragraph data-line-1173">
<p>The vector mode mechanism could be reused for security in the future. It is possible to define that the memory allocated to to the table can only have entry points on the specific vectors, and also only from <code>[C.]TBLJAL</code> instructions. In this way sensitive code can be placed in the table which cannot be reused for ROP/JOP gadgets, because the code cannot be targetted by <code>JALR</code> instructions.</p>
</div>
<div class="paragraph data-line-1175">
<p>These ideas will not be pursued as part of the code size work.</p>
</div>
</div>
</div>
<div class="sect2 data-line-1178">
<h3 id="emulation-mode">8.6. Future Mode: Emulation Mode (not for RVM22/RVA22)</h3>
<div class="paragraph data-line-1180">
<p>Emulation mode is the simplest. It doesn&#8217;t have a jump table or vector table, so allow a minimal hardware implementation.
It relies on the values in temporary registers not being maintained across function calls.</p>
</div>
<div class="paragraph data-line-1183">
<p><em>There are concerns about overwriting the temporary registers so this may be rejected</em></p>
</div>
<div class="paragraph data-line-1185">
<p>No illegal instruction exceptions are possible in emulation mode.</p>
</div>
<div class="sect3 data-line-1187">
<h4 id="_pseudo_code_for_emulation_mode">8.6.1. Pseudo-code for emulation mode</h4>
<div class="listingblock data-line-1190">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">t4 = next_PC; #PC+2 for c.tbljal, PC+4 for tbljal
t5 = n;       #immediate operand
J xTBLJALVEC.base</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-1196">
<h3 id="_diagram_for_all_table_jump_modes">8.7. Diagram for all table jump modes</h3>
<div class="imageblock data-line-1199">
<div class="content">
<img src="https://github.com/riscv/riscv-code-size-reduction/blob/master/ISA%20proposals/Huawei/tbljump4.PNG" alt="all three modes">
</div>
<div class="title">Figure 2. all three modes</div>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-1202">
<h2 id="pushpoppopret">9. PUSH and POP</h2>
<div class="sectionbody">
<div class="paragraph data-line-1204">
<p><code>PUSH, POP, POPRET</code> and <code>PUSH.E, POP.E, POPRET.E</code> along with the 16-bit forms are used to reduce the size of function prologues and epilogues.</p>
</div>
<div class="sect2 data-line-1206">
<h3 id="_a_brief_example_from_zephyr">9.1. A brief example from Zephyr</h3>
<div class="paragraph data-line-1208">
<p>This example gives a nice illustration of what <code>PUSH, POP, POPRET</code> are trying to achieve.</p>
</div>
<div class="listingblock data-line-1211">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">from subsys/bluetooth/controller/crypto/crypto.c
int bt_rand(void *buf, size_t len)
{
        return lll_csrand_get(buf, len);
}</code></pre>
</div>
</div>
<div class="paragraph data-line-1219">
<p>compiles with GCC10 to:</p>
</div>
<div class="listingblock data-line-1222">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">20405458 &lt;bt_rand&gt;:
20405458:	1141                	addi	sp,sp,-16	;#PUSH(1)
2040545a:	c04a                	sw	s2,0(sp)	;#PUSH(2)
2040545c:	70000937          	lui	s2,0x70000
20405460:	62090613          	addi	a2,s2,1568 # 70000620 &lt;prng&gt;
20405464:	c422                	sw	s0,8(sp)	;#PUSH(3)
20405466:	c226                	sw	s1,4(sp)	;#PUSH(4)
20405468:	c606                	sw	ra,12(sp)	;#PUSH(5)
2040546a:	842a                	mv	s0,a0		;#PUSH(6)
2040546c:	84ae                	mv	s1,a1		;#PUSH(7)
&lt;function body&gt;
20405494:	4501                	li	a0,0		;#POPRET(1)
20405496:	40b2                	lw	ra,12(sp)	;#POPRET(2)
20405498:	4422                	lw	s0,8(sp)	;#POPRET(3)
2040549a:	4492                	lw	s1,4(sp)	;#POPRET(4)
2040549c:	4902                	lw	s2,0(sp)	;#POPRET(5)
2040549e:	0141                	addi	sp,sp,16	;#POPRET(6)
204054a0:	8082                	ret			;#POPRET(7)</code></pre>
</div>
</div>
<div class="paragraph data-line-1243">
<p>with the GCC option <code>-msave-restore</code> the output is the following:</p>
</div>
<div class="listingblock data-line-1246">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">204089ac &lt;bt_rand&gt;:
204089ac:       f97f72ef                jal     t0,20400942 &lt;__riscv_save_0&gt;	;#PUSH(1)
204089b0:       70001937                lui     s2,0x70001
204089b4:       ac090613                addi    a2,s2,-1344 # 70000ac0 &lt;prng&gt;
204089b8:       842a                    mv      s0,a0	;#PUSH(2)
204089ba:       84ae                    mv      s1,a1	;#PUSH(3)
&lt;function_body&gt;
204089e2:       4501                    li      a0,0	;#POPRET(1)
204089e4:       f83f706f                j       20400966 &lt;__riscv_restore_0&gt;	;#POPRET(2)</code></pre>
</div>
</div>
<div class="paragraph data-line-1258">
<p>with <code>PUSH/POPRET</code> this reduces to</p>
</div>
<div class="listingblock data-line-1261">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">20405458 &lt;bt_rand&gt;:
20405458:	&lt;16-bit&gt;                push	 {ra,s0-s2},{a0-a1},-16
2040545c:	70000937          	lui	s2,0x70000
20405460:	62090613          	addi	a2,s2,1568 # 70000620 &lt;prng&gt;
&lt;function body&gt;
20405496:	&lt;16-bit&gt;                popret	 {ra,s0-s2},{0} 16</code></pre>
</div>
</div>
<div class="paragraph data-line-1271">
<p>The prologue / epilogue reduce from 28-bytes in the original code, to 14-bytes with <code>-msave-restore</code>, and to to 8-bytes with <code>PUSH, POP, POPRET</code>, which will also improve the performance.</p>
</div>
<div class="admonitionblock note data-line-1275">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  The calls to <code>&lt;riscv_save_0&gt;/&lt;riscv_restore_0&gt;</code> become 64-bit when the target functions are out of the ±1MB range, increasing the prologue/epilogue size to 22-bytes.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2 data-line-1277">
<h3 id="_uabi_and_eabi_support">9.2. UABI and EABI support</h3>
<div class="paragraph data-line-1279">
<p>The UABI is available on all RVI cores. The EABI is optional on RV32I and required on RV32E.</p>
</div>
<div class="paragraph data-line-1281">
<p>The UABI supports saved registers <code>s0-s11</code>, the EABI supports saved registers <code>s0-s4</code> only but <code>s2-s4</code> are mapped to <em>different</em> <code>X</code> registers.</p>
</div>
<div class="paragraph data-line-1283">
<p>Therefore encodings which support register lists which include up to <code>s1</code> can be used for both ABIs. As soon as the list includes <code>s2</code> then a different encoding is required.</p>
</div>
<div class="paragraph data-line-1285">
<p>This specification for the EABI is taken from <a href="https://github.com/riscv/riscv-eabi-spec/blob/master/EABI.adoc">this document</a>.</p>
</div>
<div class="paragraph data-line-1287">
<p>The <code>PUSH/POP/POPRET</code> instructions support the UABI. The <code>PUSH.E/POP.E/POPRET.E</code> instructions support the EABI.</p>
</div>
<div class="paragraph data-line-1289">
<p>Where the <code>X</code> register list is the same for both ABIs the EABI version is a pseudo-instruction mapping to the UABI version. For example:</p>
</div>
<div class="ulist data-line-1291">
<ul>
<li class="data-line-1291">
<p><code>c.pop.e {ra, s0}, 32</code> is a pseudo-instruction for <code>c.pop {ra, s0}, 32</code></p>
</li>
</ul>
</div>
<div class="paragraph data-line-1293">
<p>If the register list includes <code>s2</code> or a higher numbered <code>s</code> register then the encoding is different, as the mapping to <code>X</code> registers is different. Therefore:</p>
</div>
<div class="ulist data-line-1295">
<ul>
<li class="data-line-1295">
<p><code>c.pop.e {ra, s0-s2}, 32</code> has a different encoding to <code>c.pop {ra, s0-s2}, 32</code></p>
</li>
</ul>
</div>
<div class="paragraph data-line-1297">
<p>It is recommended that:</p>
</div>
<div class="ulist data-line-1299">
<ul>
<li class="data-line-1299">
<p>when compiling/disassembling for the UABI, the pseudo-instructions with the <code>.E</code> suffix <em>should not</em> be used.</p>
</li>
<li class="data-line-1300">
<p>when compiling/disassembling for the EABI, the pseudo-instructions with the <code>.E</code> suffix <em>should</em> be used.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1302">
<p>The <code>.E</code> forms are not available on RV64I or RV128I. Any encodings with a <code>.E</code> suffix are reserved on those base architectures.</p>
</div>
<table id="ABI-on-base-arch" class="tableblock frame-all grid-all stretch data-line-1307">
<caption class="title">Table 36. ABIs on different base architectures</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Base architecture</th>
<th class="tableblock halign-left valign-top">UABI</th>
<th class="tableblock halign-left valign-top">EABI</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RV32I</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Full support of both ABIs required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RV32E</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binary can execute on RV32I</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RV64I/RV128I</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No EABI support on RV64I/RV128I</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-1314">
<p>Code compiled for RV32I may be compiled for the UABI or EABI. Code compiled for RV32E may be executed on an RV32I core.</p>
</div>
</div>
<div class="sect2 data-line-1316">
<h3 id="_assembler_syntax">9.3. Assembler Syntax</h3>
<div class="olist arabic data-line-1318">
<ol class="arabic">
<li class="data-line-1318">
<p>The <code>PUSH</code> instruction</p>
<div class="ulist data-line-1319">
<ul>
<li class="data-line-1319">
<p>pushes(stores)  the registers specified in <code>reg_list</code> to the stack</p>
</li>
<li class="data-line-1320">
<p>if <code>areg_list</code> is included, moves the registers in the <code>areg_list</code> into <code>s</code> registers</p>
</li>
<li class="data-line-1321">
<p>adjusts the stack pointer by the <code>stack_adjustment</code></p>
</li>
</ul>
</div>
</li>
<li class="data-line-1323">
<p>The <code>POP</code> instruction</p>
<div class="ulist data-line-1324">
<ul>
<li class="data-line-1324">
<p>pops(loads) the registers in <code>reg_list</code> from the stack</p>
</li>
<li class="data-line-1325">
<p>if <code>ret_val</code> is included, moves the specified value into <code>a0</code> as the return value</p>
</li>
<li class="data-line-1326">
<p>adjusts the stack pointer by the <code>stack_adjustment</code>.</p>
</li>
</ul>
</div>
</li>
<li class="data-line-1328">
<p><code>POPRET</code> has the same behaviour as <code>POP</code>, followed by <code>RET</code>. It uses <code>rsreg_list</code> as the <code>ra</code> register must be included.</p>
</li>
</ol>
</div>
<div class="paragraph data-line-1330">
<p>32-bit and 16-bit forms of all instructions are available, the assembler should choose the 16-bit form if the parameters permit.</p>
</div>
<div class="paragraph data-line-1332">
<p>The registers in <code>reg_list</code> and <code>areg_list</code> are comma separated lists and must not be empty.</p>
</div>
<div class="listingblock data-line-1335">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">&lt;sreg_list&gt;  ::= &lt;ra&gt; "," &lt;sreg_range&gt; | &lt;ra&gt; | &lt;sreg_range&gt;
&lt;rsreg_list&gt; ::= &lt;ra&gt; "," &lt;sreg_range&gt; | &lt;ra&gt;
&lt;areg_list&gt;  ::= &lt;areg_range&gt;
&lt;ret_val&gt;    ::= s0 | 0 | 1
&lt;sreg_range&gt; ::= &lt;s0&gt;  | &lt;s0-sN&gt;   (where N is in the range [1, 11])
&lt;areg_range&gt; ::= &lt;a0&gt;  | &lt;a0-aP&gt;   (where P is in the range [1, 2])
&lt;reg_list&gt;   ::= &lt;sreg_list&gt;  | &lt;rsreg_list&gt;

//legal syntax

push         {&lt;sreg_list&gt;},  [{&lt;areg_list&gt;}],-stack_adjustment
pop          {&lt;sreg_list&gt;},  [{ret_val},]    stack_adjustment
popret       {&lt;rsreg_list&gt;}, [{ret_val},]    stack_adjustment //popret must include ra</code></pre>
</div>
</div>
<div class="paragraph data-line-1352">
<p>For the 16-bit encodings</p>
</div>
<div class="olist arabic data-line-1354">
<ol class="arabic">
<li class="data-line-1354">
<p>In <code>reg_list</code></p>
<div class="olist loweralpha data-line-1355">
<ol class="loweralpha" type="a">
<li class="data-line-1355">
<p><code>ra</code> must be included</p>
</li>
<li class="data-line-1356">
<p><code>s0-sN</code> may be included, valid values of <code>N</code> are 0,1,2,3,5,8,11</p>
</li>
</ol>
</div>
</li>
<li class="data-line-1357">
<p>for <code>pop, ret_val</code> must not be included</p>
</li>
<li class="data-line-1358">
<p>for <code>popret, ret_val</code> may be included - and can only be set to <code>0</code></p>
<div class="olist loweralpha data-line-1359">
<ol class="loweralpha" type="a">
<li class="data-line-1359">
<p>rationale: about 27% of functions which infer <code>popret</code> issue <code>li a0, 0</code> first</p>
</li>
</ol>
</div>
</li>
<li class="data-line-1360">
<p>for <code>push</code> only specific combinations of <code>areg_list</code> and <code>sreg_list</code> are permitted</p>
<div class="olist loweralpha data-line-1361">
<ol class="loweralpha" type="a">
<li class="data-line-1361">
<p><code>if sreg_list={ra}:       areg_list={}</code></p>
</li>
<li class="data-line-1362">
<p><code>if sreg_list={ra,s0}:    areg_list={a0}</code></p>
</li>
<li class="data-line-1363">
<p><code>if sreg_list={ra,s0-sN}: areg_list={a0-a1} where N=1,2,3</code></p>
</li>
<li class="data-line-1364">
<p><code>if sreg_list={ra,s0-sN}: areg_list={a0-a2} where N=5,8,11</code></p>
</li>
</ol>
</div>
</li>
<li class="data-line-1365">
<p>The <code>stack_adjustment</code> must be no more than the total memory required for <code>reg_list</code>, rounded up to a multiple of 16-bytes, plus an additional (0..7)*16-bytes.</p>
</li>
</ol>
</div>
<div class="admonitionblock note data-line-1369">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  Depending on the EABI definition - the <code>.E</code> forms <strong>may</strong> support {ra,s0-s4}, TBD
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1371">
<p>Examples of valid 16-bit encodings for RV32I or RV64I using the UABI:</p>
</div>
<div class="listingblock data-line-1374">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">push   {ra},                 -16; //store ra;                                      decrement sp by 16
push   {ra,s0},    {a0},     -32; //store ra,s0;     mv s0,a0;                     decrement sp by 32
push   {ra,s0-s3}, {a0-a1},  -96; //store ra,s0-s3;  mv s0,a0; mv s1,a1;           decrement sp by 96
push   {ra,s0-s11},{a0-a2}, -128; //store ra,s0-s11; mv s0,a0; mv s1,a1; mv s2,a2; decrement sp by 128

pop    {ra},        16;  //load  ra;        increment sp by 16
popret {ra},        16;  //load  ra;        increment sp by 16; jump to ra

pop    {ra,s0},     32;  //load  ra,s0;     increment sp by 32
popret {ra,s0},{s0},32;  //load  ra,s0;     increment sp by 32; mv a0, s0; jump to ra

pop    {ra,s0-s3},  96;  //load  ra,s0-s3;  increment sp by 96
popret {ra,s0-s3},  96;  //load  ra,s0-s3;  increment sp by 96; jump to ra

pop    {ra,s0-s11}, 128; //load  ra,s0-s11; increment sp by 128
popret {ra,s0-s11}, 128; //load  ra,s0-s11; increment sp by 128; jump to ra</code></pre>
</div>
</div>
<div class="admonitionblock note data-line-1395">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  To save encoding space, for <code>c.push</code>, <code>areg_list</code> is automatically determined from the <code>reg_list</code> value based on analysing usage in the benchmark suite .
</td>
</tr>
</table>
</div>
<div class="admonitionblock note data-line-1398">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  To save encoding space some opcodes do not allow the full range of <code>spimm</code> or <code>reg_list</code> which reduces the possible <code>stack adjustment</code> range further, see <a href="#proposed-16bit-encodingsI-1">Table 41</a>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note data-line-1401">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  For the EABI the encodings, or pseudo-instructions all have a <code>.E</code> suffix and the highest <code>s</code> register is limited to <code>s4</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1403">
<p>For the 32-bit encodings</p>
</div>
<div class="olist arabic data-line-1405">
<ol class="arabic">
<li class="data-line-1405">
<p>The <code>stack_adjustment</code> must be no more than the total memory required for <code>reg_list</code>, rounded up to a multiple of 16-bytes, plus an additional (0..15)*16-bytes.</p>
</li>
<li class="data-line-1406">
<p><code>areg_list</code> must not overwrite an <code>s</code> register which has not been saved. For example:</p>
<div class="olist loweralpha data-line-1407">
<ol class="loweralpha" type="a">
<li class="data-line-1407">
<p><code>push {ra,s0}, {a0}, -32</code> <em>is</em> valid - it saves <code>ra</code>, saves <code>s0</code> and the moves <code>a0</code> into <code>s0</code>.</p>
</li>
<li class="data-line-1408">
<p><code>push {ra,s0}, {a0-a1}, -32</code> <em>is not</em> valid - it saves <code>ra</code>, saves <code>s0</code> and then moves <code>a0-a1</code> into <code>s0-s1</code>. Therefore it overwrites <code>s1</code> which has <strong>not</strong> been saved. This case will cause an illegal instruction exception.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph data-line-1410">
<p>For example</p>
</div>
<div class="olist arabic data-line-1412">
<ol class="arabic">
<li class="data-line-1412">
<p><code>push   {ra,s0-s2}, {a0-a1}, -64</code> can use a 16-bit encoding</p>
</li>
<li class="data-line-1413">
<p><code>push   {s0-s2},    {a0-a1}, -64</code> must use a 32-bit encoding as <code>ra</code> is not in the register list</p>
</li>
<li class="data-line-1414">
<p><code>push   {ra,s0-s2}, {a0-a1}, -256</code> must use a 32-bit encoding as the <code>stack_adjustment</code> is out of range</p>
</li>
<li class="data-line-1415">
<p><code>push   {ra,s0-s2},          -32</code> must use a 32-bit encoding as <code>sreg_list</code> requires <code>areg_list={a0-a1}</code> for the 16-bit encoding</p>
</li>
<li class="data-line-1416">
<p><code>pop    {ra,s0-s2}, {s0},     32</code> must use a 32-bit encoding as <code>ret_val</code> is specified</p>
</li>
<li class="data-line-1417">
<p><code>popret {ra,s0-s2}, {s0},     32</code> must use a 32-bit encoding as <code>c.popret</code> only supports <code>0</code> as the <code>ret_val</code> value</p>
</li>
</ol>
</div>
<div class="paragraph data-line-1419">
<p>To be a legal encoding:</p>
</div>
<div class="olist arabic data-line-1421">
<ol class="arabic">
<li class="data-line-1421">
<p>The stack adjustment must be negative for <code>PUSH</code> and positive for <code>POP/POPRET</code></p>
</li>
<li class="data-line-1422">
<p>The stack adjustment must be in range (see <a href="#spimm">Section 9.7.1</a>) and must be a multiple of 16</p>
</li>
<li class="data-line-1423">
<p>The register lists must be valid (see above)</p>
</li>
<li class="data-line-1424">
<p>For <code>PUSH</code>, <code>areg_list</code> must not overwrite an <code>s</code> register which is not listed in <code>reg_list</code></p>
</li>
<li class="data-line-1425">
<p>For <code>POPRET</code>, <code>reg_list</code> must include <code>ra</code></p>
</li>
<li class="data-line-1426">
<p>For <code>POP</code> and <code>POPRET</code>, <code>areg_list</code> must not be included</p>
</li>
</ol>
</div>
</div>
<div class="sect2 data-line-1429">
<h3 id="_determining_xlen_to_decode_and_execute_the_instructions">9.4. Determining XLEN to decode and execute the instructions</h3>
<div class="paragraph data-line-1431">
<p>The width of <code>x</code> registers in the register list depends upon XLEN and so <code>misa.MXL</code>. From the ELF file header, XLEN is determined by the following flags:</p>
</div>
<div class="ulist data-line-1433">
<ul>
<li class="data-line-1433">
<p>ELFCLASS64 for RV64</p>
</li>
<li class="data-line-1434">
<p>ELFCLASS32 for RV32</p>
</li>
</ul>
</div>
<div class="admonitionblock note data-line-1438">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  I don&#8217;t think there&#8217;s an ELFCLASS128 for RV128
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1440">
<p>If using a debugger then <code>misa.MXL</code> can be read, if XLEN is not known for the core.</p>
</div>
<div class="paragraph data-line-1442">
<p>Follow this link for details of the <a href="https://github.com/riscv/riscv-elf-psabi-doc/blob/master/riscv-elf.md#file-header">ELF file header</a></p>
</div>
</div>
<div class="sect2 data-line-1444">
<h3 id="_pseudo_code">9.5. Pseudo-code</h3>
<div class="paragraph data-line-1446">
<p>The pseudo-code below show the required architectural state updates.</p>
</div>
<div class="paragraph data-line-1448">
<p>Note that every architectural state update in the pseudo-code can be executed as a standard RISC-V 32-bit encoding, so that it is possible execute the instructions as sequences of standard instructions.</p>
</div>
<div class="paragraph data-line-1450">
<p>Because the pseudo-code includes load or store operations, they may take any fault caused by executing loads or stores. See <a href="#fault-handling">Section 9.8</a> for more details.</p>
</div>
<div class="sect3 data-line-1452">
<h4 id="_pushpush_e_pseudo_code">9.5.1. PUSH/PUSH.E Pseudo-code</h4>
<div class="paragraph data-line-1454">
<p>The <code>PUSH/PUSH.E</code> instruction store the set of registers from <code>reg_list</code> to consecutive memory locations, and decrements the stack pointer.
The pseudo-code uses assembly inserts so that it can use <code>sw/sd</code> etc.</p>
</div>
<div class="paragraph data-line-1457">
<p>The pseudo-code shows the memory and architectural state updates of the whole instruction which has completed without faults, debug halts or interrupts. See <a href="#fault-handling">Section 9.8</a> and <a href="#software-view">Section 9.9</a> for more information.</p>
</div>
<div class="admonitionblock note data-line-1460">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  <code>stack_adjustment</code> is negative.
</td>
</tr>
</table>
</div>
<div class="listingblock data-line-1463">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">//RV64/RV128 must have a 16-byte aligned sp
if (misa.MXL&gt;=2 &amp;&amp; sp[3:0]) {take_illegal_instruction_exception();}
//RV32I might be using the EABI (8-byte alignment) or UABI (16-byte alignment, so in hardware we can only check for 8)
if (misa.MXL==1 &amp;&amp; sp[2:0]) {take_illegal_instruction_exception();}

if (misa.MXL==1) {bytes=4;}
if (misa.MXL==2) {bytes=8;}
else             {bytes=16;}
addr=sp;
if (ra) {
  addr-=bytes;
  switch(bytes) {
    4:  asm("sw ra, 0(addr)");
    8:  asm("sd ra, 0(addr)");
    16: asm("sq ra, 0(addr)");
  }
}
for(i in sreg_list)  {
  addr-=bytes;
  switch(bytes) {
    4:  asm("sw s[i], 0(addr)");
    8:  asm("sd s[i], 0(addr)");
    16: asm("sq s[i], 0(addr)");
  }
}
if (areg_list) {
  for (i in areg_list) {
    asm("mv s[i], a[i]");}
  }
}
sp+=stack_adjustment; //decrement</code></pre>
</div>
</div>
</div>
<div class="sect3 data-line-1497">
<h4 id="_poppop_epopretpopret_e_pseudo_code">9.5.2. POP/POP.E/POPRET/POPRET.E Pseudo-code</h4>
<div class="paragraph data-line-1499">
<p>A <code>POP/POP.E/POPRET/POPRET.E</code> instruction loads the set of registers from <code>reg_list</code> from consecutive memory locations, and then increments the stack pointer.
The pseudo-code uses assembly inserts so that it can use <code>lw/ld/ret</code> etc.</p>
</div>
<div class="paragraph data-line-1502">
<p>The pseudo-code shows the architectural state updates of the whole instruction which has completed without faults, debug halts or interrupts. See <a href="#fault-handling">Section 9.8</a> and <a href="#software-view">Section 9.9</a> for more information.</p>
</div>
<div class="admonitionblock note data-line-1505">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  <code>stack_adjustment</code> is positive.
</td>
</tr>
</table>
</div>
<div class="listingblock data-line-1508">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">//RV64/RV128 must have a 16-byte aligned sp
if (misa.MXL&gt;=2 &amp;&amp; sp[3:0]) {take_illegal_instruction_exception();}
//RV32I might be using the EABI (8-byte alignment) or UABI (16-byte alignment, so in hardware we can only check for 8)
if (misa.MXL==1 &amp;&amp; sp[2:0]) {take_illegal_instruction_exception();}

if (misa.MXL==1) {bytes=4;}
if (misa.MXL==2) {bytes=8;}
else             {bytes=16;}
addr=sp+stack_adjustment;
if (ra) {
  addr-=bytes;
  switch(bytes) {
    4:  asm("lw ra, 0(addr)");
    8:  asm("ld ra, 0(addr)");
    16: asm("lq ra, 0(addr)");

  }
}
for(i in sreg_list)  {
  addr-=bytes;
  switch(bytes) {
    4:  asm("lw s[i], 0(addr)");
    8:  asm("ld s[i], 0(addr)");
    16: asm("lq s[i], 0(addr)");
  }
}
if (ret_val) {
   switch(ret_val) {
      "s0": asm("mv a0, s0");
      "0":  asm("li a0, 0");
      "1":  asm("li a0, 1");
   }
}
sp+=stack_adjustment; //increment
if (opcode == "POPRET" or opcode == "POPRET.E") {
   asm("ret");
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-1549">
<h3 id="pushpoppopret32bitencodings">9.6. 32-bit Encodings</h3>
<div class="admonitionblock note data-line-1553">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  These encodings are in <em>custom-0</em>, correct encodings need to be allocated.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch data-line-1557">
<caption class="title">Table 37. push/pop/popret 32-bit format PPP-type</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">31:23</th>
<th class="tableblock halign-left valign-top">22:20</th>
<th class="tableblock halign-left valign-top">19:16</th>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14:12</th>
<th class="tableblock halign-left valign-top">11: 7</th>
<th class="tableblock halign-left valign-top">6 : 0</th>
<th class="tableblock halign-left valign-top">type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">funct9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">field4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">field3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">field2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">funct3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">field1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opcode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZCE-type</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch data-line-1564">
<caption class="title">Table 38. push/pop/popret 32-bit encodings</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">31:23</th>
<th class="tableblock halign-left valign-top">22:20</th>
<th class="tableblock halign-left valign-top">19:16</th>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14:12</th>
<th class="tableblock halign-left valign-top">11: 7</th>
<th class="tableblock halign-left valign-top">6 : 0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">000000000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mv</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rlist (0-12)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0010011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">000000000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mv</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rlist (13-15)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0010011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH.E</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">000000000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ret_val</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rlist (0-12)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0010011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">000000000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ret_val</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rlist (13-15)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0010011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP.E</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">000000000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ret_val</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rlist (0-12)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">110</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0010011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">000000000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ret_val</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rlist (13-15)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">110</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0010011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET.E</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note data-line-1576">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  <code>rlist&gt;12</code> gives register lists which only map to the EABI because the <code>X</code> register mapping is different for <code>s2-s4</code>, hence the <code>.E</code> suffix
</td>
</tr>
</table>
</div>
<div class="admonitionblock note data-line-1579">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  <code>ra=1</code> for all <code>popret</code> encodings, it is not specified in the encoding
  Not all cases of <code>mv</code> and <code>rlist</code> are legal for <code>PUSH</code>, see below.
</td>
</tr>
</table>
</div>
<table id="proposed-32bit-encodingsI-2" class="tableblock frame-all grid-all stretch data-line-1585">
<caption class="title">Table 39. PUSH/POP/POPRET 32-bit encoding validity on RV32I/RV32E/RV64I/RV128I</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">RV32I</th>
<th class="tableblock halign-left valign-top">RV32E</th>
<th class="tableblock halign-left valign-top">RV64I/RV128I</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP          {ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP          {[ra,] s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP          {[ra,] s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP          {[ra,] s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP.E        {[ra,] s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET       {ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET       {[ra,] s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET       {[ra,] s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET       {[ra,] s0- <em>sN</em>}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET.E     {[ra,] s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET.E     {[ra,] s0-s3}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET.E     {[ra,] s0-s4}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH         {ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH         {[ra,] s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH         {[ra,] s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH         {[ra,] s0- <em>sN</em>}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH.E       {[ra,] s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH.E       {[ra,] s0-s3}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH.E       {[ra,] s0-s4}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note data-line-1610">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  <em>sN</em> = (s2,s3,..,s11)
</td>
</tr>
</table>
</div>
<div class="admonitionblock note data-line-1614">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  If there is no ✓ in a cell then the encoding is <strong>reserved</strong> on that architecture
</td>
</tr>
</table>
</div>
<table id="proposed-32bit-encodings-pseudo" class="tableblock frame-all grid-all stretch data-line-1619">
<caption class="title">Table 40. PUSH/POP/POPRET 32-bit encoding pseudo-instructions</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Pseudo-instruction</th>
<th class="tableblock halign-left valign-top">Resolves to</th>
<th class="tableblock halign-left valign-top">RV32I</th>
<th class="tableblock halign-left valign-top">RV32E</th>
<th class="tableblock halign-left valign-top">RV64I/RV128I</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP.E {ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP {ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP.E {[ra,] s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP {[ra,] s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP.E {[ra,] s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP {[ra,] s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET.E {ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET {ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET.E {[ra,] s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET {[ra,] s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET.E {[ra,] s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET {[ra,] s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH.E {ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH {ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH.E {[ra,] s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH {[ra,] s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH.E {[ra,] s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH {[ra,] s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note data-line-1634">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  All the pseudo-instructions are valid for <code>RV32I/RV32E</code>, none are valid for <code>RV64I/RV128I</code>
</td>
</tr>
</table>
</div>
<div class="sect3 data-line-1636">
<h4 id="_illegal_instructions">9.6.1. Illegal instructions</h4>
<div class="paragraph data-line-1638">
<p>The following cases cause illegal instruction exceptions:</p>
</div>
<div class="ulist data-line-1640">
<ul>
<li class="data-line-1640">
<p>If <code>sp</code> is not 8-byte aligned and <code>XLEN=32</code></p>
</li>
<li class="data-line-1641">
<p>If <code>sp</code> is not 16-byte aligned and <code>XLEN&gt;32</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note data-line-1645">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  RV32I may use either the UABI or EABI, so we can only check the EABI minimum alignment.
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1647">
<p>The following case causes an illegal instruction exception for <code>PUSH</code>.</p>
</div>
<div class="ulist data-line-1649">
<ul>
<li class="data-line-1649">
<p><code>rlist&lt;mv</code></p>
</li>
</ul>
</div>
<div class="paragraph data-line-1651">
<p>This rule enumerates to the following 6 illegal encodings:</p>
</div>
<div class="ulist data-line-1653">
<ul>
<li class="data-line-1653">
<p><code>mv=1 &amp;&amp; rlist&lt;1</code></p>
</li>
<li class="data-line-1654">
<p><code>mv=2 &amp;&amp; rlist&lt;2</code></p>
</li>
<li class="data-line-1655">
<p><code>mv=3 &amp;&amp; rlist&lt;3</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2 data-line-1658">
<h3 id="pushpoppopret16bitIencodings">9.7. 16-bit Encodings</h3>
<div class="paragraph data-line-1660">
<p>These instructions have no conflicts with other extensions, they use previously reserved encodings.</p>
</div>
<table id="proposed-16bit-encodingsI-1" class="tableblock frame-all grid-all stretch data-line-1666">
<caption class="title">Table 41. PUSH/POP/POPRET 16-bit encodings</caption>
<colgroup>
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8832%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rlist[2:0]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ret0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">spimm[6:4]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rlist[2:0]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">spimm[6:4]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">000-010</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">spimm[5:4]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">spimm[5:4]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH.E   {ra, s0-s2}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">spimm[5:4]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH.E   {ra, s0-s3}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">spimm[5:4]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH.E   {ra, s0-s4}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rlist[1]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rlist[0]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spimm[4]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ret0</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">spimm[5:4]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET.E   {ra, s0-s2}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ret0</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">spimm[5:4]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET.E   {ra, s0-s3}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ret0</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">spimm[5:4]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET.E   {ra, s0-s4}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spimm[4]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP.E {ra, s0-s2}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spimm[4]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spimm[4]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spimm[4]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
</tbody>
</table>
<div class="ulist data-line-1689">
<ul>
<li class="data-line-1689">
<p>For <code>C.POPRET</code>, <code>ret_val[0]=ret0</code> as specified in the encoding, <code>ret_val[1]=0</code>.</p>
</li>
<li class="data-line-1690">
<p>For <code>C.POP</code> <code>ret_val[1:0]=0</code>.</p>
</li>
</ul>
</div>
<table id="proposed-16bit-encodingsI-2" class="tableblock frame-all grid-all stretch data-line-1696">
<caption class="title">Table 42. PUSH/POP/POPRET 16-bit encoding validity on RV32I/RV32E/RV64I/RV128I</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">RV32I</th>
<th class="tableblock halign-left valign-top">RV32E</th>
<th class="tableblock halign-left valign-top">RV64I/RV128I</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP        {ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP        {ra, s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP        {ra, s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP        {ra, s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP.E      {ra, s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET     {ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET     {ra, s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET     {ra, s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET     {ra, s0- <em>sN</em>}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET.E   {ra, s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET.E   {ra, s0-s3}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET.E   {ra, s0-s4}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH       {ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH       {ra, s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH       {ra, s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH       {ra, s0- <em>sN</em>}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH.E     {ra, s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH.E     {ra, s0-s3}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH.E     {ra, s0-s4}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note data-line-1721">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  <em>sN</em> = (s2,s3,s5,s8,s11)
</td>
</tr>
</table>
</div>
<div class="admonitionblock note data-line-1725">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  If there is no ✓ in a cell then the encoding is <strong>reserved</strong> on that architecture
</td>
</tr>
</table>
</div>
<table id="proposed-16bit-encodings-pseudo" class="tableblock frame-all grid-all stretch data-line-1731">
<caption class="title">Table 43. PUSH/POP/POPRET 16-bit encoding pseudo-instructions</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Pseudo-instruction</th>
<th class="tableblock halign-left valign-top">Resolves to</th>
<th class="tableblock halign-left valign-top">RV32I</th>
<th class="tableblock halign-left valign-top">RV32E</th>
<th class="tableblock halign-left valign-top">RV64I/RV128I</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP.E {ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP {ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP.E {ra, s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP {ra, s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP.E {ra, s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP {ra, s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET.E {ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET {ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET.E {ra, s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET {ra, s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET.E {ra, s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET {ra, s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH.E {ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH {ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH.E {ra, s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH {ra, s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH.E {ra, s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH {ra, s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note data-line-1746">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  All the pseudo-instructions are valid for <code>RV32I/RV32E</code>, none are valid for <code>RV64I/RV128I</code>
</td>
</tr>
</table>
</div>
<div class="sect3 data-line-1749">
<h4 id="spimm">9.7.1. <code>spimm</code> encoding field</h4>
<div class="paragraph data-line-1751">
<p>The <code>stack_adjustment</code> field in the assembly syntax comprises of two components:</p>
</div>
<div class="olist arabic data-line-1753">
<ol class="arabic">
<li class="data-line-1753">
<p>the memory required for the registers in the list, rounded up to 16-bytes (using the <code>Align16</code> function below)</p>
</li>
<li class="data-line-1754">
<p>additional stack space allocated for local variables, encoded in the <code>spimm</code> field</p>
</li>
</ol>
</div>
<div class="listingblock data-line-1757">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">function Align16(i): return (i&gt;&gt;4)&lt;&lt;4; // make it 16-byte aligned
total_register_bytes = number_of_registers_in_reg_list * XLEN/8;
stack_adjustment = Align16(total_register_bytes) + spimm;</code></pre>
</div>
</div>
<div class="paragraph data-line-1763">
<p>The 16-bit encoding allows up to 7 additional 16-byte blocks (as <code>spimm</code> has up to 3-bits), and the 32-bit encoding allows up to 31.</p>
</div>
<table id="spimmrange_16" class="tableblock frame-all grid-all stretch data-line-1768">
<caption class="title">Table 44. C.PUSH/C.POP/C.POPRET valid values of stack adjustment</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">rlist</th>
<th class="tableblock halign-left valign-top">C.PUSH</th>
<th class="tableblock halign-left valign-top">C.PUSH.E</th>
<th class="tableblock halign-left valign-top">C.POPRET</th>
<th class="tableblock halign-left valign-top">C.POPRET.E</th>
<th class="tableblock halign-left valign-top">C.POP</th>
<th class="tableblock halign-left valign-top">C.POP.E</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s3}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -144</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -144</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 144</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 144</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 48</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 48</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s4}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -144</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 144</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 48</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s5}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -144</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 144</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 48</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s8}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-48 to -160</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48 to 160</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48 to 64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s11}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-64 to -176</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64 to 176</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64 to 80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
</tbody>
</table>
<table id="spimmrange_32_ra" class="tableblock frame-all grid-all stretch data-line-1784">
<caption class="title">Table 45. PUSH/POP/POPRET valid values of stack adjustment including ra</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">rlist</th>
<th class="tableblock halign-left valign-top">PUSH</th>
<th class="tableblock halign-left valign-top">PUSH.E</th>
<th class="tableblock halign-left valign-top">POP/POPRET</th>
<th class="tableblock halign-left valign-top">POP.E/POPRET.E</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 512</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 512</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 512</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 512</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s3}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 528</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s4}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 528</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s5}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s6}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s7}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-48 to -544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48 to 544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s8}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-48 to -544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48 to 544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s9}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-48 to -544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48 to 544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s10}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-48 to -544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48 to 544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s11}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-64 to -560</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64 to 560</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
</tbody>
</table>
<table id="spimmrange_32_no_ra" class="tableblock frame-all grid-all stretch data-line-1804">
<caption class="title">Table 46. PUSH/POP valid values of stack adjustment excluding ra</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">rlist</th>
<th class="tableblock halign-left valign-top">PUSH</th>
<th class="tableblock halign-left valign-top">PUSH.E</th>
<th class="tableblock halign-left valign-top">POP</th>
<th class="tableblock halign-left valign-top">POP.E</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 512</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 512</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 512</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{s0-s3}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 512</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{s0-s4}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 528</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{s0-s5}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 528</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{s0-s6}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{s0-s7}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{s0-s8}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-48 to -544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48 to 544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{s0-s9}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-48 to -544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48 to 544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{s0-s10}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-48 to -544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48 to 544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{s0-s11}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-48 to -544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48 to 544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note data-line-1822">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  <code>spimm</code> represents 16-byte blocks even on RV32E where the stack is 8-byte aligned. This is for simplicity.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note data-line-1826">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  if <code>spimm</code> is out of range for the compiler, <code>PUSH/POP/POPRET</code> can still be inferred, and the compiler can infer an additional stack adjust instruction
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1829">
<p>In many cases the 16-bit encoding is sufficient. The 32-bit encoding offers a larger <code>spimm</code> range, but this can also be achieved with a separate <code>c.addi sp, sp, #offset</code> instruction giving the same overall code-size.
Additional benefits of the 32-bit encoding are:</p>
</div>
<div class="ulist data-line-1832">
<ul>
<li class="data-line-1832">
<p>more accurate register lists improving performance and memory usage (so that superfluous <code>s</code> registers aren&#8217;t saved/restored)</p>
</li>
<li class="data-line-1833">
<p>direct control of the <code>mv</code> instructions (<code>PUSH</code>) improving performance (so that superfluous register moves aren&#8217;t executed)</p>
</li>
<li class="data-line-1834">
<p>better control over the return value (<code>POP/POPRET</code>) improving code-size.</p>
</li>
</ul>
</div>
</div>
<div class="sect3 data-line-1836">
<h4 id="_mv_ret_val_ra_rlist_for_the_32_bit_encodings">9.7.2. mv, ret_val, ra, rlist for the 32-bit encodings</h4>
<div class="paragraph data-line-1838">
<p>The registers in the <code>reg_list</code> are controlled by these fields</p>
</div>
<div class="paragraph data-line-1840">
<p>Note that <code>mv</code> and <code>ret_val</code> are in the same location in the encoding.</p>
</div>
<table id="32bit-mv" class="tableblock frame-all grid-all stretch data-line-1845">
<caption class="title">Table 47. <code>mv</code> values for the 32-bit encodings for <code>PUSH</code></caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">mv</th>
<th class="tableblock halign-left valign-top">ABI names</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a0-a1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a0-a2</p></td>
</tr>
</tbody>
</table>
<table id="32bit-ret_val" class="tableblock frame-all grid-all stretch data-line-1856">
<caption class="title">Table 48. <code>ret_val</code> values for the 32-bit encodings for <code>POP, POPRET</code></caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">return value</th>
<th class="tableblock halign-left valign-top">ABI names</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none (don&#8217;t set a0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a0=0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a0=1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a0=s0</p></td>
</tr>
</tbody>
</table>
<table id="32bit-ra" class="tableblock frame-all grid-all stretch data-line-1867">
<caption class="title">Table 49. <code>ra</code> values for the 32-bit encodings</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ra</th>
<th class="tableblock halign-left valign-top">ABI names</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra</p></td>
</tr>
</tbody>
</table>
<table id="32bit-rlist" class="tableblock frame-all grid-all stretch data-line-1876">
<caption class="title">Table 50. <code>rlist</code> field values for the 32-bit encodings</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">rlist</th>
<th class="tableblock halign-left valign-top">ABI names</th>
<th class="tableblock halign-left valign-top">ABI</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>s0-s1</code> are the same for the UABI or EABI so the encoding is the same</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">both</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">both</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">both</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UABI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>s2+</code> is different</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UABI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UABI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UABI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UABI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UABI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UABI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UABI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UABI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UABI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">EABI has <code>s2-s4</code> differently mapped</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EABI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EABI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EABI</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3 data-line-1899">
<h4 id="_rlist_ret_val_for_the_16_bit_encodings">9.7.3. <code>rlist</code>, <code>ret_val</code> for the 16-bit encodings</h4>
<table id="rlist-table" class="tableblock frame-all grid-all stretch data-line-1904">
<caption class="title">Table 51. <code>rlist</code> values for the 16-bit encodings</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">rlist</th>
<th class="tableblock halign-left valign-top">ABI names</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra, s0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra, s0-s1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra, s0-s2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">Following options for <code>C.PUSH/C.POPRET</code> only</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra, s0-s3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra, s0-s5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra, s0-s8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra, s0-s11</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-1917">
<p><code>ret_val</code> is as specified in <a href="#32bit-ret_val">Table 48</a>. Note that:</p>
</div>
<div class="ulist data-line-1919">
<ul>
<li class="data-line-1919">
<p><code>C.POPRET</code> allows bit 0 to vary, bit 1 is always 0</p>
</li>
<li class="data-line-1920">
<p><code>C.POP</code> always has <code>ret_val=0</code> to save encoding space</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2 data-line-1923">
<h3 id="fault-handling">9.8. Fault handling</h3>
<div class="paragraph data-line-1925">
<p>The sequence required to execute the instruction may be interrupted, or may not be able to start execution for several reasons.</p>
</div>
<div class="ulist data-line-1927">
<ul>
<li class="data-line-1927">
<p>virtual memory page fault or PMP fault</p>
<div class="ulist data-line-1928">
<ul>
<li class="data-line-1928">
<p>these can be detected before execution, or during execution if the memory addresses cross a page/PMP boundary</p>
</li>
</ul>
</div>
</li>
<li class="data-line-1929">
<p>watchpoint trigger</p>
<div class="ulist data-line-1930">
<ul>
<li class="data-line-1930">
<p>these can be detected before execution, or during execution depending on the trigger type (load data triggers require the sequence to have started executing, for example)</p>
</li>
</ul>
</div>
</li>
<li class="data-line-1931">
<p>external debug halt</p>
<div class="ulist data-line-1932">
<ul>
<li class="data-line-1932">
<p>the halt can treat the whole sequence atomically, or interrupt mid sequence (implementation defined)</p>
</li>
</ul>
</div>
</li>
<li class="data-line-1933">
<p>debug halt caused by a trigger</p>
<div class="ulist data-line-1934">
<ul>
<li class="data-line-1934">
<p>same comment as watchpoint trigger above</p>
</li>
</ul>
</div>
</li>
<li class="data-line-1935">
<p>load access fault</p>
<div class="ulist data-line-1936">
<ul>
<li class="data-line-1936">
<p>these are detected while the sequence is executing</p>
</li>
</ul>
</div>
</li>
<li class="data-line-1937">
<p>store access fault (precise or imprecise)</p>
<div class="ulist data-line-1938">
<ul>
<li class="data-line-1938">
<p>these may be detected while the sequence is executing, or afterwards if imprecise</p>
</li>
</ul>
</div>
</li>
<li class="data-line-1939">
<p>interrupts</p>
<div class="ulist data-line-1940">
<ul>
<li class="data-line-1940">
<p>these may arrive at any time. An implementation can choose whether to interrupt the sequence or not.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph data-line-1942">
<p>Because some faults can only be detected during the sequence the core implementation is able to recover from the fault and re-execute the sequence. This may involve executing some or all of the loads and stores from the sequence multiple times before the sequence completes (as multiple faults or multiple interrupts are possible).</p>
</div>
<div class="paragraph data-line-1944">
<p>Therefore correct execution requires that <code>sp</code> refers to idempotent memory (see <a href="#non-idem-mem">Section 9.9.3</a> for non-idempotent handling)</p>
</div>
</div>
<div class="sect2 data-line-1947">
<h3 id="software-view">9.9. Software view of execution</h3>
<div class="sect3 data-line-1949">
<h4 id="_software_view_of_push_sequence">9.9.1. Software view of <code>PUSH</code> sequence</h4>
<div class="paragraph data-line-1951">
<p>From a software perspective the <code>PUSH</code> sequence appears as:</p>
</div>
<div class="ulist data-line-1953">
<ul>
<li class="data-line-1953">
<p>A sequence of stores writing a contiguous block of memory. Any of the bytes may be written multiple times.</p>
</li>
<li class="data-line-1954">
<p>A stack pointer adjustment</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1956">
<p>Because the memory is idempotent and the stores are non-overlapping, they may be reordered, grouped into larger accesses, split into smaller access or any combination of these.</p>
</div>
<div class="paragraph data-line-1958">
<p>If an implementation allows interrupts during the sequence, and the interrupt handler uses <code>sp</code> to allocate stack memory, then any stores which were executed before the interrupt maybe be overwritten by the handler. This is safe because the memory is idempotent and the stores will be re-executed once the handler completes.</p>
</div>
<div class="paragraph data-line-1960">
<p>The stack pointer adjustment must only be committed once it is certain that all of the stores will complete within triggerring any precise faults (stores may return imprecise bus errors which are received after the instruction has completed execution).</p>
</div>
<div class="paragraph data-line-1962">
<p>For example:</p>
</div>
<div class="listingblock data-line-1965">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">c.push  {ra, s0-s5},{a0-a2}, -64</code></pre>
</div>
</div>
<div class="paragraph data-line-1969">
<p>Appears to software as:</p>
</div>
<div class="listingblock data-line-1972">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode"># any bytes from SP-1 to SP-28 may be written multiple times before the instruction completes
sw  ra, -4(sp);
sw  s0, -8(sp);
sw  s1,-12(sp);
sw  s2,-16(sp);
sw  s3,-20(sp);
sw  s4,-24(sp);
sw  s5,-28(sp);

# these must only execute once, and will only execute after all stores complete sucessfully
mv s0, a0;
mv s1, a1;
mv s2, a2;
addi sp, sp, -64;</code></pre>
</div>
</div>
</div>
<div class="sect3 data-line-1989">
<h4 id="_software_view_of_poppopret_sequence">9.9.2. Software view of <code>POP/POPRET</code> sequence</h4>
<div class="paragraph data-line-1991">
<p>From a software perspective the <code>POP/POPRET</code> sequence appears as:</p>
</div>
<div class="ulist data-line-1993">
<ul>
<li class="data-line-1993">
<p>A sequence of loads, any of which may be executed multiple times</p>
</li>
<li class="data-line-1994">
<p>A stack pointer adjustment</p>
</li>
<li class="data-line-1995">
<p>An optional <code>RET</code></p>
</li>
</ul>
</div>
<div class="paragraph data-line-1997">
<p>If an implementation allows interrupts during the sequence, then any loads which were executed before the interrupt may update architectural state. The loads will be re-executed once the handler completes, so the values will be overwritten. Therefore it is permitted for an implementation to update some of the destination registers before taking the interrupt or other fault.</p>
</div>
<div class="paragraph data-line-1999">
<p>The register moves and stack pointer adjustment must only be committed once it is certain that all of the loads will complete successfully.</p>
</div>
<div class="paragraph data-line-2001">
<p>For <code>POPRET</code> once the stack pointer adjustment has been committed the <code>RET</code> must execute.</p>
</div>
<div class="paragraph data-line-2003">
<p>For example:</p>
</div>
<div class="listingblock data-line-2006">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">popret   {ra, s0-s3}, {s1}, 32 ;</code></pre>
</div>
</div>
<div class="paragraph data-line-2010">
<p>Appears to software as:</p>
</div>
<div class="listingblock data-line-2013">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode"># any or all of these load instructions may execute multiple times
lw   ra, 28(sp);
lw   s0, 24(sp);
lw   s1, 20(sp);
lw   s2, 16(sp);
lw   s3, 12(sp);

# must only execute once, will only execute after all loads complete successfully
# all instructions must execute atomically
mv a0, s1
addi sp, sp, 32;
ret;</code></pre>
</div>
</div>
</div>
<div class="sect3 data-line-2028">
<h4 id="non-idem-mem">9.9.3. Non-idempotent memory</h4>
<div class="paragraph data-line-2030">
<p>An implementation may have a requirement to issue <code>PUSH/POP/POPRET</code> to non-idempotent memory.</p>
</div>
</div>
<div class="sect3 data-line-2032">
<h4 id="_error_detection">9.9.4. Error detection</h4>
<div class="paragraph data-line-2034">
<p>If the core implementation does not have a requirement to support <code>PUSH/POP/POPRET</code> to non-idempotent memories, and the core can use a PMA to detect that the memory is non-idempotent, then take a load(<code>POP/POPRET</code>) or store (<code>PUSH</code>) access fault exception.</p>
</div>
</div>
<div class="sect3 data-line-2036">
<h4 id="_non_idempotent_support">9.9.5. Non-idempotent support</h4>
<div class="paragraph data-line-2038">
<p>It is possible to support non-idempotent memory. One reason is to re-use <code>PUSH/POP</code> as a restricted form of a load/store multiple instruction to a peripheral (see <a href="#ldstm">Section 9.12</a>), as there is no generic load/store multiple instruction currently in the RISC-V ISA. If load/store multiple is supported in the future then it should support non-idempotent memory.</p>
</div>
<div class="paragraph data-line-2040">
<p>Non-idempotent memory support requires additional restrictions:</p>
</div>
<div class="olist arabic data-line-2042">
<ol class="arabic">
<li class="data-line-2042">
<p>Do not allow interrupts during execution</p>
</li>
<li class="data-line-2043">
<p>Do not allow external debug halt during execution</p>
</li>
<li class="data-line-2044">
<p>Detect any virtual memory page faults or PMP faults for the whole instruction before starting execution (instead of during the sequence)</p>
</li>
<li class="data-line-2045">
<p>Do not split / merge / reorder the generated memory accesses</p>
</li>
</ol>
</div>
<div class="paragraph data-line-2047">
<p>It is possible that one of the following will still occur during execution:</p>
</div>
<div class="olist arabic data-line-2049">
<ol class="arabic">
<li class="data-line-2049">
<p>Watchpoint trigger</p>
</li>
<li class="data-line-2050">
<p>Load/store access fault</p>
</li>
</ol>
</div>
<div class="paragraph data-line-2052">
<p>In these cases the core will jump to the debug or exception handler. If execution is required to continue afterwards (so the event is not fatal to the code execution), then the handler is required to do so in software.</p>
</div>
<div class="paragraph data-line-2054">
<p>By following these rules memory accesses will only ever be issued once, and in the order listed in the pseudo-code.</p>
</div>
<div class="paragraph data-line-2056">
<p>It is possible for implementations to follow these restricted rules and to safely access both types of memory. It is also possible for an implementation to use PMAs to detect the memory type and apply different rules, such as only allowing interrupts if accessing cacheable memory, for example.</p>
</div>
</div>
</div>
<div class="sect2 data-line-2058">
<h3 id="_toolchain_implementation">9.10. Toolchain implementation</h3>
<div class="paragraph data-line-2060">
<p><code>PUSH/POP/POPRET</code> can be generated by the compiler, but can also be added as an optimisation in the linker. If they are inferred at link time then they can also be used to optimise precompiled library code. This means that the libraries can be shipped without these instructions, but platforms which implement them can still benefit from the code-size saving.</p>
</div>
</div>
<div class="sect2 data-line-2062">
<h3 id="_assembly_examples">9.11. Assembly examples</h3>
<div class="sect3 data-line-2065">
<h4 id="push-example-1">9.11.1. C.PUSH RV32 UABI (16-byte aligned stack)</h4>
<div class="listingblock data-line-2068">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">c.push  {ra, s0-s5}, {a0-a2}, -64</code></pre>
</div>
</div>
<div class="paragraph data-line-2072">
<p>Encoding: rlist=5, spimm=32</p>
</div>
<div class="paragraph data-line-2074">
<p>Equivalent sequence:</p>
</div>
<div class="listingblock data-line-2077">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">sw  ra, -4(sp);
sw  s0, -8(sp);
sw  s1, -12(sp);
sw  s2, -16(sp);
sw  s3, -20(sp);
sw  s4, -24(sp);
sw  s5, -28(sp);
mv  s0, a0;
mv  s1, a1;
mv  s2, a2;
addi sp, sp, -64;</code></pre>
</div>
</div>
</div>
<div class="sect3 data-line-2091">
<h4 id="_c_push_rv32i_uabi_16_byte_aligned_stack">9.11.2. C.PUSH RV32I UABI (16-byte aligned stack)</h4>
<div class="listingblock data-line-2094">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">c.push {ra, s0-s1}, {a0-a1} -32</code></pre>
</div>
</div>
<div class="paragraph data-line-2098">
<p>Encoding: rlist=2, spimm=16</p>
</div>
<div class="paragraph data-line-2100">
<p>Equivalent sequence:</p>
</div>
<div class="listingblock data-line-2103">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">sw  ra, -4(sp);
sw  s0, -8(sp);
sw  s1, -12(sp);
mv s0, a0;
mv s1, a1;
addi sp, sp, -32;</code></pre>
</div>
</div>
</div>
<div class="sect3 data-line-2112">
<h4 id="_c_pop_rv32i_uabi_16_byte_aligned_stack">9.11.3. C.POP RV32I UABI (16-byte aligned stack)</h4>
<div class="listingblock data-line-2115">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">c.pop   {ra, s0-s7}, 160</code></pre>
</div>
</div>
<div class="paragraph data-line-2119">
<p>Encoding: rlist=6, spimm=112</p>
</div>
<div class="paragraph data-line-2121">
<p>Equivalent sequence:</p>
</div>
<div class="listingblock data-line-2124">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">lw   ra, 156(sp);
lw   s0, 152(sp);
lw   s1, 148(sp);
lw   s2, 144(sp);
lw   s3, 140(sp);
lw   s4, 136(sp);
lw   s5, 132(sp);
lw   s6, 128(sp);
lw   s7, 124(sp);
lw   s8, 120(sp);
addi sp, sp, 160</code></pre>
</div>
</div>
</div>
<div class="sect3 data-line-2139">
<h4 id="popret-example-1">9.11.4. C.POPRET RV32I UABI (16-byte aligned stack)</h4>
<div class="listingblock data-line-2142">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">c.pop   {ra, s0-s7},{s0}, 160</code></pre>
</div>
</div>
<div class="paragraph data-line-2146">
<p>Encoding: rlist=6, spimm=112</p>
</div>
<div class="paragraph data-line-2148">
<p>Equivalent sequence:</p>
</div>
<div class="listingblock data-line-2151">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">lw   ra, 156(sp);
lw   s0, 152(sp);
lw   s1, 148(sp);
lw   s2, 144(sp);
lw   s3, 140(sp);
lw   s4, 136(sp);
lw   s5, 132(sp);
lw   s6, 128(sp);
lw   s7, 124(sp);
lw   s8, 120(sp);
addi sp, sp, 160;
mv a0, s0;
ret</code></pre>
</div>
</div>
</div>
<div class="sect3 data-line-2167">
<h4 id="_pop_rv32i_uabi_16_byte_aligned_stack">9.11.5. POP RV32I UABI (16-byte aligned stack)</h4>
<div class="listingblock data-line-2170">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">pop   {ra, s0-s9}, {s0}, 256</code></pre>
</div>
</div>
<div class="paragraph data-line-2174">
<p>Encoding: ra=1, rlist=10, frlist=0, spimm=128 (16-byte aligned)</p>
</div>
<div class="paragraph data-line-2176">
<p>Micro operation sequence:</p>
</div>
<div class="listingblock data-line-2179">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">lw   ra, 252(sp);
lw   s0, 248(sp);
lw   s1, 244(sp);
lw   s2, 240(sp)
lw   s3, 236(sp);
lw   s4, 232(sp);
lw   s5, 228(sp);
lw   s6, 224(sp)
lw   s7, 220(sp);
lw   s8, 216(sp);
lw   s9, 212(sp);
mv   a0, s0
addi sp, sp, 256</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-2196">
<h3 id="ldstm">9.12. Appendix: Usage as load/store-multiple</h3>
<div class="paragraph data-line-2198">
<p><code>PUSH/POP</code> encodings can be reused as generic load/store multiple instructions. For example:</p>
</div>
<div class="listingblock data-line-2201">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">lui t0, 0xffff
sw  s5, 4c(t0)
sw  s4, 50(t0)
sw  s3, 54(t0)
sw  s2, 58(t0)
sw  s1, 5c(t0)
sw  s0, 60(t0)</code></pre>
</div>
</div>
<div class="paragraph data-line-2213">
<p>Can be replaced by</p>
</div>
<div class="listingblock data-line-2216">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">lui t0, 0xffff
addi sp, t0, 64
push {s0-s5}, -64</code></pre>
</div>
</div>
<div class="paragraph data-line-2224">
<p>This requires that  <code>sp</code> is saved before and restored after the sequence. Also <code>POP</code> can be used to replace the equivalent series of loads.</p>
</div>
<div class="paragraph data-line-2226">
<p>Even though there is not much code-size saving once the <code>sp</code> save/restore code has been included, and the restricted memory layout targetted by the instructions, there may be a performance benefit to doing this for small embedded cores. A load/store-multiple sequence may be issued to the peripheral bus as a single burst instead of multiple single accesses which individually require arbitration. In some cases this can save one or more cycles per access as the arbiter remains locked to the core until the sequence has completed.</p>
</div>
<div class="paragraph data-line-2228">
<p>If the target memory is non-idempotent then see <a href="#non-idem-mem">Section 9.9.3</a> for additional constraints.</p>
</div>
</div>
</div>
</div>
<h1 id="_verification_notes" class="sect0 data-line-2230">Verification notes</h1>
<div class="sect1 data-line-2232">
<h2 id="_existing_functionality">1. Existing functionality</h2>
<div class="sectionbody">
<div class="paragraph data-line-2234">
<p>Many of the instructions are 16-bit encodings of existing 32-bit instructions, therefore the verification should be a simple extension to existing tests and coverage. Additionally, the instructions are all very simple.
. C.SEXT.B, C.SEXT.H, (C.SEXT.W is a pseudo-instruction)
. C.ZEXT.B, C.ZEXT.H, C.ZEXT.W
. C.MUL, C.NOT, C.NEG
. C.LBU, C.LHU, C.SB, C.SH</p>
</div>
</div>
</div>
<div class="sect1 data-line-2240">
<h2 id="_simple_extensions_to_existing_functionality">2. Simple extensions to existing functionality</h2>
<div class="sectionbody">
<div class="paragraph data-line-2242">
<p>These instructions are extremely similar to existing instructions, so the verification tests and coverage should be a simple extension from existing tests and coverage:</p>
</div>
<div class="olist arabic data-line-2244">
<ol class="arabic">
<li class="data-line-2244">
<p>BEQI, BNEI</p>
<div class="olist loweralpha data-line-2245">
<ol class="loweralpha" type="a">
<li class="data-line-2245">
<p>these are immediate forms of BEQ and BNE, they compare a register value against an immediate instead of two register values</p>
</li>
</ol>
</div>
</li>
<li class="data-line-2246">
<p>LWGP, LWTP</p>
<div class="olist loweralpha data-line-2247">
<ol class="loweralpha" type="a">
<li class="data-line-2247">
<p>these have the same functionality as LW, but the base register is explicitly GP or TP and the immediate offset range is larger</p>
</li>
</ol>
</div>
</li>
<li class="data-line-2248">
<p>SWGP, SWTP</p>
<div class="olist loweralpha data-line-2249">
<ol class="loweralpha" type="a">
<li class="data-line-2249">
<p>these have the same functionality as SW, but the base register is explicitly GP or TP and the immediate offset range is larger</p>
</li>
</ol>
</div>
</li>
<li class="data-line-2250">
<p>MULI, MULIW</p>
<div class="olist loweralpha data-line-2251">
<ol class="loweralpha" type="a">
<li class="data-line-2251">
<p>same as MUL, MULW with an immediate operand, note that the register specifiers are only 3-bit (x8-x15)</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1 data-line-2253">
<h2 id="_new_arithmetic_functionality">3. New arithmetic functionality</h2>
<div class="sectionbody">
<div class="paragraph data-line-2255">
<p>MULIADD[W], ADDIADD[W] are different because they have two register sources and an immediate source. They are all the fused version of two or three instructions.</p>
</div>
<div class="paragraph data-line-2257">
<p><code>MULIADD</code> is equivalent to two or three fused instructions:</p>
</div>
<div class="listingblock data-line-2260">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">muliadd s0, s1, s2, 32</code></pre>
</div>
</div>
<div class="paragraph data-line-2264">
<p>is equivalant to</p>
</div>
<div class="listingblock data-line-2267">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">muli s0, s2, 32
add  s0, s0, s1</code></pre>
</div>
</div>
<div class="paragraph data-line-2272">
<p>or without using any Zce instructions:</p>
</div>
<div class="listingblock data-line-2275">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">li  s0, 32
mul s0, s0, s2
add s0, s0, s1</code></pre>
</div>
</div>
<div class="paragraph data-line-2281">
<p><code>ADDIADD</code> is equivalent to a fused version of two instructions:</p>
</div>
<div class="listingblock data-line-2284">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">addiadd s0, s1, s2, 32</code></pre>
</div>
</div>
<div class="paragraph data-line-2288">
<p>is equivalent to:</p>
</div>
<div class="listingblock data-line-2291">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">addi s0, s2, 32
add  s0, s0, s1</code></pre>
</div>
</div>
<div class="paragraph data-line-2296">
<p>Therefore the coverage is the same as the combined covergroups of the set of two or three sequential instructions, covering all combinations which are possible within the fused set for the legal set of operands to <code>MULIADD</code> and <code>ADDIADD</code>. Because of the 3-bit register specifiers the coverage space is smaller than you might imagine, and additionally the immediate range is smaller than the of the expanded sequence.</p>
</div>
</div>
</div>
<div class="sect1 data-line-2298">
<h2 id="_new_branch_functionality">4. New branch functionality</h2>
<div class="sectionbody">
<div class="paragraph data-line-2300">
<p><code>DECBGEZ</code> and <code>C.DECBGEZ</code> are also fused versions of two instructions:</p>
</div>
<div class="listingblock data-line-2303">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">decbgez  s2, 1, -48</code></pre>
</div>
</div>
<div class="paragraph data-line-2307">
<p>is equivalent to:</p>
</div>
<div class="listingblock data-line-2310">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">addi s2, s2, -1
bgez s2, -48</code></pre>
</div>
</div>
<div class="paragraph data-line-2315">
<p>Therefore the coverage is the same as for <code>ADDI/BGEZ</code> combined, noting the limited range of subtraction values (1,2,4,8) and the range of the branch offset (especially for <code>C.DECBGEZ</code>).</p>
</div>
</div>
</div>
<div class="sect1 data-line-2317">
<h2 id="_sequenced_functionality">5. Sequenced functionality</h2>
<div class="sectionbody">
<div class="paragraph data-line-2319">
<p><code>PUSH/POP/POPRET</code> execute a sequence of micro-ops to execute the whole instruction. As a result they are considerably more complex to verify than the other instructions.</p>
</div>
<div class="sect2 data-line-2321">
<h3 id="_cover_all_possible_sets_of_operands">5.1. Cover all possible sets of operands</h3>
<div class="paragraph data-line-2323">
<p><code>mv, rlist, ra, spimm</code> are all fields in the encoding.</p>
</div>
<table id="32pushpopsourcecoverage" class="tableblock frame-all grid-all stretch data-line-2328">
<caption class="title">Table 52. Coverage for PUSH/POP/POPRET source operands</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Instruction</th>
<th class="tableblock halign-left valign-top">Variables</th>
<th class="tableblock halign-left valign-top">Coverage bins</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH (<code>mv</code>=0)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rlist</code>(0 to 12) x <code>ra</code> (0 to 1) x <code>spimm</code> (0 to 15)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">416</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH (<code>mv</code>=1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rlist</code>(1 to 12) x <code>ra</code> (0 to 1) x <code>spimm</code> (0 to 15)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">384</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH (<code>mv</code>=2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rlist</code>(2 to 12) x <code>ra</code> (0 to 1) x <code>spimm</code> (0 to 15)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">352</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH (<code>mv</code>=3)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rlist</code>(3 to 12) x <code>ra</code> (0 to 1) x <code>spimm</code> (0 to 15)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">288</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rlist</code>(0 to 12) x <code>ret_val</code> (0 to 3) x <code>ra</code> (0 to 1) x <code>spimm</code> (0 to 15)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1664</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rlist</code>(0 to 12) x <code>ret_val</code> (0 to 3) x <code>spimm</code> (0 to 15)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">834</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-2338">
<p>The 16-bit encodings have ffar ewer coverage bins:</p>
</div>
<table id="16pushpopsourcecoverage" class="tableblock frame-all grid-all stretch data-line-2343">
<caption class="title">Table 53. Coverage for C.PUSH/C.POP/C.POPRET source operands</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Instruction</th>
<th class="tableblock halign-left valign-top">Variables</th>
<th class="tableblock halign-left valign-top">Coverage bins</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rlist</code>(0 to 7) x <code>spimm</code> (0 to 7)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rlist</code>(0 to 3) x <code>spimm</code> (0 to 1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rlist</code>(0 to 7) x <code>ret_val</code> (0 to 1) x <code>spimm</code> (0 to 7)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">128</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2 data-line-2350">
<h3 id="_test_the_functionality">5.2. Test the functionality</h3>
<div class="paragraph data-line-2352">
<p>Execution of every PUSH/POP/POPRET instruction must result in the same architectural state updates as executing the sequence that it expands into. For example:</p>
</div>
<div class="listingblock data-line-2355">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">popret   {ra, s0-s3}, {s1}, 32;</code></pre>
</div>
</div>
<div class="paragraph data-line-2359">
<p>causes identical architectural state updates to the expanded sequence:</p>
</div>
<div class="listingblock data-line-2362">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">lw   ra, 28(sp);
lw   s0, 24(sp);
lw   s1, 20(sp);
lw   s2, 16(sp);
lw   s3, 12(sp);
mv   a0, s1
addi sp, sp, 32;
ret</code></pre>
</div>
</div>
<div class="paragraph data-line-2373">
<p>Therefore a suggestion is to generate pairs of tests, one with the expanded sequences and one with <code>PUSH/POP/POPRET</code>. Each test must give identical results, including having the same contents in the memory.</p>
</div>
<div class="paragraph data-line-2375">
<p>It is also possible to introduce</p>
</div>
<div class="olist arabic data-line-2377">
<ol class="arabic">
<li class="data-line-2377">
<p>interrupts</p>
</li>
<li class="data-line-2378">
<p>debug triggers on the loads/stores in the sequence</p>
</li>
<li class="data-line-2379">
<p>external debug halts</p>
</li>
<li class="data-line-2380">
<p>load/store access faults due to bus errors or PMP faults</p>
</li>
<li class="data-line-2381">
<p>load/store page faults</p>
</li>
</ol>
</div>
<div class="paragraph data-line-2383">
<p>on the loads and stores in the sequence. <code>mepc</code> will be different between the two tests but <code>mcause</code> and <code>mtval</code> must match. Note that interrupts and external debug halts are asynchronous events, so to make the results from the two tests match then the handler must not (for example) count the number of interrupts taken.</p>
</div>
<div class="paragraph data-line-2385">
<p>Implementations may choose for the sequences to be uninterruptible, or to be interruptible and to restart after the <code>mret</code>. The overall result is the same - the sequence will eventually complete and correctly update the architectural state, providing any debug triggers are disabled in the handler before resuming execution (so they don&#8217;t trigger again)</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2387">
<h2 id="_table_jump_jump_table_mode_only">6. Table jump, jump table mode only</h2>
<div class="sectionbody">
<div class="paragraph data-line-2389">
<p>Table jump is quite simple architecturally.</p>
</div>
<div class="paragraph data-line-2391">
<p><code>tbljal #n;</code> references memory address <code>m = xTBLJALVEC + n * XLEN/8</code></p>
</div>
<div class="paragraph data-line-2393">
<p>The core to jump to address <code>m</code>, and link to the register referenced by bits[1:0] of the data at address <code>m</code>, including the illegal case where [1:0]=11</p>
</div>
<div class="paragraph data-line-2395">
<p>For verification we must show that the different link registers work and that the core jumps to the correct location each time.</p>
</div>
</div>
</div>
<h1 id="_rejected_and_postponed_instructions" class="sect0 data-line-2397">Rejected and postponed instructions</h1>
<div class="sect1 data-line-2399">
<h2 id="_not_benchmarked_push_fdq_pop_fdq_popret_fdq">1. Not benchmarked: PUSH.[FDQ], POP.[FDQ], POPRET.[FDQ]</h2>
<div class="sectionbody">
<div class="paragraph data-line-2401">
<p>Please read <a href="#pushpoppopret">Section 9</a> before reading this section.</p>
</div>
<div class="paragraph data-line-2403">
<p>These instructions are variants of <code>PUSH/POP/POPRET</code> which also allow <code>F</code> registers to be saved/restored.</p>
</div>
<div class="sect2 data-line-2405">
<h3 id="_assembler_syntax_2">1.1. Assembler Syntax</h3>
<div class="paragraph data-line-2407">
<p>These instructions require a register list including <code>fs</code> registers.</p>
</div>
<div class="listingblock data-line-2410">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">&lt;fsreg_list&gt; ::= &lt;ra&gt; "," &lt;sreg_range&gt; ", " &lt;freg_range&gt; | &lt;ra&gt; "," &lt;freg_range&gt; | &lt;sreg_range&gt; "," &lt;freg_range&gt; | &lt;freg_range&gt;
&lt;rfsreg_list&gt; ::= &lt;ra&gt; "," &lt;sreg_range&gt; ", " &lt;freg_range&gt; | &lt;ra&gt; "," &lt;freg_range&gt;
&lt;freg_range&gt; ::= &lt;fs0&gt; | &lt;fs0-fsM&gt; (valid values of M are 1,2,3,5,8,11)

//legal syntax

push.[fdq]   {&lt;fsreg_list&gt;},     -stack_adjustment
pop.[fdq]    {&lt;fsreg_list&gt;},      stack_adjustment
popret.[fdq] {&lt;rfsreg_list&gt;},     stack_adjustment //popret must include ra</code></pre>
</div>
</div>
<div class="paragraph data-line-2423">
<p>To be a legal encoding:</p>
</div>
<div class="olist arabic data-line-2425">
<ol class="arabic">
<li class="data-line-2425">
<p>The stack adjustment must be negative for <code>PUSH.[FDQ]</code> and positive for <code>POP.[FDQ]/POPRET.[FDQ]</code></p>
</li>
<li class="data-line-2426">
<p>The stack adjustment must be in range (see <a href="#spimm">Section 9.7.1</a>) and must be a multiple of 16</p>
</li>
<li class="data-line-2427">
<p>The register lists must be valid (see above)</p>
</li>
<li class="data-line-2428">
<p>For <code>POPRET.[FDQ]</code>, <code>rfsreg_list</code> must include <code>ra</code></p>
</li>
</ol>
</div>
<div class="paragraph data-line-2430">
<p>Additionally:</p>
</div>
<div class="olist arabic data-line-2432">
<ol class="arabic">
<li class="data-line-2432">
<p>If <code>sp</code> is not 16-byte aligned then take a load (<code>PUSH.[FDQ]</code>) or store (<code>POP.[FDQ]/POPRET.[FDQ]</code>) address misaligned exception, and do not issue any loads or stores.</p>
</li>
</ol>
</div>
<div class="admonitionblock note data-line-2435">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  When moving from loading or storing <code>x</code> registers to <code>f</code> registers there may be a gap as the registers may be different widths, and all registers must be aligned in memory
</td>
</tr>
</table>
</div>
<div class="sect3 data-line-2437">
<h4 id="_rationale_why_include_the_fdq_suffix">1.1.1. Rationale: why include the .[fdq] suffix</h4>
<div class="paragraph data-line-2439">
<p>It is required to hard-code the length of the <code>f</code> registers in the opcode, and not just save/restore the whole register. We must allow code compiled for the F-extension
to run on a  core which supports D and possibly Q. We must also allow code compiled for the D-extension to run on a core which supports Q.</p>
</div>
<div class="paragraph data-line-2442">
<p>If we don&#8217;t explicitly state the <code>f</code> register width and always store the whole register, then the registers will be stored at different addresses to the ones expected
by the compiler.</p>
</div>
<div class="paragraph data-line-2445">
<p>An alternative would be to use <code>misa.[FDQ]</code>
to directly control the behaviour and so set <code>misa.[DQ]=0</code> when running F code. Nothing else in the architecture requires this, so it seems unreasonable to
add this requirement here. This approach also wouldn&#8217;t work for <code>Z[FDQ]inx</code> cores as <code>misa.[FDQ]</code> are all hardwired to zero.</p>
</div>
</div>
</div>
<div class="sect2 data-line-2449">
<h3 id="_pseudo_code_2">1.2. Pseudo-code</h3>
<div class="paragraph data-line-2451">
<p>The pseudo-code below show the required architectural state updates.</p>
</div>
<div class="paragraph data-line-2453">
<p>Note that every architectural state update in the pseudo-code can be executed as a standard RISC-V 32-bit encoding, so that it is possible execute the instructions as sequences of standard instructions.</p>
</div>
<div class="paragraph data-line-2455">
<p>Because the pseudo-code includes load or store operations, they may take any fault caused by executing loads or stores. See <a href="#fault-handling">Section 9.8</a> for more details.</p>
</div>
<div class="sect3 data-line-2457">
<h4 id="_push_fdq_pseudo_code">1.2.1. PUSH.[FDQ] Pseudo-code</h4>
<div class="paragraph data-line-2459">
<p>The <code>PUSH.FDQ</code> instruction stores the set of registers from <code>fsreg_list</code> to consecutive memory locations, and decrements the stack pointer.
The pseudo-code uses assembly inserts so that it can use <code>fsw/fsd</code> etc.</p>
</div>
<div class="paragraph data-line-2462">
<p>The pseudo-code shows the memory and architectural state updates of the whole instruction which has completed without faults, debug halts or interrupts. See <a href="#fault-handling">Section 9.8</a> and <a href="#software-view">Section 9.9</a> for more information.</p>
</div>
<div class="admonitionblock note data-line-2465">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  <code>stack_adjustment</code> is negative.
</td>
</tr>
</table>
</div>
<div class="listingblock data-line-2468">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">//sp must be correctly aligned
if (sp[3:0])            {take_illegal_instruction_exception();}
if (rlist&gt;12)          {take_illegal_instruction_exception();}
if (rlist&gt;2 &amp;&amp; misa.E) {take_illegal_instruction_exception();}
if (misa.MXL==1) {bytes=4;}
if (misa.MXL==2) {bytes=8;}
else             {bytes=16;}
addr=sp;
if (ra) {
  addr-=bytes;
  switch(bytes) {
    4:  asm("sw ra, 0(addr)");
    8:  asm("sd ra, 0(addr)");
    16: asm("sq ra, 0(addr)");
  }
}
for(i in sreg_list)  {
  addr-=bytes;
  switch(bytes) {
    4:  asm("sw s[i], 0(addr)");
    8:  asm("sd s[i], 0(addr)");
    16: asm("sq s[i], 0(addr)");
  }
}
switch (opcode) {
  //if FLEN &gt; XLEN, then get the address back into alignment before saving the F registers
  "PUSH.D": while(addr% 8) {addr-=bytes;}
  "PUSH.Q": while(addr%16) {addr-=bytes;}
}
for(i in freg_list)  {
  switch (opcode) {
    "PUSH.F": {addr-= 4;asm("fsw fs[i], 0(addr)");}
    "PUSH.D": {addr-= 8;asm("fsd fs[i], 0(addr)");}
    "PUSH.Q": {addr-=16;asm("fsq fs[i], 0(addr)");}
  }
}
sp+=stack_adjustment; //decrement</code></pre>
</div>
</div>
</div>
<div class="sect3 data-line-2508">
<h4 id="_pop_fdqpopretfdq_pseudo_code">1.2.2. POP.[FDQ]/POPRET/[FDQ] Pseudo-code</h4>
<div class="paragraph data-line-2510">
<p>A <code>POP/POPRET</code> instruction loads the set of registers from <code>fsreg_list</code> from consecutive memory locations, and then increments the stack pointer.
The pseudo-code uses assembly inserts so that it can use <code>flw/fld/ret</code>.</p>
</div>
<div class="paragraph data-line-2513">
<p>The pseudo-code shows the architectural state updates of the whole instruction which has completed without faults, debug halts or interrupts. See <a href="#fault-handling">Section 9.8</a> and <a href="#software-view">Section 9.9</a> for more information.</p>
</div>
<div class="admonitionblock note data-line-2516">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  <code>stack_adjustment</code> is positive.
</td>
</tr>
</table>
</div>
<div class="listingblock data-line-2519">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">//sp must be correctly aligned
if (sp[3:0])            {take_illegal_instruction_exception();}
if (rlist&gt;12)          {take_illegal_instruction_exception();}
if (rlist&gt;2 &amp;&amp; misa.E) {take_illegal_instruction_exception();}
if (misa.MXL==1) {bytes=4;}
if (misa.MXL==2) {bytes=8;}
else             {bytes=16;}
addr=sp+stack_adjustment;
if (ra) {
  addr-=bytes;
  switch(bytes) {
    4:  asm("lw ra, 0(addr)");
    8:  asm("ld ra, 0(addr)");
    16: asm("lq ra, 0(addr)");

  }
}
for(i in sreg_list)  {
  addr-=bytes;
  switch(bytes) {
    4:  asm("lw s[i], 0(addr)");
    8:  asm("ld s[i], 0(addr)");
    16: asm("lq s[i], 0(addr)");
  }
}
switch (opcode) {
  //if FLEN &gt; XLEN, then get the address back into alignment before saving the F registers
  "POP.D", "POPRET.D": while(addr% 8) {addr-=bytes;}
  "POP.Q", "POPRET.Q": while(addr%16) {addr-=bytes;}
}
for(i in freg_list)  {
  switch (opcode) {
    "POP.F", "POPRET.F": {addr-= 4;asm("flw fs[i], 0(addr)");}
    "POP.D", "POPRET.D": {addr-= 8;asm("fld fs[i], 0(addr)");}
    "POP.Q", "POPRET.Q": {addr-=16;asm("flq fs[i], 0(addr)");}
  }
}
sp+=stack_adjustment; //increment
if (opcode == "POPRET") {
   asm("ret");
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-2564">
<h3 id="pushpoppopret32bitencodings">1.3. 32-bit Encodings</h3>
<div class="admonitionblock note data-line-2568">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  These encodings are provisional.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch data-line-2573">
<caption class="title">Table 54. push/pop 32-bit encodings</caption>
<colgroup>
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6676%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">31:27</th>
<th class="tableblock halign-left valign-top">26</th>
<th class="tableblock halign-left valign-top">25</th>
<th class="tableblock halign-left valign-top">24</th>
<th class="tableblock halign-left valign-top">23</th>
<th class="tableblock halign-left valign-top">22</th>
<th class="tableblock halign-left valign-top">21:20</th>
<th class="tableblock halign-left valign-top">19:18</th>
<th class="tableblock halign-left valign-top">17:16</th>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14:12</th>
<th class="tableblock halign-left valign-top">11:10</th>
<th class="tableblock halign-left valign-top">9: 7</th>
<th class="tableblock halign-left valign-top">6 : 0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="15"><p class="tableblock"><code>PUSH.[FDQ]</code> encodings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">0000000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">frlist</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rlist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH.F</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">0000000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">frlist</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rlist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH.D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">0000000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">frlist</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rlist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH.Q</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="15"><p class="tableblock"><code>POP.[FDQ]</code> encodings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">0000000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">frlist</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rlist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP.F</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">0000000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">frlist</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rlist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP.D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">0000000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">frlist</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rlist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP.Q</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="15"><p class="tableblock"><code>POPRET.[FDQ]</code> encodings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">0000000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">frlist</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rlist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET.F</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">0000000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">frlist</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rlist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET.D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">0000000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">frlist</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rlist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET.Q</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note data-line-2590">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  bits [23:22] are the <code>fdq</code> field
</td>
</tr>
</table>
</div>
<div class="admonitionblock note data-line-2593">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  <code>ra=1</code> for all <code>popret</code> encodings, it is not specified in the encoding
</td>
</tr>
</table>
</div>
<div class="sect3 data-line-2596">
<h4 id="_illegal_instructions_2">1.3.1. Illegal instructions</h4>
<div class="paragraph data-line-2598">
<p>The encoding takes the same behaviour as any floating point instruction if executed when disabled:</p>
</div>
<div class="ulist data-line-2600">
<ul>
<li class="data-line-2600">
<p>if <code>frlist&gt;0</code> and <code>misa.F==0</code></p>
</li>
<li class="data-line-2601">
<p>if <code>frlist&gt;0</code> and <code>fdq==1</code> and <code>misa.D==0</code></p>
</li>
<li class="data-line-2602">
<p>if <code>frlist&gt;0</code> and <code>fdq==2</code> and <code>misa.Q==0</code></p>
</li>
</ul>
</div>
<div class="paragraph data-line-2604">
<p>The following cases do not decode as <code>PUSH*/POP*/POPRET*</code></p>
</div>
<div class="ulist data-line-2606">
<ul>
<li class="data-line-2606">
<p>No registers are specified (<code>rlist, frlist</code> are both zero)</p>
</li>
<li class="data-line-2607">
<p><code>rlist&gt;14</code></p>
</li>
<li class="data-line-2608">
<p><code>fdq=3</code></p>
</li>
<li class="data-line-2609">
<p><code>rlist==13</code> and <code>frlist&gt;0</code> and the opcode doesn&#8217;t have an <code>[fdq]</code> suffix</p>
</li>
</ul>
</div>
</div>
<div class="sect3 data-line-2611">
<h4 id="_rational_rlist13_frlist0_saving_all_saved_registers">1.3.2. Rational: <code>rlist=13, frlist=0</code> saving all saved registers</h4>
<div class="paragraph data-line-2613">
<p>The debian distro does save all <code>s</code> and <code>fs</code> registers on a few occasions, so there is a special encoding for this case. I saw no justification for saving all <code>fs</code> registers <strong>without</strong> saving all <code>s</code> registers. It seems useful to have a form which saves all saved registers.</p>
</div>
<div class="paragraph data-line-2615">
<p>The programmable range for <code>frlist</code> doesn&#8217;t save many <code>fs</code> registers as <code>FPMark</code> only saves one or two and Debian rarely saves more than that.</p>
</div>
</div>
</div>
<div class="sect2 data-line-2617">
<h3 id="_encoding_fields">1.4. Encoding Fields</h3>
<div class="paragraph data-line-2619">
<p>See <a href="#spimm">Section 9.7.1</a>.</p>
</div>
<div class="listingblock data-line-2622">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">//the padding calculation requires SP to be 16-byte aligned before executing the instruction
if (FLEN&gt;XLEN &amp;&amp;
    number_of_registers_in_freg_list&gt;0 &amp;&amp;
    number_of_registers_in_reg_list % (FLEN/XLEN)&gt;0) {
  //need padding to ensure FLEN registers are aligned
  padding = (FLEN/XLEN - number_of_registers_in_reg_list % (FLEN/XLEN)) * XLEN/8;
} else {
  padding = 0
}
total_register_bytes = number_of_registers_in_reg_list * XLEN/8 + padding + number_of_registers_in_freg_list * FLEN/8;
stack_adjustment = Align16(total_register_bytes) + spimm;</code></pre>
</div>
</div>
<div class="paragraph data-line-2636">
<p>The bytes required for padding is simple - if FLEN==XLEN it&#8217;s always zero. If FLEN=2*XLEN it is 0 or 4. RV32Q is more complex (see below) but this is an unlikely configuration.
<code>n</code> is an integer in the tables so <code>2n</code> is always even, <code>2n+1</code> is always odd.</p>
</div>
<table id="padding-examples-RV32D" class="tableblock frame-all grid-all stretch data-line-2642">
<caption class="title">Table 55. RV32D padding examples, XLEN=32, FLEN=64</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">#Xreg</th>
<th class="tableblock halign-left valign-top">Padding required if accessing Fregs</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2n</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2n+1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4-bytes</p></td>
</tr>
</tbody>
</table>
<table id="padding-examples-RV64Q" class="tableblock frame-all grid-all stretch data-line-2651">
<caption class="title">Table 56. RV64Q padding examples, XLEN=64, FLEN=128</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">#Xreg</th>
<th class="tableblock halign-left valign-top">Padding required if accessing Fregs</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2n</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2n+1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4-bytes</p></td>
</tr>
</tbody>
</table>
<table id="padding-examples-RV32Q" class="tableblock frame-all grid-all stretch data-line-2660">
<caption class="title">Table 57. RV32Q padding examples, XLEN=32, FLEN=128</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">#Xreg</th>
<th class="tableblock halign-left valign-top">Padding required if accessing Fregs</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4n</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4n+1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4-bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4n+2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4n+3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12-bytes</p></td>
</tr>
</tbody>
</table>
<div class="sect3 data-line-2668">
<h4 id="_mv_ret_val_ra_frlist_rlist_for_the_32_bit_encodings">1.4.1. <code>mv, ret_val, ra, frlist, rlist</code> for the 32-bit encodings</h4>
<div class="paragraph data-line-2670">
<p>The registers in the <code>reg_list</code> are controlled by these fields</p>
</div>
<div class="paragraph data-line-2672">
<p>Note that <code>frlist</code>, <code>mv</code> and <code>ret_val</code> are in the same location in the encoding.</p>
</div>
<table id="32bit-frlist" class="tableblock frame-all grid-all stretch data-line-2677">
<caption class="title">Table 58. <code>frlist</code> values for the 32-bit encodings for <code>PUSH.[FDQ], POP.[FDQ], POPRET.[FDQ]</code></caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">frlist</th>
<th class="tableblock halign-left valign-top">ABI names</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none or <code>fs0-fs11</code> (see <code>rlist=13</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fs0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fs0-fs1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fs0-fs5</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-2685">
<p>See <a href="#32bit-mv">Table 47</a> for <code>mv</code>.</p>
</div>
<div class="paragraph data-line-2687">
<p>See <a href="#32bit-ra">Table 49</a> for <code>ra</code>.</p>
</div>
<table id="32bit-frlist" class="tableblock frame-all grid-all stretch data-line-2692">
<caption class="title">Table 59. <code>rlist</code> field values for PUSH.[FDQ]/POP.[FDQ]/POPRET.[FDQ]</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">rlist</th>
<th class="tableblock halign-left valign-top">ABI names</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s9</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s10</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s11</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><code>rlist=13</code> is valid if <code>frlist=0</code> for <code>[.fdq]</code> opcodes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s11,fs0-fs11</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">these values could be used for interrupt save/restore</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">14-15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2 data-line-2713">
<h3 id="_assembly_examples_2">1.5. Assembly examples</h3>
<div class="sect3 data-line-2715">
<h4 id="_push_f_rv32ifdq_uabi_16_byte_aligned_stack">1.5.1. PUSH.F RV32I[FDQ] UABI (16-byte aligned stack)</h4>
<div class="listingblock data-line-2718">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">push.f  {ra, s0-s4, fs0}, -64</code></pre>
</div>
</div>
<div class="paragraph data-line-2722">
<p>Encoding: ra=1, rlist=5, frlist=1, fdq=0, spimm=16 (16-byte aligned)</p>
</div>
<div class="paragraph data-line-2724">
<p>Micro operation sequence:</p>
</div>
<div class="listingblock data-line-2727">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">sw  ra,   -4(sp);
sw  s0,   -8(sp);
sw  s1,  -12(sp);
sw  s2,  -16(sp);
sw  s3,  -20(sp);
sw  s4,  -24(sp);
fsw fs0, -28(sp)
addi sp, sp, -64;</code></pre>
</div>
</div>
</div>
<div class="sect3 data-line-2738">
<h4 id="_push_d_rv64idq_uabi_16_byte_aligned_stack">1.5.2. PUSH.D RV64I[DQ] UABI (16-byte aligned stack)</h4>
<div class="listingblock data-line-2741">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">push.d  {ra, s0-s4, fs0}, -64</code></pre>
</div>
</div>
<div class="paragraph data-line-2745">
<p>Encoding: ra=1, rlist=5, frlist=1, fdq=1, spimm=0 (16-byte aligned)</p>
</div>
<div class="paragraph data-line-2747">
<p>Micro operation sequence:</p>
</div>
<div class="listingblock data-line-2750">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">sd  ra,  -8(sp);
sd  s0,  -16(sp);
sd  s1,  -24(sp);
sd  s2,  -32(sp);
sd  s3,  -40(sp);
sd  s4,  -48(sp);
fsd fs0, -56(sp)
addi sp, sp, -64;</code></pre>
</div>
</div>
</div>
<div class="sect3 data-line-2761">
<h4 id="_push_d_rv64idq_uabi_16_byte_aligned_stack_2">1.5.3. PUSH.D RV64I[DQ] UABI (16-byte aligned stack)</h4>
<div class="listingblock data-line-2764">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">push.d  {fs0-fs7}, -128</code></pre>
</div>
</div>
<div class="paragraph data-line-2768">
<p>Encoding: rlist=0, frlist=12, fdq=2, spimm=32 (16-byte aligned)</p>
</div>
<div class="paragraph data-line-2770">
<p>Micro operation sequence:</p>
</div>
<div class="listingblock data-line-2773">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">fsd  fs0,  -8(sp);
fsd  fs1, -16(sp);
fsd  fs2, -24(sp);
fsd  fs3, -32(sp);
fsd  fs5, -40(sp);
fsd  fs4, -48(sp);
fsd  fs6, -56(sp);
fsd  fs7, -64(sp);
fsd  fs8, -72(sp);
fsd  fs9, -80(sp);
fsd  fs10,-88(sp);
fsd  fs11,-96(sp);
addi sp, sp, -128;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2789">
<h2 id="_benchmarking_results_too_low">2. Benchmarking results too low</h2>
<div class="sectionbody">
<div class="sect2 data-line-2791">
<h3 id="_bgeui_bltui">2.1. BGEUI, BLTUI</h3>
<div class="paragraph data-line-2793">
<p>These allocate reserved encodings, and are similar to <a href="#cmpimmbr">Section 6.4</a> but have lower value. It&#8217;s possible that future use of these instructions will be found in later versions of <code>Zce</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch data-line-2798">
<caption class="title">Table 60. Rejected 32-bit encodings</caption>
<colgroup>
<col style="width: 7.6923%;">
<col style="width: 7.6923%;">
<col style="width: 7.6923%;">
<col style="width: 7.6923%;">
<col style="width: 7.6923%;">
<col style="width: 7.6923%;">
<col style="width: 7.6923%;">
<col style="width: 7.6923%;">
<col style="width: 7.6923%;">
<col style="width: 7.6923%;">
<col style="width: 7.6923%;">
<col style="width: 7.6923%;">
<col style="width: 7.6924%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">31:27</th>
<th class="tableblock halign-left valign-top">26:25</th>
<th class="tableblock halign-left valign-top">24</th>
<th class="tableblock halign-left valign-top">23</th>
<th class="tableblock halign-left valign-top">22:20</th>
<th class="tableblock halign-left valign-top">19:18</th>
<th class="tableblock halign-left valign-top">17:16</th>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14:12</th>
<th class="tableblock halign-left valign-top">11:10</th>
<th class="tableblock halign-left valign-top">9:7</th>
<th class="tableblock halign-left valign-top">6 : 0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">zcmpimm[5:1]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zcmpimm[0]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">offset[9:6]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">offset[5:1]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BGEUI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">zcmpimm[5:1]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zcmpimm[0]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">offset[9:6]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">offset[5:1]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BLTUI</p></td>
</tr>
</tbody>
</table>
<table id="rejected-cmpimmbr-branch_semantics" class="tableblock frame-all grid-all stretch data-line-2807">
<caption class="title">Table 61. Rejected compare immediate branch semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BGEUI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if (rs1&gt;=<sub>u</sub> zero_ext(zcmpimm)) target_pc=PC+offset; else target_pc=PC+4;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BLTUI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if (rs1&lt;<sub>u</sub>  zero_ext(zcmpimm)) target_pc=PC+offset; else target_pc=PC+4;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-2813">
<p>Assembly Examples</p>
</div>
<div class="listingblock data-line-2816">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">bgeu a5, 1,offset # if(a5&gt;= 1) branch_to(PC+offset) # unsigned comparison
bltu a5, 1,offset # if(a5&lt;  1) branch_to(PC+offset) # unsigned comparison</code></pre>
</div>
</div>
</div>
<div class="sect2 data-line-2821">
<h3 id="_c_lbusp_c_lhusp_c_sbsp_c_shsp">2.2. C.LBUSP, C.LHUSP, C.SBSP, C.SHSP</h3>
<div class="paragraph data-line-2823">
<p>These encodings require too much space for the benefit.</p>
</div>
<table id="ldstbhsprel-16encodings" class="tableblock frame-all grid-all stretch data-line-2828">
<caption class="title">Table 62. Rejected load/store half/byte SP relative 16-bit encodings</caption>
<colgroup>
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8832%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="17"><p class="tableblock">source/dest with one other source operand, stack pointer relative</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uimm[3]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">uimm[2:0]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LBUSP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uimm[3]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">uimm[2:1，4]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LHUSP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uimm[3]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs2'</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">uimm[2:0]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SBSP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uimm[3]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs2'</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">uimm[2:1，4]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SHSP</p></td>
</tr>
</tbody>
</table>
<table id="ldstbhsprel-semantics" class="tableblock frame-all grid-all stretch data-line-2840">
<caption class="title">Table 63. Rejected load/store byte/half SP relative semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LBUSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = zero_ext(Memory[sp + zero_ext(uimm)][ 7:0])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LHUSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = zero_ext(Memory[sp + zero_ext(uimm)][15:0])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SBSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Memory[sp + zero_ext(uimm)][ 7:0] = rs2'[ 7:0]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SHSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Memory[sp + zero_ext(uimm)][15:0] = rs2'[15:0]</p></td>
</tr>
</tbody>
</table>
<table id="ldstbh_sprel_32bit" class="tableblock frame-all grid-all stretch data-line-2851">
<caption class="title">Table 64. load/store byte/half SP relative assembly syntax and 32-bit equivalent instructions</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">assembly syntax</th>
<th class="tableblock halign-left valign-top">requirements for 16-bit encoding</th>
<th class="tableblock halign-left valign-top">32-bit extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LBUSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lbu    rd, imm(sp)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd is x8-x15, imm is in range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-extension</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LHUSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lhu    rd, imm(sp)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd is x8-x15, imm is in range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-extension</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SBSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sb     rd, imm(sp)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd is x8-x15, imm is in range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-extension</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SHSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sh     rd, imm(sp)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd is x8-x15, imm is in range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-extension</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-2859">
<p>Assembly Examples</p>
</div>
<div class="listingblock data-line-2862">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">lbu a5,20(sp)   # a5 = zero_ext(Memory(sp+20)[ 7:0])
lhu a5,20(sp)   # a5 = zero_ext(Memory(sp+20)[15:0])
sb  a5,20(sp)   # Memory(sp+20)[ 7:0] = a5[ 7:0]
sh  a5,20(sp)   # Memory(sp+20)[15:0] = a5[15:0]</code></pre>
</div>
</div>
</div>
<div class="sect2 data-line-2869">
<h3 id="_c_lsbnot_c_lsbset">2.3. C.LSBNOT / C.LSBSET</h3>
<div class="paragraph data-line-2871">
<p>The encodings are cheap, but the benefit is low.</p>
</div>
<table id="dyadic-16encodings" class="tableblock frame-all grid-all stretch data-line-2876">
<caption class="title">Table 65. simple instructions 16-bit encodings</caption>
<colgroup>
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8832%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs1'/rd'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">110</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LSBNOT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs1'/rd'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">111</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LSBSET</p></td>
</tr>
</tbody>
</table>
<table id="monsemantics" class="tableblock frame-all grid-all stretch data-line-2885">
<caption class="title">Table 66. simple instruction semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LSBNOT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = rd' XOR 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LSBSET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = rd' OR 1</p></td>
</tr>
</tbody>
</table>
<table id="mon-32bit" class="tableblock frame-all grid-all stretch data-line-2894">
<caption class="title">Table 67. simple instruction 32-bit equivalent instructions/pseudo-instructions</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">assembly syntax</th>
<th class="tableblock halign-left valign-top">requirements for 16-bit encoding</th>
<th class="tableblock halign-left valign-top">32-bit extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LSBNOT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lsbnot rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all registers x8-x15, rd==rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-extension</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LSBKEEP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lsbset rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all registers x8-x15, rd==rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-extension</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-2901">
<p>Assembly Examples</p>
</div>
<div class="listingblock data-line-2904">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">lsbnot a5;      # a5 = a5 XOR 1</code></pre>
</div>
</div>
</div>
</div>
</div>
<h1 id="_future_ideas" class="sect0 data-line-2909">Future ideas</h1>
<div class="sect1 data-line-2911">
<h2 id="_multiple_move_instructions">1. Multiple move instructions</h2>
<div class="sectionbody">
<div class="paragraph data-line-2913">
<p>These instructions have some problems:</p>
</div>
<div class="olist arabic data-line-2915">
<ol class="arabic">
<li class="data-line-2915">
<p>They either two register file write ports, or to be issued in a sequence.</p>
</li>
<li class="data-line-2916">
<p>C.MVA* use ABI names when specifying source registers, which is efficient but non-standard</p>
</li>
<li class="data-line-2917">
<p>There is no 32-bit encoding which makes sense, because each does the work of 2 x 16-bit encodings</p>
</li>
</ol>
</div>
<div class="paragraph data-line-2919">
<p>Therefore ratification is delayed, and some more thought is needed.</p>
</div>
<div class="sect2 data-line-2921">
<h3 id="_c_mvp">1.1. C.MVP</h3>
<div class="paragraph data-line-2923">
<p>The generic move uses standard x register numbers, and so it more standard than <code>C.MVA*S07</code>, however it takes a lot more encoding space. Both register pairs must be even/odd pairs (<code>rdp[0]=0, rsp[0]=0</code>) to reduce the encoding space requirement.</p>
</div>
<div class="admonitionblock note data-line-2927">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  Currently there are no 32-bit equivalent instructions, is it enough to expand to <strong>two</strong> 32-bit instructions?
</td>
</tr>
</table>
</div>
<div class="admonitionblock note data-line-2931">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  These are optional (<code>Zces</code>) as they require 2 register file write ports, or are sequenced.
</td>
</tr>
</table>
</div>
<table id="mvp-encoding" class="tableblock frame-all grid-all stretch data-line-2936">
<caption class="title">Table 68. generic double move 16-bit encoding</caption>
<colgroup>
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8832%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">rdp[4:1]</p></td>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">rsp[4:1]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MVP</p></td>
</tr>
</tbody>
</table>
<table id="mvp-semantics" class="tableblock frame-all grid-all stretch data-line-2944">
<caption class="title">Table 69. generic double move semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MVP rdp, rsp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mv rdp, rsp;  mv rdp+1, rsp+1</p></td>
</tr>
</tbody>
</table>
<table id="mvp-syntax" class="tableblock frame-all grid-all stretch data-line-2952">
<caption class="title">Table 70. <code>C.MV01S07, C.MV23S07</code> assembly syntax</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">assembly syntax</th>
<th class="tableblock halign-left valign-top">requirements for 16-bit encoding</th>
<th class="tableblock halign-left valign-top">32-bit extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MVP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mv(rdp,rsp),(rdp+1,rsp+1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note data-line-2959">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  Currently there are no 32-bit equivalent instructions, is it enough to expand to <strong>two</strong> 32-bit instructions?
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-2961">
<p>Assembly examples.</p>
</div>
<div class="listingblock data-line-2963">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode"># c.mvp: sreg1 = 0; sreg2 = 0;
mv (x2, x3), (x18, x19) ; # mv x2, x2; mv x18, x19</code></pre>
</div>
</div>
</div>
<div class="sect2 data-line-2968">
<h3 id="_c_mva01s07_c_mva23s07">1.2. C.MVA01S07, C.MVA23S07</h3>
<div class="paragraph data-line-2970">
<p>Register moves are the most common in GCC output in both the benchmark suite and the Debian distro. These two instructions combine two very common pairs of moves into single 16-bit encodings:</p>
</div>
<div class="ulist data-line-2972">
<ul>
<li class="data-line-2972">
<p>move from two <code>s[0-7]</code> registers into <code>a0</code> and <code>a1</code>.</p>
</li>
<li class="data-line-2973">
<p>move from two <code>s[0-7]</code> registers into <code>a2</code> and <code>a3</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note data-line-2977">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  The syntax takes ABI names not <code>x</code> register names, so it is unusual. However this allows much more frequent usage without increasing the encoding space requirement.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note data-line-2981">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  Currently there are no 32-bit equivalent instructions, is it enough to expand to <strong>two</strong> 32-bit instructions?
</td>
</tr>
</table>
</div>
<div class="admonitionblock note data-line-2985">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  These are optional (<code>Zces</code>) as they require 2 register file write ports, or are sequenced.
</td>
</tr>
</table>
</div>
<table id="proposed-16bit-encodings-4" class="tableblock frame-all grid-all stretch data-line-2991">
<caption class="title">Table 71. <code>C.MV01S07, C.MV23S07</code> 16-bit encoding</caption>
<colgroup>
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8832%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">sreg1</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">sreg2</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MVA01S07</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">sreg1</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">sreg2</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MVA23S07</p></td>
</tr>
</tbody>
</table>
<table id="mvs07_semantics" class="tableblock frame-all grid-all stretch data-line-3000">
<caption class="title">Table 72. <code>C.MV01S07, C.MV23S07</code> semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MVA01S07 sreg1, sreg2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mv a0, s[sreg1];  mv a1, s[sreg2]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MVA23S07 sreg1, sreg2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mv a2, s[sreg1];  mv a3, s[sreg2]</p></td>
</tr>
</tbody>
</table>
<table id="mvs07_syntax" class="tableblock frame-all grid-all stretch data-line-3009">
<caption class="title">Table 73. <code>C.MV01S07, C.MV23S07</code> assembly syntax</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">assembly syntax</th>
<th class="tableblock halign-left valign-top">requirements for 16-bit encoding</th>
<th class="tableblock halign-left valign-top">32-bit extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MVAS01S07</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mv(a0,a1),(sreg1,sreg2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MVAS23S07</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mv(a2,a3),(sreg1,sreg2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-3015">
<p>Assembly examples.</p>
</div>
<div class="listingblock data-line-3017">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode"># c.mva01s: sreg1 = 0; sreg2 = 0;
mv (a0, a1), (s0, s0) ; # mv a0, s0; mv a1, s0

# c.mva23s: sreg1 = 1; sreg2 = 3;
mv (a2, a3), (s1, s3) ; # mv a2, s1; mv a3, s3</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-04-20 18:15:04 UTC
</div>
</div>
</body>
</html>