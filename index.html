<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="Version 0.41">
<title>RISC-V Zce code-size reduction extension proposal v0.41</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article toc2 toc-left data-line-1">
<div id="header">
<h1>RISC-V Zce code-size reduction extension proposal v0.41</h1>
<div class="details">
<span id="author" class="author">Version 0.41</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_spec_update_history">1. Spec update history</a></li>
<li><a href="#_issues">2. Issues</a></li>
<li><a href="#_zce_configurations">3. <code>Zce</code> configurations</a></li>
<li><a href="#_c_extension_subsets">4. C-extension subsets</a></li>
<li><a href="#_allocation_of_new_16_bit_encodings">5. Allocation of new 16-bit encodings</a>
<ul class="sectlevel2">
<li><a href="#_16_bit_encoding_code_points">5.1. 16-bit encoding code-points</a></li>
</ul>
</li>
<li><a href="#_zcea_definition">6. <code>Zcea</code> definition</a>
<ul class="sectlevel2">
<li><a href="#_c_sext_b_c_sext_h_c_zext_b_c_zext_h_c_zext_w_c_mul_c_not_c_neg">6.1. C.SEXT.B, C.SEXT.H, C.ZEXT.B, C.ZEXT.H, C.ZEXT.W, C.MUL, C.NOT, C.NEG</a></li>
<li><a href="#_c_sext_w">6.2. C.SEXT.W</a></li>
<li><a href="#_c_mva01s07">6.3. C.MVA01S07</a></li>
<li><a href="#_muli">6.4. MULI</a></li>
<li><a href="#cmpimmbr">6.5. BEQI, BNEI</a></li>
<li><a href="#_table_jump">6.6. Table Jump</a>
<ul class="sectlevel3">
<li><a href="#tablejump16">6.6.1. C.TBLJ, C.TBLJAL, C.TBLJALM</a></li>
</ul>
</li>
<li><a href="#pushpoppopret_heading">6.7. PUSH and POP</a>
<ul class="sectlevel3">
<li><a href="#pushpop32">6.7.1. PUSH, POP, POPRET, PUSH.E, POP.E, POPRET.E</a></li>
<li><a href="#pushpop16">6.7.2. C.PUSH, C.POP, C.POPRET, C.PUSH.E, C.POP.E, C.POPRET.E</a></li>
</ul>
</li>
<li><a href="#_b_extension_recommended_subsets_for_code_size_reduction">6.8. B-extension recommended subsets for code-size reduction</a></li>
</ul>
</li>
<li><a href="#_zceb_definition">7. <code>Zceb</code> definition</a>
<ul class="sectlevel2">
<li><a href="#_decrement_and_branch">7.1. Decrement and branch</a>
<ul class="sectlevel3">
<li><a href="#decbr16">7.1.1. C.DECBNEZ</a></li>
<li><a href="#_decbnez_limited_value">7.1.2. DECBNEZ (limited value?)</a></li>
</ul>
</li>
<li><a href="#_lwgp_swgp_ldgp_sdgp">7.2. LWGP, SWGP, LDGP, SDGP</a></li>
<li><a href="#_c_lbu_c_lhu_c_lb_c_lh_c_sb_c_sh">7.3. C.LBU, C.LHU, C.LB, C.LH, C.SB, C.SH</a></li>
</ul>
</li>
<li><a href="#tablejump">8. Table Jump</a>
<ul class="sectlevel2">
<li><a href="#_rationale">8.1. Rationale</a></li>
<li><a href="#_encoding">8.2. Encoding</a></li>
<li><a href="#configuringthejumptable">8.3. Recommended algorithm for allocating entries in the jump table</a></li>
<li><a href="#_csrs">8.4. CSRs</a></li>
<li><a href="#_jump_table_mode">8.5. Jump table mode</a>
<ul class="sectlevel3">
<li><a href="#_pseudo_code_for_jump_table_mode">8.5.1. Pseudo-code for jump table mode</a></li>
<li><a href="#_exceptions_for_jump_table_mode">8.5.2. Exceptions for jump table mode</a></li>
<li><a href="#_context_switching_for_jump_table_mode">8.5.3. Context Switching for jump table mode</a></li>
<li><a href="#_caching_for_jump_table_mode">8.5.4. Caching for jump table mode</a></li>
</ul>
</li>
<li><a href="#vector-table-mode">8.6. Future Mode: Vector table mode (not for RVM22/RVA22)</a>
<ul class="sectlevel3">
<li><a href="#_pseudo_code_for_vector_table_mode">8.6.1. Pseudo-code for vector table mode</a></li>
<li><a href="#_vector_table_code">8.6.2. vector table code</a></li>
<li><a href="#_vector_mode_security_future_ideas">8.6.3. Vector Mode Security (future ideas)</a></li>
</ul>
</li>
<li><a href="#emulation-mode">8.7. Future Mode: Emulation Mode (not for RVM22/RVA22)</a>
<ul class="sectlevel3">
<li><a href="#_pseudo_code_for_emulation_mode">8.7.1. Pseudo-code for emulation mode</a></li>
</ul>
</li>
<li><a href="#_diagram_for_all_table_jump_modes">8.8. Diagram for all table jump modes</a></li>
</ul>
</li>
<li><a href="#pushpoppopret">9. PUSH and POP</a>
<ul class="sectlevel2">
<li><a href="#_a_brief_example_from_zephyr">9.1. A brief example from Zephyr</a></li>
<li><a href="#_uabi_and_eabi_support">9.2. UABI and EABI support</a></li>
<li><a href="#_assembler_syntax">9.3. Assembler Syntax</a>
<ul class="sectlevel3">
<li><a href="#_32_bit_encoding_assembler_syntax">9.3.1. 32-bit encoding assembler syntax</a></li>
<li><a href="#_16_bit_encoding_assembler_syntax">9.3.2. 16-bit encoding assembler syntax</a></li>
</ul>
</li>
<li><a href="#_determining_xlen_to_decode_and_execute_the_instructions">9.4. Determining XLEN to decode and execute the instructions</a></li>
<li><a href="#_pseudo_code">9.5. Pseudo-code</a>
<ul class="sectlevel3">
<li><a href="#_pushpush_ec_pushc_push_e_pseudo_code">9.5.1. PUSH/PUSH.E/C.PUSH/C.PUSH.E Pseudo-code</a></li>
<li><a href="#_poppop_epopretpopret_ec_popc_pop_ec_popretc_popret_e_pseudo_code">9.5.2. POP/POP.E/POPRET/POPRET.E/C.POP/C.POP.E/C.POPRET/C.POPRET.E Pseudo-code</a></li>
</ul>
</li>
<li><a href="#pushpoppopret32bitencodings">9.6. 32-bit Encodings</a>
<ul class="sectlevel3">
<li><a href="#_illegal_instructions">9.6.1. Illegal instructions</a></li>
</ul>
</li>
<li><a href="#pushpoppopret16bitIencodings">9.7. 16-bit Encodings</a>
<ul class="sectlevel3">
<li><a href="#spimm">9.7.1. <code>spimm</code> encoding field</a></li>
<li><a href="#total-stack-rv32">9.7.2. Total stack adjustment ranges for RV32</a></li>
<li><a href="#total-stack-rv64">9.7.3. Total stack adjustment ranges for RV64</a></li>
</ul>
</li>
<li><a href="#fault-handling">9.8. Fault handling</a></li>
<li><a href="#software-view">9.9. Software view of execution</a>
<ul class="sectlevel3">
<li><a href="#_software_view_of_push_sequence">9.9.1. Software view of <code>PUSH</code> sequence</a></li>
<li><a href="#_software_view_of_poppopret_sequence">9.9.2. Software view of <code>POP/POPRET</code> sequence</a></li>
<li><a href="#non-idem-mem">9.9.3. Non-idempotent memory</a></li>
<li><a href="#_error_detection">9.9.4. Error detection</a></li>
<li><a href="#_non_idempotent_support">9.9.5. Non-idempotent support</a></li>
</ul>
</li>
<li><a href="#_toolchain_implementation">9.10. Toolchain implementation</a>
<ul class="sectlevel3">
<li><a href="#_compiling_for_size_or_performance">9.10.1. Compiling for size or performance</a></li>
</ul>
</li>
<li><a href="#_assembly_examples">9.11. Assembly examples</a>
<ul class="sectlevel3">
<li><a href="#push-example-1">9.11.1. C.PUSH RV32 UABI (16-byte aligned stack)</a></li>
<li><a href="#_c_push_rv32i_uabi_16_byte_aligned_stack">9.11.2. C.PUSH RV32I UABI (16-byte aligned stack)</a></li>
<li><a href="#_c_pop_rv32i_uabi_16_byte_aligned_stack">9.11.3. C.POP RV32I UABI (16-byte aligned stack)</a></li>
<li><a href="#popret-example-1">9.11.4. C.POPRET RV32I UABI (16-byte aligned stack)</a></li>
<li><a href="#_pop_rv32i_uabi_16_byte_aligned_stack">9.11.5. POP RV32I UABI (16-byte aligned stack)</a></li>
</ul>
</li>
<li><a href="#ldstm">9.12. Appendix: Usage as load/store-multiple</a></li>
</ul>
</li>
<li><a href="#_verification_notes">Verification notes</a>
<ul class="sectlevel1">
<li><a href="#_existing_functionality">1. Existing functionality</a></li>
<li><a href="#_simple_extensions_to_existing_functionality">2. Simple extensions to existing functionality</a></li>
<li><a href="#_new_branch_functionality">3. New branch functionality</a></li>
<li><a href="#_sequenced_functionality">4. Sequenced functionality</a>
<ul class="sectlevel2">
<li><a href="#_cover_all_possible_sets_of_operands">4.1. Cover all possible sets of operands</a></li>
<li><a href="#_test_the_functionality">4.2. Test the functionality</a></li>
</ul>
</li>
<li><a href="#_table_jump_jump_table_mode_only">5. Table jump, jump table mode only</a></li>
</ul>
</li>
<li><a href="#_rejected_and_postponed_instructions">Rejected and postponed instructions</a>
<ul class="sectlevel1">
<li><a href="#_not_benchmarked_push_fdq_pop_fdq_popret_fdq">1. Not benchmarked: PUSH.[FDQ], POP.[FDQ], POPRET.[FDQ]</a>
<ul class="sectlevel2">
<li><a href="#_assembler_syntax_2">1.1. Assembler Syntax</a>
<ul class="sectlevel3">
<li><a href="#_rationale_why_include_the_fdq_suffix">1.1.1. Rationale: why include the .[fdq] suffix</a></li>
</ul>
</li>
<li><a href="#_pseudo_code_2">1.2. Pseudo-code</a>
<ul class="sectlevel3">
<li><a href="#_push_fdq_pseudo_code">1.2.1. PUSH.[FDQ] Pseudo-code</a></li>
<li><a href="#_pop_fdqpopretfdq_pseudo_code">1.2.2. POP.[FDQ]/POPRET/[FDQ] Pseudo-code</a></li>
</ul>
</li>
<li><a href="#pushpoppopret32bitencodings">1.3. 32-bit Encodings</a>
<ul class="sectlevel3">
<li><a href="#_illegal_instructions_2">1.3.1. Illegal instructions</a></li>
<li><a href="#_rational_rlist13_frlist0_saving_all_saved_registers">1.3.2. Rational: <code>rlist=13, frlist=0</code> saving all saved registers</a></li>
</ul>
</li>
<li><a href="#_encoding_fields">1.4. Encoding Fields</a>
<ul class="sectlevel3">
<li><a href="#_mv_ret_val_ra_frlist_rlist_for_the_32_bit_encodings">1.4.1. <code>mv, ret_val, ra, frlist, rlist</code> for the 32-bit encodings</a></li>
</ul>
</li>
<li><a href="#_assembly_examples_2">1.5. Assembly examples</a>
<ul class="sectlevel3">
<li><a href="#_push_f_rv32ifdq_uabi_16_byte_aligned_stack">1.5.1. PUSH.F RV32I[FDQ] UABI (16-byte aligned stack)</a></li>
<li><a href="#_push_d_rv64idq_uabi_16_byte_aligned_stack">1.5.2. PUSH.D RV64I[DQ] UABI (16-byte aligned stack)</a></li>
<li><a href="#_push_d_rv64idq_uabi_16_byte_aligned_stack_2">1.5.3. PUSH.D RV64I[DQ] UABI (16-byte aligned stack)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_benchmarking_results_too_low">2. Benchmarking results too low</a>
<ul class="sectlevel2">
<li><a href="#_tbljal_32_bit_encoding">2.1. TBLJAL (32-bit encoding)</a></li>
<li><a href="#_lwtp_swtp_ldtp_sdtp">2.2. LWTP, SWTP, LDTP, SDTP</a></li>
<li><a href="#_muliadd_addiadd_muliw_muliaddw_addiaddw">2.3. MULIADD, ADDIADD, MULIW, MULIADDW, ADDIADDW</a></li>
<li><a href="#_bgeui_bltui">2.4. BGEUI, BLTUI</a></li>
<li><a href="#_c_lbusp_c_lhusp_c_sbsp_c_shsp">2.5. C.LBUSP, C.LHUSP, C.SBSP, C.SHSP</a></li>
<li><a href="#_c_lsbnot_c_lsbset">2.6. C.LSBNOT / C.LSBSET</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_future_ideas">Future ideas</a>
<ul class="sectlevel1">
<li><a href="#_multiple_move_instructions">1. Multiple move instructions</a>
<ul class="sectlevel2">
<li><a href="#_c_mvp">1.1. C.MVP</a></li>
<li><a href="#_c_mva23s07">1.2. C.MVA23S07</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph data-line-13">
<p>This document describes the <code>Zce</code> extension to reduce code-size.</p>
</div>
</div>
</div>
<div class="sect1 data-line-15">
<h2 id="_spec_update_history">1. Spec update history</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch data-line-17">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">change</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.41</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bug fix: change MULI encoding, as it overlapped with SLLI (it&#8217;s now in custom-0, so will have to change again in the future)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bug fix: C.TBLJ and C.TBLJALM were reserved in the encoding table and example usage</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.40</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Stable version for toolchain/simulator prototyping</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Split C.TBLJAL into C.TBLJ, C,TBLJAL, C.TBLJALM. The encoding is the same, the link register is chosen based on the table index.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.34</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Update encodings as requested by John Hauser for 16-bit encodings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Update C.TBLJAL encoding</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Change C.PUSH etc encodings, and adjust register lists and spimm ranges. No change to 32-bit encodings.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Put BEQI/BNEI in the BRANCH major opcode with funct3=01x, update branch offset range and make comparison immediate unsigned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reinstate C.MVA01S07 (will get renamed at some point)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">remove MULIW, ADDIADD*, MULIADD*, change encoding for MULI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add C.LB, C.LH</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove LWTP/SWTP/LDTP/SDTP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">remove TBLJAL - 0.01% benefit occasionally</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mark DECBNEZ as "limited value" - we may well remove it in the future</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.33</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0 as a return value is UNSAFE for pop/popret, as the sequence is not restartable. Only returning constant values 0/1/-1 (only 0 for C.POPRET)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Simplify PUSH/POP/POPRET to remove ra option (very rare not to include ra)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Increase PUSH/C.PUSH embedded moves to include a3, and make them consistent with between PUSH and C.PUSH (PUSH has the option not to do any so as not to waste performance).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">John Hauser feedback: Update encodings for C.SB/C.SH/C.LBU/C.LHU/C.DECBNEZ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Warning</strong> C.PUSH/C.POP/C.POPRET encodings will change in the next revision</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replace DECBGEZ with DECBNEZ as it&#8217;s better for the compiler</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For C.PUSH/C.POPRET change register list to include s7 instead of s8 as it greatly reduces the number of wasted load/stores (16% for debian, 4% for the other benchmarks) and has no effect on code-size</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fix POP/POPRET pseudo-code - it was doing "mv a0, s0" <em>after</em> "ld s0,sp(n)" instead of before so the return value would have been wrong</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">for C.POPRET change ret_val to only be "mv a0, s0" not "mv a0, 0" as s0 is more commonly used</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For PUSH also allow "mv s3, a3" up to "mv s6, a6", I&#8217;d forgotten to allocate 4 encodings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For C.PUSH increase the embedded moves to include s3 to improve the code-size reduction.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tighten up the Memory[] used in the semantics to specify that it&#8217;s XLEN bits wide, and whether it&#8217;s Instruction or Data memory as the endianness handling may be different (according to Allen Baum)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.31</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fix Allen Baum&#8217;s feedback including removing Zba/Zbb requirement and making them a recommendation only. There&#8217;s no written policy requiring 32-bit versions of 16-bit encodings as far as I know, and we&#8217;re not planning to fully benchmark Zba/Zbb for code-size.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">careful proofreading and updated C.POP encoding for simpler decode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.29.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">updated c.sext, c.zext, c.not, c.neg assembler syntax to match the 32-bit encodings, fix Align16 function</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.29.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">change SPIMM definition so the encoding sets bits [8:4] not [4:0] to make it obvious it&#8217;s a multiple of 16</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fixed C.PUSH/C.POP etc. encodings as they overlapped</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.29.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add ZCE-type format for push/pop/popret and tbljal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.29</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add EABI versions of 32-bit encodings of PUSH/POP/POPRET, and move encodings of PUSH/POP/POPRET/BEQI/BNEI to custom-0 as I chose bad encodings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.28</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">change alignment check of all non FP forms of PUSH/POP/POPRET to 8-byte not 16-byte to allow EABI compatibility. SPIMM still allocates blocks of 16-bytes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.27</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">add tentative versions of C.PUSH.E/C.POP.E/C.POPRET.E, need to review them</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.26</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">simplify and rename subsets. Re-encode LWGP/SWGP etc. Add LDWP/SDGP etc. Re-encode DECBGEZ. Re-encode C.SEXT.B, C.SEXT.H, C.NOT, C.NEG following Greg Favor&#8217;s recommendation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add Zcee for inclusion in RVA22</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">add illegal combinations of mv and rcount into PUSH spec</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">added verification notes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.23</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">add C.ZEXT.W and Zba for the 32-bit version</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">group encodings closer together to hopefully allocate 16-bit encoding space to Zce. Put code points numbers into the tables</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.21</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">remove SEXT.W as it&#8217;s an existing pseudo-instruction, and also remove ZEXT.W as it requires Zbp (which is otherwise is <strong>not</strong> required).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove C.LSBKEEP as it&#8217;s the same as C.ANDI, rs, 1. Postpone C.LSBSET.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tidy up encodings of C.[SX]EXT.[BH] so we don&#8217;t leave gaps</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add code-point information</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Put MULI[W]/MULIADD[W] into Zcecm</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POSTPONE PUSH.[FDQ]/POP.[FDQ]/POPRET.[FDQ].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replace C.LSBNOT with C.LSBSET and also add C.LSBKEEP.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove BGEUI, BLTUI, C.LSBNOT, C.LBUSP, C.LHUSP, C.SBSP, C.SHSP as benchmarking results are low</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Put C.MVP/C.MVA*S07 into a "future work" category as they need more thought</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reduced C.TBLJAL immediate to 8-bits, the 9th bit didn&#8217;t pay for itself</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Note EABI compatibility in PUSH/POP/POPRET</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Update C.NOT/C.NEG assembler syntax</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.18</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Separate C.MUL into Zcecm to avoid the dependancy on M, so Zcec has one subset (but is still the same ratification group)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add Zbb and possibly Zba (open issue)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add Zces[fdq] subsets</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">add B-ext pseudo-ops and pack/packw into Zcec for 32-bit forms of new instructions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BNEI/BEQI/MULI/MULIADD/ADDIADD moved from Zced to Zcec. Found encodings for B*I and DECBGEZ to allow Zced+Zdinx. Reduced cmpimm range for BNEI/BEQI to fit the encoding. Allocated provisional encodings for all 32-bit instructions. Fixed width of frcount, mv in PUSH/POP encodings.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">split LWGP/SWGP into LWGP/SWGP and LWTP/SWTP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reduce ret_val to 2-bits for POP/POPRET</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add C.SEXT.W, C.ZEXT.W, MULI, MULIADDW, ADDIADDW, and change the C.[SZ]EXT.* encodings. Rename flen PUSH/POP encoding field to fdq to avoid confusion with FLEN.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1 data-line-82">
<h2 id="_issues">2. Issues</h2>
<div class="sectionbody">
<div class="ulist data-line-84">
<ul>
<li class="data-line-84">
<p><code>MULI</code> has a temporary encoding</p>
</li>
<li class="data-line-85">
<p>should the fault handling in <code>push/pop/popret</code> be profile defined, or is platform defined ok?</p>
</li>
<li class="data-line-86">
<p>is a hypervisor version of <code>xTBLJALVEC</code> required for <code>tbljal</code>?</p>
</li>
<li class="data-line-87">
<p><code>xTBLJALVEC</code> need addresses to be allocated</p>
</li>
<li class="data-line-88">
<p>EABI spec is not frozen - so it&#8217;s not clear which formats of PUSH.E etc that I need</p>
<div class="ulist data-line-89">
<ul>
<li class="data-line-89">
<p>currently s4 is the maximum EABI saved register, which doesn&#8217;t match a 16-bit format register list (which end at s3, s5, s7, s11) I&#8217;d prefer it if the register lists match for the UABI and EABI for a simpler spec.</p>
</li>
</ul>
</div>
</li>
<li class="data-line-90">
<p>May need an EABI version of <code>C.MVA01S07</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1 data-line-92">
<h2 id="_zce_configurations">3. <code>Zce</code> configurations</h2>
<div class="sectionbody">
<div class="imageblock data-line-94">
<div class="content">
<img src="https://github.com/riscv/riscv-code-size-reduction/blob/master/ISA%20proposals/Huawei/Zce_subsets%20simplified.png" alt="Zce subsets">
</div>
</div>
<div class="paragraph data-line-96">
<p><code>Zce</code> is split into two main subsets</p>
</div>
<div class="ulist data-line-98">
<ul>
<li class="data-line-98">
<p><code>Zcea</code> which is compatible with all existing standard extensions designed for small embedded cores</p>
<div class="ulist data-line-99">
<ul>
<li class="data-line-99">
<p><code>Zcee</code> is a simpler subset of <code>Zcea</code> for high performance cores, it can be implemented without the test of <code>Zcwa</code></p>
</li>
</ul>
</div>
</li>
<li class="data-line-100">
<p><code>Zceb</code> reuses encoding from the <code>D</code>-extension, and so is incompatible with <code>D</code></p>
<div class="ulist data-line-101">
<ul>
<li class="data-line-101">
<p><code>Zceb</code> is fully compatible with <code>Zdinx</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note data-line-105">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  To get 32-bit versions of the instructions from <code>Zcee</code> the <code>B</code>-extension subsets <code>Zba</code> and <code>Zbb</code> should be implemented. This is recommended but not required by this specification.
</td>
</tr>
</table>
</div>
<table id="zcea" class="tableblock frame-all grid-all stretch data-line-110">
<caption class="title">Table 1. Zcea extension</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Instruction</th>
<th class="tableblock halign-left valign-top">RV32</th>
<th class="tableblock halign-left valign-top">RV64</th>
<th class="tableblock halign-left valign-top">RV128</th>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="6"><p class="tableblock">Zcee subset</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SEXT.B</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea/Zcee</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SEXT.H</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea/Zcee</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SEXT.W</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea/Zcee</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pseudo-instruction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ZEXT.B</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea/Zcee</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ZEXT.H</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea/Zcee</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ZEXT.W</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea/Zcee</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="6"><p class="tableblock">Require M or Zmmul to be inferred</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MUL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">requires M or Zmmul</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">requires M or Zmmul</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="6"><p class="tableblock">other 16-bit encodings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MVA01S07</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.NOT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.NEG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.TBLJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.TBLJAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.TBLJALM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH.E</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP.E</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET.E</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="6"><p class="tableblock">other 32-bit encodings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH.E</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP.E</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET.E</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<table id="zceb" class="tableblock frame-all grid-all stretch data-line-147">
<caption class="title">Table 2. Zceb extension, incompatible with D, compatible with Zdinx</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Instruction</th>
<th class="tableblock halign-left valign-top">RV32</th>
<th class="tableblock halign-left valign-top">RV64</th>
<th class="tableblock halign-left valign-top">RV128</th>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="6"><p class="tableblock">16-bit encodings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.DECBNEZ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zceb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incompatible with D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LBU</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zceb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incompatible with D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LHU</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zceb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incompatible with D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zceb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incompatible with D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zceb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incompatible with D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zceb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incompatible with D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zceb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incompatible with D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="6"><p class="tableblock">32-bit encodings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LWGP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zceb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incompatible with D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWGP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zceb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incompatible with D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDGP</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zceb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incompatible with D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SDGP</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zceb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incompatible with D</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-164">
<p><code>Zcea/Zceb</code> are compatible with both the <code>I</code> and <code>E</code> extensions.</p>
</div>
<div class="paragraph data-line-166">
<p>All systems which implement <code>Zcea/Zceb</code> must also implement the <code>C</code> extension.</p>
</div>
<div class="paragraph data-line-168">
<p>If <code>M</code> or <code>Zmmul</code> is specified then <code>Zcea</code> also includes the <code>C.MUL, MULI</code> instructions.</p>
</div>
</div>
</div>
<div class="sect1 data-line-170">
<h2 id="_c_extension_subsets">4. C-extension subsets</h2>
<div class="sectionbody">
<div class="paragraph data-line-172">
<p>The C-extension already reuses encodings between different architectures. <code>Zce</code> extends this concept further. <a href="#zce_quad0">Table 3</a>, <a href="#zce_quad1">Table 4</a> and <a href="#zce_quad2">Table 5</a> show how each encoding is allocated for different architectures or for different combinations of extensions.</p>
</div>
<div class="paragraph data-line-174">
<p>For example:</p>
</div>
<div class="ulist data-line-176">
<ul>
<li class="data-line-176">
<p><code>C.FSD</code>, <code>C.SQ</code>, and <code>{C.LBU, C.SB}</code> share opcodes, so for different configurations the encodings represent:</p>
<div class="ulist data-line-177">
<ul>
<li class="data-line-177">
<p><code>C.FSD</code> for <code>RV32CD/RV64CD</code></p>
</li>
<li class="data-line-178">
<p><code>C.SQ</code>  for <code>RV128C</code></p>
</li>
<li class="data-line-179">
<p><code>{C.LBU, C.SB}</code> for <code>RV32C_Zceb, RV64C_Zceb， RV32C_Zceb_Zdinx, RV64C_Zceb_Zdinx</code></p>
</li>
<li class="data-line-180">
<p>illegal encoding for <code>RV32C, RV64C</code>, as neither <code>D</code> nor <code>Zce</code> was specified</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph data-line-182">
<p>The shared encoding column in the tables assigns an arbitrary number to show which encodings are grouped together (I can&#8217;t find a better way of highlighting groups of cells in the table in adoc format). <code>Zce</code> instructions are in <strong>bold</strong>.</p>
</div>
<div class="admonitionblock note data-line-186">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  The names <code>Zci, Zcf, Zcd, Zcq, Zc321, Zc64, Zc128</code> are not official subset names, I have used them to help explain how the 16-bit encoding space is divided up and reused.
</td>
</tr>
</table>
</div>
<table id="zce_quad0" class="tableblock frame-all grid-all stretch data-line-191">
<caption class="title">Table 3. C-extension quadrant 0</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Enc[15:13]</th>
<th class="tableblock halign-left valign-top">Instruction</th>
<th class="tableblock halign-left valign-top">shared encoding group</th>
<th class="tableblock halign-left valign-top">Ext Subset</th>
<th class="tableblock halign-left valign-top">RV32</th>
<th class="tableblock halign-left valign-top">RV64</th>
<th class="tableblock halign-left valign-top">RV128</th>
<th class="tableblock halign-left valign-top">Extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ADDI4SPN</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.FLD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LQ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcq</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.LBU</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zceb</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zceb</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.LHU</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zceb</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zceb</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LW</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.FLW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+F</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc64/Zc128</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.POP</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.POPRET</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.PUSH</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.POP.E</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.POPRET.E</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.PUSH.E</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.TBLJ</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.TBLJAL</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.TBLJALM</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.SEXT.B</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.SEXT.H</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.ZEXT.B</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.ZEXT.H</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.NOT</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.NEG</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zcea</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.FSD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SQ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcq</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.SB</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zceb</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zceb</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.SH</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zceb</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zceb</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">110</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SW</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.FSW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+F</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc64/Zc128</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
</tbody>
</table>
<table id="zce_quad1" class="tableblock frame-all grid-all stretch data-line-237">
<caption class="title">Table 4. C-extension quadrant 1</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Enc[15:13]</th>
<th class="tableblock halign-left valign-top">Instruction</th>
<th class="tableblock halign-left valign-top">shared encoding group</th>
<th class="tableblock halign-left valign-top">Ext Subset</th>
<th class="tableblock halign-left valign-top">RV32</th>
<th class="tableblock halign-left valign-top">RV64</th>
<th class="tableblock halign-left valign-top">RV128</th>
<th class="tableblock halign-left valign-top">Extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.NOP</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ADDI</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.JAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ADDIW (rd=0:RSV)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc64/Zc128</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LI (rd=0:HINT)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ADDI16SP (nzimm=0:RSV)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LUI (nzimm=0: RSV; rd=0:HINT)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SRLI (RV32:NSE, nzuimm[5]=1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc32/Zc64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SRLI64 (RV32:HINT)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc128</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SRAI (RV32:NSE, nzuimm[5]=1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc32/Zc64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SRAI64 (RV32/64:HINT)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc128</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ANDI</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SUB</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.XOR</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.OR</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.AND</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SUBW (RV32:RSV)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc64/Zc128</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ADDW (RV32:RSV)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc64/Zc128</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MUL</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">M+C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MVA01S07</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcea</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zcea</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.J</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">110</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.BEQZ</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.BNEZ</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
</tbody>
</table>
<table id="zce_quad2" class="tableblock frame-all grid-all stretch data-line-282">
<caption class="title">Table 5. C-extension quadrant 2</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Enc[15:13]</th>
<th class="tableblock halign-left valign-top">Instruction</th>
<th class="tableblock halign-left valign-top">shared encoding group</th>
<th class="tableblock halign-left valign-top">Ext Subset</th>
<th class="tableblock halign-left valign-top">RV32</th>
<th class="tableblock halign-left valign-top">RV64</th>
<th class="tableblock halign-left valign-top">RV128</th>
<th class="tableblock halign-left valign-top">Extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SLLI (rd=0:HINT; RV32 &amp;&amp; nzuimm[5]=1:NSE)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc32/Zc64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SLLI64 (RV32/64 or rd=0:HINT)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc128</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.FLDSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LQSP (rd=0:RSV)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc128</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.LB</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zceb</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.LH</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zceb</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LWSP (rd=0:RSV)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.FLWSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+F</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LDSP (rd=0:HINT)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc64/Zc128</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.JR     (rd=0:RSV)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MV   (rd=0:HINT)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.EBREAK</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.JALR</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ADD (rd=0:HINT)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.FSDSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SQSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc128</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C.DECBNEZ</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zceb</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+<strong>Zceb</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">110</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SWSP</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zci</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.FSWSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zcf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C+F</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SDSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zc128</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1 data-line-307">
<h2 id="_allocation_of_new_16_bit_encodings">5. Allocation of new 16-bit encodings</h2>
<div class="sectionbody">
<div class="paragraph data-line-309">
<p>This section gives a short-hand lookup of exactly where the new encodings are allocated to make it easier to review the encoding space. The first column is the group number from <a href="#zce_quad0">Table 3</a>, <a href="#zce_quad1">Table 4</a> and <a href="#zce_quad2">Table 5</a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch data-line-311">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Group</th>
<th class="tableblock halign-left valign-top">[15:13]</th>
<th class="tableblock halign-left valign-top">[12:10]</th>
<th class="tableblock halign-left valign-top">[1:0]</th>
<th class="tableblock halign-left valign-top">Instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SEXT.B, C.SEXT.H, C.ZEXT.B, C.ZEXT.H, C.ZEXT.W, C.NOT, C.NEG</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.TBLJ, C.TBLJAL, C.TBLJALM</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP, C.POPRET, C.PUSH, C.POP.E, C.POPRET.E, C.PUSH.E</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LBU</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1xx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LHU</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1xx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SH</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MUL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MVA01S07</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1xx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LH</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.DECBNEZ</p></td>
</tr>
</tbody>
</table>
<div class="sect2 data-line-334">
<h3 id="_16_bit_encoding_code_points">5.1. 16-bit encoding code-points</h3>
<div class="paragraph data-line-336">
<p>All previously reserved 16-bit encodings are in the tables below, showing how many are allocated to <code>Zce</code>.</p>
</div>
<table id="spare16encodings" class="tableblock frame-all grid-all stretch data-line-341">
<caption class="title">Table 6. spare 16-bit encodings for RV32/RV64</caption>
<colgroup>
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5565%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
<th class="tableblock halign-left valign-top">code points</th>
<th class="tableblock halign-left valign-top">sub-extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">xxxx</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">56/256</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zcea</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">xxxx</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0/256</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">xxxx</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">120/256</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zcea</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">xxxx</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">256/256</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zcea</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">1xx</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">xxxx</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0/1024</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="5"><p class="tableblock">xxxxx</p></td>
<td class="tableblock halign-left valign-top" colspan="5"><p class="tableblock">11111</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0/32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">111</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64/128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zcea</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="6"><p class="tableblock">000000</p></td>
<td class="tableblock halign-left valign-top" colspan="5"><p class="tableblock">non-zero</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0/31</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch data-line-356">
<caption class="title">Table 7. spare 16-bit encodings for RV32 only (mainly out of range shifts)</caption>
<colgroup>
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5565%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
<th class="tableblock halign-left valign-top">code points</th>
<th class="tableblock halign-left valign-top">sub-extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top" colspan="9"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0/512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">111</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0/128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" colspan="5"><p class="tableblock">non-zero</p></td>
<td class="tableblock halign-left valign-top" colspan="5"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0/992</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch data-line-366">
<caption class="title">Table 8. spare 16-bit encodings for RV64 only (ADDIW with zero destination)</caption>
<colgroup>
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5565%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
<th class="tableblock halign-left valign-top">code points</th>
<th class="tableblock halign-left valign-top">sub-extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top" colspan="5"><p class="tableblock">00000</p></td>
<td class="tableblock halign-left valign-top" colspan="5"><p class="tableblock">xxxxx</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0/64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch data-line-374">
<caption class="title">Table 9. spare 16-bit encodings reused from the D-extension</caption>
<colgroup>
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5565%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
<th class="tableblock halign-left valign-top">code points</th>
<th class="tableblock halign-left valign-top">sub-extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top" colspan="11"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2048/2048</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zceb</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top" colspan="11"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2048/2048</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zceb</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top" colspan="11"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2048/2048</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zceb</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top" colspan="11"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2047/2048</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zceb</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-382">
<p>In total in the existing RVC (16-bit) encoding space:</p>
</div>
<div class="olist arabic data-line-384">
<ol class="arabic">
<li class="data-line-384">
<p>RV32C has 3871 code points available, 496 are used (12.8%)</p>
</li>
<li class="data-line-385">
<p>RV64C has 2303 code points available, 496 are used (21.5%)</p>
</li>
<li class="data-line-386">
<p>RV32CD (i.e. the C.FSD,C.FLD, C.FSDSP, C.FLDSP encodings) has 8192 code points available, 8191 are used (99.9%)</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-388">
<h2 id="_zcea_definition">6. <code>Zcea</code> definition</h2>
<div class="sectionbody">
<div class="sect2 data-line-390">
<h3 id="_c_sext_b_c_sext_h_c_zext_b_c_zext_h_c_zext_w_c_mul_c_not_c_neg">6.1. C.SEXT.B, C.SEXT.H, C.ZEXT.B, C.ZEXT.H, C.ZEXT.W, C.MUL, C.NOT, C.NEG</h3>
<div class="paragraph data-line-392">
<p>These instructions have no conflicts with other extensions, they use previously reserved encodings.</p>
</div>
<div class="paragraph data-line-394">
<p>These instructions are 16-bit versions of existing 32-bit instructions, from either <code>I/E</code> or the <code>Zba/Zbb</code>-extension.</p>
</div>
<table id="monadic-16encodings" class="tableblock frame-all grid-all stretch data-line-399">
<caption class="title">Table 10. monadic simple instructions 16-bit encodings</caption>
<colgroup>
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8832%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="17"><p class="tableblock">monadic with single source/dest, room for 3 more encodings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ZEXT.B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SEXT.B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ZEXT.H</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SEXT.H</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ZEXT.W</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">110</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.NEG</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">111</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.NOT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">1x</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
</tbody>
</table>
<table id="dyadic-16encodings" class="tableblock frame-all grid-all stretch data-line-417">
<caption class="title">Table 11. dyadic simple instructions 16-bit encodings</caption>
<colgroup>
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8832%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">111</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs2'</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MUL</p></td>
</tr>
</tbody>
</table>
<table id="monsemantics" class="tableblock frame-all grid-all stretch data-line-425">
<caption class="title">Table 12. simple instruction semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ZEXT.B</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = zero_ext(rd'[ 7:0])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ZEXT.H</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = zero_ext(rd'[15:0])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SEXT.B</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = sign_ext(rd'[ 7:0])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SEXT.H</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = sign_ext(rd'[15:0])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.NOT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = ~rd' / rd' = rd' XOR -1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.NEG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = -rd' / rd' = 0 - rd'</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MUL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = rd' * rs2'</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">RV64/RV128 only</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ZEXT.W</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = zero_ext(rd'[31:0])</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note data-line-440">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  The expansion of <code>c.neg</code> puts <code>rd</code> onto <code>rs2</code>, unlike the other expansions which put <code>rd</code> onto <code>rs1</code>, and so requires additional muxing during the expansion
</td>
</tr>
</table>
</div>
<table id="mon-32bit" class="tableblock frame-all grid-all stretch data-line-445">
<caption class="title">Table 13. simple instruction 32-bit equivalent instructions/pseudo-instructions</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">example assembler syntax</th>
<th class="tableblock halign-left valign-top">requirements for 16-bit encoding</th>
<th class="tableblock halign-left valign-top">32-bit extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ZEXT.B</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zext.b rd, rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all regs x8-x15, rd=rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I or E</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ZEXT.H</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zext.h rd, rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all regs x8-x15, rd=rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbb</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SEXT.B</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sext.b rd, rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all regs x8-x15, rd=rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbb</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SEXT.H</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sext.h rd, rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all regs x8-x15, rd=rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zbb</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.NOT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not    rd, rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all regs x8-x15, rd=rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I or E</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.NEG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neg    rd, rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all regs x8-x15, rd=rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I or E</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MUL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mul    rd, rs1, rs2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all regs x8-x15, rd=rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I or E</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">RV64/RV128 only</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.ZEXT.W</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zext.h rd, rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all regs x8-x15, rd=rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zba</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note data-line-460">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  Other assembler syntaxes are possible such as including the c. prefix and only including one operand to cover rs1 and rd
</td>
</tr>
</table>
</div>
<div class="admonitionblock note data-line-464">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  Implementing <code>Zba</code> and <code>Zbb</code> to get the 32-bit encodings from <a href="#mon-32bit">Table 13</a> is not required by this specification.
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-466">
<p>Assembly Examples</p>
</div>
<div class="listingblock data-line-469">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">zext.b a5, a5;  # a5 = zero_ext(a5[7:0])
zext.h a5, a5;  # a5 = zero_ext(a5[15:0])
sext.b a5, a5;  # a5 = sign_ext(a5[7:0])
sext.h a5, a5;  # a5 = sign_ext(a5[15:0])

not a5, a5      # a5 = ~a5 bitwise inversion
neg a5, a5      # a5 = -a5 two's complement inversion

mul a5, a5, a6; # a5 = a5 * a6

//RV64/RV128 only

zext.w a5, a5;  # a5 = zero_ext(a5[31:0])
sext.w a5, a5;  # a5 = sign_ext(a5[31:0])</code></pre>
</div>
</div>
</div>
<div class="sect2 data-line-486">
<h3 id="_c_sext_w">6.2. C.SEXT.W</h3>
<div class="paragraph data-line-488">
<p><code>C.SEXT.W</code> is added as a pseudo-instruction for <code>C.ADDIW rd, 0</code></p>
</div>
</div>
<div class="sect2 data-line-490">
<h3 id="_c_mva01s07">6.3. C.MVA01S07</h3>
<div class="paragraph data-line-492">
<p>Register moves are the most common in GCC output in both the benchmark suite and the Debian distro. This instruction combines very common pairs of moves into a single 16-bit encoding:</p>
</div>
<div class="ulist data-line-494">
<ul>
<li class="data-line-494">
<p>move from two <code>s[0-7]</code> registers into <code>a0</code> and <code>a1</code>.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-496">
<p>Similar to <code>PUSH/POP</code> this instruction uses ABI names for the registers. The mapping from <code>s</code> to <code>x</code> number is simple. For <code>RV32_Zdinx</code> a paired register write port is required already. For other configurations the microarchitecture can</p>
</div>
<div class="ulist data-line-498">
<ul>
<li class="data-line-498">
<p>split the instructions into an uninterruptable sequence of two <code>mv</code> instructions to avoid the second write port</p>
</li>
<li class="data-line-499">
<p>add a paired write port for <code>a0</code> and <code>a1</code> only. Because the instruction only writes these two registers only one paired write port is needed, which is much cheaper than allowing paired writes to the whole register file.</p>
</li>
</ul>
</div>
<div class="admonitionblock note data-line-503">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  We may need an EABI version of this instruction. TBD.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note data-line-507">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  There is no 32-bit instruction, because a 32-bit form would add no value.
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-509">
<p>Mapping from the <code>s</code> register number to the <code>x</code> register index is simple for the UABI:</p>
</div>
<div class="listingblock data-line-512">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">//000 (s0) -&gt; 01000 (x8)
//001 (s1) -&gt; 01001 (x9)
//010 (s2) -&gt; 10010 (x18)
//011 (s3) -&gt; 10011 (x19)
// ...         ...
//111 (s7) -&gt; 10111 (x23)

//verilog syntax for concatenation of bits
xreg[4:0] = {sreg[2:1]&gt;0,sreg[2:1]==0,sreg[2:0]};</code></pre>
</div>
</div>
<div class="paragraph data-line-525">
<p>The EABI mapping may not be so simple, TBD.</p>
</div>
<table id="mva-16encodings" class="tableblock frame-all grid-all stretch data-line-530">
<caption class="title">Table 14. <code>C.MVA01S07</code> 16-bit encodings</caption>
<colgroup>
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8832%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">111</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">sreg1</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">sreg2</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MVA01S07</p></td>
</tr>
</tbody>
</table>
<table id="mva_semantics" class="tableblock frame-all grid-all stretch data-line-538">
<caption class="title">Table 15. <code>C.MVA01S07</code> semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MVA01S07 sreg1, sreg2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mv a0, s[sreg1];  mv a1, s[sreg2]</p></td>
</tr>
</tbody>
</table>
<table id="mva_syntax" class="tableblock frame-all grid-all stretch data-line-546">
<caption class="title">Table 16. <code>C.MVA01S07</code> assembler syntax</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">example assembler syntax</th>
<th class="tableblock halign-left valign-top">requirements for 16-bit encoding</th>
<th class="tableblock halign-left valign-top">32-bit extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MVA01S07</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mv(a0,a1),(sreg1,sreg2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-551">
<p>Assembly examples.</p>
</div>
<div class="listingblock data-line-553">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode"># c.mva01s07: sreg1 = 0; sreg2 = 0;
mv (a0, a1), (s0, s0) ; # mv a0, s0; mv a1, s0</code></pre>
</div>
</div>
</div>
<div class="sect2 data-line-558">
<h3 id="_muli">6.4. MULI</h3>
<div class="admonitionblock note data-line-562">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  This encoding is in <code>custom-0</code>, a real encoding must be found possibly with a shorter immediate
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch data-line-567">
<caption class="title">Table 17. <code>MULI</code> 32-bit encoding</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">31:20</th>
<th class="tableblock halign-left valign-top">19:15</th>
<th class="tableblock halign-left valign-top">14:12</th>
<th class="tableblock halign-left valign-top">11:7</th>
<th class="tableblock halign-left valign-top">6 : 0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[11:0]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0001011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULI</p></td>
</tr>
</tbody>
</table>
<table id="muli_syntax" class="tableblock frame-all grid-all stretch data-line-575">
<caption class="title">Table 18. <code>MULI</code> assembler syntax</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">assembler syntax</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mul rd, rs1, imm</p></td>
</tr>
</tbody>
</table>
<table id="arithmetic_semantics" class="tableblock frame-all grid-all stretch data-line-583">
<caption class="title">Table 19. <code>MULI</code> semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = rs1' * sign_ext(imm)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-588">
<p>Assembly Examples</p>
</div>
<div class="listingblock data-line-591">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">muli     a0, a1, 2     # a0 = a1 * 2</code></pre>
</div>
</div>
</div>
<div class="sect2 data-line-598">
<h3 id="cmpimmbr">6.5. BEQI, BNEI</h3>
<div class="admonitionblock note data-line-602">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  These encodings match the format for BEQ as much as possible
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-604">
<p>The encodings allow a comparison of a register and an immediate value. <code>BEQI</code> in particular is very useful for <em>switch</em> statements.</p>
</div>
<table class="tableblock frame-all grid-all stretch data-line-609">
<caption class="title">Table 20. proposed 32-bit encodings for <code>BEQI/BNEI</code></caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">31:25</th>
<th class="tableblock halign-left valign-top">24:20</th>
<th class="tableblock halign-left valign-top">19:15</th>
<th class="tableblock halign-left valign-top">14:12</th>
<th class="tableblock halign-left valign-top">11:7</th>
<th class="tableblock halign-left valign-top">6 : 0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">offset[12,10:5]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cmpimm[4:0]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">offset[4:1,11]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1100011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BEQI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">offset[12,10:5]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cmpimm[4:0]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">offset[4:1,11]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1100011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BNEI</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch data-line-618">
<caption class="title">Table 21. Compare immediate branch semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BEQI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if (rs1==zero_ext(cmpimm)) target_pc=PC+offset; else target_pc=PC+4;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BNEI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if (rs1!=zero_ext(cmpimm)) target_pc=PC+offset; else target_pc=PC+4;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-624">
<p>Assembly Examples</p>
</div>
<div class="listingblock data-line-627">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">beq  a5, 1,offset # if(a5== 1) branch_to(PC+offset) # signed comparison
bne  a5,-1,offset # if(a5!=-1) branch_to(PC+offset) # signed comparison</code></pre>
</div>
</div>
</div>
<div class="sect2 data-line-632">
<h3 id="_table_jump">6.6. Table Jump</h3>
<div class="paragraph data-line-634">
<p>The specification is in <a href="#tablejump">Section 8</a>.</p>
</div>
<div class="sect3 data-line-637">
<h4 id="tablejump16">6.6.1. C.TBLJ, C.TBLJAL, C.TBLJALM</h4>
<div class="paragraph data-line-639">
<p>The encodings are in <a href="#tbljal16bitencoding">Table 33</a>.</p>
</div>
</div>
</div>
<div class="sect2 data-line-642">
<h3 id="pushpoppopret_heading">6.7. PUSH and POP</h3>
<div class="paragraph data-line-644">
<p>See <a href="#pushpoppopret">Section 9</a> for the specification.</p>
</div>
<div class="sect3 data-line-647">
<h4 id="pushpop32">6.7.1. PUSH, POP, POPRET, PUSH.E, POP.E, POPRET.E</h4>
<div class="paragraph data-line-649">
<p>See <a href="#pushpoppopret32bitencodings">Section 9.6</a> for the encodings.</p>
</div>
</div>
<div class="sect3 data-line-652">
<h4 id="pushpop16">6.7.2. C.PUSH, C.POP, C.POPRET, C.PUSH.E, C.POP.E, C.POPRET.E</h4>
<div class="paragraph data-line-654">
<p>See <a href="#proposed-16bit-encodingsI-1">Table 44</a> for the encodings.</p>
</div>
</div>
</div>
<div class="sect2 data-line-657">
<h3 id="_b_extension_recommended_subsets_for_code_size_reduction">6.8. B-extension recommended subsets for code-size reduction</h3>
<div class="paragraph data-line-659">
<p>The 32-bit encodings for <code>Zcee</code> (see <a href="#mon-32bit">Table 13</a>) are in <code>Zba</code> and <code>Zbb</code>.</p>
</div>
<div class="paragraph data-line-661">
<p>It is recommended to implement both <code>Zba</code> and <code>Zbb</code> for code-size reduction, but not required by <code>Zce</code>. They contain useful instructions for example:</p>
</div>
<div class="olist arabic data-line-663">
<ol class="arabic">
<li class="data-line-663">
<p><code>Zba</code> includes <code>sh[123]add</code> which are used for address calculations.</p>
</li>
<li class="data-line-665">
<p><code>Zbb</code> includes rotate (<code>rori, ror, rol</code>), byte reverse (<code>rev8</code>) and count-leading-zeroes (<code>clz</code>).</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-667">
<h2 id="_zceb_definition">7. <code>Zceb</code> definition</h2>
<div class="sectionbody">
<div class="paragraph data-line-669">
<p><code>Zceb</code> and the <code>D</code>-extension use the same encodings, therefore the two cannot co-exist and would be an illegal RISC-V configuration.</p>
</div>
<div class="paragraph data-line-671">
<p><code>Zceb</code> is compatible with <code>Zdinx</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch data-line-676">
<caption class="title">Table 22. proposed 32-bit formats</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1112%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">31:29</th>
<th class="tableblock halign-left valign-top">28:25</th>
<th class="tableblock halign-left valign-top">24:20</th>
<th class="tableblock halign-left valign-top">19:18</th>
<th class="tableblock halign-left valign-top">17:15</th>
<th class="tableblock halign-left valign-top">14:12</th>
<th class="tableblock halign-left valign-top">11:7</th>
<th class="tableblock halign-left valign-top">6 : 0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="9"><p class="tableblock">These formats are designed for maximum overlap immediate with I-type and S-type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">funct3a</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">imm[8:2,10:9]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">imm[15:11]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">funct3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opcode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LW16-type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">funct3a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[8:5]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rs2</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">imm[15:11]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">funct3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[4:2, 10:9]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opcode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW16-type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">funct3a</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">imm[8:3,16,10:9]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">imm[15:11]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">funct3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opcode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LD16-type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">funct3a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[8:5]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rs2</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">imm[15:11]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">funct3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[4:3,16,10:9]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opcode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SD16-type</p></td>
</tr>
</tbody>
</table>
<div class="sect2 data-line-685">
<h3 id="_decrement_and_branch">7.1. Decrement and branch</h3>
<div class="sect3 data-line-688">
<h4 id="decbr16">7.1.1. C.DECBNEZ</h4>
<div class="paragraph data-line-690">
<p>This instruction conflicts with the <code>D</code>-extension. If <code>D</code> is implemented, this instruction will not be available. It is compatible with <code>ZDinx</code>.</p>
</div>
<div class="paragraph data-line-692">
<p>This instruction is a combined decrement and branch, used for inferring loops with an optionally scaled loop counter.</p>
</div>
<div class="admonitionblock note data-line-696">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  The 16 and 32-bit forms of this instruction need a new relocation type in the toolchain.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note data-line-700">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  The 32-bit encoding has a signed offset. The 16-bit encoding has an unsigned offset, but it can only represent a backwards jump.
  Therefore to be legal syntax for the 16-bit encoding the offset is specified as a negative number but encoded as a positive offset.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note data-line-705">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  The encoding is reserved if the offset is zero.
</td>
</tr>
</table>
</div>
<table id="proposed-16bit-encodings-dec_br" class="tableblock frame-all grid-all stretch data-line-710">
<caption class="title">Table 23. proposed 16-bit encodings for dec-and-branch</caption>
<colgroup>
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8832%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">nzimm[6:4]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">nzimm[3:1]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">scale</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.DECBNEZ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">scale</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
</tbody>
</table>
<table id="deccmpbrsemantics" class="tableblock frame-all grid-all stretch data-line-719">
<caption class="title">Table 24. decrement, compare and branch semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.DECBNEZ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = rd' - (1&lt;&lt;scale); bnez rd', zero, -zero_ext(nzimm);</p></td>
</tr>
</tbody>
</table>
<table id="v1" class="tableblock frame-all grid-all stretch 0-32bit data-line-727">
<caption class="title">Table 25. 32-bit equivalent instructions for decrement, compare and branch semantics</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">example assembler syntax</th>
<th class="tableblock halign-left valign-top">requirements for 16-bit encoding</th>
<th class="tableblock halign-left valign-top">32-bit extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.DECBNEZ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">decbnez, rd, imm, -offset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd is x8-x15, imm is [1248], offset is in range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zceb</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note data-line-734">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  Other assembler syntaxes are possible such as including the c. prefix
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-737">
<p>Assembly Example</p>
</div>
<div class="listingblock data-line-739">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">decbnez s2, 1, -4 ;# s2-=1;if(s2!=0) branch_to(PC-4) encoded as scale=0, uimm=4 (not uimm=-4)</code></pre>
</div>
</div>
</div>
<div class="sect3 data-line-743">
<h4 id="_decbnez_limited_value">7.1.2. DECBNEZ (limited value?)</h4>
<div class="paragraph data-line-745">
<p>This instruction conflicts with the <code>D</code>-extension. If <code>D</code> is implemented, this instruction will not be available. It is compatible with <code>ZDinx</code>.</p>
</div>
<div class="paragraph data-line-747">
<p>The 16-bit encoding and specification is in <a href="#decbr16">Section 7.1.1</a>.</p>
</div>
<div class="admonitionblock note data-line-751">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  This instruction appears to have limited value, and so it may well be removed.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note data-line-755">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  The 16 and 32-bit forms of this instruction need a new relocation type in the toolchain.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch data-line-760">
<caption class="title">Table 26. proposed 32-bit encoding <code>DECBNEZ</code></caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1112%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">31:29</th>
<th class="tableblock halign-left valign-top">28:25</th>
<th class="tableblock halign-left valign-top">24:20</th>
<th class="tableblock halign-left valign-top">19:18</th>
<th class="tableblock halign-left valign-top">17:15</th>
<th class="tableblock halign-left valign-top">14:12</th>
<th class="tableblock halign-left valign-top">11:7</th>
<th class="tableblock halign-left valign-top">6 : 0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">imm[8:2,10:9]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">scale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[1,12:11]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0000111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DECBNEZ</p></td>
</tr>
</tbody>
</table>
<table id="DECBNEZsemantics32" class="tableblock frame-all grid-all stretch data-line-768">
<caption class="title">Table 27. decrement, compare and branch 32-bit semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DECBNEZ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd = rd - (1&lt;&lt;scale); bnez rd, zero, sign_ext(imm);</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-773">
<p>Assembly Example</p>
</div>
<div class="listingblock data-line-775">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">decbnez s2, 1, offset ;# s2-=1;if(s2!=0) branch_to(PC+offset)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-780">
<h3 id="_lwgp_swgp_ldgp_sdgp">7.2. LWGP, SWGP, LDGP, SDGP</h3>
<div class="paragraph data-line-782">
<p>These instructions conflict with the <code>D</code>-extension. If <code>D</code> is implemented, these instruction will not be available. They are compatible with <code>Zdinx</code>.</p>
</div>
<div class="paragraph data-line-784">
<p>These instructions reuse the encodings for <code>FLD/FSD</code>.</p>
</div>
<div class="paragraph data-line-786">
<p><code>LWGP,SWGP</code> give a larger offset range than the standard <code>LW, SW</code> instructions by making the base register explicitly <code>gp</code>, allowing a 16-bit/64KB range of word aligned offsets, instead of a 12-bit/4KB range of byte aligned offsets.</p>
</div>
<div class="paragraph data-line-788">
<p><code>LDGP,SDGP</code> require double word alignment, and so have an increased range of 17-bit/128KB offsets relative to <code>gp</code>.</p>
</div>
<div class="admonitionblock note data-line-792">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
   Restrictions in the GCC toolchain mean that the full range of <code>gp</code> cannot be used for the standard <code>LW/SW</code> instructions, in case linker relaxation means that the <code>gp</code> relative addresses moves out of range. This will still be the case with <code>LWGP, SWGP</code> but the range is so much larger that the impact will be minimal. <a href="https://github.com/riscv/riscv-gnu-toolchain/issues/497">See this github issue</a>. This issue means that with the current RISC-V ISA the full 4KB range cannot be accessed using <code>gp</code> using GCC so the benefit is lower than might be expected.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch data-line-797">
<caption class="title">Table 28. proposed 32-bit encodings for <code>LWGP/SWGP/LWTP/SWTP</code> and <code>LDGP/SDGP/LDTP/SDTP</code></caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">31:29</th>
<th class="tableblock halign-left valign-top">28:25</th>
<th class="tableblock halign-left valign-top">24:20</th>
<th class="tableblock halign-left valign-top">19:15</th>
<th class="tableblock halign-left valign-top">14:12</th>
<th class="tableblock halign-left valign-top">11:7</th>
<th class="tableblock halign-left valign-top">6 : 0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">imm[8:2,10:9]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[15:11]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0000111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LWGP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[8:5]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rs2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[15:11]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[4:2, 10:9]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0100111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWGP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">RV64/RV128 only</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">imm[8:3,16,10:9]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[15:11]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0000111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDGP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[8:5]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rs2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[15:11]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imm[4:3,16,10:9]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0100111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SDGP</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note data-line-808">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  In <a href="#lwgp_semantics">Table 29</a> DataMemory is a data memory array of elements with XLEN width.
</td>
</tr>
</table>
</div>
<table id="lwgp_semantics" class="tableblock frame-all grid-all stretch data-line-813">
<caption class="title">Table 29. Load/store word/double GP relative semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LWGP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd=sign_ext(DataMemory[gp+sign_ext(imm)][31:0]);</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SWGP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DataMemory[gp+sign_ext(imm)][31:0])=rs2[31:0];</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">RV64/RV128 only</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDGP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd=sign_ext(DataMemory[gp+sign_ext(imm)][63:0]);</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SDGP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DataMemory[gp+sign_ext(imm)][63:0])=rs2[63:0];</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-822">
<p>Assembly Examples</p>
</div>
<div class="listingblock data-line-824">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">lw s0, 20(gp)
sw s0, 20(gp)

//RV64/RV128 only
ld s0, 20(gp)
sd s0, 20(gp)</code></pre>
</div>
</div>
</div>
<div class="sect2 data-line-833">
<h3 id="_c_lbu_c_lhu_c_lb_c_lh_c_sb_c_sh">7.3. C.LBU, C.LHU, C.LB, C.LH, C.SB, C.SH</h3>
<div class="paragraph data-line-835">
<p>These instructions conflict with the <code>D</code>-extension. If <code>D</code> is implemented, these instruction will not be available. They are compatible with <code>Zdinx</code>.</p>
</div>
<table id="ldstbh" class="tableblock frame-all grid-all stretch data-line-840">
<caption class="title">Table 30. proposed 16-bit encodings for load/store byte/half</caption>
<colgroup>
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8832%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">uimm[0,3]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs1'</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">uimm[2:1]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs2'</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LBU</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">uimm[4:3]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs1'</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">uimm[2:1]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs2'</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LHU</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">uimm[0,3]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs1'</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">uimm[2:1]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs2'</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">uimm[4:3]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs1'</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">uimm[2:1]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs2'</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LH</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">uimm[0,3]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs1'</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">uimm[2:1]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs2'</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">uimm[4:3]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs1'</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">uimm[2:1]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs2'</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SH</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note data-line-852">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  Because of the short offsets available in the 16-bit encodings, if programmers place byte/short values near the base of their structures then it&#8217;s more likely that they will be accessible with a 16-bit encoding and therefore save code-size.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note data-line-856">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  In <a href="#ldstbhsemantics">Table 31</a> DataMemory is a data memory array of elements with XLEN width
</td>
</tr>
</table>
</div>
<table id="ldstbhsemantics" class="tableblock frame-all grid-all stretch data-line-861">
<caption class="title">Table 31. Load/store byte/half semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LBU</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = zero_ext(DataMemory[rs1'+zero_ext(uimm)][ 7:0])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LHU</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = zero_ext(DataMemory[rs1'+zero_ext(uimm)][15:0])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = sign_ext(DataMemory[rs1'+zero_ext(uimm)][ 7:0])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = sign_ext(DataMemory[rs1'+zero_ext(uimm)][15:0])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = DataMemory[rs1'+zero_ext(uimm)][ 7:0] = rs2'[ 7:0]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = DataMemory[rs1'+zero_ext(uimm)][15:0] = rs2'[15:0]</p></td>
</tr>
</tbody>
</table>
<table id="ldstbh-32bit" class="tableblock frame-all grid-all stretch data-line-874">
<caption class="title">Table 32. Load/store byte-half 32-bit equivalent instructions with a direct equivalent</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">example assembler syntax</th>
<th class="tableblock halign-left valign-top">requirements for 16-bit encoding</th>
<th class="tableblock halign-left valign-top">32-bit extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LBU</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lbu    rd, imm(rs1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all regs x8-x15, imm in range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-extension</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LHU</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lhu    rd, imm(rs1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all regs x8-x15, imm in range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-extension</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lb     rd, imm(rs1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all regs x8-x15, imm in range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-extension</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lh     rd, imm(rs1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all regs x8-x15, imm in range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-extension</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sb     rd, imm(rs1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all regs x8-x15, imm in range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-extension</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sh     rd, imm(rs1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all regs x8-x15, imm in range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-extension</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note data-line-886">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  Other assembler syntaxes are possible such as including the c. prefix
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-888">
<p>Assembly Examples</p>
</div>
<div class="listingblock data-line-890">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">lbu a5,20(a4)   # a5 = zero_ext(DataMemory(a4+20)[ 7:0])
lhu a5,20(a4)   # a5 = zero_ext(DataMemory(a4+20)[15:0])
lb  a5,20(a4)   # a5 = sign_ext(DataMemory(a4+20)[ 7:0])
lh  a5,20(a4)   # a5 = sign_ext(DataMemory(a4+20)[15:0])
sb  a5,20(a4)   # DataMemory(a4+20)[ 7:0] = a5[ 7:0]
sh  a5,20(a4)   # DataMemory(a4+20)[15:0] = a5[15:0]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-900">
<h2 id="tablejump">8. Table Jump</h2>
<div class="sectionbody">
<div class="paragraph data-line-902">
<p>Table jumps are used to reduce the code size of <code>JAL</code> / <code>AUIPC+JALR</code> / <code>JR</code> / <code>AUIPC+JR</code> instructions.</p>
</div>
<div class="sect2 data-line-904">
<h3 id="_rationale">8.1. Rationale</h3>
<div class="paragraph data-line-906">
<p>Function calls and jumps to fixed labels typically take 32-bit or 64-bit instruction sequences.
Here&#8217;s an example from the Huawei IoT code, GCC output:</p>
</div>
<div class="listingblock data-line-910">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">00e084be &lt;vsprintf&gt;:
  #64-bit AUIPC/JALR sequence
  e084be:	001f8317            auipc t1,0x1f8
  e084c2:	18a302e7            jalr  t0,394(t1) # 1000648 &lt;__riscv_save_0&gt;

  e084c6:	86b2                mv    a3,a2
  e084c8:	862e                mv    a2,a1
  e084ca:	800005b7            lui	  a1,0x80000
  e084ce:	fff5c593            not	  a1,a1

  #32-bit JAL
  e084d2:	f61ff0ef            jal	  ra,e08432 &lt;vsnprintf&gt; # vsnprintf

  #64-bit AUIPC/JALR sequence
  e084d6:	001f8317            auipc	t1,0x1f8
  e084da:	19630067            jr	  406(t1) # 100066c &lt;__riscv_restore_0&gt;</code></pre>
</div>
</div>
<div class="paragraph data-line-929">
<p>using <code>C.TBLJ*</code> we can reduce this as follows (accepting gaps in the PCs as code has been deleted)</p>
</div>
<div class="listingblock data-line-932">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">00e084be &lt;vsprintf&gt;:
  e084be:	&lt;16-bit&gt;            tbljalm #x ;#&lt;mapped to __riscv_save_0&gt;, saving 6-bytes

  e084c6:	86b2                mv     a3,a2
  e084c8:	862e                mv     a2,a1
  e084ca:	800005b7            lui	   a1,0x80000
  e084ce:	fff5c593            not	   a1,a1

  e084d2:	&lt;16-bit&gt;            tbljal #y ;#&lt;mapped to vsnprintf&gt;, saving 2-bytes (8-byte refs to this fn also exist)

  e084da:	&lt;16-bit&gt;            tblj   #z ;#&lt;mapped to __riscv_restore_0&gt;</code></pre>
</div>
</div>
<div class="paragraph data-line-946">
<p>The principle is to have a single lookup table of <code>TBLJALENTRIES</code> addresses for <code>C.TBLJ*</code>, which is built by the linker. The linker then substitutes the code as shown in the example above where the 32-byte function is reduced to 18-bytes giving ~ 56% saving. Clearly the lookup table takes some space, but this is a minimal overhead for repeated functions such as the save/restore routines.</p>
</div>
<div class="paragraph data-line-948">
<p><code>TBLJALENTRIES</code> is set by the maximum size of the table, which is 256 as the encoding has an 8-bit index.</p>
</div>
<div class="paragraph data-line-950">
<p>Table jump allows the linker to:</p>
</div>
<div class="ulist data-line-952">
<ul>
<li class="data-line-952">
<p>replace 32-bit <code>J</code> calls with <code>C.TBLJ</code></p>
</li>
<li class="data-line-953">
<p>replace 32-bit <code>JAL ra</code> calls with <code>C.TBLJAL</code></p>
</li>
<li class="data-line-954">
<p>replace 32-bit <code>JAL t0</code> calls with <code>C.TBLJALM</code> (<code>M</code> for Millicode)</p>
</li>
<li class="data-line-955">
<p>replace 64-bit <code>AUIPC/JR</code> calls to fixed locations with <code>C.TBLJ</code></p>
</li>
<li class="data-line-956">
<p>replace 64-bit <code>AUIPC/JALR ra</code> calls to fixed locations with <code>C.TBLJAL</code></p>
</li>
<li class="data-line-957">
<p>replace 64-bit <code>AUIPC/JALR t0</code> calls to fixed locations with <code>C.TBLJALM</code></p>
<div class="ulist data-line-958">
<ul>
<li class="data-line-958">
<p>The <code>AUIPC+JR/JALR</code> sequence is used because the offset from the PC is out of the ±1MB range.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2 data-line-960">
<h3 id="_encoding">8.2. Encoding</h3>
<div class="paragraph data-line-962">
<p>These instructions use a previously reserved encoding.</p>
</div>
<table id="tbljal16bitencoding" class="tableblock frame-all grid-all stretch data-line-967">
<caption class="title">Table 33. C.TBLJAL 16-bit encoding</caption>
<colgroup>
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8832%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">index8&lt;7</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.TBLJALM</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">index8&gt;=8 &amp;&amp; index8&lt;64</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.TBLJ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">index8&gt;=64</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.TBLJAL</p></td>
</tr>
</tbody>
</table>
<table id="tbljal16bitassemblersyntax" class="tableblock frame-all grid-all stretch data-line-977">
<caption class="title">Table 34. C.TBLJAL assembler syntax</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">example assembler syntax</th>
<th class="tableblock halign-left valign-top">requirements for 16-bit encoding</th>
<th class="tableblock halign-left valign-top">32-bit extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.TBLJALM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tbljalm #n</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n is in the range 0 to 7   (index8=n)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.TBLJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tblj    #n</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n is in the range 0 to 55  (index8=n+8)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.TBLJAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tbljal  #n</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n is in the range 0 to 191 (index8=n+64)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note data-line-986">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  Other assembler syntaxes are possible such as including the c. prefix
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-988">
<p>Therefore there is a single jump table in memory. The table entry number is from the <code>index8</code> field in the encoding, which controls the link register.</p>
</div>
<div class="ulist data-line-990">
<ul>
<li class="data-line-990">
<p><code>C.TBLJALM</code>: entries 0-7,    link to <code>zero</code></p>
</li>
<li class="data-line-991">
<p><code>C.TBLJ</code>   : entries 8-63,   link to <code>t0</code></p>
</li>
<li class="data-line-992">
<p><code>C.TBLJAL</code> : entries 64-255, link to <code>ra</code></p>
</li>
</ul>
</div>
<div class="paragraph data-line-994">
<p>Note that the LSB of every jump table entry is <em>ignored</em> which matches standard <code>JALR</code> behaviour.</p>
</div>
</div>
<div class="sect2 data-line-997">
<h3 id="configuringthejumptable">8.3. Recommended algorithm for allocating entries in the jump table</h3>
<div class="paragraph data-line-999">
<p>Calls to each function are categorised as shown in <a href="#tbljalsavings">Table 35</a>.</p>
</div>
<table id="tbljalsavings" class="tableblock frame-all grid-all stretch data-line-1004">
<caption class="title">Table 35. C.TBLJAL/TBJAL code size saving per function</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">original sequence</th>
<th class="tableblock halign-left valign-top"><code>C.TBLJ*</code> saving</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>J</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A*2-(XLEN/8) bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AUIPC+JR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">B*6-(XLEN/8) bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JAL ra</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C*2-(XLEN/8) bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AUIPC+JALR ra</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">D*6-(XLEN/8) bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JAL t0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E*2-(XLEN/8) bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AUIPC+JALR t0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F*6-(XLEN/8) bytes</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note data-line-1016">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  <code>C.JAL</code> is not included as there&#8217;s no code-size saving for RV32 and it&#8217;s not available for RV64
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1018">
<p>Each function is called by using one of the three link registers. The total saving per function is calculated by looking at all the times it is called, as follows:</p>
</div>
<div class="listingblock data-line-1020">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">saving_per_function_c_tblj    = A * 2 + B * 6 - 2*(XLEN-8)
saving_per_function_c_tbljal  = C * 2 + D * 6 - 2*(XLEN-8)
saving_per_function_c_tbljalm = E * 2 + F * 6 - 2*(XLEN-8)</code></pre>
</div>
</div>
<div class="paragraph data-line-1026">
<p>The functions are sorted so that the one with the highest saving is in table entry 0, the second highest in entry 1 etc. for that encoding.</p>
</div>
<div class="admonitionblock note data-line-1030">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  This algorithm assumes that each function is only called with one link register.
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1032">
<p>This allows the core to cache the most frequent targets by caching the lowest numbered entries of each section of the jump table. Only caching a few entries will greatly improve the performance.</p>
</div>
</div>
<div class="sect2 data-line-1034">
<h3 id="_csrs">8.4. CSRs</h3>
<div class="paragraph data-line-1036">
<p>The following set of CSRs is required to control the jump table.</p>
</div>
<div class="admonitionblock note data-line-1040">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  The addresses are for custom CSRs, correct CSR addresses need to be specified.
</td>
</tr>
</table>
</div>
<table id="xTBLJALVEC-table" class="tableblock frame-all grid-all stretch data-line-1045">
<caption class="title">Table 36. <code>xTBLJALVEC</code> definition</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">XLEN-1:6</th>
<th class="tableblock halign-left valign-top">5:2</th>
<th class="tableblock halign-left valign-top">1: 0</th>
<th class="tableblock halign-left valign-top">CSR</th>
<th class="tableblock halign-left valign-top">Permissions</th>
<th class="tableblock halign-left valign-top">Status</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7c0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">base[XLEN-1:6]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">scale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MTBLJALVEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required if jump table mode is implemented</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xbc0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">base[XLEN-1:6]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">scale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STBLJALVEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required if S-mode is implemented</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x800</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">base[XLEN-1:6]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">scale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UTBLJALVEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
<div class="ulist data-line-1052">
<ul>
<li class="data-line-1052">
<p>M-mode always uses <code>MTBLJALVEC.base</code></p>
</li>
<li class="data-line-1053">
<p>S-mode always uses <code>STBLJALVEC.base</code></p>
</li>
<li class="data-line-1054">
<p>U-mode uses <code>UTBLJALVEC.base</code> if implemented, otherwise <code>STBLJALVEC.base</code> if implemented, otherwise <code>MTBLJALVEC.base</code></p>
</li>
</ul>
</div>
<div class="paragraph data-line-1056">
<p><code>xTBLJALVEC.base</code> is a virtual address, whenever virtual memory is enabled (i.e. S and U-modes only if implemented and enabled).</p>
</div>
<div class="paragraph data-line-1058">
<p>Using <code>xTBLJALVEC.base</code> in the pseudo code below implicitly assumes that <code>xTBLJALVEC.base[5:0]=0</code>. This is consistent with the description of <code>xTVEC</code> in the Unprivileged ISA manual.</p>
</div>
<div class="paragraph data-line-1060">
<p><code>xTBLJALVEC.base</code> is naturally aligned for all legal values of <code>XLEN</code>.</p>
</div>
<div class="paragraph data-line-1062">
<p>The memory pointed to by <code>xTBLJALVEC.base</code> only requires eXecute permission. Read/Write access is not required once the jump table/vector table has been configured.</p>
</div>
<table id="xTBLJALVEC-mode-table" class="tableblock frame-all grid-all stretch data-line-1067">
<caption class="title">Table 37. <code>xTBLJALVEC.mode</code> definition</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Mode</th>
<th class="tableblock halign-left valign-top">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jump table mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved for <a href="#vector-table-mode">Section 8.6</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved for <a href="#emulation-mode">Section 8.7</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-1075">
<p><code>xTBLJALVEC.mode</code> is a WARL field, so can only be programmed to modes which are implemented. Therefore the discovery mechanism is to attempt to program different modes and read back the values to see which are available. Jump table mode <em>must</em> be implemented.</p>
</div>
<div class="paragraph data-line-1077">
<p><code>xTBLJALVEC.scale</code> is also WARL, and reads as zero. It is reserved for Vector Table Mode, see <a href="#vector-table-mode">Section 8.6</a>.</p>
</div>
</div>
<div class="sect2 data-line-1079">
<h3 id="_jump_table_mode">8.5. Jump table mode</h3>
<div class="paragraph data-line-1081">
<p>In jump table mode the behaviour is to load the target address from <code>xTBLJALVEC.base</code> with an offset which is <code>XLEN/8</code> times the parameter passed to the instruction.</p>
</div>
<div class="paragraph data-line-1083">
<p>The actual functions are not moved in memory, the jump table lookup is only to give a reference to them using a 16-bit encoding.</p>
</div>
<div class="paragraph data-line-1085">
<p>Jump table mode is easy to implement in the linker and doesn&#8217;t affect the compiler as it is only a link time optimisation.</p>
</div>
<div class="sect3 data-line-1087">
<h4 id="_pseudo_code_for_jump_table_mode">8.5.1. Pseudo-code for jump table mode</h4>
<div class="admonitionblock note data-line-1091">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  InstMemory below is an instruction memory array of elements with XLEN width.
</td>
</tr>
</table>
</div>
<div class="listingblock data-line-1094">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode"># tmp is temporary internal state, it doesn't represent a real register
# Mem is byte indexed
# index8 is the field from the encoding, not the index passed to the C.TBLJ* in the assembler
switch(XLEN) {
  32:  LW tmp, InstMemory[xTBLJALVEC.base + index8&lt;&lt;2][XLEN-1:0];
  64:  LD tmp, InstMemory[xTBLJALVEC.base + index8&lt;&lt;3][XLEN-1:0];
  128: LQ tmp, InstMemory[xTBLJALVEC.base + index8&lt;&lt;4][XLEN-1:0];
}
switch(opcode) {
  C.TBLJALM: JALR t0,   tmp[XLEN-1:0]&amp;~0x1;
  C.TBLJ:    JALR zero, tmp[XLEN-1:0]&amp;~0x1;
  C.TBLJAL:  JALR ra,   tmp[XLEN-1:0]&amp;~0x1;
}</code></pre>
</div>
</div>
<div class="paragraph data-line-1110">
<p>For the <code>vsprintf</code> example above, the jump table contains the following for <code>RV32</code>:</p>
</div>
<div class="listingblock data-line-1113">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">xTBLJALVEC.base+ 32(index  0) = # 100064a &lt;__riscv_save_0&gt;    # called with C.TBLJALM #0 (index8=0  in the encoding)
xTBLJALVEC.base+  0(index  8) = # 100066c &lt;__riscv_restore_0&gt; # called with C.TBLJ    #0 (index8=8  in the encoding)
xTBLJALVEC.base+256(index 64) = #  e08433 &lt;vsnprintf&gt;         # called with C.TBLJAL  #0 (index8=64 in the encoding)</code></pre>
</div>
</div>
</div>
<div class="sect3 data-line-1119">
<h4 id="_exceptions_for_jump_table_mode">8.5.2. Exceptions for jump table mode</h4>
<div class="paragraph data-line-1121">
<p>The jump table address can cause instruction fetch errors, such as page faults. In these cases <code>MEPC</code> is set to the PC of the <code>C.TBLJ*</code> instruction and <code>MADDR</code> is set to the address in the jump table entry.</p>
</div>
</div>
<div class="sect3 data-line-1123">
<h4 id="_context_switching_for_jump_table_mode">8.5.3. Context Switching for jump table mode</h4>
<div class="paragraph data-line-1125">
<p>The <code>xTBLJALVEC</code> CSRs form part of the current context, and so will need to be saved and restored. It is also possible for the jump table to have a single configuration for all contexts, but in general <code>xTBLJALVEC</code> is considered part of the context.</p>
</div>
</div>
<div class="sect3 data-line-1127">
<h4 id="_caching_for_jump_table_mode">8.5.4. Caching for jump table mode</h4>
<div class="paragraph data-line-1129">
<p>For improved performance, the implementation may cache the contents of the jump table. To assist this and avoid unnecessary memory fetches, we state that the table contents may be cached without consistency checks against memory outside the hart if <code>xTBLJALVEC</code> has not been written to.</p>
</div>
<div class="paragraph data-line-1131">
<p>Any write to <code>xTBLJALVEC</code>, even if the actual value is not updated, will indicate that any table caching must be flushed and refetched.</p>
</div>
<div class="paragraph data-line-1133">
<p>Therefore if there are any updates to generated code in the table in vector mode, a write to <code>xTBLJALVEC</code> is required to ensure that any cached contents are not stale. This is not expected to be the common case, because in the absence of dynamically linked libraries, the jump table is static for a given executable. Therefore the recommendation is that it is set with eXecute only privileges, the same as the rest of the code. This is better for security to prevent code in the jump table being scanned for gadgets.</p>
</div>
</div>
</div>
<div class="sect2 data-line-1136">
<h3 id="vector-table-mode">8.6. Future Mode: Vector table mode (not for RVM22/RVA22)</h3>
<div class="paragraph data-line-1138">
<p>Vector table mode is very similar to vectored interrupt handling. The target address is a scaled offset from the base vector. Therefore in vector table mode, execution passes directly to the scaled offset from the base register, not via a jump table.</p>
</div>
<div class="paragraph data-line-1140">
<p>Vector table mode is similar to the mechanism for the interrupt handler vector. The jump is direct to the destination. However the compiler would have to be aware as it will have to try to fit functions into the table, as each entry is a fixed size so it&#8217;s not so obviously implementable in the toolchain. We may find other reasons for having this mode. TBD.</p>
</div>
<div class="paragraph data-line-1142">
<p><code>xTBLJALVEC.scale</code> controls the scale. It is a read/write field instead of WARL.</p>
</div>
<table class="tableblock frame-all grid-all data-line-1145" style="width: 40%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>xTBLJALVEC.scale</code></th>
<th class="tableblock halign-left valign-top"><code>tablescale</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16-bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32-bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">&#8230;&#8203;..</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4096-bytes to match minimum TLB page size</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-1155">
<p>Note that <code>tablescale = 1&lt;&lt;(xTBLJALVEC.scale+3)</code></p>
</div>
<div class="sect3 data-line-1157">
<h4 id="_pseudo_code_for_vector_table_mode">8.6.1. Pseudo-code for vector table mode</h4>
<div class="admonitionblock note data-line-1161">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  InstMemory below is an instruction memory array of elements with XLEN width.
</td>
</tr>
</table>
</div>
<div class="listingblock data-line-1164">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode"># Mem is byte indexed
# n is the immediate operand passed to c.tblj*
switch(opcode) {
  C.TBLJ:    JALR zero, InstMemory[xTBLJALVEC.base + n*tablescale][XLEN-1:0]&amp;~0x1;
  C.TBLJAL:  JALR ra,   InstMemory[xTBLJALVEC.base + n*tablescale][XLEN-1:0]&amp;~0x1;
  C.TBLJALM: JALR t0,   InstMemory[xTBLJALVEC.base + n*tablescale][XLEN-1:0]&amp;~0x1;
}</code></pre>
</div>
</div>
</div>
<div class="sect3 data-line-1174">
<h4 id="_vector_table_code">8.6.2. vector table code</h4>
<div class="paragraph data-line-1176">
<p>Because this method doesn&#8217;t have the jump table - the code is actually placed in the table. If the code is too large to fit then it will have to call a routine outside the table, or use more than one entry which invalidates one or more table entries.
This avoids an additional redirection to get to the actual code, assuming the whole body of the code actually fits in the table.</p>
</div>
<div class="paragraph data-line-1179">
<p>Setting <code>xTBLJALVEC.scale</code> to specific values does not set a requirement on the alignment of <code>xTBLJALVEC.base</code>. For example if <code>tablescale=4096</code>, <code>xTBLJALVEC.base</code> does <em>not</em> need to be 4096-byte aligned.</p>
</div>
<div class="paragraph data-line-1181">
<p>If <code>tablescale</code> is set to 4096 then this allows each entry in the table to be owned by different privilege domain, which can manange its own code. <code>xTBLJALVEC</code> must be changed by machine mode only so as the table refers to the system as a whole.</p>
</div>
<div class="paragraph data-line-1183">
<p>In a way this approach is similar to a <strong>flash patch</strong> mechanism, where the code can be patched by replacing an instruction with a <code>C.TBLJALM</code> instruction to call an alternative routine to fix a bug, or add functionality. Although this requires write permission on the code area so cannot work on a boot ROM for example, but it can form the basis of such a mechanism.</p>
</div>
<div class="paragraph data-line-1185">
<p>For the <code>vsprintf</code> example above <code>riscv_save_0</code> / <code>riscv_restore_0</code> each take 12 bytes, and <code>xTBLJALVEC.scale=1</code> (16 bytes per entry) so the actual code is placed in the table. <code>vsprintf</code> is 136 bytes, but will shrink to 128-bytes or smaller by use of <code>c.tbljal</code> so I have allocated 4 entries to it.</p>
</div>
<div class="listingblock data-line-1188">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode"># index 0 (JAL t0 called by C.TBLJALM #0 (index8=0 in the encoding))
xTBLJALVEC.base+32  &lt;__riscv_save_0&gt;:
 	1141                	addi	sp,sp,-16
 	c04a                	sw	s2,0(sp)
 	c226                	sw	s1,4(sp)
 	c422                	sw	s0,8(sp)
 	c606                	sw	ra,12(sp)
 	8282                	jr	t0

#index 8 (JAL zero called by C.TBLJ #0 (index8=8 in the encoding))
xTBLJALVEC.base+0 &lt;__riscv_restore_0&gt;:
 	4902                	lw	s2,0(sp)
 	4492                	lw	s1,4(sp)
 	4422                	lw	s0,8(sp)
 	40b2                	lw	ra,12(sp)
 	0141                	addi	sp,sp,16
 	8082                	ret

# index 64-67 (JAL ra called by C.TBLJAL #0 (index8=64 in the encoding))
xTBLJALVEC.base+48: &lt;vsnprintf&gt;
  	xxxx                	tbljalm #0 ;# call to &lt;__riscv_save_0&gt;
  ...  up to 128-byte function body ...
  	xxxx                	tblj #0 ;# call to &lt;__riscv_restore_0&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note data-line-1217">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  This mode may waste memory as the target functions are very unlikely to all be multiples of <code>tablescale</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-1219">
<h4 id="_vector_mode_security_future_ideas">8.6.3. Vector Mode Security (future ideas)</h4>
<div class="paragraph data-line-1221">
<p>The vector mode mechanism could be reused for security in the future. It is possible to define that the memory allocated to to the table can only have entry points on the specific vectors, and also only from <code>C.TBLJ*</code> instructions. In this way sensitive code can be placed in the table which cannot be reused for ROP/JOP gadgets, because the code cannot be targetted by <code>JALR</code> instructions.</p>
</div>
<div class="paragraph data-line-1223">
<p>These ideas will not be pursued as part of the code size work.</p>
</div>
</div>
</div>
<div class="sect2 data-line-1226">
<h3 id="emulation-mode">8.7. Future Mode: Emulation Mode (not for RVM22/RVA22)</h3>
<div class="paragraph data-line-1228">
<p>Emulation mode is the simplest. It doesn&#8217;t have a jump table or vector table, so allow a minimal hardware implementation.
It relies on the values in temporary registers not being maintained across function calls.</p>
</div>
<div class="paragraph data-line-1231">
<p><em>There are concerns about overwriting the temporary registers so this may be rejected</em></p>
</div>
<div class="sect3 data-line-1233">
<h4 id="_pseudo_code_for_emulation_mode">8.7.1. Pseudo-code for emulation mode</h4>
<div class="listingblock data-line-1236">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">t4 = xTBLJALVEC.base;
t5 = n;       #table index
JALR t4, t4;  # t4 gets PC+2 for c.tbljal, PC+4 for tbljal</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-1242">
<h3 id="_diagram_for_all_table_jump_modes">8.8. Diagram for all table jump modes</h3>
<div class="imageblock data-line-1245">
<div class="content">
<img src="https://github.com/riscv/riscv-code-size-reduction/blob/master/ISA%20proposals/Huawei/tbljump4.PNG" alt="all three modes">
</div>
<div class="title">Figure 1. all three modes</div>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-1248">
<h2 id="pushpoppopret">9. PUSH and POP</h2>
<div class="sectionbody">
<div class="paragraph data-line-1250">
<p><code>PUSH, POP, POPRET</code> and <code>PUSH.E, POP.E, POPRET.E</code> along with the 16-bit forms are used to reduce the size of function prologues and epilogues.</p>
</div>
<div class="sect2 data-line-1252">
<h3 id="_a_brief_example_from_zephyr">9.1. A brief example from Zephyr</h3>
<div class="paragraph data-line-1254">
<p>This example gives a nice illustration of what <code>PUSH, POP, POPRET</code> are trying to achieve.</p>
</div>
<div class="listingblock data-line-1257">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">from subsys/bluetooth/controller/crypto/crypto.c
int bt_rand(void *buf, size_t len)
{
        return lll_csrand_get(buf, len);
}</code></pre>
</div>
</div>
<div class="paragraph data-line-1265">
<p>compiles with GCC10 to:</p>
</div>
<div class="listingblock data-line-1268">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">20405458 &lt;bt_rand&gt;:
20405458:	1141                	addi	sp,sp,-16	;#PUSH(1)
2040545a:	c04a                	sw	s2,0(sp)	;#PUSH(2)
2040545c:	70000937          	lui	s2,0x70000
20405460:	62090613          	addi	a2,s2,1568 # 70000620 &lt;prng&gt;
20405464:	c422                	sw	s0,8(sp)	;#PUSH(3)
20405466:	c226                	sw	s1,4(sp)	;#PUSH(4)
20405468:	c606                	sw	ra,12(sp)	;#PUSH(5)
2040546a:	842a                	mv	s0,a0		;#PUSH(6)
2040546c:	84ae                	mv	s1,a1		;#PUSH(7)
&lt;function body&gt;
20405494:	4501                	li	a0,0		;#POPRET(1)
20405496:	40b2                	lw	ra,12(sp)	;#POPRET(2)
20405498:	4422                	lw	s0,8(sp)	;#POPRET(3)
2040549a:	4492                	lw	s1,4(sp)	;#POPRET(4)
2040549c:	4902                	lw	s2,0(sp)	;#POPRET(5)
2040549e:	0141                	addi	sp,sp,16	;#POPRET(6)
204054a0:	8082                	ret			;#POPRET(7)</code></pre>
</div>
</div>
<div class="paragraph data-line-1289">
<p>with the GCC option <code>-msave-restore</code> the output is the following:</p>
</div>
<div class="listingblock data-line-1292">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">204089ac &lt;bt_rand&gt;:
204089ac:       f97f72ef                jal     t0,20400942 &lt;__riscv_save_0&gt;	;#PUSH(1)
204089b0:       70001937                lui     s2,0x70001
204089b4:       ac090613                addi    a2,s2,-1344 # 70000ac0 &lt;prng&gt;
204089b8:       842a                    mv      s0,a0	;#PUSH(2)
204089ba:       84ae                    mv      s1,a1	;#PUSH(3)
&lt;function_body&gt;
204089e2:       4501                    li      a0,0	;#POPRET(1)
204089e4:       f83f706f                j       20400966 &lt;__riscv_restore_0&gt;	;#POPRET(2)</code></pre>
</div>
</div>
<div class="paragraph data-line-1304">
<p>with <code>PUSH/POPRET</code> this reduces to</p>
</div>
<div class="listingblock data-line-1307">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">20405458 &lt;bt_rand&gt;:
20405458:	&lt;16-bit&gt;                push	 {ra,s0-s2},{a0-a1},-16
2040545c:	70000937          	lui	s2,0x70000
20405460:	62090613          	addi	a2,s2,1568 # 70000620 &lt;prng&gt;
&lt;function body&gt;
20405496:	&lt;16-bit&gt;                popret	 {ra,s0-s2},{0} 16</code></pre>
</div>
</div>
<div class="paragraph data-line-1317">
<p>The prologue / epilogue reduce from 28-bytes in the original code, to 14-bytes with <code>-msave-restore</code>, and to to 8-bytes with <code>PUSH, POP, POPRET</code>, which will also improve the performance.</p>
</div>
<div class="admonitionblock note data-line-1321">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  The calls to <code>&lt;riscv_save_0&gt;/&lt;riscv_restore_0&gt;</code> become 64-bit when the target functions are out of the ±1MB range, increasing the prologue/epilogue size to 22-bytes.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2 data-line-1323">
<h3 id="_uabi_and_eabi_support">9.2. UABI and EABI support</h3>
<div class="paragraph data-line-1325">
<p>The UABI is available on all RVI cores. The EABI is optional on RV32I and required on RV32E.</p>
</div>
<div class="paragraph data-line-1327">
<p>The UABI supports saved registers <code>s0-s11</code>, the EABI supports saved registers <code>s0-s4</code> only but <code>s2-s4</code> are mapped to <em>different</em> <code>X</code> registers.</p>
</div>
<div class="paragraph data-line-1329">
<p>Therefore encodings which support register lists which include up to <code>s1</code> can be used for both ABIs. As soon as the list includes <code>s2</code> then a different encoding is required.</p>
</div>
<div class="paragraph data-line-1331">
<p>This specification for the EABI is taken from <a href="https://github.com/riscv/riscv-eabi-spec/blob/master/EABI.adoc">this document</a>.</p>
</div>
<div class="paragraph data-line-1333">
<p>The <code>PUSH/POP/POPRET/C.PUSH/C.POP/C.POPRET</code> instructions support the UABI. The <code>PUSH.E/POP.E/POPRET.E/C.PUSH.E/C.POP.E/C.POPRET.E</code> instructions support the EABI.</p>
</div>
<div class="paragraph data-line-1335">
<p>Where the <code>X</code> register list is the same for both ABIs the EABI version is a pseudo-instruction, where the <code>X</code> register list is different it has a different encoding, for example:</p>
</div>
<div class="ulist data-line-1337">
<ul>
<li class="data-line-1337">
<p><code>c.pop.e {ra, s0}, 32</code> is a pseudo-instruction for <code>c.pop {ra, s0}, 32</code></p>
</li>
<li class="data-line-1338">
<p><code>c.pop.e {ra, s0-s2}, 32</code> has a different encoding to <code>c.pop {ra, s0-s2}, 32</code></p>
</li>
</ul>
</div>
<div class="paragraph data-line-1340">
<p>It is recommended that:</p>
</div>
<div class="ulist data-line-1342">
<ul>
<li class="data-line-1342">
<p>when compiling/disassembling for the UABI, the pseudo-instructions with the <code>.E</code> suffix <em>should not</em> be used.</p>
</li>
<li class="data-line-1343">
<p>when compiling/disassembling for the EABI, the pseudo-instructions with the <code>.E</code> suffix <em>should</em> be used.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1345">
<p>The <code>.E</code> forms are not available on RV64I or RV128I. Any encodings with a <code>.E</code> suffix are reserved on those base architectures.</p>
</div>
<table id="ABI-on-base-arch" class="tableblock frame-all grid-all stretch data-line-1350">
<caption class="title">Table 38. ABIs on different base architectures</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Base architecture</th>
<th class="tableblock halign-left valign-top">UABI</th>
<th class="tableblock halign-left valign-top">EABI</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RV32I</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Full support of both ABIs required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RV32E</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binary can execute on RV32I</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RV64I/RV128I</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No EABI support on RV64I/RV128I</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-1357">
<p>Code compiled for RV32I may be compiled for the UABI or EABI. Code compiled for RV32E may be executed on an RV32I core.</p>
</div>
</div>
<div class="sect2 data-line-1359">
<h3 id="_assembler_syntax">9.3. Assembler Syntax</h3>
<div class="olist arabic data-line-1361">
<ol class="arabic">
<li class="data-line-1361">
<p>The <code>PUSH</code> instruction</p>
<div class="ulist data-line-1362">
<ul>
<li class="data-line-1362">
<p>pushes(stores)  the registers specified in <code>reg_list</code> to the stack</p>
</li>
<li class="data-line-1363">
<p>if <code>areg_list</code> is included, moves the registers in the <code>areg_list</code> into <code>s</code> registers</p>
</li>
<li class="data-line-1364">
<p>adjusts the stack pointer by the <code>stack_adjustment</code></p>
</li>
</ul>
</div>
</li>
<li class="data-line-1366">
<p>The <code>POP</code> instruction</p>
<div class="ulist data-line-1367">
<ul>
<li class="data-line-1367">
<p>pops(loads) the registers in <code>reg_list</code> from the stack</p>
</li>
<li class="data-line-1368">
<p>if <code>ret_val</code> is included, moves the specified constant value into <code>a0</code> as the return value</p>
</li>
<li class="data-line-1369">
<p>adjusts the stack pointer by the <code>stack_adjustment</code>.</p>
</li>
</ul>
</div>
</li>
<li class="data-line-1371">
<p><code>POPRET</code> has the same behaviour as <code>POP</code>, followed by <code>RET</code>.</p>
</li>
</ol>
</div>
<div class="paragraph data-line-1373">
<p>32-bit and 16-bit forms of all instructions are available, the assembler should choose the 16-bit form if the parameters permit.</p>
</div>
<div class="paragraph data-line-1375">
<p>The registers in <code>reg_list</code> and <code>areg_list</code> are comma separated lists and must not be empty.</p>
</div>
<div class="paragraph data-line-1377">
<p>The assembler/disassembler can choose whether to include the <code>c.</code> prefix for 16-bit encodings. The recommendation is to exclude it.</p>
</div>
<div class="sect3 data-line-1379">
<h4 id="_32_bit_encoding_assembler_syntax">9.3.1. 32-bit encoding assembler syntax</h4>
<div class="paragraph data-line-1381">
<p>There are different definitions for the register lists in use (<code>reg_list_32u/reg_list_16u/reg_list_e</code>). In all cases the requirements of <code>areg_list</code> are the same - and so it is only specified only once with respect to <code>reg_list_*</code> to avoid replication.</p>
</div>
<div class="paragraph data-line-1383">
<p>The stack adjustment range varies between encodings. The syntax <code>stack_adjustment_0_N</code> is used. The stack adjustment value must be the total memory required for the registers in <code>reg_list_*</code> rounded up to a multiple of 16-bytes, plus an additional 0 to <code>N</code> * 16-bytes. Also see <a href="#spimm">Section 9.7.1</a>.</p>
</div>
<div class="paragraph data-line-1385">
<p>This syntax is for the 32-bit encodings, for the UABI</p>
</div>
<div class="listingblock data-line-1388">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">&lt;ret_val_32&gt;     ::= 0 | 1 | -1
&lt;sreg_list_32u&gt;  ::=      &lt;s0&gt;  | &lt;s0-sN&gt;   (where N is in the range [1, 11])
&lt;areg_list&gt;      ::= "" | &lt;a0&gt;  | &lt;a0-aP&gt;   (where P is in the range [1, 3])
&lt;reg_list_32u&gt;   ::= &lt;ra&gt; ["," &lt;sreg_list_32u&gt;]

//Only certain combinations of &lt;reg_list_*&gt; and &lt;areg_list&gt; are allowed.

if (&lt;reg_list_*&gt;=="ra")        &lt;areg_list&gt;=""
if (&lt;reg_list_*&gt;=="ra, s0")    &lt;areg_list&gt;="a0"
if (&lt;reg_list_*&gt;=="ra, s0-sN") &lt;areg_list&gt;="a0-aP" where: if (N&lt;4) P=N; else P=3;

//legal syntax for 32-bit encodings. Note that &lt;areg_list&gt; is optional for push.

push         {&lt;reg_list_32u&gt;}, [{&lt;areg_list&gt;}], -stack_adjustment_0_31
popret       {&lt;reg_list_32u&gt;}, [{ret_val_32},]   stack_adjustment_0_31
pop          {&lt;reg_list_32u&gt;}, [{ret_val_32},]   stack_adjustment_0_31</code></pre>
</div>
</div>
<div class="paragraph data-line-1408">
<p>This syntax is for the 32-bit encodings, for the EABI, which has a shorter range of <code>s</code> registers. Note that if the highest register in <code>sreg_list_e</code> is <code>s2</code> or lower, then this instruction is a <em>pseudo-instruction</em> for the non <code>.e</code> version. If <code>sreg_list_e</code> includes <code>s3</code> or <code>s4</code> then it is a separate encoding.</p>
</div>
<div class="listingblock data-line-1411">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">&lt;sreg_list_e&gt;  ::= &lt;s0&gt;  | &lt;s0-sN&gt;   (where N is in the range [1, 4])
&lt;reg_list_e&gt;   ::= &lt;ra&gt; ["," &lt;sreg_list_e&gt;]

push.e         {&lt;reg_list_e&gt;}, [{&lt;areg_list&gt;}], -stack_adjustment_0_31
popret.e       {&lt;reg_list_e&gt;}, [{ret_val_32},]   stack_adjustment_0_31
pop.e          {&lt;reg_list_e&gt;}, [{ret_val_32},]   stack_adjustment_0_31</code></pre>
</div>
</div>
<div class="admonitionblock note data-line-1423">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  An ealier version of the specification allowed <code>ra</code> to be excluded from the register list. This caused a lot of complexity in the specifications above and we found very few cases in the benchmark suite where it would have been beneficial. If <code>ra</code> is not required then <code>PUSH/C.PUSH</code> can still be used, which will waste <code>XLEN</code> bits of stack memory but <code>POP/POPRET</code> etc. <em>cannot</em> as they would overwrite <code>ra</code>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-1425">
<h4 id="_16_bit_encoding_assembler_syntax">9.3.2. 16-bit encoding assembler syntax</h4>
<div class="paragraph data-line-1427">
<p>This syntax is for the 16-bit encodings, for the UABI. The rules stated above for the 32-bit encodings also apply.</p>
</div>
<div class="listingblock data-line-1430">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">&lt;sreg_list_16u&gt;  ::= &lt;s0&gt;  | &lt;s0-sN&gt;   (where N is 1,2,3,5,7,11)
&lt;reg_list_16u&gt;   ::= &lt;ra&gt; ["," &lt;sreg_list_16u&gt;]

c.push       {&lt;reg_list_16u&gt;}, {&lt;areg_list&gt;}, -stack_adjustment_0_5
c.popret     {&lt;reg_list_16u&gt;}, [{0},]          stack_adjustment_0_5
c.pop        {&lt;reg_list_16u&gt;},                 stack_adjustment_0_1</code></pre>
</div>
</div>
<div class="paragraph data-line-1440">
<p>This syntax is for the 16-bit encodings, for the EABI. All variables have been previously defined.</p>
</div>
<div class="listingblock data-line-1443">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">c.push.e     {&lt;reg_list_e&gt;}, {&lt;areg_list&gt;}, -stack_adjustment_0_5
c.popret.e   {&lt;reg_list_e&gt;}, [{0},]          stack_adjustment_0_5
c.pop.e      {&lt;reg_list_e&gt;},                 stack_adjustment_0_1</code></pre>
</div>
</div>
<div class="paragraph data-line-1451">
<p>Examples of valid 16-bit encodings for RV32I or RV64I using the UABI:</p>
</div>
<div class="listingblock data-line-1454">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">c.push   {ra},                 -16; //store ra;                                                decrement sp by 16
c.push   {ra,s0},    {a0},     -32; //store ra,s0;     mv s0,a0;                               decrement sp by 32
c.push   {ra,s0-s1}, {a0-a1},  -96; //store ra,s0-s1;  mv s0,a0; mv s1,a1;                     decrement sp by 96
c.push   {ra,s0-s11},{a0-a3}, -128; //store ra,s0-s11; mv s0,a0; mv s1,a1; mv s2,a2; mv s2,a3; decrement sp by 128

c.pop    {ra},        16;  //load  ra;        increment sp by 16
c.popret {ra},        16;  //load  ra;        increment sp by 16; jump to ra

c.pop    {ra,s0},     32;  //load  ra,s0;     increment sp by 32
c.popret {ra,s0},{0}, 32;  //load  ra,s0;     increment sp by 32; li a0, 0; jump to ra
c.popret {ra,s0-s3},  96;  //load  ra,s0-s3;  increment sp by 96;           jump to ra
c.popret {ra,s0-s11}, 128; //load  ra,s0-s11; increment sp by 128;          jump to ra</code></pre>
</div>
</div>
<div class="paragraph data-line-1471">
<p>For example</p>
</div>
<div class="olist arabic data-line-1473">
<ol class="arabic">
<li class="data-line-1473">
<p><code>c.push   {ra,s0-s2}, {a0-a2},  -64</code> can use a 16-bit encoding</p>
</li>
<li class="data-line-1474">
<p><code>push     {ra,s0-s2},           -64</code> must use a 32-bit encoding as <code>{a0-a2}</code> is excluded</p>
</li>
<li class="data-line-1475">
<p><code>push     {ra,s0-s2}, {a0-a2}, -256</code> can use a 32-bit encoding as the <code>stack_adjustment</code> is out of range for <code>c.push</code>, or a <code>c.addi16sp; c.push</code> sequence achieves the same code-size</p>
</li>
<li class="data-line-1476">
<p><code>c.popret {ra,s0-s2}, {0},       32</code> can use a 16-bit encoding</p>
</li>
<li class="data-line-1477">
<p><code>popret   {ra,s0-s2}, {1},       32</code> must use a 32-bit encoding as <code>c.popret</code> only supports <code>0</code> as the <code>ret_val</code> value</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2 data-line-1479">
<h3 id="_determining_xlen_to_decode_and_execute_the_instructions">9.4. Determining XLEN to decode and execute the instructions</h3>
<div class="paragraph data-line-1481">
<p>The execution of the instructions depends upon <code>XLEN</code>, as the width of the loads and stores change. From the ELF file header, the dissembler can determine <code>XLEN</code> by the following flags:</p>
</div>
<div class="ulist data-line-1483">
<ul>
<li class="data-line-1483">
<p>ELFCLASS64 for RV64</p>
</li>
<li class="data-line-1484">
<p>ELFCLASS32 for RV32</p>
</li>
</ul>
</div>
<div class="admonitionblock note data-line-1488">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  I don&#8217;t think there&#8217;s an ELFCLASS128 for RV128
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1490">
<p>If using a debugger then <code>misa.MXL</code> can be read, if XLEN is not known for the core.</p>
</div>
<div class="paragraph data-line-1492">
<p>Follow this link for details of the <a href="https://github.com/riscv/riscv-elf-psabi-doc/blob/master/riscv-elf.md#file-header">ELF file header</a></p>
</div>
</div>
<div class="sect2 data-line-1494">
<h3 id="_pseudo_code">9.5. Pseudo-code</h3>
<div class="paragraph data-line-1496">
<p>The pseudo-code below show the required architectural state updates.</p>
</div>
<div class="paragraph data-line-1498">
<p>Note that every architectural state update in the pseudo-code can be executed as a standard RISC-V 32-bit encoding, so that it is possible execute the instructions as sequences of standard instructions.</p>
</div>
<div class="paragraph data-line-1500">
<p>Because the pseudo-code includes load or store operations, they may take any fault caused by executing loads or stores. See <a href="#fault-handling">Section 9.8</a> for more details.</p>
</div>
<div class="sect3 data-line-1502">
<h4 id="_pushpush_ec_pushc_push_e_pseudo_code">9.5.1. PUSH/PUSH.E/C.PUSH/C.PUSH.E Pseudo-code</h4>
<div class="paragraph data-line-1504">
<p>The <code>PUSH/PUSH.E/C.PUSH/C.PUSH.E</code> instructions store the set of registers from <code>reg_list</code> to consecutive memory locations, and decrement the stack pointer.
The pseudo-code uses assembly inserts so that it can use <code>sw/sd</code> etc.</p>
</div>
<div class="paragraph data-line-1507">
<p>The pseudo-code shows the memory and architectural state updates of the whole instruction which has completed without faults, debug halts or interrupts. See <a href="#fault-handling">Section 9.8</a> and <a href="#software-view">Section 9.9</a> for more information.</p>
</div>
<div class="admonitionblock note data-line-1510">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  <code>stack_adjustment</code> is negative.
</td>
</tr>
</table>
</div>
<div class="listingblock data-line-1513">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">//RV64/RV128 must have a 16-byte aligned sp
if (misa.MXL&gt;=2 &amp;&amp; sp[3:0]) {take_illegal_instruction_exception();}
//RV32I might be using the EABI (8-byte alignment) or UABI (16-byte alignment, so in hardware we can only check for 8)
if (misa.MXL==1 &amp;&amp; sp[2:0]) {take_illegal_instruction_exception();}

if (misa.MXL==1) {bytes=4;}
if (misa.MXL==2) {bytes=8;}
else             {bytes=16;}
addr=sp-bytes;
switch(bytes) {
  4:  asm("sw ra, 0(addr)");
  8:  asm("sd ra, 0(addr)");
  16: asm("sq ra, 0(addr)");
}
for(i in sreg_list)  {
  addr-=bytes;
  switch(bytes) {
    4:  asm("sw s[i], 0(addr)");
    8:  asm("sd s[i], 0(addr)");
    16: asm("sq s[i], 0(addr)");
  }
}
if (areg_list) {
  for (i in areg_list) {
    asm("mv s[i], a[i]");}
  }
}
sp+=stack_adjustment; //decrement</code></pre>
</div>
</div>
</div>
<div class="sect3 data-line-1544">
<h4 id="_poppop_epopretpopret_ec_popc_pop_ec_popretc_popret_e_pseudo_code">9.5.2. POP/POP.E/POPRET/POPRET.E/C.POP/C.POP.E/C.POPRET/C.POPRET.E Pseudo-code</h4>
<div class="paragraph data-line-1546">
<p>A <code>POP/POP.E/POPRET/POPRET.E/C.POP/C.POP.E/C.POPRET/C.POPRET.E</code> instruction loads the set of registers from <code>reg_list</code> from consecutive memory locations, and then increments the stack pointer.
The pseudo-code uses assembly inserts so that it can use <code>lw/ld/ret</code> etc.</p>
</div>
<div class="paragraph data-line-1549">
<p>The pseudo-code shows the architectural state updates of the whole instruction which has completed without faults, debug halts or interrupts. See <a href="#fault-handling">Section 9.8</a> and <a href="#software-view">Section 9.9</a> for more information.</p>
</div>
<div class="admonitionblock note data-line-1552">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  <code>stack_adjustment</code> is positive.
</td>
</tr>
</table>
</div>
<div class="listingblock data-line-1555">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">//RV64/RV128 must have a 16-byte aligned sp
if (misa.MXL&gt;=2 &amp;&amp; sp[3:0]) {take_illegal_instruction_exception();}
//RV32I might be using the EABI (8-byte alignment) or UABI (16-byte alignment, so in hardware we can only check for 8)
if (misa.MXL==1 &amp;&amp; sp[2:0]) {take_illegal_instruction_exception();}

if (misa.MXL==1) {bytes=4;}
if (misa.MXL==2) {bytes=8;}
else             {bytes=16;}
addr=sp+stack_adjustment-bytes;
switch(bytes) {
  4:  asm("lw ra, 0(addr)");
  8:  asm("ld ra, 0(addr)");
  16: asm("lq ra, 0(addr)");
}
for(i in sreg_list)  {
  addr-=bytes;
  switch(bytes) {
    4:  asm("lw s[i], 0(addr)");
    8:  asm("ld s[i], 0(addr)");
    16: asm("lq s[i], 0(addr)");
  }
}
sp+=stack_adjustment; //increment
if (ret_val) {
   switch(ret_val) {
      "0":  asm("li a0, 0");
      "1":  asm("li a0, 1");
      "-1": asm("li a0, -1");
   }
}
if (opcode == "POPRET"   or
    opcode == "POPRET.E" or
    opcode == "C.POPRET" or
    opcode == "C.POPRET.E") {
   asm("ret");
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-1595">
<h3 id="pushpoppopret32bitencodings">9.6. 32-bit Encodings</h3>
<div class="admonitionblock note data-line-1599">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  These encodings are in <em>custom-0</em>, correct encodings need to be allocated.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch data-line-1603">
<caption class="title">Table 39. push/pop/popret 32-bit format PPP-type</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">31:23</th>
<th class="tableblock halign-left valign-top">22:20</th>
<th class="tableblock halign-left valign-top">19:16</th>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14:12</th>
<th class="tableblock halign-left valign-top">11: 7</th>
<th class="tableblock halign-left valign-top">6 : 0</th>
<th class="tableblock halign-left valign-top">type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">funct9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">field4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">field3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">field2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">funct3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">field1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opcode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZCE-type</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch data-line-1610">
<caption class="title">Table 40. push/pop/popret 32-bit encodings</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">31:22</th>
<th class="tableblock halign-left valign-top">21:20</th>
<th class="tableblock halign-left valign-top">19:16</th>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14:12</th>
<th class="tableblock halign-left valign-top">11: 7</th>
<th class="tableblock halign-left valign-top">6 : 0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">000000000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rlist (0-12)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0010011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">000000000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rlist (13-15)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0010011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH.E</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">000000000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ret_val</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rlist (0-12)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0010011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">000000000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ret_val</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rlist (13-15)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0010011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP.E</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">000000000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ret_val</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rlist (0-12)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">110</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0010011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">000000000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ret_val</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rlist (13-15)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">110</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0010011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET.E</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note data-line-1622">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  <code>rlist&gt;12</code> gives register lists which only map to the EABI because the <code>X</code> register mapping is different for <code>s2-s4</code>, hence the <code>.E</code> suffix
</td>
</tr>
</table>
</div>
<table id="32bit-ret_val" class="tableblock frame-all grid-all stretch data-line-1628">
<caption class="title">Table 41. <code>ret_val</code> values for the 32-bit encodings for <code>POP, POPRET</code></caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">return value</th>
<th class="tableblock halign-left valign-top">ABI names</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none (don&#8217;t set a0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a0=0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a0=1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a0=-1</p></td>
</tr>
</tbody>
</table>
<table id="32bit-rlist" class="tableblock frame-all grid-all stretch data-line-1639">
<caption class="title">Table 42. <code>rlist</code> field values for the 32-bit encodings</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">rlist</th>
<th class="tableblock halign-left valign-top">ABI names</th>
<th class="tableblock halign-left valign-top">ABI</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>s0-s1</code> are the same for the UABI or EABI so the encoding is the same</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">both</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">both</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">both</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UABI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>s2+</code> is different</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UABI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UABI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UABI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UABI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UABI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UABI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UABI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UABI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UABI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">EABI has <code>s2-s4</code> differently mapped</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EABI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EABI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EABI</p></td>
</tr>
</tbody>
</table>
<table id="proposed-32bit-encodingsI-2" class="tableblock frame-all grid-all stretch data-line-1666">
<caption class="title">Table 43. PUSH/POP/POPRET 32-bit encoding validity on RV32I/RV32E/RV64I/RV128I</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">RV32I</th>
<th class="tableblock halign-left valign-top">RV32E</th>
<th class="tableblock halign-left valign-top">RV64I/RV128I</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP          {ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP          {[ra,] s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP          {[ra,] s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP          {[ra,] s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP.E        {[ra,] s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET       {ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET       {[ra,] s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET       {[ra,] s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET       {[ra,] s0- <em>sN</em>}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET.E     {[ra,] s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET.E     {[ra,] s0-s3}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET.E     {[ra,] s0-s4}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH         {ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH         {[ra,] s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH         {[ra,] s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH         {[ra,] s0- <em>sN</em>}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH.E       {[ra,] s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH.E       {[ra,] s0-s3}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH.E       {[ra,] s0-s4}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note data-line-1691">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  <em>sN</em> = (s2,s3,..,s11)
</td>
</tr>
</table>
</div>
<div class="admonitionblock note data-line-1695">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  If there is no ✓ in a cell then the encoding is <strong>reserved</strong> on that architecture
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1697">
<p>All the <code>.E</code> instructions and pseudo-instructions are valid for <code>RV32I/RV32E</code>, none are valid for <code>RV64I/RV128I</code></p>
</div>
<div class="sect3 data-line-1699">
<h4 id="_illegal_instructions">9.6.1. Illegal instructions</h4>
<div class="paragraph data-line-1701">
<p>The following cases cause illegal instruction exceptions:</p>
</div>
<div class="ulist data-line-1703">
<ul>
<li class="data-line-1703">
<p>If <code>sp</code> is not 8-byte aligned and <code>XLEN=32</code></p>
</li>
<li class="data-line-1704">
<p>If <code>sp</code> is not 16-byte aligned and <code>XLEN&gt;32</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note data-line-1708">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  RV32I may use either the UABI or EABI, so we can only check the EABI minimum alignment.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2 data-line-1711">
<h3 id="pushpoppopret16bitIencodings">9.7. 16-bit Encodings</h3>
<div class="paragraph data-line-1713">
<p>These instructions have no conflicts with other extensions, they use previously reserved encodings.</p>
</div>
<table id="proposed-16bit-encodingsI-1" class="tableblock frame-all grid-all stretch data-line-1718">
<caption class="title">Table 44. PUSH/POP/POPRET 16-bit encodings</caption>
<colgroup>
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8832%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">spimm0_5[6:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ret0</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rlist3</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spimm[4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rlist3</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spimm[4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rlist2</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP.E (RV32 only)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">spimm0_5[6:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rlist3</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">spimm0_5[6:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ret0</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rlist2</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET.E (RV32 only)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spimm0_5[4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">spimm0_5[6:5]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rlist2</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH.E (RV32 only)</p></td>
</tr>
</tbody>
</table>
<div class="ulist data-line-1731">
<ul>
<li class="data-line-1731">
<p><code>spimm0_5[6:4]</code> has legal values of 0 to 5</p>
</li>
</ul>
</div>
<table id="rlist3-table" class="tableblock frame-all grid-all stretch data-line-1736">
<caption class="title">Table 45. <code>rlist3</code> values for the 16-bit encodings</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">rlist3</th>
<th class="tableblock halign-left valign-top">ABI names</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s1}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s2}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s3}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s5}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s7}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s11}</p></td>
</tr>
</tbody>
</table>
<table id="rlist2-table" class="tableblock frame-all grid-all stretch data-line-1751">
<caption class="title">Table 46. <code>rlist2</code> values for the 16-bit encodings</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">rlist2</th>
<th class="tableblock halign-left valign-top">ABI names</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s2}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s3}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s4}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
</tbody>
</table>
<table id="ret0-table" class="tableblock frame-all grid-all stretch data-line-1762">
<caption class="title">Table 47. <code>ret0</code> values for the 16-bit encodings</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">return value</th>
<th class="tableblock halign-left valign-top">ABI names</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none (don&#8217;t set a0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a0=0</p></td>
</tr>
</tbody>
</table>
<table id="proposed-16bit-encodingsI-2" class="tableblock frame-all grid-all stretch data-line-1772">
<caption class="title">Table 48. PUSH/POP/POPRET 16-bit encoding validity on RV32I/RV32E/RV64I/RV128I</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">RV32I</th>
<th class="tableblock halign-left valign-top">RV32E</th>
<th class="tableblock halign-left valign-top">RV64I/RV128I</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP        {ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP        {ra, s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP        {ra, s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP        {ra, s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP.E      {ra, s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET     {ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET     {ra, s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET     {ra, s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET     {ra, s0- <em>sN</em>}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET.E   {ra, s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET.E   {ra, s0-s3}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET.E   {ra, s0-s4}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH       {ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH       {ra, s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH       {ra, s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH       {ra, s0- <em>sN</em>}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH.E     {ra, s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH.E     {ra, s0-s3}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH.E     {ra, s0-s4}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note data-line-1797">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  <em>sN</em> = (s2,s3,s5,s7,s11)
</td>
</tr>
</table>
</div>
<div class="admonitionblock note data-line-1801">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  If there is no ✓ in a cell then the encoding is <strong>reserved</strong> on that architecture
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1803">
<p>All the <code>.E</code> instructions and pseudo-instructions are valid for <code>RV32I/RV32E</code>, none are valid for <code>RV64I/RV128I</code></p>
</div>
<div class="sect3 data-line-1806">
<h4 id="spimm">9.7.1. <code>spimm</code> encoding field</h4>
<div class="paragraph data-line-1808">
<p>The <code>stack_adjustment</code> field in the assembler syntax comprises of two components:</p>
</div>
<div class="olist arabic data-line-1810">
<ol class="arabic">
<li class="data-line-1810">
<p>the memory required for the registers in the list, rounded up to 16-bytes (using the <code>Align16</code> function below)</p>
</li>
<li class="data-line-1811">
<p>additional stack space allocated for local variables, encoded in the <code>spimm</code> field</p>
</li>
</ol>
</div>
<div class="listingblock data-line-1814">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">function Align16(i): return (i+15)&amp;~0xf; // make it 16-byte aligned
total_register_bytes = number_of_registers_in_reg_list * XLEN/8;
stack_adjustment = Align16(total_register_bytes) + spimm;</code></pre>
</div>
</div>
<div class="paragraph data-line-1820">
<p>the allowable range of <code>spimm</code> varies for different encodings.</p>
</div>
<div class="admonitionblock note data-line-1823">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  <code>spimm</code> always represents 16-byte blocks even on RV32E where the stack is 8-byte aligned. This is for simplicity.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note data-line-1827">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  if <code>spimm</code> is out of range for the compiler, <code>PUSH/POP/POPRET</code> can still be inferred, and the compiler can infer an additional stack adjustment instruction
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1829">
<p>In many cases the 16-bit encoding is sufficient. The 32-bit encoding offers a larger <code>spimm</code> range, but this can also be achieved with a separate <code>c.addi sp, sp, #offset</code> instruction giving the same overall code-size.</p>
</div>
<div class="paragraph data-line-1831">
<p>Additional benefits of the 32-bit encoding are:</p>
</div>
<div class="ulist data-line-1833">
<ul>
<li class="data-line-1833">
<p>more accurate register lists improving performance and memory usage (so that superfluous <code>s</code> registers aren&#8217;t saved/restored)</p>
</li>
<li class="data-line-1834">
<p>disabling the mebedded <code>mv</code> instrucitons for <code>PUSH</code> if they are not needed</p>
</li>
<li class="data-line-1835">
<p>better control over the return value (<code>POP/POPRET</code>) improving code-size.</p>
</li>
</ul>
</div>
</div>
<div class="sect3 data-line-1838">
<h4 id="total-stack-rv32">9.7.2. Total stack adjustment ranges for RV32</h4>
<div class="paragraph data-line-1840">
<p>These tables are provided as a handy reference, they are all calculated from the formulae in this specification. They should be in an appendix.</p>
</div>
<table id="spimmrange_16" class="tableblock frame-all grid-all stretch data-line-1845">
<caption class="title">Table 49. C.PUSH/C.POP/C.POPRET valid values of stack adjustment for RV32</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">rlist</th>
<th class="tableblock halign-left valign-top">C.PUSH</th>
<th class="tableblock halign-left valign-top">C.PUSH.E</th>
<th class="tableblock halign-left valign-top">C.POPRET</th>
<th class="tableblock halign-left valign-top">C.POPRET.E</th>
<th class="tableblock halign-left valign-top">C.POP</th>
<th class="tableblock halign-left valign-top">C.POP.E</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s3}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -112</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -112</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 112</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 112</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 48</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s4}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -112</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 112</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s5}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -112</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 112</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 48</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 48</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s7}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-48 to -128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48 to 128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48 to 64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48 to 64</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s11}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-64 to -144</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64 to 144</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64 to 80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64 to 80</p></td>
</tr>
</tbody>
</table>
<table id="spimmrange_32_ra" class="tableblock frame-all grid-all stretch data-line-1861">
<caption class="title">Table 50. PUSH/POP/POPRET valid values of total stack adjustment for RV32</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">rlist</th>
<th class="tableblock halign-left valign-top">PUSH</th>
<th class="tableblock halign-left valign-top">PUSH.E</th>
<th class="tableblock halign-left valign-top">POP/POPRET</th>
<th class="tableblock halign-left valign-top">POP.E/POPRET.E</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 512</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 512</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 512</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 512</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s3}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 528</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s4}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 528</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s5}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s6}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s7}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-48 to -544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48 to 544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s8}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-48 to -544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48 to 544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s9}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-48 to -544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48 to 544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s10}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-48 to -544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48 to 544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s11}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-64 to -560</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64 to 560</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3 data-line-1879">
<h4 id="total-stack-rv64">9.7.3. Total stack adjustment ranges for RV64</h4>
<div class="paragraph data-line-1881">
<p>These tables are provided as a handy reference, they are all calculated from the formulae in this specification.</p>
</div>
<table id="spimmrange_16_rv64" class="tableblock frame-all grid-all stretch data-line-1886">
<caption class="title">Table 51. C.PUSH/C.POP/C.POPRET valid values of stack adjustment for RV64</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">rlist</th>
<th class="tableblock halign-left valign-top">C.PUSH</th>
<th class="tableblock halign-left valign-top">C.PUSH.E</th>
<th class="tableblock halign-left valign-top">C.POPRET</th>
<th class="tableblock halign-left valign-top">C.POPRET.E</th>
<th class="tableblock halign-left valign-top">C.POP</th>
<th class="tableblock halign-left valign-top">C.POP.E</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -112</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -112</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 112</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 112</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 48</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 48</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -112</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -112</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 112</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 112</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 48</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 48</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s3}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-48 to -128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-48 to -128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48 to 128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48 to 128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48 to 64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48 to 80</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s4}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-48 to -128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48 to 128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48 to 96</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s5}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-64 to -144</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64 to 144</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64 to 80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s7}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-80 to -160</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80 to 160</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80 to 96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s11}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-112 to -192</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">112 to 192</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">112 to 128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
</tbody>
</table>
<table id="spimmrange_32_ra_rv64" class="tableblock frame-all grid-all stretch data-line-1902">
<caption class="title">Table 52. PUSH/POP/POPRET valid values of total stack adjustment for RV64</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">rlist</th>
<th class="tableblock halign-left valign-top">PUSH</th>
<th class="tableblock halign-left valign-top">PUSH.E</th>
<th class="tableblock halign-left valign-top">POP/POPRET</th>
<th class="tableblock halign-left valign-top">POP.E/POPRET.E</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 512</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-16 to -512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 512</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 to 512</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 528</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-32 to -528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 to 528</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s3}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-48 to -544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-48 to -544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48 to 544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48 to 544</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s4}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-48 to -544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-48 to -544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48 to 544</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48 to 544</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s5}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-64 to -560</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64 to 560</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s6}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-64 to -560</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64 to 560</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s7}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-80 to -576</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80 to 576</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s8}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-80 to -576</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80 to 576</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s9}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-96 to -592</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">96 to 592</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s10}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-96 to -592</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">96 to 592</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ra, s0-s11}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-112 to -608</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">112 to 608</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2 data-line-1920">
<h3 id="fault-handling">9.8. Fault handling</h3>
<div class="paragraph data-line-1922">
<p>The sequence required to execute the instruction may be interrupted, or may not be able to start execution for several reasons.</p>
</div>
<div class="ulist data-line-1924">
<ul>
<li class="data-line-1924">
<p>virtual memory page fault or PMP fault</p>
<div class="ulist data-line-1925">
<ul>
<li class="data-line-1925">
<p>these can be detected before execution, or during execution if the memory addresses cross a page/PMP boundary</p>
</li>
</ul>
</div>
</li>
<li class="data-line-1926">
<p>watchpoint trigger</p>
<div class="ulist data-line-1927">
<ul>
<li class="data-line-1927">
<p>these can be detected before execution, or during execution depending on the trigger type (load data triggers require the sequence to have started executing, for example)</p>
</li>
</ul>
</div>
</li>
<li class="data-line-1928">
<p>external debug halt</p>
<div class="ulist data-line-1929">
<ul>
<li class="data-line-1929">
<p>the halt can treat the whole sequence atomically, or interrupt mid sequence (implementation defined)</p>
</li>
</ul>
</div>
</li>
<li class="data-line-1930">
<p>debug halt caused by a trigger</p>
<div class="ulist data-line-1931">
<ul>
<li class="data-line-1931">
<p>same comment as watchpoint trigger above</p>
</li>
</ul>
</div>
</li>
<li class="data-line-1932">
<p>load access fault</p>
<div class="ulist data-line-1933">
<ul>
<li class="data-line-1933">
<p>these are detected while the sequence is executing</p>
</li>
</ul>
</div>
</li>
<li class="data-line-1934">
<p>store access fault (precise or imprecise)</p>
<div class="ulist data-line-1935">
<ul>
<li class="data-line-1935">
<p>these may be detected while the sequence is executing, or afterwards if imprecise</p>
</li>
</ul>
</div>
</li>
<li class="data-line-1936">
<p>interrupts</p>
<div class="ulist data-line-1937">
<ul>
<li class="data-line-1937">
<p>these may arrive at any time. An implementation can choose whether to interrupt the sequence or not.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph data-line-1939">
<p>Because some faults can only be detected during the sequence the core implementation is able to recover from the fault and re-execute the sequence. This may involve executing some or all of the loads and stores from the sequence multiple times before the sequence completes (as multiple faults or multiple interrupts are possible).</p>
</div>
<div class="paragraph data-line-1941">
<p>Therefore correct execution requires that <code>sp</code> refers to idempotent memory (see <a href="#non-idem-mem">Section 9.9.3</a> for non-idempotent handling)</p>
</div>
</div>
<div class="sect2 data-line-1944">
<h3 id="software-view">9.9. Software view of execution</h3>
<div class="sect3 data-line-1946">
<h4 id="_software_view_of_push_sequence">9.9.1. Software view of <code>PUSH</code> sequence</h4>
<div class="paragraph data-line-1948">
<p>From a software perspective the <code>PUSH</code> sequence appears as:</p>
</div>
<div class="ulist data-line-1950">
<ul>
<li class="data-line-1950">
<p>A sequence of stores writing a contiguous block of memory. Any of the bytes may be written multiple times.</p>
</li>
<li class="data-line-1951">
<p>A stack pointer adjustment</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1953">
<p>Because the memory is idempotent and the stores are non-overlapping, they may be reordered, grouped into larger accesses, split into smaller access or any combination of these.</p>
</div>
<div class="paragraph data-line-1955">
<p>If an implementation allows interrupts during the sequence, and the interrupt handler uses <code>sp</code> to allocate stack memory, then any stores which were executed before the interrupt maybe be overwritten by the handler. This is safe because the memory is idempotent and the stores will be re-executed once the handler completes.</p>
</div>
<div class="paragraph data-line-1957">
<p>The stack pointer adjustment must only be committed once it is certain that all of the stores will complete within triggerring any precise faults (stores may return imprecise bus errors which are received after the instruction has completed execution).</p>
</div>
<div class="paragraph data-line-1959">
<p>For example:</p>
</div>
<div class="listingblock data-line-1962">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">c.push  {ra, s0-s5},{a0-a3}, -64</code></pre>
</div>
</div>
<div class="paragraph data-line-1966">
<p>Appears to software as:</p>
</div>
<div class="listingblock data-line-1969">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode"># any bytes from SP-1 to SP-28 may be written multiple times before the instruction completes
sw  ra, -4(sp);
sw  s0, -8(sp);
sw  s1,-12(sp);
sw  s2,-16(sp);
sw  s3,-20(sp);
sw  s4,-24(sp);
sw  s5,-28(sp);

# these must only execute once, and will only execute after all stores complete sucessfully
mv s0, a0;
mv s1, a1;
mv s2, a2;
mv s3, a3;
addi sp, sp, -64;</code></pre>
</div>
</div>
</div>
<div class="sect3 data-line-1987">
<h4 id="_software_view_of_poppopret_sequence">9.9.2. Software view of <code>POP/POPRET</code> sequence</h4>
<div class="paragraph data-line-1989">
<p>From a software perspective the <code>POP/POPRET</code> sequence appears as:</p>
</div>
<div class="ulist data-line-1991">
<ul>
<li class="data-line-1991">
<p>A sequence of loads, any of which may be executed multiple times</p>
</li>
<li class="data-line-1992">
<p>A stack pointer adjustment</p>
</li>
<li class="data-line-1993">
<p>An optional <code>RET</code></p>
</li>
</ul>
</div>
<div class="paragraph data-line-1995">
<p>If an implementation allows interrupts during the sequence, then any loads which were executed before the interrupt may update architectural state. The loads will be re-executed once the handler completes, so the values will be overwritten. Therefore it is permitted for an implementation to update some of the destination registers before taking the interrupt or other fault.</p>
</div>
<div class="paragraph data-line-1997">
<p>The register moves and stack pointer adjustment must only be committed once it is certain that all of the loads will complete successfully.</p>
</div>
<div class="paragraph data-line-1999">
<p>For <code>POPRET</code> once the stack pointer adjustment has been committed the <code>RET</code> must execute.</p>
</div>
<div class="paragraph data-line-2001">
<p>For example:</p>
</div>
<div class="listingblock data-line-2004">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">popret   {ra, s0-s3}, {1}, 32 ;</code></pre>
</div>
</div>
<div class="paragraph data-line-2008">
<p>Appears to software as:</p>
</div>
<div class="listingblock data-line-2011">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode"># any or all of these load instructions may execute multiple times
lw   ra, 28(sp);
lw   s0, 24(sp);
lw   s1, 20(sp);
lw   s2, 16(sp);
lw   s3, 12(sp);

# must only execute once, will only execute after all loads complete successfully
# all instructions must execute atomically
li a0, 1
addi sp, sp, 32;
ret;</code></pre>
</div>
</div>
</div>
<div class="sect3 data-line-2026">
<h4 id="non-idem-mem">9.9.3. Non-idempotent memory</h4>
<div class="paragraph data-line-2028">
<p>An implementation may have a requirement to issue <code>PUSH/POP/POPRET</code> to non-idempotent memory.</p>
</div>
</div>
<div class="sect3 data-line-2030">
<h4 id="_error_detection">9.9.4. Error detection</h4>
<div class="paragraph data-line-2032">
<p>If the core implementation does not have a requirement to support <code>PUSH/POP/POPRET</code> to non-idempotent memories, and the core can use a PMA to detect that the memory is non-idempotent, then take a load(<code>POP/POPRET</code>) or store (<code>PUSH</code>) access fault exception.</p>
</div>
</div>
<div class="sect3 data-line-2034">
<h4 id="_non_idempotent_support">9.9.5. Non-idempotent support</h4>
<div class="paragraph data-line-2036">
<p>It is possible to support non-idempotent memory. One reason is to re-use <code>PUSH/POP</code> as a restricted form of a load/store multiple instruction to a peripheral (see <a href="#ldstm">Section 9.12</a>), as there is no generic load/store multiple instruction currently in the RISC-V ISA. If load/store multiple is supported in the future then it should support non-idempotent memory.</p>
</div>
<div class="paragraph data-line-2038">
<p>Non-idempotent memory support requires additional restrictions:</p>
</div>
<div class="olist arabic data-line-2040">
<ol class="arabic">
<li class="data-line-2040">
<p>Do not allow interrupts during execution</p>
</li>
<li class="data-line-2041">
<p>Do not allow external debug halt during execution</p>
</li>
<li class="data-line-2042">
<p>Detect any virtual memory page faults or PMP faults for the whole instruction before starting execution (instead of during the sequence)</p>
</li>
<li class="data-line-2043">
<p>Do not split / merge / reorder the generated memory accesses</p>
</li>
</ol>
</div>
<div class="paragraph data-line-2045">
<p>It is possible that one of the following will still occur during execution:</p>
</div>
<div class="olist arabic data-line-2047">
<ol class="arabic">
<li class="data-line-2047">
<p>Watchpoint trigger</p>
</li>
<li class="data-line-2048">
<p>Load/store access fault</p>
</li>
</ol>
</div>
<div class="paragraph data-line-2050">
<p>In these cases the core will jump to the debug or exception handler. If execution is required to continue afterwards (so the event is not fatal to the code execution), then the handler is required to do so in software.</p>
</div>
<div class="paragraph data-line-2052">
<p>By following these rules memory accesses will only ever be issued once, and in the order listed in the pseudo-code.</p>
</div>
<div class="paragraph data-line-2054">
<p>It is possible for implementations to follow these restricted rules and to safely access both types of memory. It is also possible for an implementation to use PMAs to detect the memory type and apply different rules, such as only allowing interrupts if accessing cacheable memory, for example.</p>
</div>
</div>
</div>
<div class="sect2 data-line-2056">
<h3 id="_toolchain_implementation">9.10. Toolchain implementation</h3>
<div class="paragraph data-line-2058">
<p><code>PUSH/POP/POPRET</code> can be generated by the compiler, but can also be added as an optimisation in the linker. If they are inferred at link time then they can also be used to optimise precompiled library code. This means that the libraries can be shipped without these instructions, but platforms which implement them can still benefit from the code-size saving.</p>
</div>
<div class="admonitionblock note data-line-2062">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  The linker may have to reallocate registers as the register moves included in <code>PUSH/C.PUSH</code> target specific <code>s</code> registers which may not agree with the compiler output, example.
</td>
</tr>
</table>
</div>
<div class="sect3 data-line-2064">
<h4 id="_compiling_for_size_or_performance">9.10.1. Compiling for size or performance</h4>
<div class="paragraph data-line-2066">
<p>There are cases where it is not clear whether to use the 16-bit or 32-bit encoding.</p>
</div>
<div class="paragraph data-line-2068">
<p>If compiling with -Os/-Oz the compiler should generate the smallest possible code output, which may include performance reduction due to:</p>
</div>
<div class="olist arabic data-line-2070">
<ol class="arabic">
<li class="data-line-2070">
<p>too many <code>s</code> registers in the register list</p>
<div class="olist loweralpha data-line-2071">
<ol class="loweralpha" type="a">
<li class="data-line-2071">
<p>for example <code>push {ra, s0-s6}</code> is required but not available in the 16-bit encoding so <code>c.push {ra,s0-s7}</code> must be used instead for the smallest code-size</p>
</li>
</ol>
</div>
</li>
<li class="data-line-2072">
<p>too many included register moves (for <code>C.PUSH</code> only)</p>
<div class="olist loweralpha data-line-2073">
<ol class="loweralpha" type="a">
<li class="data-line-2073">
<p>for example <code>push {ra,s0-s1}, {a0}</code> is required, but the 16-bit encoding will include an extra register move <code>c.push {ra,s0-s1}, {a0-a1}</code></p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph data-line-2075">
<p>Another consideration is whether the total stack adjustment can be encoded by the 16-bit version, the 32-bit encoding gives a larger range but still will not cover all cases.</p>
</div>
<div class="paragraph data-line-2077">
<p>The default choice is always to use the 16-bit encoding. The rules below are for when to choose the 32-bit encoding instead.</p>
</div>
<div class="paragraph data-line-2079">
<p>For <code>C.PUSH/PUSH</code>, use <code>PUSH</code> if:</p>
</div>
<div class="olist arabic data-line-2081">
<ol class="arabic">
<li class="data-line-2081">
<p>The total stack adjustment (see <a href="#total-stack-rv32">Section 9.7.2</a>, <a href="#total-stack-rv64">Section 9.7.3</a>) is out of range for <code>C.PUSH</code>, but in range for <code>PUSH</code>.</p>
</li>
<li class="data-line-2082">
<p><code>C.PUSH</code> includes too many <code>s</code> registers and not compiling with -Os/-Oz.</p>
</li>
<li class="data-line-2083">
<p><code>C.PUSH</code> includes too many register moves and not compiling with -Os/-Oz.</p>
</li>
</ol>
</div>
<div class="paragraph data-line-2085">
<p>For <code>C.POPRET/POPRET</code>, use <code>POPRET</code> if:</p>
</div>
<div class="olist arabic data-line-2087">
<ol class="arabic">
<li class="data-line-2087">
<p>The total stack adjustment (see <a href="#total-stack-rv32">Section 9.7.2</a>, <a href="#total-stack-rv64">Section 9.7.3</a>) is out of range for <code>C.POPRET</code>, but in range for <code>POPRET</code>.</p>
</li>
<li class="data-line-2088">
<p><code>C.POPRET</code> includes too many <code>s</code> registers and not compiling with -Os/-Oz.</p>
</li>
<li class="data-line-2089">
<p>The return value is <code>1</code> or <code>-1</code>, (<code>C.POPRET</code> only allows the option of returning <code>0</code>).</p>
</li>
</ol>
</div>
<div class="paragraph data-line-2091">
<p>For <code>C.POP/POP</code>, use <code>POP</code> if</p>
</div>
<div class="olist arabic data-line-2093">
<ol class="arabic">
<li class="data-line-2093">
<p>The total stack adjustment (see <a href="#total-stack-rv32">Section 9.7.2</a>, <a href="#total-stack-rv64">Section 9.7.3</a>) is out of range for <code>C.POP</code>, but in range for <code>POP</code>.</p>
</li>
<li class="data-line-2094">
<p><code>C.POP</code> doesn&#8217;t include enough registers.</p>
</li>
<li class="data-line-2095">
<p>The return value is <code>0, 1</code> or <code>-1</code>.</p>
</li>
</ol>
</div>
<div class="paragraph data-line-2097">
<p><em>Example 1</em> The 16-bit encoding includes too many register moves.</p>
</div>
<div class="listingblock data-line-2100">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">#From debian / re compiled with GCC (RV64), reordered to put the registers in order
    53be:       7135                    addi    sp,sp,-160
    53c6:       ed06                    sd      ra,152(sp)
    53c8:       e922                    sd      s0,144(sp)
...s1-s10...
    53d8:       fc6e                    sd      s11,56(sp)
    53da:       84aa                    mv      s1,a0
    53e0:       892e                    mv      s2,a1
#-Os/-Oz: compile to C.PUSH, but includes redundant register moves of a2, a3
#note that the moves are "mv s0, a0; mv a1, s1; mv a2, s2; mv a3, s3"  so the s registers need to be reallocated
    53be:       &lt;16-bit&gt;                c.push  {ra,s0-s11}, {a0-a3}, -160
#-O1/-O2/-O3: compile to PUSH to avoid the redundant register moves of a2, a3 even though the code is larger
    53be:       &lt;32-bit&gt;                push    {ra,s0-s11}, -160
    53da:       84aa                    mv      s1,a0
    53e0:       892e                    mv      s2,a1</code></pre>
</div>
</div>
<div class="paragraph data-line-2118">
<p><em>Example 2</em> The stack adjustment is out of range for the 32-bit encoding, and the register list matches the 16-bit encoding.</p>
</div>
<div class="listingblock data-line-2121">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">#From Huawei IoT code compiled with GCC (RV32)
  e0c744:       2bc12083                lw      ra,700(sp)
  e0c748:       2b812403                lw      s0,696(sp)
...s1-s7...
  e0c768:       29812c03                lw      s7,668(sp)
  e0c76c:       2c010113                addi    sp,sp,704 #out of range, limit is 544 for 32-bit encoding
  e0c770:       8082                    ret
#-Os/-Oz/-O1/-O2/-O3: always compile to 2 16-bit encodings, the 32-bit encoding doesn't improve performance
  e0c744:       &lt;16-bit&gt;                c.addi16sp sp,sp,640
  e0c748:       &lt;16-bit&gt;                c.popret   {ra,s0-s7}, 64</code></pre>
</div>
</div>
<div class="paragraph data-line-2134">
<p><em>Example 3</em> The register list doesn&#8217;t match the 16-bit encoding, and the 32-bit encoding allows inclusion of the return value.</p>
</div>
<div class="paragraph data-line-2136">
<p>In this case the 16-bit encoding is inferior in the epilogue - because it includes <code>s7</code> and cannot include the <code>mv, a0, s0</code>. Therefore the 32-bit encoding uses the correct register list and has the same code size.</p>
</div>
<div class="listingblock data-line-2139">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">#From Huawei IoT code compiled with GCC (RV32), reordered to put the registers in order
#prologue
  e0073e:       7179                    addi    sp,sp,-48
  e0074c:       d606                    sw      ra,44(sp)
  e00740:       d422                    sw      s0,40(sp)
...s1-s6...
  e0074a:       c65e                    sw      s6,16(sp)
  e00752:       892a                    mv      s2,a0
...a1-a3...
  e0075a:       8a3a                    mv      s4,a4
....
#epilogue
  e0079a:       8522                    mv      a0,s0
  e0079c:       5422                    lw      s0,40(sp)
...s1-s6...
  e007aa:       4bb2                    lw      s6,16(sp)
  e007ac:       6145                    addi    sp,sp,48
  e007ae:       8082                    ret

#optimised prologue
#-Os/-Oz: the smallest is with the 16-bit encoding which also stores s7 (so wastes performance)
  e0073e:       &lt;16-bit&gt;                push {ra,s0-s7}, {a0-a2}
  e0075a:       8a3a                    mv      s4,a4

#-O1/-O2/-O3: the 32-bit encoding is larger but doesn't store s7 (so doesn't waste performance)
  e0073e:       &lt;32-bit&gt;                push {ra,s0-s6}, {a0-a2}
  e0075a:       8a3a                    mv      s4,a4

#optimised epilogue
#-Os/-Oz the smallest is with the 16-bit encoding which also stores s7 (so wastes performance)
  e0079c:       &lt;16-bit&gt;                popret {ra,s0-s7}, 48

#-O1/-O2/-O3: the 32-bit encoding is larger but doesn't store s7 (so doesn't waste performance)
  e0079c:       &lt;32-bit&gt;                popret {ra,s0-s6}, 48</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-2176">
<h3 id="_assembly_examples">9.11. Assembly examples</h3>
<div class="sect3 data-line-2179">
<h4 id="push-example-1">9.11.1. C.PUSH RV32 UABI (16-byte aligned stack)</h4>
<div class="listingblock data-line-2182">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">c.push  {ra, s0-s5}, {a0-a3}, -64</code></pre>
</div>
</div>
<div class="paragraph data-line-2186">
<p>Encoding: rlist=5, spimm=32</p>
</div>
<div class="paragraph data-line-2188">
<p>Equivalent sequence:</p>
</div>
<div class="listingblock data-line-2191">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">sw  ra, -4(sp);
sw  s0, -8(sp);
sw  s1, -12(sp);
sw  s2, -16(sp);
sw  s3, -20(sp);
sw  s4, -24(sp);
sw  s5, -28(sp);
mv  s0, a0;
mv  s1, a1;
mv  s2, a2;
mv  s3, a3;
addi sp, sp, -64;</code></pre>
</div>
</div>
</div>
<div class="sect3 data-line-2206">
<h4 id="_c_push_rv32i_uabi_16_byte_aligned_stack">9.11.2. C.PUSH RV32I UABI (16-byte aligned stack)</h4>
<div class="listingblock data-line-2209">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">c.push {ra, s0-s1}, {a0-a1} -32</code></pre>
</div>
</div>
<div class="paragraph data-line-2213">
<p>Encoding: rlist=2, spimm=16</p>
</div>
<div class="paragraph data-line-2215">
<p>Equivalent sequence:</p>
</div>
<div class="listingblock data-line-2218">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">sw  ra, -4(sp);
sw  s0, -8(sp);
sw  s1, -12(sp);
mv s0, a0;
mv s1, a1;
addi sp, sp, -32;</code></pre>
</div>
</div>
</div>
<div class="sect3 data-line-2227">
<h4 id="_c_pop_rv32i_uabi_16_byte_aligned_stack">9.11.3. C.POP RV32I UABI (16-byte aligned stack)</h4>
<div class="listingblock data-line-2230">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">c.pop   {ra, s0-s7}, 160</code></pre>
</div>
</div>
<div class="paragraph data-line-2234">
<p>Encoding: rlist=6, spimm=112</p>
</div>
<div class="paragraph data-line-2236">
<p>Equivalent sequence:</p>
</div>
<div class="listingblock data-line-2239">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">lw   ra, 156(sp);
lw   s0, 152(sp);
lw   s1, 148(sp);
lw   s2, 144(sp);
lw   s3, 140(sp);
lw   s4, 136(sp);
lw   s5, 132(sp);
lw   s6, 128(sp);
lw   s7, 124(sp);
addi sp, sp, 160</code></pre>
</div>
</div>
</div>
<div class="sect3 data-line-2253">
<h4 id="popret-example-1">9.11.4. C.POPRET RV32I UABI (16-byte aligned stack)</h4>
<div class="listingblock data-line-2256">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">c.popret   {ra, s0-s7},{0}, 160</code></pre>
</div>
</div>
<div class="paragraph data-line-2260">
<p>Encoding: rlist=6, spimm=112</p>
</div>
<div class="paragraph data-line-2262">
<p>Equivalent sequence:</p>
</div>
<div class="listingblock data-line-2265">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">lw   ra, 156(sp);
lw   s0, 152(sp);
lw   s1, 148(sp);
lw   s2, 144(sp);
lw   s3, 140(sp);
lw   s4, 136(sp);
lw   s5, 132(sp);
lw   s6, 128(sp);
lw   s7, 124(sp);
li   a0, 0;
addi sp, sp, 160;
ret</code></pre>
</div>
</div>
</div>
<div class="sect3 data-line-2280">
<h4 id="_pop_rv32i_uabi_16_byte_aligned_stack">9.11.5. POP RV32I UABI (16-byte aligned stack)</h4>
<div class="listingblock data-line-2283">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">pop   {ra, s0-s9}, {1}, 256</code></pre>
</div>
</div>
<div class="paragraph data-line-2287">
<p>Encoding: ra=1, rlist=10, frlist=0, spimm=128 (16-byte aligned)</p>
</div>
<div class="paragraph data-line-2289">
<p>Micro operation sequence:</p>
</div>
<div class="listingblock data-line-2292">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">lw   ra, 252(sp);
lw   s0, 248(sp);
lw   s1, 244(sp);
lw   s2, 240(sp)
lw   s3, 236(sp);
lw   s4, 232(sp);
lw   s5, 228(sp);
lw   s6, 224(sp)
lw   s7, 220(sp);
lw   s8, 216(sp);
lw   s9, 212(sp);
li   a0, 1
addi sp, sp, 256</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-2309">
<h3 id="ldstm">9.12. Appendix: Usage as load/store-multiple</h3>
<div class="paragraph data-line-2311">
<p><code>PUSH/POP</code> encodings can be reused as generic load/store multiple instructions. For example:</p>
</div>
<div class="listingblock data-line-2314">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">lui t0, 0xffff
sw  s5, 4c(t0)
sw  s4, 50(t0)
sw  s3, 54(t0)
sw  s2, 58(t0)
sw  s1, 5c(t0)
sw  s0, 60(t0)</code></pre>
</div>
</div>
<div class="paragraph data-line-2326">
<p>Can be replaced by</p>
</div>
<div class="listingblock data-line-2329">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">lui t0, 0xffff
addi sp, t0, 64
push {s0-s5}, -64</code></pre>
</div>
</div>
<div class="paragraph data-line-2337">
<p>This requires that  <code>sp</code> is saved before and restored after the sequence. Also <code>POP</code> can be used to replace the equivalent series of loads.</p>
</div>
<div class="paragraph data-line-2339">
<p>Even though there is not much code-size saving once the <code>sp</code> save/restore code has been included, and the restricted memory layout targetted by the instructions, there may be a performance benefit to doing this for small embedded cores. A load/store-multiple sequence may be issued to the peripheral bus as a single burst instead of multiple single accesses which individually require arbitration. In some cases this can save one or more cycles per access as the arbiter remains locked to the core until the sequence has completed.</p>
</div>
<div class="paragraph data-line-2341">
<p>If the target memory is non-idempotent then see <a href="#non-idem-mem">Section 9.9.3</a> for additional constraints.</p>
</div>
</div>
</div>
</div>
<h1 id="_verification_notes" class="sect0 data-line-2343">Verification notes</h1>
<div class="sect1 data-line-2345">
<h2 id="_existing_functionality">1. Existing functionality</h2>
<div class="sectionbody">
<div class="paragraph data-line-2347">
<p>Many of the instructions are 16-bit encodings of existing 32-bit instructions, therefore the verification should be a simple extension to existing tests and coverage. Additionally, the instructions are all very simple.
. C.SEXT.B, C.SEXT.H, (C.SEXT.W is a pseudo-instruction)
. C.ZEXT.B, C.ZEXT.H, C.ZEXT.W
. C.MUL, C.NOT, C.NEG
. C.LBU, C.LHU, C.LB, C.LH, C.SB, C.SH</p>
</div>
</div>
</div>
<div class="sect1 data-line-2353">
<h2 id="_simple_extensions_to_existing_functionality">2. Simple extensions to existing functionality</h2>
<div class="sectionbody">
<div class="paragraph data-line-2355">
<p>These instructions are extremely similar to existing instructions, so the verification tests and coverage should be a simple extension from existing tests and coverage:</p>
</div>
<div class="olist arabic data-line-2357">
<ol class="arabic">
<li class="data-line-2357">
<p>BEQI, BNEI</p>
<div class="olist loweralpha data-line-2358">
<ol class="loweralpha" type="a">
<li class="data-line-2358">
<p>these are immediate forms of BEQ and BNE, they compare a register value against an immediate instead of two register values</p>
</li>
</ol>
</div>
</li>
<li class="data-line-2359">
<p>LWGP</p>
<div class="olist loweralpha data-line-2360">
<ol class="loweralpha" type="a">
<li class="data-line-2360">
<p>this have the same functionality as LW, but the base register is explicitly GP and the immediate offset range is larger</p>
</li>
</ol>
</div>
</li>
<li class="data-line-2361">
<p>SWGP</p>
<div class="olist loweralpha data-line-2362">
<ol class="loweralpha" type="a">
<li class="data-line-2362">
<p>this have the same functionality as SW, but the base register is explicitly GP and the immediate offset range is larger</p>
</li>
</ol>
</div>
</li>
<li class="data-line-2363">
<p>MULI</p>
<div class="olist loweralpha data-line-2364">
<ol class="loweralpha" type="a">
<li class="data-line-2364">
<p>same as MUL with a signed immediate operand</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1 data-line-2366">
<h2 id="_new_branch_functionality">3. New branch functionality</h2>
<div class="sectionbody">
<div class="paragraph data-line-2368">
<p><code>DECBNEZ</code> and <code>C.DECBNEZ</code> are also fused versions of two instructions:</p>
</div>
<div class="listingblock data-line-2371">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">decbnez  s2, 1, -48</code></pre>
</div>
</div>
<div class="paragraph data-line-2375">
<p>is equivalent to:</p>
</div>
<div class="listingblock data-line-2378">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">addi s2, s2, -1
bnez s2, -48</code></pre>
</div>
</div>
<div class="paragraph data-line-2383">
<p>Therefore the coverage is the same as for <code>ADDI/BGEZ</code> combined, noting the limited range of subtraction values (1,2,4,8) and the range of the branch offset (especially for <code>C.DECBNEZ</code>).</p>
</div>
</div>
</div>
<div class="sect1 data-line-2385">
<h2 id="_sequenced_functionality">4. Sequenced functionality</h2>
<div class="sectionbody">
<div class="paragraph data-line-2387">
<p><code>PUSH/POP/POPRET</code> execute a sequence of micro-ops to execute the whole instruction. As a result they are considerably more complex to verify than the other instructions.</p>
</div>
<div class="sect2 data-line-2389">
<h3 id="_cover_all_possible_sets_of_operands">4.1. Cover all possible sets of operands</h3>
<div class="paragraph data-line-2391">
<p><code>mv, rlist, ra, spimm</code> are all fields in the encoding.</p>
</div>
<table id="32pushpopsourcecoverage" class="tableblock frame-all grid-all stretch data-line-2396">
<caption class="title">Table 53. Coverage for PUSH/POP/POPRET source operands</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Instruction</th>
<th class="tableblock halign-left valign-top">Variables</th>
<th class="tableblock halign-left valign-top">Coverage bins</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH (<code>mv</code>=0)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rlist</code>(0 to 12) x <code>ra</code> (0 to 1) x <code>spimm</code> (0 to 15)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">416</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH (<code>mv</code>=1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rlist</code>(1 to 12) x <code>ra</code> (0 to 1) x <code>spimm</code> (0 to 15)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">384</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH (<code>mv</code>=2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rlist</code>(2 to 12) x <code>ra</code> (0 to 1) x <code>spimm</code> (0 to 15)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">352</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH (<code>mv</code>=3)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rlist</code>(3 to 12) x <code>ra</code> (0 to 1) x <code>spimm</code> (0 to 15)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">288</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rlist</code>(0 to 12) x <code>ret_val</code> (0 to 3) x <code>ra</code> (0 to 1) x <code>spimm</code> (0 to 15)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1664</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rlist</code>(0 to 12) x <code>ret_val</code> (0 to 3) x <code>spimm</code> (0 to 15)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">834</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-2406">
<p>The 16-bit encodings have ffar ewer coverage bins:</p>
</div>
<table id="16pushpopsourcecoverage" class="tableblock frame-all grid-all stretch data-line-2411">
<caption class="title">Table 54. Coverage for C.PUSH/C.POP/C.POPRET source operands</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Instruction</th>
<th class="tableblock halign-left valign-top">Variables</th>
<th class="tableblock halign-left valign-top">Coverage bins</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.PUSH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rlist</code>(0 to 7) x <code>spimm</code> (0 to 7)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rlist</code>(0 to 3) x <code>spimm</code> (0 to 1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.POPRET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rlist</code>(0 to 7) x <code>ret_val</code> (0 to 1) x <code>spimm</code> (0 to 7)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">128</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2 data-line-2418">
<h3 id="_test_the_functionality">4.2. Test the functionality</h3>
<div class="paragraph data-line-2420">
<p>Execution of every PUSH/POP/POPRET instruction must result in the same architectural state updates as executing the sequence that it expands into. For example:</p>
</div>
<div class="listingblock data-line-2423">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">popret   {ra, s0-s3}, {1}, 32;</code></pre>
</div>
</div>
<div class="paragraph data-line-2427">
<p>causes identical architectural state updates to the expanded sequence:</p>
</div>
<div class="listingblock data-line-2430">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">lw   ra, 28(sp);
lw   s0, 24(sp);
lw   s1, 20(sp);
lw   s2, 16(sp);
lw   s3, 12(sp);
li   a0, 1
addi sp, sp, 32;
ret</code></pre>
</div>
</div>
<div class="paragraph data-line-2441">
<p>Therefore a suggestion is to generate pairs of tests, one with the expanded sequences and one with <code>PUSH/POP/POPRET</code>. Each test must give identical results, including having the same contents in the memory.</p>
</div>
<div class="paragraph data-line-2443">
<p>It is also possible to introduce</p>
</div>
<div class="olist arabic data-line-2445">
<ol class="arabic">
<li class="data-line-2445">
<p>interrupts</p>
</li>
<li class="data-line-2446">
<p>debug triggers on the loads/stores in the sequence</p>
</li>
<li class="data-line-2447">
<p>external debug halts</p>
</li>
<li class="data-line-2448">
<p>load/store access faults due to bus errors or PMP faults</p>
</li>
<li class="data-line-2449">
<p>load/store page faults</p>
</li>
</ol>
</div>
<div class="paragraph data-line-2451">
<p>on the loads and stores in the sequence. <code>mepc</code> will be different between the two tests but <code>mcause</code> and <code>mtval</code> must match. Note that interrupts and external debug halts are asynchronous events, so to make the results from the two tests match then the handler must not (for example) count the number of interrupts taken.</p>
</div>
<div class="paragraph data-line-2453">
<p>Implementations may choose for the sequences to be uninterruptible, or to be interruptible and to restart after the <code>mret</code>. The overall result is the same - the sequence will eventually complete and correctly update the architectural state, providing any debug triggers are disabled in the handler before resuming execution (so they don&#8217;t trigger again)</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2455">
<h2 id="_table_jump_jump_table_mode_only">5. Table jump, jump table mode only</h2>
<div class="sectionbody">
<div class="paragraph data-line-2457">
<p>Table jump is quite simple architecturally.</p>
</div>
<div class="paragraph data-line-2459">
<p><code>tbljal #n;</code> references memory address <code>m = xTBLJALVEC + n * XLEN/8</code></p>
</div>
<div class="paragraph data-line-2461">
<p>The core to jump to address <code>m</code>, and link to the register referenced by bits[1:0] of the data at address <code>m</code>, including the illegal case where [1:0]=11</p>
</div>
<div class="paragraph data-line-2463">
<p>For verification we must show that the different link registers work and that the core jumps to the correct location each time.</p>
</div>
</div>
</div>
<h1 id="_rejected_and_postponed_instructions" class="sect0 data-line-2465">Rejected and postponed instructions</h1>
<div class="sect1 data-line-2467">
<h2 id="_not_benchmarked_push_fdq_pop_fdq_popret_fdq">1. Not benchmarked: PUSH.[FDQ], POP.[FDQ], POPRET.[FDQ]</h2>
<div class="sectionbody">
<div class="paragraph data-line-2469">
<p>Please read <a href="#pushpoppopret">Section 9</a> before reading this section.</p>
</div>
<div class="paragraph data-line-2471">
<p>These instructions are variants of <code>PUSH/POP/POPRET</code> which also allow <code>F</code> registers to be saved/restored.</p>
</div>
<div class="sect2 data-line-2473">
<h3 id="_assembler_syntax_2">1.1. Assembler Syntax</h3>
<div class="paragraph data-line-2475">
<p>These instructions require a register list including <code>fs</code> registers.</p>
</div>
<div class="listingblock data-line-2478">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">&lt;fsreg_list&gt; ::= &lt;ra&gt; "," &lt;sreg_range&gt; ", " &lt;freg_range&gt; | &lt;ra&gt; "," &lt;freg_range&gt; | &lt;sreg_range&gt; "," &lt;freg_range&gt; | &lt;freg_range&gt;
&lt;rfsreg_list&gt; ::= &lt;ra&gt; "," &lt;sreg_range&gt; ", " &lt;freg_range&gt; | &lt;ra&gt; "," &lt;freg_range&gt;
&lt;freg_range&gt; ::= &lt;fs0&gt; | &lt;fs0-fsM&gt; (valid values of M are 1,2,3,5,8,11)

//legal syntax

push.[fdq]   {&lt;fsreg_list&gt;},     -stack_adjustment
pop.[fdq]    {&lt;fsreg_list&gt;},      stack_adjustment
popret.[fdq] {&lt;rfsreg_list&gt;},     stack_adjustment //popret must include ra</code></pre>
</div>
</div>
<div class="paragraph data-line-2491">
<p>To be a legal encoding:</p>
</div>
<div class="olist arabic data-line-2493">
<ol class="arabic">
<li class="data-line-2493">
<p>The total stack adjustment must be negative for <code>PUSH.[FDQ]</code> and positive for <code>POP.[FDQ]/POPRET.[FDQ]</code></p>
</li>
<li class="data-line-2494">
<p>The total stack adjustment must be in range (see <a href="#spimm">Section 9.7.1</a>) and must be a multiple of 16</p>
</li>
<li class="data-line-2495">
<p>The register lists must be valid (see above)</p>
</li>
<li class="data-line-2496">
<p>For <code>POPRET.[FDQ]</code>, <code>rfsreg_list</code> must include <code>ra</code></p>
</li>
</ol>
</div>
<div class="paragraph data-line-2498">
<p>Additionally:</p>
</div>
<div class="olist arabic data-line-2500">
<ol class="arabic">
<li class="data-line-2500">
<p>If <code>sp</code> is not 16-byte aligned then take a load (<code>PUSH.[FDQ]</code>) or store (<code>POP.[FDQ]/POPRET.[FDQ]</code>) address misaligned exception, and do not issue any loads or stores.</p>
</li>
</ol>
</div>
<div class="admonitionblock note data-line-2503">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  When moving from loading or storing <code>x</code> registers to <code>f</code> registers there may be a gap as the registers may be different widths, and all registers must be aligned in memory
</td>
</tr>
</table>
</div>
<div class="sect3 data-line-2505">
<h4 id="_rationale_why_include_the_fdq_suffix">1.1.1. Rationale: why include the .[fdq] suffix</h4>
<div class="paragraph data-line-2507">
<p>It is required to hard-code the length of the <code>f</code> registers in the opcode, and not just save/restore the whole register. We must allow code compiled for the F-extension
to run on a  core which supports D and possibly Q. We must also allow code compiled for the D-extension to run on a core which supports Q.</p>
</div>
<div class="paragraph data-line-2510">
<p>If we don&#8217;t explicitly state the <code>f</code> register width and always store the whole register, then the registers will be stored at different addresses to the ones expected
by the compiler.</p>
</div>
<div class="paragraph data-line-2513">
<p>An alternative would be to use <code>misa.[FDQ]</code>
to directly control the behaviour and so set <code>misa.[DQ]=0</code> when running F code. Nothing else in the architecture requires this, so it seems unreasonable to
add this requirement here. This approach also wouldn&#8217;t work for <code>Z[FDQ]inx</code> cores as <code>misa.[FDQ]</code> are all hardwired to zero.</p>
</div>
</div>
</div>
<div class="sect2 data-line-2517">
<h3 id="_pseudo_code_2">1.2. Pseudo-code</h3>
<div class="paragraph data-line-2519">
<p>The pseudo-code below show the required architectural state updates.</p>
</div>
<div class="paragraph data-line-2521">
<p>Note that every architectural state update in the pseudo-code can be executed as a standard RISC-V 32-bit encoding, so that it is possible execute the instructions as sequences of standard instructions.</p>
</div>
<div class="paragraph data-line-2523">
<p>Because the pseudo-code includes load or store operations, they may take any fault caused by executing loads or stores. See <a href="#fault-handling">Section 9.8</a> for more details.</p>
</div>
<div class="sect3 data-line-2525">
<h4 id="_push_fdq_pseudo_code">1.2.1. PUSH.[FDQ] Pseudo-code</h4>
<div class="paragraph data-line-2527">
<p>The <code>PUSH.FDQ</code> instruction stores the set of registers from <code>fsreg_list</code> to consecutive memory locations, and decrements the stack pointer.
The pseudo-code uses assembly inserts so that it can use <code>fsw/fsd</code> etc.</p>
</div>
<div class="paragraph data-line-2530">
<p>The pseudo-code shows the memory and architectural state updates of the whole instruction which has completed without faults, debug halts or interrupts. See <a href="#fault-handling">Section 9.8</a> and <a href="#software-view">Section 9.9</a> for more information.</p>
</div>
<div class="admonitionblock note data-line-2533">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  <code>stack_adjustment</code> is negative.
</td>
</tr>
</table>
</div>
<div class="listingblock data-line-2536">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">//sp must be correctly aligned
if (sp[3:0])            {take_illegal_instruction_exception();}
if (rlist&gt;12)          {take_illegal_instruction_exception();}
if (rlist&gt;2 &amp;&amp; misa.E) {take_illegal_instruction_exception();}
if (misa.MXL==1) {bytes=4;}
if (misa.MXL==2) {bytes=8;}
else             {bytes=16;}
addr=sp;
if (ra) {
  addr-=bytes;
  switch(bytes) {
    4:  asm("sw ra, 0(addr)");
    8:  asm("sd ra, 0(addr)");
    16: asm("sq ra, 0(addr)");
  }
}
for(i in sreg_list)  {
  addr-=bytes;
  switch(bytes) {
    4:  asm("sw s[i], 0(addr)");
    8:  asm("sd s[i], 0(addr)");
    16: asm("sq s[i], 0(addr)");
  }
}
switch (opcode) {
  //if FLEN &gt; XLEN, then get the address back into alignment before saving the F registers
  "PUSH.D": while(addr% 8) {addr-=bytes;}
  "PUSH.Q": while(addr%16) {addr-=bytes;}
}
for(i in freg_list)  {
  switch (opcode) {
    "PUSH.F": {addr-= 4;asm("fsw fs[i], 0(addr)");}
    "PUSH.D": {addr-= 8;asm("fsd fs[i], 0(addr)");}
    "PUSH.Q": {addr-=16;asm("fsq fs[i], 0(addr)");}
  }
}
sp+=stack_adjustment; //decrement</code></pre>
</div>
</div>
</div>
<div class="sect3 data-line-2576">
<h4 id="_pop_fdqpopretfdq_pseudo_code">1.2.2. POP.[FDQ]/POPRET/[FDQ] Pseudo-code</h4>
<div class="paragraph data-line-2578">
<p>A <code>POP/POPRET</code> instruction loads the set of registers from <code>fsreg_list</code> from consecutive memory locations, and then increments the stack pointer.
The pseudo-code uses assembly inserts so that it can use <code>flw/fld/ret</code>.</p>
</div>
<div class="paragraph data-line-2581">
<p>The pseudo-code shows the architectural state updates of the whole instruction which has completed without faults, debug halts or interrupts. See <a href="#fault-handling">Section 9.8</a> and <a href="#software-view">Section 9.9</a> for more information.</p>
</div>
<div class="admonitionblock note data-line-2584">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  <code>stack_adjustment</code> is positive.
</td>
</tr>
</table>
</div>
<div class="listingblock data-line-2587">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">//sp must be correctly aligned
if (sp[3:0])            {take_illegal_instruction_exception();}
if (rlist&gt;12)          {take_illegal_instruction_exception();}
if (rlist&gt;2 &amp;&amp; misa.E) {take_illegal_instruction_exception();}
if (misa.MXL==1) {bytes=4;}
if (misa.MXL==2) {bytes=8;}
else             {bytes=16;}
addr=sp+stack_adjustment;
if (ra) {
  addr-=bytes;
  switch(bytes) {
    4:  asm("lw ra, 0(addr)");
    8:  asm("ld ra, 0(addr)");
    16: asm("lq ra, 0(addr)");

  }
}
for(i in sreg_list)  {
  addr-=bytes;
  switch(bytes) {
    4:  asm("lw s[i], 0(addr)");
    8:  asm("ld s[i], 0(addr)");
    16: asm("lq s[i], 0(addr)");
  }
}
switch (opcode) {
  //if FLEN &gt; XLEN, then get the address back into alignment before saving the F registers
  "POP.D", "POPRET.D": while(addr% 8) {addr-=bytes;}
  "POP.Q", "POPRET.Q": while(addr%16) {addr-=bytes;}
}
for(i in freg_list)  {
  switch (opcode) {
    "POP.F", "POPRET.F": {addr-= 4;asm("flw fs[i], 0(addr)");}
    "POP.D", "POPRET.D": {addr-= 8;asm("fld fs[i], 0(addr)");}
    "POP.Q", "POPRET.Q": {addr-=16;asm("flq fs[i], 0(addr)");}
  }
}
sp+=stack_adjustment; //increment
if (opcode == "POPRET") {
   asm("ret");
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-2632">
<h3 id="pushpoppopret32bitencodings">1.3. 32-bit Encodings</h3>
<div class="admonitionblock note data-line-2636">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  These encodings are provisional.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch data-line-2641">
<caption class="title">Table 55. push/pop 32-bit encodings</caption>
<colgroup>
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6676%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">31:27</th>
<th class="tableblock halign-left valign-top">26</th>
<th class="tableblock halign-left valign-top">25</th>
<th class="tableblock halign-left valign-top">24</th>
<th class="tableblock halign-left valign-top">23</th>
<th class="tableblock halign-left valign-top">22</th>
<th class="tableblock halign-left valign-top">21:20</th>
<th class="tableblock halign-left valign-top">19:18</th>
<th class="tableblock halign-left valign-top">17:16</th>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14:12</th>
<th class="tableblock halign-left valign-top">11:10</th>
<th class="tableblock halign-left valign-top">9: 7</th>
<th class="tableblock halign-left valign-top">6 : 0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="15"><p class="tableblock"><code>PUSH.[FDQ]</code> encodings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">0000000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">frlist</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rlist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH.F</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">0000000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">frlist</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rlist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH.D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">0000000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">frlist</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rlist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUSH.Q</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="15"><p class="tableblock"><code>POP.[FDQ]</code> encodings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">0000000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">frlist</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rlist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP.F</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">0000000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">frlist</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rlist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP.D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">0000000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">frlist</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rlist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ra</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP.Q</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="15"><p class="tableblock"><code>POPRET.[FDQ]</code> encodings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">0000000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">frlist</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rlist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET.F</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">0000000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">frlist</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rlist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET.D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">0000000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">frlist</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">rlist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">spimm[8:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POPRET.Q</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note data-line-2658">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  bits [23:22] are the <code>fdq</code> field
</td>
</tr>
</table>
</div>
<div class="admonitionblock note data-line-2661">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  <code>ra=1</code> for all <code>popret</code> encodings, it is not specified in the encoding
</td>
</tr>
</table>
</div>
<div class="sect3 data-line-2664">
<h4 id="_illegal_instructions_2">1.3.1. Illegal instructions</h4>
<div class="paragraph data-line-2666">
<p>The encoding takes the same behaviour as any floating point instruction if executed when disabled:</p>
</div>
<div class="ulist data-line-2668">
<ul>
<li class="data-line-2668">
<p>if <code>frlist&gt;0</code> and <code>misa.F==0</code></p>
</li>
<li class="data-line-2669">
<p>if <code>frlist&gt;0</code> and <code>fdq==1</code> and <code>misa.D==0</code></p>
</li>
<li class="data-line-2670">
<p>if <code>frlist&gt;0</code> and <code>fdq==2</code> and <code>misa.Q==0</code></p>
</li>
</ul>
</div>
<div class="paragraph data-line-2672">
<p>The following cases do not decode as <code>PUSH*/POP*/POPRET*</code></p>
</div>
<div class="ulist data-line-2674">
<ul>
<li class="data-line-2674">
<p>No registers are specified (<code>rlist, frlist</code> are both zero)</p>
</li>
<li class="data-line-2675">
<p><code>rlist&gt;14</code></p>
</li>
<li class="data-line-2676">
<p><code>fdq=3</code></p>
</li>
<li class="data-line-2677">
<p><code>rlist==13</code> and <code>frlist&gt;0</code> and the opcode doesn&#8217;t have an <code>[fdq]</code> suffix</p>
</li>
</ul>
</div>
</div>
<div class="sect3 data-line-2679">
<h4 id="_rational_rlist13_frlist0_saving_all_saved_registers">1.3.2. Rational: <code>rlist=13, frlist=0</code> saving all saved registers</h4>
<div class="paragraph data-line-2681">
<p>The debian distro does save all <code>s</code> and <code>fs</code> registers on a few occasions, so there is a special encoding for this case. I saw no justification for saving all <code>fs</code> registers <strong>without</strong> saving all <code>s</code> registers. It seems useful to have a form which saves all saved registers.</p>
</div>
<div class="paragraph data-line-2683">
<p>The programmable range for <code>frlist</code> doesn&#8217;t save many <code>fs</code> registers as <code>FPMark</code> only saves one or two and Debian rarely saves more than that.</p>
</div>
</div>
</div>
<div class="sect2 data-line-2685">
<h3 id="_encoding_fields">1.4. Encoding Fields</h3>
<div class="paragraph data-line-2687">
<p>See <a href="#spimm">Section 9.7.1</a>.</p>
</div>
<div class="listingblock data-line-2690">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">//the padding calculation requires SP to be 16-byte aligned before executing the instruction
if (FLEN&gt;XLEN &amp;&amp;
    number_of_registers_in_freg_list&gt;0 &amp;&amp;
    number_of_registers_in_reg_list % (FLEN/XLEN)&gt;0) {
  //need padding to ensure FLEN registers are aligned
  padding = (FLEN/XLEN - number_of_registers_in_reg_list % (FLEN/XLEN)) * XLEN/8;
} else {
  padding = 0
}
total_register_bytes = number_of_registers_in_reg_list * XLEN/8 + padding + number_of_registers_in_freg_list * FLEN/8;
stack_adjustment = Align16(total_register_bytes) + spimm;</code></pre>
</div>
</div>
<div class="paragraph data-line-2704">
<p>The bytes required for padding is simple - if FLEN==XLEN it&#8217;s always zero. If FLEN=2*XLEN it is 0 or 4. RV32Q is more complex (see below) but this is an unlikely configuration.
<code>n</code> is an integer in the tables so <code>2n</code> is always even, <code>2n+1</code> is always odd.</p>
</div>
<table id="padding-examples-RV32D" class="tableblock frame-all grid-all stretch data-line-2710">
<caption class="title">Table 56. RV32D padding examples, XLEN=32, FLEN=64</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">#Xreg</th>
<th class="tableblock halign-left valign-top">Padding required if accessing Fregs</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2n</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2n+1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4-bytes</p></td>
</tr>
</tbody>
</table>
<table id="padding-examples-RV64Q" class="tableblock frame-all grid-all stretch data-line-2719">
<caption class="title">Table 57. RV64Q padding examples, XLEN=64, FLEN=128</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">#Xreg</th>
<th class="tableblock halign-left valign-top">Padding required if accessing Fregs</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2n</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2n+1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4-bytes</p></td>
</tr>
</tbody>
</table>
<table id="padding-examples-RV32Q" class="tableblock frame-all grid-all stretch data-line-2728">
<caption class="title">Table 58. RV32Q padding examples, XLEN=32, FLEN=128</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">#Xreg</th>
<th class="tableblock halign-left valign-top">Padding required if accessing Fregs</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4n</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4n+1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4-bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4n+2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4n+3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12-bytes</p></td>
</tr>
</tbody>
</table>
<div class="sect3 data-line-2736">
<h4 id="_mv_ret_val_ra_frlist_rlist_for_the_32_bit_encodings">1.4.1. <code>mv, ret_val, ra, frlist, rlist</code> for the 32-bit encodings</h4>
<div class="paragraph data-line-2738">
<p>The registers in the <code>reg_list</code> are controlled by these fields</p>
</div>
<div class="paragraph data-line-2740">
<p>Note that <code>frlist</code>, <code>mv</code> and <code>ret_val</code> are in the same location in the encoding.</p>
</div>
<table id="32bit-frlist" class="tableblock frame-all grid-all stretch data-line-2745">
<caption class="title">Table 59. <code>frlist</code> values for the 32-bit encodings for <code>PUSH.[FDQ], POP.[FDQ], POPRET.[FDQ]</code></caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">frlist</th>
<th class="tableblock halign-left valign-top">ABI names</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none or <code>fs0-fs11</code> (see <code>rlist=13</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fs0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fs0-fs1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fs0-fs5</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-2753">
<p>See <a href="#32bit-mv">[32bit-mv]</a> for <code>mv</code>.</p>
</div>
<div class="paragraph data-line-2755">
<p>See <a href="#32bit-ra">[32bit-ra]</a> for <code>ra</code>.</p>
</div>
<table id="32bit-frlist" class="tableblock frame-all grid-all stretch data-line-2760">
<caption class="title">Table 60. <code>rlist</code> field values for PUSH.[FDQ]/POP.[FDQ]/POPRET.[FDQ]</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">rlist</th>
<th class="tableblock halign-left valign-top">ABI names</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s9</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s10</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s11</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><code>rlist=13</code> is valid if <code>frlist=0</code> for <code>[.fdq]</code> opcodes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s0-s11,fs0-fs11</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">these values could be used for interrupt save/restore</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">14-15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>reserved</strong></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2 data-line-2781">
<h3 id="_assembly_examples_2">1.5. Assembly examples</h3>
<div class="sect3 data-line-2783">
<h4 id="_push_f_rv32ifdq_uabi_16_byte_aligned_stack">1.5.1. PUSH.F RV32I[FDQ] UABI (16-byte aligned stack)</h4>
<div class="listingblock data-line-2786">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">push.f  {ra, s0-s4, fs0}, -64</code></pre>
</div>
</div>
<div class="paragraph data-line-2790">
<p>Encoding: ra=1, rlist=5, frlist=1, fdq=0, spimm=16 (16-byte aligned)</p>
</div>
<div class="paragraph data-line-2792">
<p>Micro operation sequence:</p>
</div>
<div class="listingblock data-line-2795">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">sw  ra,   -4(sp);
sw  s0,   -8(sp);
sw  s1,  -12(sp);
sw  s2,  -16(sp);
sw  s3,  -20(sp);
sw  s4,  -24(sp);
fsw fs0, -28(sp)
addi sp, sp, -64;</code></pre>
</div>
</div>
</div>
<div class="sect3 data-line-2806">
<h4 id="_push_d_rv64idq_uabi_16_byte_aligned_stack">1.5.2. PUSH.D RV64I[DQ] UABI (16-byte aligned stack)</h4>
<div class="listingblock data-line-2809">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">push.d  {ra, s0-s4, fs0}, -64</code></pre>
</div>
</div>
<div class="paragraph data-line-2813">
<p>Encoding: ra=1, rlist=5, frlist=1, fdq=1, spimm=0 (16-byte aligned)</p>
</div>
<div class="paragraph data-line-2815">
<p>Micro operation sequence:</p>
</div>
<div class="listingblock data-line-2818">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">sd  ra,  -8(sp);
sd  s0,  -16(sp);
sd  s1,  -24(sp);
sd  s2,  -32(sp);
sd  s3,  -40(sp);
sd  s4,  -48(sp);
fsd fs0, -56(sp)
addi sp, sp, -64;</code></pre>
</div>
</div>
</div>
<div class="sect3 data-line-2829">
<h4 id="_push_d_rv64idq_uabi_16_byte_aligned_stack_2">1.5.3. PUSH.D RV64I[DQ] UABI (16-byte aligned stack)</h4>
<div class="listingblock data-line-2832">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">push.d  {fs0-fs7}, -128</code></pre>
</div>
</div>
<div class="paragraph data-line-2836">
<p>Encoding: rlist=0, frlist=12, fdq=2, spimm=32 (16-byte aligned)</p>
</div>
<div class="paragraph data-line-2838">
<p>Micro operation sequence:</p>
</div>
<div class="listingblock data-line-2841">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">fsd  fs0,  -8(sp);
fsd  fs1, -16(sp);
fsd  fs2, -24(sp);
fsd  fs3, -32(sp);
fsd  fs5, -40(sp);
fsd  fs4, -48(sp);
fsd  fs6, -56(sp);
fsd  fs7, -64(sp);
fsd  fs8, -72(sp);
fsd  fs9, -80(sp);
fsd  fs10,-88(sp);
fsd  fs11,-96(sp);
addi sp, sp, -128;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-2857">
<h2 id="_benchmarking_results_too_low">2. Benchmarking results too low</h2>
<div class="sectionbody">
<div class="sect2 data-line-2859">
<h3 id="_tbljal_32_bit_encoding">2.1. TBLJAL (32-bit encoding)</h3>
<div class="paragraph data-line-2861">
<p><code>TBLJAL</code> offers minimal additional benefit over <code>C.TBLJAL</code></p>
</div>
<div class="admonitionblock note data-line-2865">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  The 32-bit encoding is in <em>custom-0</em>, correct encodings need to be allocated.
</td>
</tr>
</table>
</div>
<table id="tbljal32bitencoding" class="tableblock frame-all grid-all stretch data-line-2870">
<caption class="title">Table 61. TBLJAL 32-bit encoding, ZCE-type encoding</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">31:23</th>
<th class="tableblock halign-left valign-top">22:15</th>
<th class="tableblock halign-left valign-top">14:12</th>
<th class="tableblock halign-left valign-top">11:7</th>
<th class="tableblock halign-left valign-top">6 : 0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">00000000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">index13[12:5]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">000</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">index13[4:0]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0101011</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2 data-line-2876">
<h3 id="_lwtp_swtp_ldtp_sdtp">2.2. LWTP, SWTP, LDTP, SDTP</h3>
<div class="paragraph data-line-2878">
<p>TP relative load/store (similar to LWGP etc.) adding TP as a second global pointer.</p>
</div>
<div class="paragraph data-line-2880">
<p>The benefit from LWGP etc. so far is very low so there is no justification to add an extended range to TP.</p>
</div>
</div>
<div class="sect2 data-line-2882">
<h3 id="_muliadd_addiadd_muliw_muliaddw_addiaddw">2.3. MULIADD, ADDIADD, MULIW, MULIADDW, ADDIADDW</h3>
<div class="paragraph data-line-2884">
<p>These instructions have low benefit. <code>MULIADD</code> and <code>ADDIADD</code> are unpopular due to requiring 3 operands. <code>MULI</code> is useful (and is included in the proposal) and takes much of the benefit of <code>MULIADD</code></p>
</div>
<div class="paragraph data-line-2886">
<p>See <a href="https://github.com/clairexen/riscv-fanfic/blob/master/riscv-cfmt/riscv-cfmt.md">Clare&#8217;s proposal from the B-extension</a>.
Also see <a href="https://github.com/riscv/riscv-code-size-reduction/blob/master/existing_extensions/Huawei%20Custom%20Extension/riscv_muladd_extension.rst">this document</a>, which is implemented on silicon.</p>
</div>
<table id="arithmetic_semantics" class="tableblock frame-all grid-all stretch data-line-2892">
<caption class="title">Table 62. Arithmetic semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULIADD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = rs1' + rs2' * sign_ext(imm)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADDIADD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = rs1' + rs2' + sign_ext(imm)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">RV64/RV128 only</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULIW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = sign_extrs1'[31:0] * sign_ext(imm[31:0])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULIADDW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = sign_extrs1'[31:0] + rs2'[31:0] * sign_ext(imm[31:0])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADDIADDW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = sign_extrs1'[31:0] + rs2'[31:0] + sign_ext(imm[31:0])
)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-2903">
<p>Assembly Examples</p>
</div>
<div class="listingblock data-line-2906">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">muliadd  a0, a1, a2, 2 # a0 = a1 + a2 * 2
addiadd  a0, a1, a2, 2 # a0 = a1 + a2 + 2
muliw    a0, a1, 2     # a0 = sign_ext(a1 * 2)
muliaddw a0, a1, 2     # a0 = sign_ext(a1 + a2 * 2)
addiaddw a0, a1, 2     # a0 = sign_ext(a1 + a2 + 2)</code></pre>
</div>
</div>
</div>
<div class="sect2 data-line-2913">
<h3 id="_bgeui_bltui">2.4. BGEUI, BLTUI</h3>
<div class="paragraph data-line-2915">
<p>These allocate reserved encodings, and are similar to <a href="#cmpimmbr">Section 6.5</a> but have lower value. It&#8217;s possible that future use of these instructions will be found in later versions of <code>Zce</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch data-line-2920">
<caption class="title">Table 63. Rejected 32-bit encodings</caption>
<colgroup>
<col style="width: 7.6923%;">
<col style="width: 7.6923%;">
<col style="width: 7.6923%;">
<col style="width: 7.6923%;">
<col style="width: 7.6923%;">
<col style="width: 7.6923%;">
<col style="width: 7.6923%;">
<col style="width: 7.6923%;">
<col style="width: 7.6923%;">
<col style="width: 7.6923%;">
<col style="width: 7.6923%;">
<col style="width: 7.6923%;">
<col style="width: 7.6924%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">31:27</th>
<th class="tableblock halign-left valign-top">26:25</th>
<th class="tableblock halign-left valign-top">24</th>
<th class="tableblock halign-left valign-top">23</th>
<th class="tableblock halign-left valign-top">22:20</th>
<th class="tableblock halign-left valign-top">19:18</th>
<th class="tableblock halign-left valign-top">17:16</th>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14:12</th>
<th class="tableblock halign-left valign-top">11:10</th>
<th class="tableblock halign-left valign-top">9:7</th>
<th class="tableblock halign-left valign-top">6 : 0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">zcmpimm[5:1]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zcmpimm[0]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">offset[9:6]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">010</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">offset[5:1]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BGEUI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">zcmpimm[5:1]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zcmpimm[0]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">offset[9:6]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">011</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">offset[5:1]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BLTUI</p></td>
</tr>
</tbody>
</table>
<table id="rejected-cmpimmbr-branch_semantics" class="tableblock frame-all grid-all stretch data-line-2929">
<caption class="title">Table 64. Rejected compare immediate branch semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BGEUI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if (rs1&gt;=<sub>u</sub> zero_ext(zcmpimm)) target_pc=PC+offset; else target_pc=PC+4;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BLTUI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if (rs1&lt;<sub>u</sub>  zero_ext(zcmpimm)) target_pc=PC+offset; else target_pc=PC+4;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-2935">
<p>Assembly Examples</p>
</div>
<div class="listingblock data-line-2938">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">bgeu a5, 1,offset # if(a5&gt;= 1) branch_to(PC+offset) # unsigned comparison
bltu a5, 1,offset # if(a5&lt;  1) branch_to(PC+offset) # unsigned comparison</code></pre>
</div>
</div>
</div>
<div class="sect2 data-line-2943">
<h3 id="_c_lbusp_c_lhusp_c_sbsp_c_shsp">2.5. C.LBUSP, C.LHUSP, C.SBSP, C.SHSP</h3>
<div class="paragraph data-line-2945">
<p>These encodings require too much space for the benefit.</p>
</div>
<table id="ldstbhsprel-16encodings" class="tableblock frame-all grid-all stretch data-line-2950">
<caption class="title">Table 65. Rejected load/store half/byte SP relative 16-bit encodings</caption>
<colgroup>
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8832%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="17"><p class="tableblock">source/dest with one other source operand, stack pointer relative</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uimm[3]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">uimm[2:0]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LBUSP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uimm[3]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rd'</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">uimm[2:1，4]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">01</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LHUSP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uimm[3]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs2'</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">uimm[2:0]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SBSP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uimm[3]</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs2'</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">uimm[2:1，4]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SHSP</p></td>
</tr>
</tbody>
</table>
<table id="ldstbhsprel-semantics" class="tableblock frame-all grid-all stretch data-line-2962">
<caption class="title">Table 66. Rejected load/store byte/half SP relative semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LBUSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = zero_ext(DataMemory[sp + zero_ext(uimm)][ 7:0])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LHUSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = zero_ext(DataMemory[sp + zero_ext(uimm)][15:0])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SBSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DataMemory[sp + zero_ext(uimm)][ 7:0] = rs2'[ 7:0]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SHSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DataMemory[sp + zero_ext(uimm)][15:0] = rs2'[15:0]</p></td>
</tr>
</tbody>
</table>
<table id="ldstbh_sprel_32bit" class="tableblock frame-all grid-all stretch data-line-2973">
<caption class="title">Table 67. load/store byte/half SP relative assembler syntax and 32-bit equivalent instructions</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">assembler syntax</th>
<th class="tableblock halign-left valign-top">requirements for 16-bit encoding</th>
<th class="tableblock halign-left valign-top">32-bit extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LBUSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lbu    rd, imm(sp)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd is x8-x15, imm is in range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-extension</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LHUSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lhu    rd, imm(sp)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd is x8-x15, imm is in range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-extension</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SBSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sb     rd, imm(sp)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd is x8-x15, imm is in range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-extension</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.SHSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sh     rd, imm(sp)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd is x8-x15, imm is in range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-extension</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-2981">
<p>Assembly Examples</p>
</div>
<div class="listingblock data-line-2984">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">lbu a5,20(sp)   # a5 = zero_ext(Memory(sp+20)[ 7:0])
lhu a5,20(sp)   # a5 = zero_ext(Memory(sp+20)[15:0])
sb  a5,20(sp)   # Memory(sp+20)[ 7:0] = a5[ 7:0]
sh  a5,20(sp)   # Memory(sp+20)[15:0] = a5[15:0]</code></pre>
</div>
</div>
</div>
<div class="sect2 data-line-2991">
<h3 id="_c_lsbnot_c_lsbset">2.6. C.LSBNOT / C.LSBSET</h3>
<div class="paragraph data-line-2993">
<p>The encodings are cheap, but the benefit is low.</p>
</div>
<table id="dyadic-16encodings" class="tableblock frame-all grid-all stretch data-line-2998">
<caption class="title">Table 68. simple instructions 16-bit encodings</caption>
<colgroup>
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8832%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs1'/rd'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">110</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LSBNOT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">rs1'/rd'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">111</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LSBSET</p></td>
</tr>
</tbody>
</table>
<table id="monsemantics" class="tableblock frame-all grid-all stretch data-line-3007">
<caption class="title">Table 69. simple instruction semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LSBNOT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = rd' XOR 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LSBSET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd' = rd' OR 1</p></td>
</tr>
</tbody>
</table>
<table id="mon-32bit" class="tableblock frame-all grid-all stretch data-line-3016">
<caption class="title">Table 70. simple instruction 32-bit equivalent instructions/pseudo-instructions</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">assembler syntax</th>
<th class="tableblock halign-left valign-top">requirements for 16-bit encoding</th>
<th class="tableblock halign-left valign-top">32-bit extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LSBNOT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lsbnot rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all registers x8-x15, rd==rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-extension</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.LSBKEEP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lsbset rd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all registers x8-x15, rd==rs1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-extension</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-3023">
<p>Assembly Examples</p>
</div>
<div class="listingblock data-line-3026">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode">lsbnot a5;      # a5 = a5 XOR 1</code></pre>
</div>
</div>
</div>
</div>
</div>
<h1 id="_future_ideas" class="sect0 data-line-3031">Future ideas</h1>
<div class="sect1 data-line-3033">
<h2 id="_multiple_move_instructions">1. Multiple move instructions</h2>
<div class="sectionbody">
<div class="paragraph data-line-3035">
<p>These instructions have some problems:</p>
</div>
<div class="olist arabic data-line-3037">
<ol class="arabic">
<li class="data-line-3037">
<p>They either two register file write ports, or to be issued in a sequence.</p>
</li>
<li class="data-line-3038">
<p>C.MVA* use ABI names when specifying source registers, which is efficient but non-standard</p>
</li>
<li class="data-line-3039">
<p>There is no 32-bit encoding which makes sense, because each does the work of 2 x 16-bit encodings</p>
</li>
</ol>
</div>
<div class="paragraph data-line-3041">
<p>Therefore ratification is delayed, and some more thought is needed.</p>
</div>
<div class="sect2 data-line-3043">
<h3 id="_c_mvp">1.1. C.MVP</h3>
<div class="paragraph data-line-3045">
<p>The generic move uses standard x register numbers, and so it more standard than <code>C.MVA*S07</code>, however it takes a lot more encoding space. Both register pairs must be even/odd pairs (<code>rdp[0]=0, rsp[0]=0</code>) to reduce the encoding space requirement.</p>
</div>
<div class="admonitionblock note data-line-3049">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  Currently there are no 32-bit equivalent instructions, is it enough to expand to <strong>two</strong> 32-bit instructions?
</td>
</tr>
</table>
</div>
<div class="admonitionblock note data-line-3053">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  These are optional (<code>Zces</code>) as they require 2 register file write ports, or are sequenced.
</td>
</tr>
</table>
</div>
<table id="mvp-encoding" class="tableblock frame-all grid-all stretch data-line-3058">
<caption class="title">Table 71. generic double move 16-bit encoding</caption>
<colgroup>
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8832%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">rdp[4:1]</p></td>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">rsp[4:1]</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MVP</p></td>
</tr>
</tbody>
</table>
<table id="mvp-semantics" class="tableblock frame-all grid-all stretch data-line-3066">
<caption class="title">Table 72. generic double move semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MVP rdp, rsp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mv rdp, rsp;  mv rdp+1, rsp+1</p></td>
</tr>
</tbody>
</table>
<table id="mvp-syntax" class="tableblock frame-all grid-all stretch data-line-3074">
<caption class="title">Table 73. <code>C.MVP</code> assembler syntax</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">assembler syntax</th>
<th class="tableblock halign-left valign-top">requirements for 16-bit encoding</th>
<th class="tableblock halign-left valign-top">32-bit extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MVP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mv(rdp,rsp),(rdp+1,rsp+1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note data-line-3081">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
  Currently there are no 32-bit equivalent instructions, is it enough to expand to <strong>two</strong> 32-bit instructions?
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-3083">
<p>Assembly examples.</p>
</div>
<div class="listingblock data-line-3085">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode"># c.mvp: sreg1 = 0; sreg2 = 0;
mv (x2, x3), (x18, x19) ; # mv x2, x2; mv x18, x19</code></pre>
</div>
</div>
</div>
<div class="sect2 data-line-3090">
<h3 id="_c_mva23s07">1.2. C.MVA23S07</h3>
<div class="paragraph data-line-3092">
<p>Similar to C.MVA01S07 but the benefit is much lower.</p>
</div>
<table id="proposed-16bit-encodings-4" class="tableblock frame-all grid-all stretch data-line-3097">
<caption class="title">Table 74. <code>C.MVA01S07, C.MVA23S07</code> 16-bit encoding</caption>
<colgroup>
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8832%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
<th class="tableblock halign-left valign-top">instruction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">001</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">sreg1</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">sreg2</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MVA23S07</p></td>
</tr>
</tbody>
</table>
<table id="mvs07_semantics" class="tableblock frame-all grid-all stretch data-line-3105">
<caption class="title">Table 75. <code>C.MVA01S07, C.MVA23S07</code> semantics</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MVA23S07 sreg1, sreg2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mv a2, s[sreg1];  mv a3, s[sreg2]</p></td>
</tr>
</tbody>
</table>
<table id="mvs07_syntax" class="tableblock frame-all grid-all stretch data-line-3113">
<caption class="title">Table 76. <code>C.MVA01S07, C.MVA23S07</code> assembler syntax</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">instruction</th>
<th class="tableblock halign-left valign-top">assembler syntax</th>
<th class="tableblock halign-left valign-top">requirements for 16-bit encoding</th>
<th class="tableblock halign-left valign-top">32-bit extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C.MVAS23S07</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mv(a2,a3),(sreg1,sreg2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-3118">
<p>Assembly examples.</p>
</div>
<div class="listingblock data-line-3120">
<div class="content">
<pre class="highlight"><code class="language-sourceCode" data-lang="sourceCode"># c.mva23s: sreg1 = 1; sreg2 = 3;
mv (a2, a3), (s1, s3) ; # mv a2, s1; mv a3, s3</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-05-13 12:14:36 +0100
</div>
</div>
</body>
</html>